<!DOCTYPE html><html lang="en"><head><meta http-equiv="Content-Security-Policy" content="default-src 'self' 'unsafe-inline' 'unsafe-eval' data: blob: https://cdnjs.cloudflare.com https://cdn.jsdelivr.net https://code.jquery.com https://unpkg.com https://d3js.org https://threejs.org https://cdn.plot.ly https://stackpath.bootstrapcdn.com https://maps.googleapis.com https://cdn.tailwindcss.com https://ajax.googleapis.com https://kit.fontawesome.com https://cdn.datatables.net https://maxcdn.bootstrapcdn.com https://code.highcharts.com https://tako-static-assets-production.s3.amazonaws.com https://www.youtube.com https://fonts.googleapis.com https://fonts.gstatic.com https://pfst.cf2.poecdn.net https://puc.poecdn.net https://i.imgur.com https://wikimedia.org https://*.icons8.com https://*.giphy.com https://picsum.photos https://images.unsplash.com; frame-src 'self' https://www.youtube.com https://trytako.com; child-src 'self'; manifest-src 'self'; worker-src 'self'; upgrade-insecure-requests; block-all-mixed-content;">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>To-Do App</title>
    
    <!-- CDN Libraries -->
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&amp;display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/themes/material_blue.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    
    <style>
        :root {
            --primary-color: #5D5CDE;
            --primary-hover: #4a49c0;
            --success-color: #28A745;
            --success-hover: #218838;
            --warning-color: #FFC107;
            --warning-hover: #e0a800;
            --danger-color: #DC3545;
            --danger-hover: #c82333;
            --secondary-color: #6C757D;
            --secondary-hover: #5a6268;
            --dark-blue: #00008B;
            --orange: #FD7E14;
            --light-color: #F8F9FA;
            --dark-color: #343A40;
            --border-color: #DEE2E6;
            --text-color: #212529;
            --bg-color: #FFFFFF;
            --card-bg: #FFFFFF;
            --header-bg: #FFFFFF;
            --transition: all 0.3s ease;
            --shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            --hover-shadow: 0 8px 16px rgba(0, 0, 0, 0.15);
            --border-radius: 8px;
            --popup-bg: #FFFFFF;
            --popup-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
        }

        .dark {
            --primary-color: #6465e4;
            --primary-hover: #5353d9;
            --success-color: #2ebd4e;
            --success-hover: #28a745;
            --warning-color: #ffca2c;
            --warning-hover: #ffc107;
            --danger-color: #e84c5d;
            --danger-hover: #dc3545;
            --secondary-color: #7d8693;
            --secondary-hover: #6c757d;
            --text-color: #f8f9fa;
            --bg-color: #181818;
            --card-bg: #242526;
            --header-bg: #242526;
            --border-color: #4e4e4e;
            --popup-bg: #242526;
            --popup-shadow: 0 10px 25px rgba(0, 0, 0, 0.5);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Poppins', sans-serif;
            transition: var(--transition);
        }

        body {
            background-color: var(--bg-color);
            color: var(--text-color);
            min-height: 100vh;
            overflow-x: hidden;
        }

        /* Loader */
        .loader-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: flex;
            justify-content: center;
            align-items: center;
            background-color: var(--bg-color);
            z-index: 9999;
            opacity: 1;
            visibility: visible;
            transition: opacity 0.5s, visibility 0.5s;
        }

        .loader {
            width: 50px;
            height: 50px;
            border: 5px solid var(--border-color);
            border-top: 5px solid var(--primary-color);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .hidden {
            opacity: 0;
            visibility: hidden;
        }

        /* Login Page */
        #login-page {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            padding: 20px;
            background: linear-gradient(135deg, var(--bg-color), var(--border-color));
        }

        .login-container {
            background-color: var(--card-bg);
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            width: 100%;
            max-width: 400px;
            padding: 30px;
            text-align: center;
            animation: fadeIn 0.5s ease;
        }

        @keyframes fadeIn {
            0% { opacity: 0; transform: translateY(-20px); }
            100% { opacity: 1; transform: translateY(0); }
        }

        .login-title {
            font-size: 28px;
            font-weight: 600;
            margin-bottom: 25px;
            color: var(--primary-color);
        }

        .input-group {
            margin-bottom: 20px;
            text-align: left;
        }

        .input-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
        }

        .input-field {
            width: 100%;
            padding: 12px 15px;
            font-size: 16px;
            border: 1px solid var(--border-color);
            border-radius: var(--border-radius);
            background-color: var(--bg-color);
            color: var(--text-color);
        }

        .input-field:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 2px rgba(93, 92, 222, 0.2);
        }

        .login-btn {
            position: relative;
            width: 100%;
            max-width: 200px;
            margin: 0 auto;
            padding: 12px 0;
            font-size: 16px;
            font-weight: 500;
            background-color: var(--primary-color);
            color: white;
            border: none;
            border-radius: var(--border-radius);
            cursor: pointer;
            overflow: hidden;
            transform: translateZ(0);
        }

        .login-btn:hover {
            background-color: var(--primary-hover);
        }

        .login-btn::before {
            content: '';
            position: absolute;
            top: -2px;
            left: -2px;
            right: -2px;
            bottom: -2px;
            background: linear-gradient(45deg, 
                #ff0000, #ff7300, #fffb00, #48ff00, 
                #00ffd5, #002bff, #7a00ff, #ff00c8, 
                #ff0000);
            z-index: -1;
            animation: glowing 20s linear infinite;
            background-size: 400%;
            border-radius: calc(var(--border-radius) + 2px);
            opacity: 0;
            transition: opacity 0.3s;
        }

        .login-btn:hover::before {
            opacity: 1;
        }

        @keyframes glowing {
            0% { background-position: 0 0; }
            50% { background-position: 400% 0; }
            100% { background-position: 0 0; }
        }

        .register-link {
            margin-top: 20px;
            font-size: 14px;
        }

        .register-link a {
            color: var(--dark-blue);
            font-weight: 500;
            text-decoration: none;
            transition: all 0.2s;
        }

        .register-link a:hover {
            text-decoration: underline;
        }

        /* Dashboard */
        #dashboard {
            display: none;
            min-height: 100vh;
            padding-bottom: 50px;
        }

        .header {
            background-color: var(--header-bg);
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            padding: 15px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .app-title {
            font-size: 24px;
            font-weight: 700;
            color: var(--primary-color);
            text-decoration: none;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .header-right {
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .task-timer {
            background-color: var(--card-bg);
            border: 1px solid var(--border-color);
            border-radius: var(--border-radius);
            padding: 8px 12px;
            display: flex;
            align-items: center;
            gap: 10px;
            box-shadow: var(--shadow);
        }

        .timer-display {
            font-size: 18px;
            font-weight: 600;
            min-width: 80px;
            text-align: center;
        }

        .timer-btn {
            background: none;
            border: none;
            font-size: 16px;
            cursor: pointer;
            color: var(--text-color);
        }

        .mode-switcher {
            background: none;
            border: none;
            font-size: 20px;
            cursor: pointer;
            color: var(--text-color);
        }

        .user-profile {
            position: relative;
        }

        .profile-img {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            cursor: pointer;
            box-shadow: 0 0 0 2px var(--primary-color);
            object-fit: cover;
        }

        .online-indicator {
            position: absolute;
            bottom: 0;
            right: 0;
            width: 12px;
            height: 12px;
            background-color: var(--success-color);
            border-radius: 50%;
            border: 2px solid var(--header-bg);
        }

        .notification-badge {
            position: absolute;
            top: -5px;
            right: -5px;
            background-color: var(--danger-color);
            color: white;
            font-size: 10px;
            min-width: 18px;
            height: 18px;
            border-radius: 10px;
            display: flex;
            justify-content: center;
            align-items: center;
            font-weight: 600;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
        }

        .status-selector {
            position: relative;
            margin-right: 15px;
        }

        .status-btn {
            background-color: var(--card-bg);
            border: 1px solid var(--border-color);
            border-radius: var(--border-radius);
            padding: 8px 15px;
            font-size: 14px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
            color: var(--text-color);
        }

        .status-dropdown {
            position: absolute;
            top: 100%;
            right: 0;
            background-color: var(--card-bg);
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            width: 150px;
            border: 1px solid var(--border-color);
            z-index: 1000;
            display: none;
        }

        .status-dropdown.show {
            display: block;
            animation: fadeDown 0.3s ease;
        }

        .status-option {
            padding: 10px 15px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .status-option:hover {
            background-color: rgba(93, 92, 222, 0.1);
        }

        .status-option:first-child {
            border-radius: var(--border-radius) var(--border-radius) 0 0;
        }

        .status-option:last-child {
            border-radius: 0 0 var(--border-radius) var(--border-radius);
        }

        .dropdown-content {
            position: absolute;
            top: 100%;
            right: 0;
            background-color: var(--card-bg);
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            width: 200px;
            border: 1px solid var(--border-color);
            z-index: 1000;
            display: none;
        }

        .dropdown-content.show {
            display: block;
            animation: fadeDown 0.3s ease;
        }

        @keyframes fadeDown {
            0% { opacity: 0; transform: translateY(-10px); }
            100% { opacity: 1; transform: translateY(0); }
        }

        .dropdown-item {
            padding: 12px 15px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 10px;
            color: var(--text-color);
        }

        .dropdown-item:hover {
            background-color: rgba(93, 92, 222, 0.1);
        }

        .dropdown-item:first-child {
            border-radius: var(--border-radius) var(--border-radius) 0 0;
        }

        .dropdown-item:last-child {
            border-radius: 0 0 var(--border-radius) var(--border-radius);
        }

        /* Content Container */
        .content-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        /* Summary Section */
        .summary-section {
            margin-bottom: 30px;
        }

        .total-tasks {
            background-color: var(--card-bg);
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            padding: 20px;
            margin-bottom: 20px;
            border: 2px solid var(--dark-color);
            animation: fadeIn 0.5s ease;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .total-tasks-title {
            font-size: 20px;
            font-weight: 600;
        }

        .total-tasks-count {
            font-size: 32px;
            font-weight: 700;
            color: var(--primary-color);
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .task-status-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
        }

        .status-card {
            border-radius: var(--border-radius);
            padding: 20px;
            box-shadow: var(--shadow);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            animation: fadeIn 0.5s ease;
        }

        .status-card:hover {
            transform: translateY(-5px);
            box-shadow: var(--hover-shadow);
        }

        .status-card-title {
            font-size: 18px;
            font-weight: 500;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .status-card-count {
            font-size: 28px;
            font-weight: 700;
        }

        .completed-card {
            background-color: rgba(40, 167, 69, 0.1);
            border: 1px solid var(--success-color);
        }

        .completed-card .status-card-count {
            color: var(--success-color);
        }

        .pending-card {
            background-color: rgba(255, 193, 7, 0.1);
            border: 1px solid var(--warning-color);
        }

        .pending-card .status-card-count {
            color: var(--warning-color);
        }

        /* Tasks Section */
        .tasks-section {
            background-color: var(--card-bg);
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            padding: 20px;
            margin-bottom: 30px;
        }

        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            flex-wrap: wrap;
            gap: 15px;
        }

        .section-title {
            font-size: 22px;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .action-buttons {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .view-toggle {
            display: flex;
            align-items: center;
            background-color: var(--bg-color);
            border-radius: var(--border-radius);
            border: 1px solid var(--border-color);
            overflow: hidden;
            margin-left: auto;
        }

        .view-btn {
            background: none;
            border: none;
            padding: 8px 15px;
            cursor: pointer;
            font-size: 14px;
            transition: background-color 0.3s ease;
            display: flex;
            align-items: center;
            gap: 5px;
            color: var(--text-color);
        }

        .view-btn.active {
            background-color: var(--primary-color);
            color: white;
        }

        .add-task-btn, .export-btn, .import-btn, .category-btn {
            padding: 8px 16px;
            border-radius: var(--border-radius);
            border: none;
            font-weight: 500;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: all 0.2s ease;
            font-size: 14px;
        }

        .add-task-btn {
            background-color: var(--success-color);
            color: white;
        }

        .add-task-btn:hover {
            background-color: var(--success-hover);
            transform: translateY(-2px);
            box-shadow: 0 3px 6px rgba(0, 0, 0, 0.15);
        }

        .export-btn {
            background-color: var(--primary-color);
            color: white;
        }

        .export-btn:hover {
            background-color: var(--primary-hover);
            transform: translateY(-2px);
            box-shadow: 0 3px 6px rgba(0, 0, 0, 0.15);
        }

        .import-btn {
            background-color: var(--orange);
            color: white;
        }

        .import-btn:hover {
            background-color: #e67300;
            transform: translateY(-2px);
            box-shadow: 0 3px 6px rgba(0, 0, 0, 0.15);
        }

        .category-btn {
            background-color: var(--secondary-color);
            color: white;
        }

        .category-btn:hover {
            background-color: var(--secondary-hover);
            transform: translateY(-2px);
            box-shadow: 0 3px 6px rgba(0, 0, 0, 0.15);
        }

        /* Filters */
        .filters-row {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
            flex-wrap: wrap;
            align-items: center;
        }

        .filter-group {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .filter-label {
            font-weight: 500;
            font-size: 14px;
        }

        .filter-select, .sort-select {
            padding: 8px 12px;
            border-radius: var(--border-radius);
            border: 1px solid var(--border-color);
            background-color: var(--bg-color);
            color: var(--text-color);
            font-size: 14px;
            min-width: 120px;
        }

        .search-box {
            flex-grow: 1;
            max-width: 300px;
            position: relative;
        }

        .search-input {
            width: 100%;
            padding: 8px 12px 8px 35px;
            border-radius: var(--border-radius);
            border: 1px solid var(--border-color);
            background-color: var(--bg-color);
            color: var(--text-color);
            font-size: 14px;
        }

        .search-icon {
            position: absolute;
            left: 10px;
            top: 50%;
            transform: translateY(-50%);
            color: var(--secondary-color);
            font-size: 14px;
        }

        .action-history {
            display: flex;
            gap: 8px;
            margin-left: auto;
        }

        .undo-btn, .redo-btn {
            background: none;
            border: none;
            cursor: pointer;
            font-size: 16px;
            color: var(--text-color);
            display: flex;
            align-items: center;
            justify-content: center;
            width: 32px;
            height: 32px;
            border-radius: 50%;
            transition: all 0.2s ease;
        }

        .undo-btn:hover, .redo-btn:hover {
            background-color: rgba(93, 92, 222, 0.1);
        }

        .undo-btn:disabled, .redo-btn:disabled {
            color: var(--secondary-color);
            cursor: not-allowed;
        }

        /* Task List */
        .task-list {
            margin-top: 20px;
        }

        .task-item {
            background-color: var(--bg-color);
            border-radius: var(--border-radius);
            border: 1px solid var(--border-color);
            padding: 15px;
            margin-bottom: 15px;
            box-shadow: var(--shadow);
            transition: transform 0.2s ease, box-shadow 0.2s ease;
            animation: fadeIn 0.5s ease;
            display: flex;
            flex-wrap: wrap;
        }

        .task-item:hover {
            transform: translateY(-3px);
            box-shadow: var(--hover-shadow);
        }

        .task-item.expired {
            border-left: 4px solid var(--danger-color);
        }

        .task-item.due-soon {
            border-left: 4px solid var(--warning-color);
        }

        .task-item.due-later {
            border-left: 4px solid var(--success-color);
        }

        .task-item.dragging {
            opacity: 0.5;
            transform: scale(0.98);
        }

        .task-checkbox {
            flex: 0 0 auto;
            margin-right: 15px;
            display: flex;
            align-items: center;
        }

        .task-checkbox input[type="checkbox"] {
            width: 20px;
            height: 20px;
            cursor: pointer;
        }

        .task-content {
            flex-grow: 1;
            padding-right: 15px;
        }

        .task-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 8px;
            flex-wrap: wrap;
            gap: 10px;
        }

        .task-title {
            font-size: 16px;
            font-weight: 600;
            margin-right: auto;
        }

        .task-item.completed .task-title {
            text-decoration: line-through;
            color: var(--secondary-color);
        }

        .task-meta {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-bottom: 8px;
        }

        .task-due-date, .task-priority, .task-category {
            display: flex;
            align-items: center;
            gap: 5px;
            font-size: 12px;
            padding: 3px 8px;
            border-radius: 12px;
            background-color: var(--card-bg);
        }

        .task-due-date {
            color: var(--text-color);
        }

        .task-priority.high {
            background-color: rgba(220, 53, 69, 0.1);
            color: var(--danger-color);
        }

        .task-priority.medium {
            background-color: rgba(253, 126, 20, 0.1);
            color: var(--orange);
        }

        .task-priority.low {
            background-color: rgba(108, 117, 125, 0.1);
            color: var(--secondary-color);
        }

        .task-category {
            background-color: rgba(93, 92, 222, 0.1);
            color: var(--primary-color);
        }

        .task-description {
            font-size: 14px;
            margin-bottom: 10px;
            color: var(--text-color);
            word-break: break-word;
        }

        .subtasks {
            margin-top: 8px;
            padding-left: 15px;
        }

        .subtask-item {
            font-size: 13px;
            margin-bottom: 3px;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .task-actions {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-top: 10px;
        }

        .task-time {
            display: flex;
            align-items: center;
            gap: 5px;
            font-size: 12px;
            margin-right: auto;
            color: var(--secondary-color);
        }

        .action-btn {
            border: none;
            background: none;
            cursor: pointer;
            font-size: 14px;
            padding: 5px 10px;
            border-radius: var(--border-radius);
            display: flex;
            align-items: center;
            gap: 5px;
            transition: background-color 0.2s ease;
            color: var(--text-color);
        }

        .action-btn:hover {
            background-color: rgba(93, 92, 222, 0.1);
        }

        .view-btn-task {
            color: var(--primary-color);
        }

        .edit-btn {
            color: var(--warning-color);
        }

        .delete-btn {
            color: var(--danger-color);
        }

        .timer-btn-task {
            color: var(--success-color);
        }

        .share-btn {
            color: var(--dark-blue);
        }

        .complete-btn {
            color: var(--success-color);
        }

        /* Multi-select Action Bar */
        .multi-action-bar {
            position: fixed;
            bottom: 0;
            left: 0;
            width: 100%;
            background: linear-gradient(135deg, var(--primary-color), var(--primary-hover));
            color: white;
            padding: 15px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transform: translateY(100%);
            transition: transform 0.3s ease;
            z-index: 900;
            box-shadow: 0 -2px 10px rgba(0, 0, 0, 0.2);
        }

        .multi-action-bar.show {
            transform: translateY(0);
        }

        .selected-count {
            font-weight: 500;
        }

        .multi-actions {
            display: flex;
            gap: 15px;
        }

        .multi-action-btn {
            padding: 8px 16px;
            border-radius: var(--border-radius);
            border: none;
            font-weight: 500;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 14px;
            transition: all 0.2s ease;
        }

        .multi-delete-btn {
            background-color: var(--danger-color);
            color: white;
        }

        .multi-delete-btn:hover {
            background-color: var(--danger-hover);
        }

        .multi-complete-btn {
            background-color: var(--success-color);
            color: white;
        }

        .multi-complete-btn:hover {
            background-color: var(--success-hover);
        }

        .multi-cancel-btn {
            background-color: var(--secondary-color);
            color: white;
        }

        .multi-cancel-btn:hover {
            background-color: var(--secondary-hover);
        }

        /* Graph View */
        .graph-view {
            display: none;
            background-color: var(--card-bg);
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            padding: 20px;
            margin-bottom: 30px;
        }

        .graphs-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-top: 20px;
        }

        @media (max-width: 768px) {
            .graphs-container {
                grid-template-columns: 1fr;
            }
        }

        .graph-card {
            background-color: var(--bg-color);
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            padding: 20px;
            height: 100%;
        }

        .graph-title {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 15px;
            text-align: center;
        }

        .chart-container {
            position: relative;
            height: 300px;
            max-width: 100%;
        }

        /* Insights Section */
        .insights-section {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .insight-card {
            background-color: var(--card-bg);
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            padding: 20px;
            animation: fadeIn 0.5s ease;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }

        .insight-card:hover {
            transform: translateY(-5px);
            box-shadow: var(--hover-shadow);
        }

        .insight-title {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .insight-content {
            color: var(--text-color);
        }

        .insight-value {
            font-size: 24px;
            font-weight: 700;
            color: var(--primary-color);
            margin-bottom: 5px;
        }

        .insight-description {
            font-size: 14px;
            color: var(--secondary-color);
        }

        .insight-list {
            margin-top: 10px;
        }

        .insight-item {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
            border-bottom: 1px solid var(--border-color);
        }

        .insight-item:last-child {
            border-bottom: none;
        }

        .insight-label {
            font-weight: 500;
        }

        .insight-number {
            font-weight: 600;
            color: var(--primary-color);
        }

        /* Notifications */
        .notification-dropdown {
            position: absolute;
            top: 100%;
            right: 0;
            background-color: var(--card-bg);
            border-radius: var(--border-radius);
            box-shadow: var(--popup-shadow);
            width: 300px;
            max-height: 400px;
            overflow-y: auto;
            z-index: 1000;
            display: none;
            border: 1px solid var(--border-color);
        }

        .notification-dropdown.show {
            display: block;
            animation: fadeDown 0.3s ease;
        }

        .notification-header {
            padding: 15px;
            border-bottom: 1px solid var(--border-color);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .notification-title {
            font-weight: 600;
            font-size: 16px;
        }

        .mark-all-read {
            font-size: 12px;
            color: var(--primary-color);
            background: none;
            border: none;
            cursor: pointer;
            font-weight: 500;
        }

        .notification-item {
            padding: 12px 15px;
            border-bottom: 1px solid var(--border-color);
            cursor: pointer;
            transition: background-color 0.2s ease;
            display: flex;
            gap: 10px;
            align-items: flex-start;
        }

        .notification-item:last-child {
            border-bottom: none;
        }

        .notification-item:hover {
            background-color: rgba(93, 92, 222, 0.05);
        }

        .notification-item.unread {
            background-color: rgba(93, 92, 222, 0.1);
        }

        .notification-icon {
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            background-color: rgba(93, 92, 222, 0.1);
            border-radius: 50%;
            flex-shrink: 0;
        }

        .notification-body {
            flex-grow: 1;
        }

        .notification-message {
            font-size: 13px;
            margin-bottom: 3px;
        }

        .notification-time {
            font-size: 11px;
            color: var(--secondary-color);
        }

        .notification-dot {
            width: 8px;
            height: 8px;
            background-color: var(--primary-color);
            border-radius: 50%;
            margin-top: 6px;
            margin-left: auto;
        }

        .empty-notifications {
            padding: 30px 15px;
            text-align: center;
            color: var(--secondary-color);
            font-size: 14px;
        }

        /* Toast Notifications */
        .toast-container {
            position: fixed;
            bottom: 20px;
            left: 20px;
            z-index: 1000;
            display: flex;
            flex-direction: column;
            gap: 10px;
            max-width: 300px;
        }

        .toast {
            background-color: var(--card-bg);
            color: var(--text-color);
            border-radius: var(--border-radius);
            padding: 12px 15px;
            box-shadow: var(--shadow);
            display: flex;
            align-items: center;
            gap: 10px;
            animation: slideIn 0.3s ease, fadeOut 0.3s ease 4.7s;
            border-left: 4px solid var(--primary-color);
        }

        .toast.success {
            border-left-color: var(--success-color);
        }

        .toast.warning {
            border-left-color: var(--warning-color);
        }

        .toast.error {
            border-left-color: var(--danger-color);
        }

        @keyframes slideIn {
            0% { transform: translateX(-100%); opacity: 0; }
            100% { transform: translateX(0); opacity: 1; }
        }

        @keyframes fadeOut {
            0% { opacity: 1; }
            100% { opacity: 0; }
        }

        .toast-icon {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 24px;
            height: 24px;
            border-radius: 50%;
            flex-shrink: 0;
        }

        .toast-content {
            flex-grow: 1;
        }

        .toast-message {
            font-size: 14px;
            margin-bottom: 2px;
        }

        .toast-close {
            background: none;
            border: none;
            cursor: pointer;
            font-size: 14px;
            color: var(--secondary-color);
            display: flex;
            align-items: center;
            justify-content: center;
            width: 24px;
            height: 24px;
            border-radius: 50%;
            transition: background-color 0.2s ease;
        }

        .toast-close:hover {
            background-color: rgba(108, 117, 125, 0.1);
        }

        /* Popup Styles */
        .popup-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s ease, visibility 0.3s ease;
        }

        .popup-overlay.show {
            opacity: 1;
            visibility: visible;
        }

        .popup {
            background-color: var(--popup-bg);
            border-radius: var(--border-radius);
            box-shadow: var(--popup-shadow);
            width: 90%;
            max-width: 500px;
            max-height: 90vh;
            overflow-y: auto;
            transform: translateY(20px);
            opacity: 0;
            transition: transform 0.3s ease, opacity 0.3s ease;
        }

        .popup.show {
            transform: translateY(0);
            opacity: 1;
        }

        .popup-header {
            padding: 15px 20px;
            border-bottom: 1px solid var(--border-color);
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: sticky;
            top: 0;
            background-color: var(--popup-bg);
            z-index: 1;
        }

        .popup-title {
            font-size: 18px;
            font-weight: 600;
        }

        .popup-close {
            background: none;
            border: none;
            cursor: pointer;
            font-size: 20px;
            color: var(--secondary-color);
            display: flex;
            align-items: center;
            justify-content: center;
            width: 32px;
            height: 32px;
            border-radius: 50%;
            transition: background-color 0.2s ease;
        }

        .popup-close:hover {
            background-color: rgba(108, 117, 125, 0.1);
        }

        .popup-body {
            padding: 20px;
        }

        .popup-footer {
            padding: 15px 20px;
            border-top: 1px solid var(--border-color);
            display: flex;
            justify-content: flex-end;
            gap: 10px;
            position: sticky;
            bottom: 0;
            background-color: var(--popup-bg);
        }

        .popup-btn {
            padding: 8px 16px;
            border-radius: var(--border-radius);
            border: none;
            font-weight: 500;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.2s ease;
        }

        .popup-btn.primary {
            background-color: var(--primary-color);
            color: white;
        }

        .popup-btn.primary:hover {
            background-color: var(--primary-hover);
        }

        .popup-btn.success {
            background-color: var(--success-color);
            color: white;
        }

        .popup-btn.success:hover {
            background-color: var(--success-hover);
        }

        .popup-btn.secondary {
            background-color: var(--secondary-color);
            color: white;
        }

        .popup-btn.secondary:hover {
            background-color: var(--secondary-hover);
        }

        .popup-btn.danger {
            background-color: var(--danger-color);
            color: white;
        }

        .popup-btn.danger:hover {
            background-color: var(--danger-hover);
        }

        /* Form Groups */
        .form-group {
            margin-bottom: 15px;
        }

        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: 500;
            font-size: 14px;
        }

        .form-control {
            width: 100%;
            padding: 10px 12px;
            border-radius: var(--border-radius);
            border: 1px solid var(--border-color);
            background-color: var(--bg-color);
            color: var(--text-color);
            font-size: 16px;
        }

        .form-control:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 2px rgba(93, 92, 222, 0.2);
        }

        .form-error {
            color: var(--danger-color);
            font-size: 12px;
            margin-top: 4px;
        }

        /* Subtasks */
        .subtasks-container {
            margin-top: 10px;
        }

        .subtask-form {
            display: flex;
            gap: 10px;
            margin-bottom: 10px;
        }

        .subtask-form input {
            flex-grow: 1;
        }

        .subtask-form button {
            flex-shrink: 0;
            width: 36px;
            height: 36px;
            display: flex;
            align-items: center;
            justify-content: center;
            background-color: var(--danger-color);
            color: white;
            border: none;
            border-radius: var(--border-radius);
            cursor: pointer;
        }

        .add-subtask-btn {
            display: flex;
            align-items: center;
            gap: 5px;
            background: none;
            border: 1px dashed var(--border-color);
            border-radius: var(--border-radius);
            padding: 8px 15px;
            width: 100%;
            color: var(--primary-color);
            font-weight: 500;
            cursor: pointer;
            transition: background-color 0.2s ease;
        }

        .add-subtask-btn:hover {
            background-color: rgba(93, 92, 222, 0.05);
        }

        /* Users Popup */
        .users-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 20px;
            margin-top: 15px;
        }

        .user-card {
            background-color: var(--bg-color);
            border-radius: var(--border-radius);
            border: 1px solid var(--border-color);
            padding: 15px;
            box-shadow: var(--shadow);
            transition: transform 0.2s ease, box-shadow 0.2s ease;
            text-align: center;
        }

        .user-card:hover {
            transform: translateY(-5px);
            box-shadow: var(--hover-shadow);
        }

        .user-avatar {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            margin: 0 auto 10px;
            object-fit: cover;
            border: 3px solid var(--primary-color);
        }

        .user-name {
            font-size: 16px;
            font-weight: 600;
            margin-bottom: 5px;
        }

        .user-email {
            font-size: 14px;
            color: var(--secondary-color);
            margin-bottom: 8px;
            word-break: break-all;
        }

        .user-role {
            display: inline-block;
            padding: 3px 10px;
            background-color: rgba(93, 92, 222, 0.1);
            color: var(--primary-color);
            border-radius: 12px;
            font-size: 12px;
            font-weight: 500;
        }
        
        /* Profile Popup */
        .profile-container {
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .profile-picture-container {
            position: relative;
            margin-bottom: 20px;
        }

        .large-profile-picture {
            width: 120px;
            height: 120px;
            border-radius: 50%;
            object-fit: cover;
            border: 3px solid var(--primary-color);
        }

        .edit-picture-btn {
            position: absolute;
            bottom: 0;
            right: 0;
            width: 32px;
            height: 32px;
            background-color: var(--primary-color);
            color: white;
            border: none;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
        }

        .profile-picture-input {
            display: none;
        }

        .profile-detail {
            display: flex;
            flex-direction: column;
            width: 100%;
            margin-bottom: 15px;
        }

        .profile-label {
            font-size: 12px;
            color: var(--secondary-color);
            margin-bottom: 3px;
        }

        .profile-value {
            font-size: 16px;
            padding: 5px 0;
            border-bottom: 1px solid var(--border-color);
        }

        .profile-value input, .profile-value select {
            width: 100%;
            padding: 8px 10px;
            border-radius: var(--border-radius);
            border: 1px solid var(--border-color);
            background-color: var(--bg-color);
            color: var(--text-color);
            font-size: 16px;
        }

        /* Export Popup */
        .export-options {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
        }

        .export-option {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 15px;
            border-radius: var(--border-radius);
            border: 1px solid var(--border-color);
            cursor: pointer;
            transition: border-color 0.2s ease, background-color 0.2s ease;
        }

        .export-option:hover {
            background-color: rgba(93, 92, 222, 0.05);
            border-color: var(--primary-color);
        }

        .export-option.selected {
            background-color: rgba(93, 92, 222, 0.1);
            border-color: var(--primary-color);
        }

        .export-icon {
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            background-color: rgba(93, 92, 222, 0.1);
            border-radius: 50%;
            font-size: 18px;
            color: var(--primary-color);
        }

        .export-info {
            flex-grow: 1;
        }

        .export-format {
            font-weight: 600;
            font-size: 14px;
        }

        .export-description {
            font-size: 12px;
            color: var(--secondary-color);
        }

        /* Import Popup */
        .import-options {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .import-option {
            padding: 20px;
            border-radius: var(--border-radius);
            border: 1px solid var(--border-color);
            cursor: pointer;
            transition: border-color 0.2s ease, background-color 0.2s ease;
            text-align: center;
        }

        .import-option:hover {
            background-color: rgba(93, 92, 222, 0.05);
            border-color: var(--primary-color);
        }

        .import-file-label {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 10px;
            cursor: pointer;
        }

        .import-icon {
            font-size: 24px;
            color: var(--primary-color);
        }

        .import-text {
            font-size: 14px;
            font-weight: 500;
        }

        .import-description {
            font-size: 12px;
            color: var(--secondary-color);
        }

        .import-file-input {
            display: none;
        }

        /* Category Management */
        .categories-list {
            margin-bottom: 20px;
            max-height: 300px;
            overflow-y: auto;
        }

        .category-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 15px;
            border-radius: var(--border-radius);
            border: 1px solid var(--border-color);
            margin-bottom: 10px;
            background-color: var(--bg-color);
        }

        .category-name {
            font-weight: 500;
        }

        .category-actions {
            display: flex;
            gap: 10px;
        }

        .category-action-btn {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: background-color 0.2s ease;
            border: none;
            background: none;
        }

        .category-edit-btn {
            color: var(--warning-color);
        }

        .category-edit-btn:hover {
            background-color: rgba(255, 193, 7, 0.1);
        }

        .category-delete-btn {
            color: var(--danger-color);
        }

        .category-delete-btn:hover {
            background-color: rgba(220, 53, 69, 0.1);
        }

        .new-category-form {
            display: flex;
            gap: 10px;
        }

        .new-category-input {
            flex-grow: 1;
        }

        /* Share Popup */
        .share-options {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-top: 15px;
        }

        .share-option {
            flex-basis: calc(50% - 5px);
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 12px;
            border-radius: var(--border-radius);
            border: 1px solid var(--border-color);
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .share-option:hover {
            background-color: rgba(93, 92, 222, 0.05);
            border-color: var(--primary-color);
            transform: translateY(-2px);
        }

        .share-icon {
            width: 36px;
            height: 36px;
            display: flex;
            align-items: center;
            justify-content: center;
            background-color: rgba(93, 92, 222, 0.1);
            border-radius: 50%;
            font-size: 16px;
            color: var(--primary-color);
        }

        .share-info {
            flex-grow: 1;
        }

        .share-method {
            font-weight: 500;
            font-size: 14px;
        }

        .share-user-list {
            max-height: 200px;
            overflow-y: auto;
            margin-top: 15px;
        }

        .share-user-item {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 10px;
            border-radius: var(--border-radius);
            border: 1px solid var(--border-color);
            margin-bottom: 10px;
            background-color: var(--bg-color);
        }

        .share-user-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            object-fit: cover;
        }

        .share-user-info {
            flex-grow: 1;
        }

        .share-user-name {
            font-weight: 500;
            font-size: 14px;
        }

        .share-user-email {
            font-size: 12px;
            color: var(--secondary-color);
        }

        .share-user-checkbox {
            width: 20px;
            height: 20px;
            cursor: pointer;
        }

        /* Responsive Styles */
        @media (max-width: 992px) {
            .export-options {
                grid-template-columns: 1fr;
            }
        }

        @media (max-width: 768px) {
            .header {
                flex-wrap: wrap;
                gap: 10px;
            }
            
            .app-title {
                font-size: 20px;
            }
            
            .header-right {
                margin-left: auto;
                gap: 12px;
            }
            
            .task-timer {
                order: -1;
                width: 100%;
                justify-content: center;
                margin: 5px 0;
            }
            
            .section-header {
                flex-direction: column;
                align-items: flex-start;
            }
            
            .view-toggle {
                margin-left: 0;
                margin-top: 10px;
                width: 100%;
            }
            
            .view-btn {
                flex: 1;
                justify-content: center;
            }
            
            .action-buttons {
                width: 100%;
                justify-content: space-between;
            }
            
            .filters-row {
                flex-direction: column;
                gap: 10px;
            }
            
            .filter-group, .search-box {
                width: 100%;
                max-width: 100%;
            }
            
            .action-history {
                margin-left: 0;
                margin-top: 10px;
            }
            
            .task-item {
                padding: 12px;
            }
            
            .task-actions {
                flex-wrap: wrap;
                justify-content: center;
                gap: 5px;
            }
            
            .action-btn {
                padding: 3px 6px;
            }
        }

        @media (max-width: 480px) {
            .content-container {
                padding: 15px 10px;
            }
            
            .task-status-cards {
                grid-template-columns: 1fr;
            }
            
            .tasks-section, .graph-view {
                padding: 15px 10px;
            }
            
            .popup {
                width: 95%;
            }
            
            .share-option {
                flex-basis: 100%;
            }
            
            .task-meta {
                flex-direction: column;
                align-items: flex-start;
                gap: 5px;
            }
            
            .task-content {
                padding-right: 0;
            }
            
            .multi-action-bar {
                flex-direction: column;
                gap: 10px;
            }
            
            .multi-actions {
                width: 100%;
                justify-content: space-between;
            }
        }
    </style>
</head>
<body>
    <!-- Loader -->
    <div class="loader-container">
        <div class="loader"></div>
    </div>

    <!-- Login Page -->
    <div id="login-page">
        <div class="login-container">
            <h1 class="login-title">To-Do App</h1>
            <form id="login-form">
                <div class="input-group">
                    <label for="email">Email</label>
                    <input type="email" id="email" class="input-field" value="test@example.com" required="">
                </div>
                <div class="input-group">
                    <label for="password">Password</label>
                    <input type="password" id="password" class="input-field" value="123456" required="">
                </div>
                <button type="submit" class="login-btn">Login</button>
                <div class="register-link">
                    Don't have an account? <a href="#" id="register-link">Register now</a>
                </div>
            </form>
        </div>
    </div>

    <!-- Dashboard -->
    <div id="dashboard">
        <header class="header">
            <a href="#" class="app-title"><i class="fas fa-check-double"></i> To-Do App</a>
            
            <div class="task-timer">
                <div class="timer-display" id="timer-display">00:00:00</div>
                <button class="timer-btn" id="timer-start"><i class="fas fa-play"></i></button>
                <button class="timer-btn" id="timer-pause" style="display: none;"><i class="fas fa-pause"></i></button>
            </div>
            
            <div class="header-right">
                <div class="status-selector">
                    <button class="status-btn" id="status-btn">
                        <i class="fas fa-circle" style="color: #28A745;"></i>
                        <span>Online</span>
                    </button>
                    <div class="status-dropdown" id="status-dropdown">
                        <div class="status-option" data-status="online">
                            <i class="fas fa-circle" style="color: #28A745;"></i>
                            <span>Online</span>
                        </div>
                        <div class="status-option" data-status="break">
                            <i class="fas fa-circle" style="color: #FFC107;"></i>
                            <span>Break</span>
                        </div>
                        <div class="status-option" data-status="busy">
                            <i class="fas fa-circle" style="color: #DC3545;"></i>
                            <span>Busy</span>
                        </div>
                        <div class="status-option" data-status="away">
                            <i class="fas fa-circle" style="color: #6C757D;"></i>
                            <span>Away</span>
                        </div>
                    </div>
                </div>
                
                <button class="mode-switcher" id="mode-switcher">
                    <i class="fas fa-sun"></i>
                </button>
                
                <div class="user-profile" id="user-profile">
                    <img src="https://i.imgur.com/Q9qFt3m.png" alt="Profile" class="profile-img" id="profile-img">
                    <div class="online-indicator"></div>
                    <div class="notification-badge" id="notification-badge">3</div>
                    
                    <div class="dropdown-content" id="profile-dropdown">
                        <div class="dropdown-item" id="view-profile">
                            <i class="fas fa-user"></i>
                            <span>View Profile</span>
                        </div>
                        <div class="dropdown-item" id="users-btn">
                            <i class="fas fa-users"></i>
                            <span>Users</span>
                        </div>
                        <div class="dropdown-item" id="switch-mode">
                            <i class="fas fa-moon"></i>
                            <span>Dark Mode</span>
                        </div>
                        <div class="dropdown-item" id="logout-btn">
                            <i class="fas fa-sign-out-alt"></i>
                            <span>Logout</span>
                        </div>
                    </div>
                    
                    <div class="notification-dropdown" id="notification-dropdown">
                        <div class="notification-header">
                            <div class="notification-title">Notifications</div>
                            <button class="mark-all-read" id="mark-all-read">Mark all as read</button>
                        </div>
                        <div id="notification-list">
                            <!-- Notifications will be added here dynamically -->
                        </div>
                    </div>
                </div>
            </div>
        </header>

        <div class="content-container">
            <!-- Summary Section -->
            <div class="summary-section">
                <div class="total-tasks">
                    <div class="total-tasks-title">Total Tasks</div>
                    <div class="total-tasks-count">
                        <i class="fas fa-tasks"></i>
                        <span id="total-tasks-count">12</span>
                    </div>
                </div>
                
                <div class="task-status-cards">
                    <div class="status-card completed-card">
                        <div class="status-card-title">
                            <i class="fas fa-check-circle"></i>
                            Completed Tasks
                        </div>
                        <div class="status-card-count" id="completed-tasks-count">5</div>
                    </div>
                    
                    <div class="status-card pending-card">
                        <div class="status-card-title">
                            <i class="fas fa-clock"></i>
                            Pending Tasks
                        </div>
                        <div class="status-card-count" id="pending-tasks-count">7</div>
                    </div>
                </div>
            </div>

            <!-- Tasks Section -->
            <div class="tasks-section" id="tasks-section">
                <div class="section-header">
                    <h2 class="section-title">
                        <i class="fas fa-list-check"></i>
                        Tasks
                    </h2>
                    
                    <div class="view-toggle">
                        <button class="view-btn active" id="list-view-btn">
                            <i class="fas fa-list"></i> List
                        </button>
                        <button class="view-btn" id="graph-view-btn">
                            <i class="fas fa-chart-pie"></i> Graph
                        </button>
                    </div>
                </div>
                
                <div class="action-buttons">
                    <button class="add-task-btn" id="add-task-btn">
                        <i class="fas fa-plus"></i> Add Task
                    </button>
                    <button class="export-btn" id="export-btn">
                        <i class="fas fa-file-export"></i> Export
                    </button>
                    <button class="import-btn" id="import-btn">
                        <i class="fas fa-file-import"></i> Import
                    </button>
                    <button class="category-btn" id="category-btn">
                        <i class="fas fa-tags"></i> Categories
                    </button>
                </div>
                
                <div class="filters-row">
                    <div class="filter-group">
                        <span class="filter-label">Status:</span>
                        <select class="filter-select" id="status-filter">
                            <option value="all">All</option>
                            <option value="active">Active</option>
                            <option value="completed">Completed</option>
                        </select>
                    </div>
                    
                    <div class="filter-group">
                        <span class="filter-label">Category:</span>
                        <select class="filter-select" id="category-filter">
                            <option value="all">All</option>
                            <!-- Categories will be added dynamically -->
                        </select>
                    </div>
                    
                    <div class="filter-group">
                        <span class="filter-label">Priority:</span>
                        <select class="filter-select" id="priority-filter">
                            <option value="all">All</option>
                            <option value="high">High</option>
                            <option value="medium">Medium</option>
                            <option value="low">Low</option>
                        </select>
                    </div>
                    
                    <div class="filter-group">
                        <span class="filter-label">Due Date:</span>
                        <select class="filter-select" id="due-date-filter">
                            <option value="all">All</option>
                            <option value="today">Today</option>
                            <option value="week">This Week</option>
                            <option value="month">This Month</option>
                            <option value="custom">Custom</option>
                        </select>
                    </div>
                    
                    <div class="filter-group">
                        <span class="filter-label">Sort By:</span>
                        <select class="sort-select" id="sort-select">
                            <option value="due-asc">Due Date (Earliest)</option>
                            <option value="due-desc">Due Date (Latest)</option>
                            <option value="title-asc">Title (A-Z)</option>
                            <option value="title-desc">Title (Z-A)</option>
                            <option value="priority-asc">Priority (Low to High)</option>
                            <option value="priority-desc">Priority (High to Low)</option>
                        </select>
                    </div>
                </div>
                
                <div class="filters-row">
                    <div class="search-box">
                        <i class="fas fa-search search-icon"></i>
                        <input type="text" class="search-input" id="search-input" placeholder="Search tasks...">
                    </div>
                    
                    <div class="action-history">
                        <button class="undo-btn" id="undo-btn" title="Undo" disabled="">
                            <i class="fas fa-undo"></i>
                        </button>
                        <button class="redo-btn" id="redo-btn" title="Redo" disabled="">
                            <i class="fas fa-redo"></i>
                        </button>
                    </div>
                </div>
                
                <div class="task-list" id="task-list">
                    <!-- Tasks will be added here dynamically -->
                </div>
                
                <div class="multi-action-bar" id="multi-action-bar">
                    <div class="selected-count">
                        <span id="selected-count">0</span> tasks selected
                    </div>
                    <div class="multi-actions">
                        <button class="multi-action-btn multi-complete-btn" id="multi-complete-btn">
                            <i class="fas fa-check"></i> Mark as Complete
                        </button>
                        <button class="multi-action-btn multi-delete-btn" id="multi-delete-btn">
                            <i class="fas fa-trash-alt"></i> Delete
                        </button>
                        <button class="multi-action-btn multi-cancel-btn" id="multi-cancel-btn">
                            <i class="fas fa-times"></i> Cancel
                        </button>
                    </div>
                </div>
            </div>
            
            <!-- Graph View -->
            <div class="graph-view" id="graph-view">
                <div class="section-header">
                    <h2 class="section-title">
                        <i class="fas fa-chart-line"></i>
                        Task Analytics
                    </h2>
                </div>
                
                <div class="graphs-container">
                    <div class="graph-card">
                        <h3 class="graph-title">Tasks Completion Over Time</h3>
                        <div class="chart-container">
                            <canvas id="completion-chart"></canvas>
                        </div>
                    </div>
                    
                    <div class="graph-card">
                        <h3 class="graph-title">Task Distribution</h3>
                        <div class="chart-container">
                            <canvas id="distribution-chart"></canvas>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Insights Section -->
            <div class="insights-section">
                <div class="insight-card">
                    <h3 class="insight-title">
                        <i class="fas fa-fire"></i>
                        Task Productivity
                    </h3>
                    <div class="insight-content">
                        <div class="insight-value" id="productivity-rate">75%</div>
                        <div class="insight-description">Task completion rate</div>
                        <div class="insight-list">
                            <div class="insight-item">
                                <div class="insight-label">Average tasks per day:</div>
                                <div class="insight-number">3.5</div>
                            </div>
                            <div class="insight-item">
                                <div class="insight-label">Most productive day:</div>
                                <div class="insight-number">Monday</div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="insight-card">
                    <h3 class="insight-title">
                        <i class="fas fa-exclamation-triangle"></i>
                        Expired Tasks
                    </h3>
                    <div class="insight-content">
                        <div class="insight-value" id="expired-count">2</div>
                        <div class="insight-description">Tasks past due date</div>
                        <div class="insight-list" id="expired-tasks-list">
                            <!-- Expired tasks will be added here dynamically -->
                        </div>
                    </div>
                </div>
                
                <div class="insight-card">
                    <h3 class="insight-title">
                        <i class="fas fa-hourglass-half"></i>
                        Due Soon
                    </h3>
                    <div class="insight-content">
                        <div class="insight-value" id="due-soon-count">3</div>
                        <div class="insight-description">Tasks due in 48 hours</div>
                        <div class="insight-list" id="due-soon-tasks-list">
                            <!-- Due soon tasks will be added here dynamically -->
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Toast Container -->
    <div class="toast-container" id="toast-container">
        <!-- Toasts will be added here dynamically -->
    </div>

    <!-- Popups -->
    <!-- Registration Popup -->
    <div class="popup-overlay" id="register-popup-overlay">
        <div class="popup" id="register-popup">
            <div class="popup-header">
                <h3 class="popup-title">Create Account</h3>
                <button class="popup-close" id="register-popup-close">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="popup-body">
                <form id="register-form">
                    <div class="form-group">
                        <label for="reg-last-name">Last Name</label>
                        <input type="text" id="reg-last-name" class="form-control" required="">
                    </div>
                    <div class="form-group">
                        <label for="reg-first-name">First Name</label>
                        <input type="text" id="reg-first-name" class="form-control" required="">
                    </div>
                    <div class="form-group">
                        <label for="reg-email">Email</label>
                        <input type="email" id="reg-email" class="form-control" required="">
                    </div>
                    <div class="form-group">
                        <label for="reg-confirm-email">Confirm Email</label>
                        <input type="email" id="reg-confirm-email" class="form-control" required="">
                        <div class="form-error" id="reg-email-error"></div>
                    </div>
                    <div class="form-group">
                        <label for="reg-password">Password</label>
                        <input type="password" id="reg-password" class="form-control" required="">
                    </div>
                    <div class="form-group">
                        <label for="reg-confirm-password">Confirm Password</label>
                        <input type="password" id="reg-confirm-password" class="form-control" required="">
                        <div class="form-error" id="reg-password-error"></div>
                    </div>
                    <div class="form-group">
                        <label for="reg-birthdate">Birthdate</label>
                        <input type="text" id="reg-birthdate" class="form-control" required="">
                    </div>
                    <div class="form-group">
                        <label for="reg-nationality">Nationality</label>
                        <select id="reg-nationality" class="form-control" required="">
                            <option value="">Select country</option>
                            <!-- Countries will be added dynamically -->
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="reg-role">Role</label>
                        <select id="reg-role" class="form-control" required="">
                            <option value="Manager">Manager</option>
                            <option value="Staff">Staff</option>
                            <option value="Customer">Customer</option>
                            <option value="Admin">Admin</option>
                        </select>
                    </div>
                </form>
            </div>
            <div class="popup-footer">
                <button class="popup-btn secondary" id="register-cancel-btn">Cancel</button>
                <button class="popup-btn success" id="register-submit-btn">Create</button>
            </div>
        </div>
    </div>

    <!-- Add Task Popup -->
    <div class="popup-overlay" id="add-task-popup-overlay">
        <div class="popup" id="add-task-popup">
            <div class="popup-header">
                <h3 class="popup-title">Add New Task</h3>
                <button class="popup-close" id="add-task-popup-close">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="popup-body">
                <form id="add-task-form">
                    <div class="form-group">
                        <label for="task-title">Title</label>
                        <input type="text" id="task-title" class="form-control" required="">
                    </div>
                    <div class="form-group">
                        <label for="task-description">Description</label>
                        <textarea id="task-description" class="form-control" rows="3"></textarea>
                    </div>
                    <div class="form-group">
                        <label for="task-due-date">Due Date</label>
                        <input type="text" id="task-due-date" class="form-control" required="">
                    </div>
                    <div class="form-group">
                        <label for="task-priority">Priority</label>
                        <select id="task-priority" class="form-control" required="">
                            <option value="high">High</option>
                            <option value="medium" selected="">Medium</option>
                            <option value="low">Low</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="task-category">Category</label>
                        <select id="task-category" class="form-control" required="">
                            <!-- Categories will be added dynamically -->
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Subtasks</label>
                        <div class="subtasks-container" id="subtasks-container">
                            <!-- Subtasks will be added here dynamically -->
                        </div>
                        <button type="button" class="add-subtask-btn" id="add-subtask-btn">
                            <i class="fas fa-plus"></i> Add Subtask
                        </button>
                    </div>
                    <div class="form-group">
                        <label for="task-notes">Notes</label>
                        <textarea id="task-notes" class="form-control" rows="2"></textarea>
                    </div>
                </form>
            </div>
            <div class="popup-footer">
                <button class="popup-btn secondary" id="add-task-cancel-btn">Cancel</button>
                <button class="popup-btn success" id="add-task-submit-btn">Create</button>
            </div>
        </div>
    </div>

    <!-- Edit Task Popup -->
    <div class="popup-overlay" id="edit-task-popup-overlay">
        <div class="popup" id="edit-task-popup">
            <div class="popup-header">
                <h3 class="popup-title">Edit Task</h3>
                <button class="popup-close" id="edit-task-popup-close">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="popup-body">
                <form id="edit-task-form">
                    <input type="hidden" id="edit-task-id">
                    <div class="form-group">
                        <label for="edit-task-title">Title</label>
                        <input type="text" id="edit-task-title" class="form-control" required="">
                    </div>
                    <div class="form-group">
                        <label for="edit-task-description">Description</label>
                        <textarea id="edit-task-description" class="form-control" rows="3"></textarea>
                    </div>
                    <div class="form-group">
                        <label for="edit-task-due-date">Due Date</label>
                        <input type="text" id="edit-task-due-date" class="form-control" required="">
                    </div>
                    <div class="form-group">
                        <label for="edit-task-priority">Priority</label>
                        <select id="edit-task-priority" class="form-control" required="">
                            <option value="high">High</option>
                            <option value="medium">Medium</option>
                            <option value="low">Low</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="edit-task-category">Category</label>
                        <select id="edit-task-category" class="form-control" required="">
                            <!-- Categories will be added dynamically -->
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Subtasks</label>
                        <div class="subtasks-container" id="edit-subtasks-container">
                            <!-- Subtasks will be added here dynamically -->
                        </div>
                        <button type="button" class="add-subtask-btn" id="edit-add-subtask-btn">
                            <i class="fas fa-plus"></i> Add Subtask
                        </button>
                    </div>
                    <div class="form-group">
                        <label for="edit-task-notes">Notes</label>
                        <textarea id="edit-task-notes" class="form-control" rows="2"></textarea>
                    </div>
                </form>
            </div>
            <div class="popup-footer">
                <button class="popup-btn secondary" id="edit-task-cancel-btn">Cancel</button>
                <button class="popup-btn success" id="edit-task-submit-btn">Save Changes</button>
            </div>
        </div>
    </div>

    <!-- View Task Popup -->
    <div class="popup-overlay" id="view-task-popup-overlay">
        <div class="popup" id="view-task-popup">
            <div class="popup-header">
                <h3 class="popup-title" id="view-task-title">Task Details</h3>
                <button class="popup-close" id="view-task-popup-close">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="popup-body">
                <div class="task-meta" id="view-task-meta">
                    <!-- Task meta info will be added here dynamically -->
                </div>
                <h4 style="margin: 15px 0 5px;">Description:</h4>
                <div id="view-task-description"></div>
                
                <div id="view-subtasks-container" style="margin-top: 15px;">
                    <h4 style="margin-bottom: 5px;">Subtasks:</h4>
                    <div id="view-subtasks-list">
                        <!-- Subtasks will be added here dynamically -->
                    </div>
                </div>
                
                <div id="view-notes-container" style="margin-top: 15px;">
                    <h4 style="margin-bottom: 5px;">Notes:</h4>
                    <div id="view-task-notes"></div>
                </div>
                
                <div style="margin-top: 15px;">
                    <h4 style="margin-bottom: 5px;">Time Spent:</h4>
                    <div id="view-task-time">00:00:00</div>
                </div>
            </div>
            <div class="popup-footer">
                <button class="popup-btn secondary" id="view-task-close-btn">Close</button>
                <button class="popup-btn primary" id="view-task-edit-btn">Edit</button>
            </div>
        </div>
    </div>

    <!-- Export Popup -->
    <div class="popup-overlay" id="export-popup-overlay">
        <div class="popup" id="export-popup">
            <div class="popup-header">
                <h3 class="popup-title">Export Tasks</h3>
                <button class="popup-close" id="export-popup-close">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="popup-body">
                <p>Choose a format to export your tasks:</p>
                <div class="export-options">
                    <div class="export-option" data-format="pdf">
                        <div class="export-icon">
                            <i class="fas fa-file-pdf"></i>
                        </div>
                        <div class="export-info">
                            <div class="export-format">PDF</div>
                            <div class="export-description">Portable Document Format</div>
                        </div>
                    </div>
                    <div class="export-option" data-format="excel">
                        <div class="export-icon">
                            <i class="fas fa-file-excel"></i>
                        </div>
                        <div class="export-info">
                            <div class="export-format">Excel</div>
                            <div class="export-description">Microsoft Excel Spreadsheet</div>
                        </div>
                    </div>
                    <div class="export-option" data-format="json">
                        <div class="export-icon">
                            <i class="fas fa-file-code"></i>
                        </div>
                        <div class="export-info">
                            <div class="export-format">JSON</div>
                            <div class="export-description">JavaScript Object Notation</div>
                        </div>
                    </div>
                    <div class="export-option" data-format="docx">
                        <div class="export-icon">
                            <i class="fas fa-file-word"></i>
                        </div>
                        <div class="export-info">
                            <div class="export-format">DOCX</div>
                            <div class="export-description">Microsoft Word Document</div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="popup-footer">
                <button class="popup-btn secondary" id="export-cancel-btn">Cancel</button>
                <button class="popup-btn primary" id="export-download-btn" disabled="">Download</button>
            </div>
        </div>
    </div>

    <!-- Import Popup -->
    <div class="popup-overlay" id="import-popup-overlay">
        <div class="popup" id="import-popup">
            <div class="popup-header">
                <h3 class="popup-title">Import Tasks</h3>
                <button class="popup-close" id="import-popup-close">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="popup-body">
                <div class="import-options">
                    <div class="import-option">
                        <label class="import-file-label">
                            <div class="import-icon">
                                <i class="fas fa-file-upload"></i>
                            </div>
                            <div class="import-text">Upload JSON File</div>
                            <div class="import-description">Import tasks from a JSON file</div>
                            <input type="file" class="import-file-input" id="import-file-input" accept=".json">
                        </label>
                    </div>
                    <div class="import-option">
                        <div class="form-group">
                            <label for="import-url">Import from URL</label>
                            <input type="url" id="import-url" class="form-control" placeholder="Enter JSON URL...">
                        </div>
                    </div>
                </div>
            </div>
            <div class="popup-footer">
                <button class="popup-btn secondary" id="import-cancel-btn">Cancel</button>
                <button class="popup-btn primary" id="import-submit-btn">Import</button>
            </div>
        </div>
    </div>

    <!-- Category Management Popup -->
    <div class="popup-overlay" id="category-popup-overlay">
        <div class="popup" id="category-popup">
            <div class="popup-header">
                <h3 class="popup-title">Manage Categories</h3>
                <button class="popup-close" id="category-popup-close">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="popup-body">
                <div class="categories-list" id="categories-list">
                    <!-- Categories will be added here dynamically -->
                </div>
                <div class="new-category-form">
                    <input type="text" class="form-control new-category-input" id="new-category-input" placeholder="New category name">
                    <button class="popup-btn success" id="add-category-btn">Add</button>
                </div>
            </div>
            <div class="popup-footer">
                <button class="popup-btn secondary" id="category-close-btn">Close</button>
            </div>
        </div>
    </div>

    <!-- Profile Popup -->
    <div class="popup-overlay" id="profile-popup-overlay">
        <div class="popup" id="profile-popup">
            <div class="popup-header">
                <h3 class="popup-title">User Profile</h3>
                <button class="popup-close" id="profile-popup-close">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="popup-body">
                <div class="profile-container">
                    <div class="profile-picture-container">
                        <img src="https://i.imgur.com/Q9qFt3m.png" alt="Profile" class="large-profile-picture" id="profile-picture">
                        <button class="edit-picture-btn" id="edit-picture-btn">
                            <i class="fas fa-camera"></i>
                        </button>
                        <input type="file" class="profile-picture-input" id="profile-picture-input" accept="image/*">
                    </div>
                    
                    <div id="profile-details">
                        <!-- Profile details will be added here dynamically -->
                    </div>
                    
                    <button class="popup-btn primary" id="edit-profile-btn" style="width: 100%; margin-top: 20px;">
                        <i class="fas fa-edit"></i> Edit Profile
                    </button>
                </div>
            </div>
            <div class="popup-footer">
                <button class="popup-btn secondary" id="profile-close-btn">Close</button>
                <button class="popup-btn success" id="save-profile-btn" style="display: none;">Save Changes</button>
            </div>
        </div>
    </div>

    <!-- Users Popup -->
    <div class="popup-overlay" id="users-popup-overlay">
        <div class="popup" id="users-popup">
            <div class="popup-header">
                <h3 class="popup-title">Users</h3>
                <button class="popup-close" id="users-popup-close">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="popup-body">
                <div class="users-grid" id="users-grid">
                    <!-- Users will be added here dynamically -->
                </div>
            </div>
            <div class="popup-footer">
                <button class="popup-btn secondary" id="users-close-btn">Close</button>
            </div>
        </div>
    </div>

    <!-- Share Task Popup -->
    <div class="popup-overlay" id="share-popup-overlay">
        <div class="popup" id="share-popup">
            <div class="popup-header">
                <h3 class="popup-title">Share Task</h3>
                <button class="popup-close" id="share-popup-close">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="popup-body">
                <div id="share-task-title" style="font-weight: 600; margin-bottom: 15px;"></div>
                
                <p>Choose how you want to share this task:</p>
                <div class="share-options">
                    <div class="share-option" data-method="users">
                        <div class="share-icon">
                            <i class="fas fa-users"></i>
                        </div>
                        <div class="share-info">
                            <div class="share-method">Share with Users</div>
                        </div>
                    </div>
                    <div class="share-option" data-method="email">
                        <div class="share-icon">
                            <i class="fas fa-envelope"></i>
                        </div>
                        <div class="share-info">
                            <div class="share-method">Share via Email</div>
                        </div>
                    </div>
                    <div class="share-option" data-method="link">
                        <div class="share-icon">
                            <i class="fas fa-link"></i>
                        </div>
                        <div class="share-info">
                            <div class="share-method">Generate Link</div>
                        </div>
                    </div>
                    <div class="share-option" data-method="social">
                        <div class="share-icon">
                            <i class="fas fa-share-alt"></i>
                        </div>
                        <div class="share-info">
                            <div class="share-method">Social Media</div>
                        </div>
                    </div>
                </div>
                
                <div id="share-users-list" style="display: none;">
                    <h4 style="margin: 20px 0 10px;">Select Users:</h4>
                    <div class="share-user-list" id="share-user-list">
                        <!-- Users will be added here dynamically -->
                    </div>
                </div>
                
                <div id="share-email-form" style="display: none; margin-top: 20px;">
                    <div class="form-group">
                        <label for="share-email">Email Addresses</label>
                        <input type="text" id="share-email" class="form-control" placeholder="Enter email addresses separated by commas">
                    </div>
                    <div class="form-group">
                        <label for="share-message">Message (Optional)</label>
                        <textarea id="share-message" class="form-control" rows="3" placeholder="Add a personal message"></textarea>
                    </div>
                </div>
                
                <div id="share-link" style="display: none; margin-top: 20px;">
                    <div class="form-group">
                        <label for="share-link-input">Shareable Link</label>
                        <div style="display: flex; gap: 10px;">
                            <input type="text" id="share-link-input" class="form-control" readonly="">
                            <button class="popup-btn primary" id="copy-link-btn">
                                <i class="fas fa-copy"></i>
                            </button>
                        </div>
                    </div>
                </div>
                
                <div id="share-social" style="display: none; margin-top: 20px;">
                    <div style="display: flex; gap: 15px; justify-content: center;">
                        <button class="action-btn">
                            <i class="fab fa-facebook" style="font-size: 24px; color: #1877F2;"></i>
                        </button>
                        <button class="action-btn">
                            <i class="fab fa-twitter" style="font-size: 24px; color: #1DA1F2;"></i>
                        </button>
                        <button class="action-btn">
                            <i class="fab fa-linkedin" style="font-size: 24px; color: #0A66C2;"></i>
                        </button>
                        <button class="action-btn">
                            <i class="fab fa-whatsapp" style="font-size: 24px; color: #25D366;"></i>
                        </button>
                    </div>
                </div>
            </div>
            <div class="popup-footer">
                <button class="popup-btn secondary" id="share-cancel-btn">Cancel</button>
                <button class="popup-btn success" id="share-submit-btn">Share</button>
            </div>
        </div>
    </div>

    <!-- Custom Date Range Popup -->
    <div class="popup-overlay" id="date-range-popup-overlay">
        <div class="popup" id="date-range-popup">
            <div class="popup-header">
                <h3 class="popup-title">Select Date Range</h3>
                <button class="popup-close" id="date-range-popup-close">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="popup-body">
                <div class="form-group">
                    <label for="date-range-start">Start Date</label>
                    <input type="text" id="date-range-start" class="form-control" required="">
                </div>
                <div class="form-group">
                    <label for="date-range-end">End Date</label>
                    <input type="text" id="date-range-end" class="form-control" required="">
                </div>
            </div>
            <div class="popup-footer">
                <button class="popup-btn secondary" id="date-range-cancel-btn">Cancel</button>
                <button class="popup-btn primary" id="date-range-apply-btn">Apply</button>
            </div>
        </div>
    </div>

    <script>
        // Global Variables
        let currentUser = null;
        let tasks = [];
        let categories = ['Work', 'Personal', 'Shopping', 'Health', 'Education'];
        let notifications = [];
        let users = [];
        let activeTask = null;
        let actionHistory = [];
        let actionHistoryIndex = -1;
        let globalTimer = { seconds: 0, minutes: 0, hours: 0, interval: null };
        let selectedTasks = [];
        let dateRangeFilter = { start: null, end: null };
        
        // Initialize the application
        document.addEventListener('DOMContentLoaded', () => {
            // Load data from local storage or use default data
            loadData();
            
            // Initialize UI event listeners
            initEventListeners();
            
            // Initialize date pickers
            initDatePickers();
            
            // Load countries for registration
            loadCountries();
            
            // Detect system dark mode preference
            setupDarkMode();
            
            // Hide loader after everything is initialized
            setTimeout(() => {
                document.querySelector('.loader-container').classList.add('hidden');
            }, 1000);
        });
        
        // Load data from local storage
        function loadData() {
            // Try to get data from local storage or use default data
            currentUser = JSON.parse(localStorage.getItem('currentUser')) || null;
            tasks = JSON.parse(localStorage.getItem('tasks')) || generateRandomTasks();
            categories = JSON.parse(localStorage.getItem('categories')) || ['Work', 'Personal', 'Shopping', 'Health', 'Education'];
            notifications = JSON.parse(localStorage.getItem('notifications')) || generateRandomNotifications();
            users = JSON.parse(localStorage.getItem('users')) || generateRandomUsers();
            
            // If there's a current user, show dashboard directly
            if (currentUser) {
                showDashboard();
            }
            
            // Update notification badge
            updateNotificationBadge();
            
            // Populate categories in filters
            populateCategoryFilters();
            
            // Render tasks
            renderTasks();
            
            // Update task statistics
            updateTaskStats();
            
            // Initialize graphs
            initializeGraphs();
            
            // Update insights
            updateInsights();
        }
        
        // Initialize event listeners
        function initEventListeners() {
            // Login form submission
            document.getElementById('login-form').addEventListener('submit', (e) => {
                e.preventDefault();
                login();
            });
            
            // Register link click
            document.getElementById('register-link').addEventListener('click', (e) => {
                e.preventDefault();
                openPopup('register-popup');
            });
            
            // Register popup events
            document.getElementById('register-popup-close').addEventListener('click', () => closePopup('register-popup'));
            document.getElementById('register-cancel-btn').addEventListener('click', () => closePopup('register-popup'));
            document.getElementById('register-submit-btn').addEventListener('click', register);
            
            // Dashboard header events
            document.getElementById('app-title').addEventListener('click', (e) => {
                e.preventDefault();
                document.getElementById('tasks-section').style.display = 'block';
                document.getElementById('graph-view').style.display = 'none';
                document.getElementById('list-view-btn').classList.add('active');
                document.getElementById('graph-view-btn').classList.remove('active');
            });
            
            // Timer controls
            document.getElementById('timer-start').addEventListener('click', startGlobalTimer);
            document.getElementById('timer-pause').addEventListener('click', pauseGlobalTimer);
            
            // Status selector
            document.getElementById('status-btn').addEventListener('click', toggleStatusDropdown);
            document.querySelectorAll('.status-option').forEach(option => {
                option.addEventListener('click', changeUserStatus);
            });
            
            // User profile dropdown
            document.getElementById('user-profile').addEventListener('click', (e) => {
                if (e.target.closest('.profile-img')) {
                    toggleProfileDropdown();
                }
            });
            
            // Notification badge click
            document.getElementById('notification-badge').addEventListener('click', (e) => {
                e.stopPropagation();
                toggleNotificationDropdown();
            });
            
            // Mark all notifications as read
            document.getElementById('mark-all-read').addEventListener('click', markAllNotificationsAsRead);
            
            // Mode switcher
            document.getElementById('mode-switcher').addEventListener('click', toggleDarkMode);
            document.getElementById('switch-mode').addEventListener('click', toggleDarkMode);
            
            // View profile
            document.getElementById('view-profile').addEventListener('click', openProfilePopup);
            
            // Users button
            document.getElementById('users-btn').addEventListener('click', openUsersPopup);
            
            // Logout button
            document.getElementById('logout-btn').addEventListener('click', logout);
            
            // View toggle
            document.getElementById('list-view-btn').addEventListener('click', () => {
                document.getElementById('tasks-section').style.display = 'block';
                document.getElementById('graph-view').style.display = 'none';
                document.getElementById('list-view-btn').classList.add('active');
                document.getElementById('graph-view-btn').classList.remove('active');
            });
            
            document.getElementById('graph-view-btn').addEventListener('click', () => {
                document.getElementById('tasks-section').style.display = 'none';
                document.getElementById('graph-view').style.display = 'block';
                document.getElementById('list-view-btn').classList.remove('active');
                document.getElementById('graph-view-btn').classList.add('active');
                
                // Refresh graphs when switching to graph view
                initializeGraphs();
            });
            
            // Add task button
            document.getElementById('add-task-btn').addEventListener('click', () => {
                resetAddTaskForm();
                openPopup('add-task-popup');
            });
            
            // Add task popup events
            document.getElementById('add-task-popup-close').addEventListener('click', () => closePopup('add-task-popup'));
            document.getElementById('add-task-cancel-btn').addEventListener('click', () => closePopup('add-task-popup'));
            document.getElementById('add-task-submit-btn').addEventListener('click', addTask);
            
            // Add subtask button
            document.getElementById('add-subtask-btn').addEventListener('click', () => addSubtaskField());
            
            // Export button
            document.getElementById('export-btn').addEventListener('click', () => openPopup('export-popup'));
            
            // Export popup events
            document.getElementById('export-popup-close').addEventListener('click', () => closePopup('export-popup'));
            document.getElementById('export-cancel-btn').addEventListener('click', () => closePopup('export-popup'));
            
            // Export options
            document.querySelectorAll('.export-option').forEach(option => {
                option.addEventListener('click', selectExportFormat);
            });
            
            document.getElementById('export-download-btn').addEventListener('click', exportTasks);
            
            // Import button
            document.getElementById('import-btn').addEventListener('click', () => openPopup('import-popup'));
            
            // Import popup events
            document.getElementById('import-popup-close').addEventListener('click', () => closePopup('import-popup'));
            document.getElementById('import-cancel-btn').addEventListener('click', () => closePopup('import-popup'));
            document.getElementById('import-submit-btn').addEventListener('click', importTasks);
            
            // Category button
            document.getElementById('category-btn').addEventListener('click', openCategoryPopup);
            
            // Category popup events
            document.getElementById('category-popup-close').addEventListener('click', () => closePopup('category-popup'));
            document.getElementById('category-close-btn').addEventListener('click', () => closePopup('category-popup'));
            document.getElementById('add-category-btn').addEventListener('click', addCategory);
            
            // Filter events
            document.getElementById('status-filter').addEventListener('change', applyFilters);
            document.getElementById('category-filter').addEventListener('change', applyFilters);
            document.getElementById('priority-filter').addEventListener('change', applyFilters);
            document.getElementById('due-date-filter').addEventListener('change', handleDueDateFilter);
            document.getElementById('sort-select').addEventListener('change', applyFilters);
            document.getElementById('search-input').addEventListener('input', debounce(applyFilters, 300));
            
            // Date range popup events
            document.getElementById('date-range-popup-close').addEventListener('click', () => closePopup('date-range-popup'));
            document.getElementById('date-range-cancel-btn').addEventListener('click', () => closePopup('date-range-popup'));
            document.getElementById('date-range-apply-btn').addEventListener('click', applyDateRangeFilter);
            
            // Undo/Redo buttons
            document.getElementById('undo-btn').addEventListener('click', undoAction);
            document.getElementById('redo-btn').addEventListener('click', redoAction);
            
            // Multi-action bar events
            document.getElementById('multi-complete-btn').addEventListener('click', completeSelectedTasks);
            document.getElementById('multi-delete-btn').addEventListener('click', deleteSelectedTasks);
            document.getElementById('multi-cancel-btn').addEventListener('click', cancelMultiSelect);
            
            // Profile popup events
            document.getElementById('profile-popup-close').addEventListener('click', () => closePopup('profile-popup'));
            document.getElementById('profile-close-btn').addEventListener('click', () => closePopup('profile-popup'));
            document.getElementById('edit-profile-btn').addEventListener('click', enableProfileEdit);
            document.getElementById('save-profile-btn').addEventListener('click', saveProfileChanges);
            document.getElementById('edit-picture-btn').addEventListener('click', () => document.getElementById('profile-picture-input').click());
            document.getElementById('profile-picture-input').addEventListener('change', handleProfilePictureChange);
            
            // Users popup events
            document.getElementById('users-popup-close').addEventListener('click', () => closePopup('users-popup'));
            document.getElementById('users-close-btn').addEventListener('click', () => closePopup('users-popup'));
            
            // Close dropdowns when clicking outside
            document.addEventListener('click', (e) => {
                const statusDropdown = document.getElementById('status-dropdown');
                const profileDropdown = document.getElementById('profile-dropdown');
                const notificationDropdown = document.getElementById('notification-dropdown');
                
                if (statusDropdown.classList.contains('show') && 
                    !e.target.closest('#status-btn') && 
                    !e.target.closest('#status-dropdown')) {
                    statusDropdown.classList.remove('show');
                }
                
                if (profileDropdown.classList.contains('show') && 
                    !e.target.closest('#user-profile') && 
                    !e.target.closest('#profile-dropdown')) {
                    profileDropdown.classList.remove('show');
                }
                
                if (notificationDropdown.classList.contains('show') && 
                    !e.target.closest('#notification-badge') && 
                    !e.target.closest('#notification-dropdown')) {
                    notificationDropdown.classList.remove('show');
                }
            });
        }
        
        // Initialize date pickers
        function initDatePickers() {
            // Registration birthdate picker
            flatpickr('#reg-birthdate', {
                dateFormat: 'Y-m-d',
                maxDate: new Date(),
                disableMobile: true
            });
            
            // Task due date pickers
            flatpickr('#task-due-date', {
                dateFormat: 'Y-m-d',
                minDate: 'today',
                disableMobile: true
            });
            
            flatpickr('#edit-task-due-date', {
                dateFormat: 'Y-m-d',
                disableMobile: true
            });
            
            // Date range pickers
            flatpickr('#date-range-start', {
                dateFormat: 'Y-m-d',
                disableMobile: true
            });
            
            flatpickr('#date-range-end', {
                dateFormat: 'Y-m-d',
                disableMobile: true
            });
        }
        
        // Load countries for registration
        function loadCountries() {
            const nationalitySelect = document.getElementById('reg-nationality');
            
            // Common countries to add as default options
            const commonCountries = [
                { code: 'US', name: 'United States' },
                { code: 'GB', name: 'United Kingdom' },
                { code: 'CA', name: 'Canada' },
                { code: 'AU', name: 'Australia' },
                { code: 'FR', name: 'France' },
                { code: 'DE', name: 'Germany' },
                { code: 'JP', name: 'Japan' },
                { code: 'CN', name: 'China' },
                { code: 'IN', name: 'India' },
                { code: 'BR', name: 'Brazil' }
            ];
            
            // Add common countries to select
            commonCountries.forEach(country => {
                const option = document.createElement('option');
                option.value = country.code;
                option.textContent = country.name;
                nationalitySelect.appendChild(option);
            });
        }
        
        // Setup dark mode detection and toggle
        function setupDarkMode() {
            // Check if user prefers dark mode
            if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
                document.documentElement.classList.add('dark');
                updateDarkModeUI(true);
            }
            
            // Listen for changes in color scheme preference
            window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', (e) => {
                if (e.matches) {
                    document.documentElement.classList.add('dark');
                    updateDarkModeUI(true);
                } else {
                    document.documentElement.classList.remove('dark');
                    updateDarkModeUI(false);
                }
            });
        }
        
        // Toggle dark mode
        function toggleDarkMode() {
            const isDarkMode = document.documentElement.classList.toggle('dark');
            updateDarkModeUI(isDarkMode);
            
            // Close profile dropdown after switching
            document.getElementById('profile-dropdown').classList.remove('show');
        }
        
        // Update UI elements when dark mode changes
        function updateDarkModeUI(isDarkMode) {
            const modeSwitcher = document.getElementById('mode-switcher');
            const switchModeItem = document.getElementById('switch-mode');
            
            if (isDarkMode) {
                modeSwitcher.innerHTML = '<i class="fas fa-moon"></i>';
                switchModeItem.innerHTML = '<i class="fas fa-sun"></i><span>Light Mode</span>';
            } else {
                modeSwitcher.innerHTML = '<i class="fas fa-sun"></i>';
                switchModeItem.innerHTML = '<i class="fas fa-moon"></i><span>Dark Mode</span>';
            }
        }
        
        // Login function
        function login() {
            const email = document.getElementById('email').value;
            const password = document.getElementById('password').value;
            
            // Check if user exists in stored users
            const user = users.find(u => u.email === email && u.password === password);
            
            if (user) {
                currentUser = user;
                localStorage.setItem('currentUser', JSON.stringify(currentUser));
                
                // Show dashboard
                showDashboard();
                
                // Show welcome notification
                showToast(`Welcome back, ${currentUser.firstName}!`, 'success');
            } else {
                // Show error for invalid credentials
                showToast('Invalid email or password. Please try again.', 'error');
                
                // Check if the email exists in the default user data
                if (email === 'test@example.com' && password !== '123456') {
                    showToast('Hint: Try password "123456" for the test account.', 'info');
                }
            }
        }
        
        // Register new user
        function register() {
            const lastName = document.getElementById('reg-last-name').value;
            const firstName = document.getElementById('reg-first-name').value;
            const email = document.getElementById('reg-email').value;
            const confirmEmail = document.getElementById('reg-confirm-email').value;
            const password = document.getElementById('reg-password').value;
            const confirmPassword = document.getElementById('reg-confirm-password').value;
            const birthdate = document.getElementById('reg-birthdate').value;
            const nationality = document.getElementById('reg-nationality').value;
            const role = document.getElementById('reg-role').value;
            
            // Clear previous errors
            document.getElementById('reg-email-error').textContent = '';
            document.getElementById('reg-password-error').textContent = '';
            
            // Validate inputs
            let isValid = true;
            
            if (!lastName || !firstName || !email || !confirmEmail || !password || !confirmPassword || !birthdate || !nationality || !role) {
                showToast('Please fill in all fields.', 'error');
                isValid = false;
            }
            
            if (email !== confirmEmail) {
                document.getElementById('reg-email-error').textContent = 'Emails do not match.';
                isValid = false;
            }
            
            if (password !== confirmPassword) {
                document.getElementById('reg-password-error').textContent = 'Passwords do not match.';
                isValid = false;
            }
            
            // Check if email already exists
            if (users.some(u => u.email === email)) {
                document.getElementById('reg-email-error').textContent = 'Email is already registered.';
                isValid = false;
            }
            
            if (!isValid) return;
            
            // Create new user
            const newUser = {
                id: generateId(),
                lastName,
                firstName,
                email,
                password,
                birthdate,
                nationality,
                role,
                profilePicture: getRandomProfilePicture(),
                joinDate: new Date().toISOString().split('T')[0]
            };
            
            // Add user to users array
            users.push(newUser);
            
            // Save to local storage
            localStorage.setItem('users', JSON.stringify(users));
            
            // Set as current user
            currentUser = newUser;
            localStorage.setItem('currentUser', JSON.stringify(currentUser));
            
            // Show dashboard
            showDashboard();
            
            // Show success message
            showToast('Account created successfully!', 'success');
            
            // Close registration popup
            closePopup('register-popup');
        }
        
        // Show dashboard
        function showDashboard() {
            document.getElementById('login-page').style.display = 'none';
            document.getElementById('dashboard').style.display = 'block';
            
            // Update profile info
            updateProfileInfo();
            
            // Add a "Logged in" notification
            addNotification({
                id: generateId(),
                type: 'info',
                message: `You logged in successfully at ${new Date().toLocaleTimeString()}`,
                time: new Date().toISOString(),
                read: false
            });
            
            // Update notification badge
            updateNotificationBadge();
        }
        
        // Update profile information
        function updateProfileInfo() {
            if (!currentUser) return;
            
            // Update profile image
            const profileImg = document.getElementById('profile-img');
            const profilePicture = document.getElementById('profile-picture');
            
            if (currentUser.profilePicture) {
                profileImg.src = currentUser.profilePicture;
                profilePicture.src = currentUser.profilePicture;
            }
            
            // Update profile details
            updateProfileDetails();
        }
        
        // Update profile details in profile popup
        function updateProfileDetails() {
            if (!currentUser) return;
            
            const profileDetails = document.getElementById('profile-details');
            
            // Clear previous details
            profileDetails.innerHTML = '';
            
            // Create details elements
            const details = [
                { label: 'Full Name', value: `${currentUser.firstName} ${currentUser.lastName}` },
                { label: 'Email', value: currentUser.email },
                { label: 'Role', value: currentUser.role },
                { label: 'Nationality', value: getCountryName(currentUser.nationality) || currentUser.nationality },
                { label: 'Birth Date', value: currentUser.birthdate },
                { label: 'Joined', value: currentUser.joinDate }
            ];
            
            // Add details to container
            details.forEach(detail => {
                const detailElement = document.createElement('div');
                detailElement.className = 'profile-detail';
                
                const labelElement = document.createElement('div');
                labelElement.className = 'profile-label';
                labelElement.textContent = detail.label;
                
                const valueElement = document.createElement('div');
                valueElement.className = 'profile-value';
                valueElement.id = `profile-${detail.label.toLowerCase().replace(' ', '-')}`;
                valueElement.textContent = detail.value;
                
                detailElement.appendChild(labelElement);
                detailElement.appendChild(valueElement);
                
                profileDetails.appendChild(detailElement);
            });
        }
        
        // Enable profile editing
        function enableProfileEdit() {
            if (!currentUser) return;
            
            const profileDetails = document.getElementById('profile-details');
            
            // Clear previous details
            profileDetails.innerHTML = '';
            
            // Create editable fields
            const fields = [
                { label: 'First Name', id: 'edit-first-name', value: currentUser.firstName, type: 'text' },
                { label: 'Last Name', id: 'edit-last-name', value: currentUser.lastName, type: 'text' },
                { label: 'Email', id: 'edit-email', value: currentUser.email, type: 'email' },
                { label: 'Role', id: 'edit-role', value: currentUser.role, type: 'select', options: ['Manager', 'Staff', 'Customer', 'Admin'] },
                { label: 'Birth Date', id: 'edit-birthdate', value: currentUser.birthdate, type: 'date' }
            ];
            
            // Add fields to container
            fields.forEach(field => {
                const fieldElement = document.createElement('div');
                fieldElement.className = 'profile-detail';
                
                const labelElement = document.createElement('div');
                labelElement.className = 'profile-label';
                labelElement.textContent = field.label;
                
                const valueElement = document.createElement('div');
                valueElement.className = 'profile-value';
                
                if (field.type === 'select') {
                    const select = document.createElement('select');
                    select.id = field.id;
                    
                    field.options.forEach(option => {
                        const optionElement = document.createElement('option');
                        optionElement.value = option;
                        optionElement.textContent = option;
                        if (option === field.value) {
                            optionElement.selected = true;
                        }
                        select.appendChild(optionElement);
                    });
                    
                    valueElement.appendChild(select);
                } else {
                    const input = document.createElement('input');
                    input.type = field.type;
                    input.id = field.id;
                    input.value = field.value;
                    valueElement.appendChild(input);
                    
                    if (field.type === 'date') {
                        // Initialize date picker
                        setTimeout(() => {
                            flatpickr(`#${field.id}`, {
                                dateFormat: 'Y-m-d',
                                maxDate: new Date(),
                                defaultDate: field.value,
                                disableMobile: true
                            });
                        }, 0);
                    }
                }
                
                fieldElement.appendChild(labelElement);
                fieldElement.appendChild(valueElement);
                
                profileDetails.appendChild(fieldElement);
            });
            
            // Show save button
            document.getElementById('profile-close-btn').style.display = 'none';
            document.getElementById('save-profile-btn').style.display = 'block';
        }
        
        // Save profile changes
        function saveProfileChanges() {
            if (!currentUser) return;
            
            // Get updated values
            const firstName = document.getElementById('edit-first-name').value;
            const lastName = document.getElementById('edit-last-name').value;
            const email = document.getElementById('edit-email').value;
            const role = document.getElementById('edit-role').value;
            const birthdate = document.getElementById('edit-birthdate').value;
            
            // Validate inputs
            if (!firstName || !lastName || !email || !role || !birthdate) {
                showToast('Please fill in all fields.', 'error');
                return;
            }
            
            // Update current user
            currentUser.firstName = firstName;
            currentUser.lastName = lastName;
            currentUser.email = email;
            currentUser.role = role;
            currentUser.birthdate = birthdate;
            
            // Update users array
            const userIndex = users.findIndex(u => u.id === currentUser.id);
            if (userIndex !== -1) {
                users[userIndex] = currentUser;
            }
            
            // Save to local storage
            localStorage.setItem('currentUser', JSON.stringify(currentUser));
            localStorage.setItem('users', JSON.stringify(users));
            
            // Update profile details
            updateProfileDetails();
            
            // Hide save button
            document.getElementById('profile-close-btn').style.display = 'block';
            document.getElementById('save-profile-btn').style.display = 'none';
            
            // Show success message
            showToast('Profile updated successfully!', 'success');
        }
        
        // Handle profile picture change
        function handleProfilePictureChange(e) {
            const file = e.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(event) {
                    const profileImg = document.getElementById('profile-img');
                    const profilePicture = document.getElementById('profile-picture');
                    
                    profileImg.src = event.target.result;
                    profilePicture.src = event.target.result;
                    
                    // Update current user
                    currentUser.profilePicture = event.target.result;
                    
                    // Update users array
                    const userIndex = users.findIndex(u => u.id === currentUser.id);
                    if (userIndex !== -1) {
                        users[userIndex] = currentUser;
                    }
                    
                    // Save to local storage
                    localStorage.setItem('currentUser', JSON.stringify(currentUser));
                    localStorage.setItem('users', JSON.stringify(users));
                    
                    // Show success message
                    showToast('Profile picture updated!', 'success');
                };
                reader.readAsDataURL(file);
            }
        }
        
        // Logout function
        function logout() {
            currentUser = null;
            localStorage.removeItem('currentUser');
            
            // Reset timer
            pauseGlobalTimer();
            resetGlobalTimer();
            
            // Show login page
            document.getElementById('dashboard').style.display = 'none';
            document.getElementById('login-page').style.display = 'flex';
            
            // Clear profile dropdown
            document.getElementById('profile-dropdown').classList.remove('show');
        }
        
        // Toggle status dropdown
        function toggleStatusDropdown(e) {
            e.stopPropagation();
            document.getElementById('status-dropdown').classList.toggle('show');
        }
        
        // Change user status
        function changeUserStatus() {
            const status = this.getAttribute('data-status');
            const statusBtn = document.getElementById('status-btn');
            const icon = statusBtn.querySelector('i');
            const text = statusBtn.querySelector('span');
            const profileImg = document.getElementById('profile-img');
            
            // Update status button
            text.textContent = this.querySelector('span').textContent;
            
            // Update icon color based on status
            switch (status) {
                case 'online':
                    icon.style.color = '#28A745';
                    profileImg.style.boxShadow = '0 0 0 2px #28A745';
                    break;
                case 'break':
                    icon.style.color = '#FFC107';
                    profileImg.style.boxShadow = '0 0 0 2px #FFC107';
                    break;
                case 'busy':
                    icon.style.color = '#DC3545';
                    profileImg.style.boxShadow = '0 0 0 2px #DC3545';
                    break;
                case 'away':
                    icon.style.color = '#6C757D';
                    profileImg.style.boxShadow = '0 0 0 2px #6C757D';
                    break;
            }
            
            // Hide dropdown
            document.getElementById('status-dropdown').classList.remove('show');
            
            // Show status change notification
            showToast(`Status changed to ${this.querySelector('span').textContent}`, 'info');
        }
        
        // Toggle profile dropdown
        function toggleProfileDropdown() {
            const profileDropdown = document.getElementById('profile-dropdown');
            
            // Close notification dropdown if open
            document.getElementById('notification-dropdown').classList.remove('show');
            
            // Toggle profile dropdown
            profileDropdown.classList.toggle('show');
        }
        
        // Toggle notification dropdown
        function toggleNotificationDropdown() {
            const notificationDropdown = document.getElementById('notification-dropdown');
            
            // Close profile dropdown if open
            document.getElementById('profile-dropdown').classList.remove('show');
            
            // Toggle notification dropdown
            notificationDropdown.classList.toggle('show');
            
            // Render notifications
            renderNotifications();
        }
        
        // Render notifications
        function renderNotifications() {
            const notificationList = document.getElementById('notification-list');
            
            // Clear previous notifications
            notificationList.innerHTML = '';
            
            if (notifications.length === 0) {
                const emptyElement = document.createElement('div');
                emptyElement.className = 'empty-notifications';
                emptyElement.textContent = 'No notifications yet';
                notificationList.appendChild(emptyElement);
                return;
            }
            
            // Sort notifications by time (newest first)
            const sortedNotifications = [...notifications].sort((a, b) => new Date(b.time) - new Date(a.time));
            
            // Add notifications to list
            sortedNotifications.forEach(notification => {
                const notificationItem = document.createElement('div');
                notificationItem.className = 'notification-item';
                if (!notification.read) {
                    notificationItem.classList.add('unread');
                }
                
                // Set icon based on notification type
                let iconClass = 'fas fa-info-circle';
                switch (notification.type) {
                    case 'success':
                        iconClass = 'fas fa-check-circle';
                        break;
                    case 'warning':
                        iconClass = 'fas fa-exclamation-triangle';
                        break;
                    case 'error':
                        iconClass = 'fas fa-times-circle';
                        break;
                }
                
                notificationItem.innerHTML = `
                    <div class="notification-icon">
                        <i class="${iconClass}"></i>
                    </div>
                    <div class="notification-body">
                        <div class="notification-message">${notification.message}</div>
                        <div class="notification-time">${formatTimeAgo(notification.time)}</div>
                    </div>
                    ${!notification.read ? '<div class="notification-dot"></div>' : ''}
                `;
                
                // Add click event to mark as read
                notificationItem.addEventListener('click', () => markNotificationAsRead(notification.id));
                
                notificationList.appendChild(notificationItem);
            });
        }
        
        // Mark notification as read
        function markNotificationAsRead(id) {
            const index = notifications.findIndex(n => n.id === id);
            if (index !== -1) {
                notifications[index].read = true;
                localStorage.setItem('notifications', JSON.stringify(notifications));
                
                // Re-render notifications
                renderNotifications();
                
                // Update notification badge
                updateNotificationBadge();
            }
        }
        
        // Mark all notifications as read
        function markAllNotificationsAsRead() {
            notifications.forEach(notification => {
                notification.read = true;
            });
            
            localStorage.setItem('notifications', JSON.stringify(notifications));
            
            // Re-render notifications
            renderNotifications();
            
            // Update notification badge
            updateNotificationBadge();
            
            // Show toast
            showToast('All notifications marked as read', 'success');
        }
        
        // Update notification badge
        function updateNotificationBadge() {
            const badge = document.getElementById('notification-badge');
            const unreadCount = notifications.filter(n => !n.read).length;
            
            if (unreadCount > 0) {
                badge.textContent = unreadCount;
                badge.style.display = 'flex';
            } else {
                badge.style.display = 'none';
            }
        }
        
        // Start global timer
        function startGlobalTimer() {
            document.getElementById('timer-start').style.display = 'none';
            document.getElementById('timer-pause').style.display = 'inline-block';
            
            clearInterval(globalTimer.interval);
            globalTimer.interval = setInterval(updateTimer, 1000);
        }
        
        // Pause global timer
        function pauseGlobalTimer() {
            document.getElementById('timer-pause').style.display = 'none';
            document.getElementById('timer-start').style.display = 'inline-block';
            
            clearInterval(globalTimer.interval);
            
            // If a task is active, show time spent
            if (activeTask) {
                const task = tasks.find(t => t.id === activeTask);
                if (task) {
                    showToast(`Time spent on "${task.title}": ${formatTimeDisplay(task.timeSpent)}`, 'info');
                }
            }
        }
        
        // Reset global timer
        function resetGlobalTimer() {
            globalTimer.seconds = 0;
            globalTimer.minutes = 0;
            globalTimer.hours = 0;
            updateTimerDisplay();
        }
        
        // Update timer
        function updateTimer() {
            globalTimer.seconds++;
            
            if (globalTimer.seconds >= 60) {
                globalTimer.seconds = 0;
                globalTimer.minutes++;
                
                if (globalTimer.minutes >= 60) {
                    globalTimer.minutes = 0;
                    globalTimer.hours++;
                }
            }
            
            updateTimerDisplay();
            
            // Update active task time
            if (activeTask) {
                const taskIndex = tasks.findIndex(t => t.id === activeTask);
                if (taskIndex !== -1) {
                    tasks[taskIndex].timeSpent++;
                    
                    // Save tasks to local storage
                    localStorage.setItem('tasks', JSON.stringify(tasks));
                }
            }
        }
        
        // Update timer display
        function updateTimerDisplay() {
            const display = document.getElementById('timer-display');
            display.textContent = formatTimeDisplay(globalTimer.hours * 3600 + globalTimer.minutes * 60 + globalTimer.seconds);
        }
        
        // Format time display (HH:MM:SS)
        function formatTimeDisplay(totalSeconds) {
            const hours = Math.floor(totalSeconds / 3600);
            const minutes = Math.floor((totalSeconds % 3600) / 60);
            const seconds = totalSeconds % 60;
            
            return `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
        }
        
        // Start task timer
        function startTaskTimer(taskId) {
            // If another task is active, pause it
            if (activeTask && activeTask !== taskId) {
                const activeTaskElement = document.querySelector(`[data-task-id="${activeTask}"] .timer-btn-task`);
                if (activeTaskElement) {
                    activeTaskElement.innerHTML = '<i class="fas fa-play"></i> Start';
                }
                
                // Show notification about switching tasks
                showToast('Switched to new task', 'info');
            }
            
            // Set active task
            activeTask = taskId;
            
            // Update button
            const taskElement = document.querySelector(`[data-task-id="${taskId}"]`);
            const timerButton = taskElement.querySelector('.timer-btn-task');
            timerButton.innerHTML = '<i class="fas fa-pause"></i> Pause';
            
            // Start global timer if not running
            if (document.getElementById('timer-start').style.display !== 'none') {
                startGlobalTimer();
            }
        }
        
        // Pause task timer
        function pauseTaskTimer(taskId) {
            // Clear active task
            activeTask = null;
            
            // Update button
            const taskElement = document.querySelector(`[data-task-id="${taskId}"]`);
            const timerButton = taskElement.querySelector('.timer-btn-task');
            timerButton.innerHTML = '<i class="fas fa-play"></i> Start';
            
            // Get task info
            const task = tasks.find(t => t.id === taskId);
            
            // Show time spent notification
            showToast(`Time spent on "${task.title}": ${formatTimeDisplay(task.timeSpent)}`, 'info');
        }
        
        // Toggle task timer
        function toggleTaskTimer(taskId) {
            const taskElement = document.querySelector(`[data-task-id="${taskId}"]`);
            const timerButton = taskElement.querySelector('.timer-btn-task');
            
            if (activeTask === taskId) {
                pauseTaskTimer(taskId);
            } else {
                startTaskTimer(taskId);
            }
        }
        
        // Reset add task form
        function resetAddTaskForm() {
            document.getElementById('add-task-form').reset();
            
            // Clear subtasks
            document.getElementById('subtasks-container').innerHTML = '';
            
            // Reset due date picker
            const dueDatePicker = document.getElementById('task-due-date')._flatpickr;
            if (dueDatePicker) {
                dueDatePicker.setDate(null);
            }
            
            // Populate category select
            populateCategories('task-category');
        }
        
        // Add subtask field
        function addSubtaskField(container = 'subtasks-container', value = '') {
            const subtasksContainer = document.getElementById(container);
            
            const subtaskForm = document.createElement('div');
            subtaskForm.className = 'subtask-form';
            
            subtaskForm.innerHTML = `
                <input type="text" class="form-control" value="${value}" placeholder="Enter subtask...">
                <button type="button" class="remove-subtask-btn">
                    <i class="fas fa-times"></i>
                </button>
            `;
            
            // Add event listener to remove button
            subtaskForm.querySelector('.remove-subtask-btn').addEventListener('click', function() {
                subtasksContainer.removeChild(subtaskForm);
            });
            
            subtasksContainer.appendChild(subtaskForm);
        }
        
        // Populate category filters
        function populateCategoryFilters() {
            const categoryFilter = document.getElementById('category-filter');
            
            // Clear previous options (except "All")
            while (categoryFilter.options.length > 1) {
                categoryFilter.remove(1);
            }
            
            // Add categories to filter
            categories.forEach(category => {
                const option = document.createElement('option');
                option.value = category;
                option.textContent = category;
                categoryFilter.appendChild(option);
            });
        }
        
        // Populate categories in select input
        function populateCategories(selectId) {
            const categorySelect = document.getElementById(selectId);
            
            // Clear previous options
            categorySelect.innerHTML = '';
            
            // Add categories to select
            categories.forEach(category => {
                const option = document.createElement('option');
                option.value = category;
                option.textContent = category;
                categorySelect.appendChild(option);
            });
        }
        
        // Open category popup
        function openCategoryPopup() {
            populateCategoriesList();
            openPopup('category-popup');
        }
        
        // Populate categories list in category popup
        function populateCategoriesList() {
            const categoriesList = document.getElementById('categories-list');
            
            // Clear previous categories
            categoriesList.innerHTML = '';
            
            // Add categories to list
            categories.forEach(category => {
                const categoryItem = document.createElement('div');
                categoryItem.className = 'category-item';
                
                categoryItem.innerHTML = `
                    <div class="category-name">${category}</div>
                    <div class="category-actions">
                        <button class="category-action-btn category-edit-btn" data-category="${category}">
                            <i class="fas fa-edit"></i>
                        </button>
                        <button class="category-action-btn category-delete-btn" data-category="${category}">
                            <i class="fas fa-trash-alt"></i>
                        </button>
                    </div>
                `;
                
                // Add event listeners
                categoryItem.querySelector('.category-edit-btn').addEventListener('click', editCategory);
                categoryItem.querySelector('.category-delete-btn').addEventListener('click', deleteCategory);
                
                categoriesList.appendChild(categoryItem);
            });
        }
        
        // Add new category
        function addCategory() {
            const categoryInput = document.getElementById('new-category-input');
            const categoryName = categoryInput.value.trim();
            
            if (!categoryName) {
                showToast('Please enter a category name.', 'error');
                return;
            }
            
            // Check if category already exists
            if (categories.includes(categoryName)) {
                showToast('This category already exists.', 'error');
                return;
            }
            
            // Add category
            categories.push(categoryName);
            
            // Save to local storage
            localStorage.setItem('categories', JSON.stringify(categories));
            
            // Clear input
            categoryInput.value = '';
            
            // Refresh categories list
            populateCategoriesList();
            
            // Update category filters
            populateCategoryFilters();
            
            // Show success message
            showToast(`Category "${categoryName}" added successfully.`, 'success');
            
            // Add notification
            addNotification({
                id: generateId(),
                type: 'success',
                message: `New category "${categoryName}" was added`,
                time: new Date().toISOString(),
                read: false
            });
        }
        
        // Edit category
        function editCategory() {
            const categoryName = this.getAttribute('data-category');
            const newName = prompt(`Edit category "${categoryName}":`, categoryName);
            
            if (!newName || newName.trim() === '') return;
            
            // Check if new name already exists
            if (categories.includes(newName) && newName !== categoryName) {
                showToast('This category already exists.', 'error');
                return;
            }
            
            // Update category name
            const index = categories.indexOf(categoryName);
            if (index !== -1) {
                categories[index] = newName;
                
                // Update tasks with this category
                tasks.forEach(task => {
                    if (task.category === categoryName) {
                        task.category = newName;
                    }
                });
                
                // Save to local storage
                localStorage.setItem('categories', JSON.stringify(categories));
                localStorage.setItem('tasks', JSON.stringify(tasks));
                
                // Refresh categories list
                populateCategoriesList();
                
                // Update category filters
                populateCategoryFilters();
                
                // Show success message
                showToast(`Category renamed to "${newName}".`, 'success');
                
                // Re-render tasks
                renderTasks();
            }
        }
        
        // Delete category
        function deleteCategory() {
            const categoryName = this.getAttribute('data-category');
            
            if (!confirm(`Are you sure you want to delete the category "${categoryName}"?`)) return;
            
            // Remove category
            const index = categories.indexOf(categoryName);
            if (index !== -1) {
                categories.splice(index, 1);
                
                // Update tasks with this category to default category
                tasks.forEach(task => {
                    if (task.category === categoryName) {
                        task.category = categories[0] || 'Uncategorized';
                    }
                });
                
                // Save to local storage
                localStorage.setItem('categories', JSON.stringify(categories));
                localStorage.setItem('tasks', JSON.stringify(tasks));
                
                // Refresh categories list
                populateCategoriesList();
                
                // Update category filters
                populateCategoryFilters();
                
                // Show success message
                showToast(`Category "${categoryName}" deleted.`, 'success');
                
                // Re-render tasks
                renderTasks();
                
                // Add notification
                addNotification({
                    id: generateId(),
                    type: 'warning',
                    message: `Category "${categoryName}" was deleted`,
                    time: new Date().toISOString(),
                    read: false
                });
            }
        }
        
        // Handle due date filter
        function handleDueDateFilter() {
            const dueDateFilter = document.getElementById('due-date-filter');
            
            if (dueDateFilter.value === 'custom') {
                openPopup('date-range-popup');
            } else {
                applyFilters();
            }
        }
        
        // Apply date range filter
        function applyDateRangeFilter() {
            const startDateInput = document.getElementById('date-range-start');
            const endDateInput = document.getElementById('date-range-end');
            
            const startDate = startDateInput._flatpickr.selectedDates[0];
            const endDate = endDateInput._flatpickr.selectedDates[0];
            
            if (!startDate || !endDate) {
                showToast('Please select both start and end dates.', 'error');
                return;
            }
            
            if (endDate < startDate) {
                showToast('End date cannot be before start date.', 'error');
                return;
            }
            
            // Set date range filter
            dateRangeFilter.start = startDate;
            dateRangeFilter.end = endDate;
            
            // Close popup and apply filters
            closePopup('date-range-popup');
            applyFilters();
        }
        
        // Apply filters to tasks
        function applyFilters() {
            const statusFilter = document.getElementById('status-filter').value;
            const categoryFilter = document.getElementById('category-filter').value;
            const priorityFilter = document.getElementById('priority-filter').value;
            const dueDateFilter = document.getElementById('due-date-filter').value;
            const sortOption = document.getElementById('sort-select').value;
            const searchInput = document.getElementById('search-input').value.toLowerCase();
            
            // Apply filters to all tasks
            let filteredTasks = [...tasks];
            
            // Status filter
            if (statusFilter !== 'all') {
                filteredTasks = filteredTasks.filter(task => {
                    if (statusFilter === 'active') return !task.completed;
                    if (statusFilter === 'completed') return task.completed;
                    return true;
                });
            }
            
            // Category filter
            if (categoryFilter !== 'all') {
                filteredTasks = filteredTasks.filter(task => task.category === categoryFilter);
            }
            
            // Priority filter
            if (priorityFilter !== 'all') {
                filteredTasks = filteredTasks.filter(task => task.priority === priorityFilter);
            }
            
            // Due date filter
            if (dueDateFilter !== 'all') {
                const today = new Date();
                today.setHours(0, 0, 0, 0);
                
                const oneWeekLater = new Date(today);
                oneWeekLater.setDate(today.getDate() + 7);
                
                const oneMonthLater = new Date(today);
                oneMonthLater.setMonth(today.getMonth() + 1);
                
                filteredTasks = filteredTasks.filter(task => {
                    const dueDate = new Date(task.dueDate);
                    dueDate.setHours(0, 0, 0, 0);
                    
                    if (dueDateFilter === 'today') return dueDate.getTime() === today.getTime();
                    if (dueDateFilter === 'week') return dueDate >= today && dueDate <= oneWeekLater;
                    if (dueDateFilter === 'month') return dueDate >= today && dueDate <= oneMonthLater;
                    if (dueDateFilter === 'custom' && dateRangeFilter.start && dateRangeFilter.end) {
                        return dueDate >= dateRangeFilter.start && dueDate <= dateRangeFilter.end;
                    }
                    
                    return true;
                });
            }
            
            // Search filter
            if (searchInput) {
                filteredTasks = filteredTasks.filter(task => {
                    return task.title.toLowerCase().includes(searchInput) || 
                           task.description.toLowerCase().includes(searchInput);
                });
            }
            
            // Sort tasks
            switch (sortOption) {
                case 'due-asc':
                    filteredTasks.sort((a, b) => new Date(a.dueDate) - new Date(b.dueDate));
                    break;
                case 'due-desc':
                    filteredTasks.sort((a, b) => new Date(b.dueDate) - new Date(a.dueDate));
                    break;
                case 'title-asc':
                    filteredTasks.sort((a, b) => a.title.localeCompare(b.title));
                    break;
                case 'title-desc':
                    filteredTasks.sort((a, b) => b.title.localeCompare(a.title));
                    break;
                case 'priority-asc':
                    const priorityOrder = { low: 1, medium: 2, high: 3 };
                    filteredTasks.sort((a, b) => priorityOrder[a.priority] - priorityOrder[b.priority]);
                    break;
                case 'priority-desc':
                    const priorityOrderDesc = { low: 1, medium: 2, high: 3 };
                    filteredTasks.sort((a, b) => priorityOrderDesc[b.priority] - priorityOrderDesc[a.priority]);
                    break;
            }
            
            // Render filtered tasks
            renderTasksList(filteredTasks);
        }
        
        // Add new task
        function addTask() {
            const title = document.getElementById('task-title').value.trim();
            const description = document.getElementById('task-description').value.trim();
            const dueDate = document.getElementById('task-due-date').value;
            const priority = document.getElementById('task-priority').value;
            const category = document.getElementById('task-category').value;
            const notes = document.getElementById('task-notes').value.trim();
            
            // Validate inputs
            if (!title || !dueDate || !priority || !category) {
                showToast('Please fill in all required fields.', 'error');
                return;
            }
            
            // Get subtasks
            const subtasksContainer = document.getElementById('subtasks-container');
            const subtaskInputs = subtasksContainer.querySelectorAll('input');
            const subtasks = [];
            
            subtaskInputs.forEach(input => {
                const subtaskText = input.value.trim();
                if (subtaskText) {
                    subtasks.push({
                        id: generateId(),
                        text: subtaskText,
                        completed: false
                    });
                }
            });
            
            // Create new task
            const newTask = {
                id: generateId(),
                title,
                description,
                dueDate,
                priority,
                category,
                notes,
                completed: false,
                subtasks,
                timeSpent: 0,
                createdAt: new Date().toISOString()
            };
            
            // Save action for undo
            saveAction('add', null, newTask);
            
            // Add task to tasks array
            tasks.unshift(newTask);
            
            // Save to local storage
            localStorage.setItem('tasks', JSON.stringify(tasks));
            
            // Close popup
            closePopup('add-task-popup');
            
            // Re-render tasks
            renderTasks();
            
            // Show success message
            showToast('Task added successfully!', 'success');
            
            // Update insights
            updateTaskStats();
            updateInsights();
            
            // Add notification
            addNotification({
                id: generateId(),
                type: 'success',
                message: `New task "${title}" was added`,
                time: new Date().toISOString(),
                read: false
            });
        }
        
        // Open edit task popup
        function openEditTaskPopup(taskId) {
            const task = tasks.find(t => t.id === taskId);
            if (!task) return;
            
            // Populate form fields
            document.getElementById('edit-task-id').value = task.id;
            document.getElementById('edit-task-title').value = task.title;
            document.getElementById('edit-task-description').value = task.description;
            document.getElementById('edit-task-due-date')._flatpickr.setDate(task.dueDate);
            document.getElementById('edit-task-priority').value = task.priority;
            
            // Populate categories
            populateCategories('edit-task-category');
            document.getElementById('edit-task-category').value = task.category;
            
            document.getElementById('edit-task-notes').value = task.notes;
            
            // Clear subtasks
            document.getElementById('edit-subtasks-container').innerHTML = '';
            
            // Add subtasks
            task.subtasks.forEach(subtask => {
                addSubtaskField('edit-subtasks-container', subtask.text);
            });
            
            // Open popup
            openPopup('edit-task-popup');
        }
        
        // Save edited task
        function saveEditedTask() {
            const taskId = document.getElementById('edit-task-id').value;
            const title = document.getElementById('edit-task-title').value.trim();
            const description = document.getElementById('edit-task-description').value.trim();
            const dueDate = document.getElementById('edit-task-due-date').value;
            const priority = document.getElementById('edit-task-priority').value;
            const category = document.getElementById('edit-task-category').value;
            const notes = document.getElementById('edit-task-notes').value.trim();
            
            // Validate inputs
            if (!title || !dueDate || !priority || !category) {
                showToast('Please fill in all required fields.', 'error');
                return;
            }
            
            // Get subtasks
            const subtasksContainer = document.getElementById('edit-subtasks-container');
            const subtaskInputs = subtasksContainer.querySelectorAll('input');
            const subtasks = [];
            
            subtaskInputs.forEach(input => {
                const subtaskText = input.value.trim();
                if (subtaskText) {
                    subtasks.push({
                        id: generateId(),
                        text: subtaskText,
                        completed: false
                    });
                }
            });
            
            // Find task index
            const taskIndex = tasks.findIndex(t => t.id === taskId);
            if (taskIndex === -1) return;
            
            // Create updated task
            const oldTask = {...tasks[taskIndex]};
            const updatedTask = {
                ...oldTask,
                title,
                description,
                dueDate,
                priority,
                category,
                notes,
                subtasks,
                updatedAt: new Date().toISOString()
            };
            
            // Save action for undo
            saveAction('edit', oldTask, updatedTask);
            
            // Update task
            tasks[taskIndex] = updatedTask;
            
            // Save to local storage
            localStorage.setItem('tasks', JSON.stringify(tasks));
            
            // Close popup
            closePopup('edit-task-popup');
            
            // Re-render tasks
            renderTasks();
            
            // Show success message
            showToast('Task updated successfully!', 'success');
            
            // Update insights
            updateInsights();
            
            // Add notification
            addNotification({
                id: generateId(),
                type: 'info',
                message: `Task "${title}" was updated`,
                time: new Date().toISOString(),
                read: false
            });
        }
        
        // Open view task popup
        function openViewTaskPopup(taskId) {
            const task = tasks.find(t => t.id === taskId);
            if (!task) return;
            
            // Populate task details
            document.getElementById('view-task-title').textContent = task.title;
            
            // Task meta info
            const metaContainer = document.getElementById('view-task-meta');
            metaContainer.innerHTML = '';
            
            // Due date with status color
            const now = new Date();
            const dueDate = new Date(task.dueDate);
            let dueDateClass = '';
            
            if (dueDate < now) {
                dueDateClass = 'task-priority high';
            } else if (dueDate < new Date(now.getTime() + 48 * 60 * 60 * 1000)) {
                dueDateClass = 'task-priority medium';
            } else {
                dueDateClass = 'task-priority low';
            }
            
            const dueDateElement = document.createElement('div');
            dueDateElement.className = dueDateClass;
            dueDateElement.innerHTML = `<i class="far fa-calendar-alt"></i> ${formatDate(task.dueDate)}`;
            metaContainer.appendChild(dueDateElement);
            
            // Priority
            const priorityElement = document.createElement('div');
            priorityElement.className = `task-priority ${task.priority}`;
            priorityElement.innerHTML = `<i class="fas fa-flag"></i> ${capitalizeFirstLetter(task.priority)}`;
            metaContainer.appendChild(priorityElement);
            
            // Category
            const categoryElement = document.createElement('div');
            categoryElement.className = 'task-category';
            categoryElement.innerHTML = `<i class="fas fa-tag"></i> ${task.category}`;
            metaContainer.appendChild(categoryElement);
            
            // Description
            document.getElementById('view-task-description').textContent = task.description || 'No description provided.';
            
            // Subtasks
            const subtasksContainer = document.getElementById('view-subtasks-container');
            const subtasksList = document.getElementById('view-subtasks-list');
            
            if (task.subtasks.length > 0) {
                subtasksContainer.style.display = 'block';
                subtasksList.innerHTML = '';
                
                task.subtasks.forEach(subtask => {
                    const subtaskItem = document.createElement('div');
                    subtaskItem.className = 'subtask-item';
                    subtaskItem.innerHTML = `
                        <i class="far fa-circle"></i>
                        <span>${subtask.text}</span>
                    `;
                    subtasksList.appendChild(subtaskItem);
                });
            } else {
                subtasksContainer.style.display = 'none';
            }
            
            // Notes
            const notesContainer = document.getElementById('view-notes-container');
            
            if (task.notes) {
                notesContainer.style.display = 'block';
                document.getElementById('view-task-notes').textContent = task.notes;
            } else {
                notesContainer.style.display = 'none';
            }
            
            // Time spent
            document.getElementById('view-task-time').textContent = formatTimeDisplay(task.timeSpent);
            
            // Edit button event
            document.getElementById('view-task-edit-btn').onclick = () => {
                closePopup('view-task-popup');
                openEditTaskPopup(taskId);
            };
            
            // Open popup
            openPopup('view-task-popup');
        }
        
        // Toggle task completion
        function toggleTaskCompletion(taskId) {
            const taskIndex = tasks.findIndex(t => t.id === taskId);
            if (taskIndex === -1) return;
            
            // Create a copy of the task before the change
            const oldTask = {...tasks[taskIndex]};
            
            // Toggle completion status
            tasks[taskIndex].completed = !tasks[taskIndex].completed;
            
            // If the task is active and now completed, stop the timer
            if (activeTask === taskId && tasks[taskIndex].completed) {
                pauseTaskTimer(taskId);
            }
            
            // Save action for undo
            saveAction('edit', oldTask, tasks[taskIndex]);
            
            // Save to local storage
            localStorage.setItem('tasks', JSON.stringify(tasks));
            
            // Re-render tasks
            renderTasks();
            
            // Show message
            const taskTitle = tasks[taskIndex].title;
            if (tasks[taskIndex].completed) {
                showToast(`Task "${taskTitle}" marked as complete!`, 'success');
                
                // Add notification
                addNotification({
                    id: generateId(),
                    type: 'success',
                    message: `Task "${taskTitle}" was completed`,
                    time: new Date().toISOString(),
                    read: false
                });
            } else {
                showToast(`Task "${taskTitle}" marked as incomplete.`, 'info');
            }
            
            // Update task statistics
            updateTaskStats();
            
            // Update insights
            updateInsights();
            
            // Refresh graphs if graph view is active
            if (document.getElementById('graph-view').style.display !== 'none') {
                initializeGraphs();
            }
        }
        
        // Delete task
        function deleteTask(taskId) {
            if (!confirm('Are you sure you want to delete this task?')) return;
            
            const taskIndex = tasks.findIndex(t => t.id === taskId);
            if (taskIndex === -1) return;
            
            // Get task info for undo and notification
            const deletedTask = tasks[taskIndex];
            
            // Save action for undo
            saveAction('delete', deletedTask, null);
            
            // If the task is active, stop the timer
            if (activeTask === taskId) {
                pauseTaskTimer(taskId);
                activeTask = null;
            }
            
            // Remove task
            tasks.splice(taskIndex, 1);
            
            // Save to local storage
            localStorage.setItem('tasks', JSON.stringify(tasks));
            
            // Re-render tasks
            renderTasks();
            
            // Show success message
            showToast(`Task "${deletedTask.title}" deleted.`, 'success');
            
            // Update task statistics
            updateTaskStats();
            
            // Update insights
            updateInsights();
            
            // Refresh graphs if graph view is active
            if (document.getElementById('graph-view').style.display !== 'none') {
                initializeGraphs();
            }
            
            // Add notification
            addNotification({
                id: generateId(),
                type: 'warning',
                message: `Task "${deletedTask.title}" was deleted`,
                time: new Date().toISOString(),
                read: false
            });
        }
        
        // Share task
        function shareTask(taskId) {
            const task = tasks.find(t => t.id === taskId);
            if (!task) return;
            
            // Set task title in share popup
            document.getElementById('share-task-title').textContent = `Share: ${task.title}`;
            
            // Reset share methods
            document.querySelectorAll('.share-option').forEach(option => {
                option.classList.remove('selected');
            });
            
            document.getElementById('share-users-list').style.display = 'none';
            document.getElementById('share-email-form').style.display = 'none';
            document.getElementById('share-link').style.display = 'none';
            document.getElementById('share-social').style.display = 'none';
            
            // Reset share button state
            document.getElementById('share-submit-btn').disabled = true;
            
            // Add event listeners to share options
            document.querySelectorAll('.share-option').forEach(option => {
                option.onclick = function() {
                    // Remove selected class from all options
                    document.querySelectorAll('.share-option').forEach(opt => {
                        opt.classList.remove('selected');
                    });
                    
                    // Add selected class to clicked option
                    this.classList.add('selected');
                    
                    // Hide all sharing forms
                    document.getElementById('share-users-list').style.display = 'none';
                    document.getElementById('share-email-form').style.display = 'none';
                    document.getElementById('share-link').style.display = 'none';
                    document.getElementById('share-social').style.display = 'none';
                    
                    // Show the selected form
                    const method = this.getAttribute('data-method');
                    
                    if (method === 'users') {
                        document.getElementById('share-users-list').style.display = 'block';
                        renderShareUsersList();
                    } else if (method === 'email') {
                        document.getElementById('share-email-form').style.display = 'block';
                    } else if (method === 'link') {
                        document.getElementById('share-link').style.display = 'block';
                        document.getElementById('share-link-input').value = `https://example.com/tasks/${taskId}`;
                    } else if (method === 'social') {
                        document.getElementById('share-social').style.display = 'block';
                    }
                    
                    // Enable share button
                    document.getElementById('share-submit-btn').disabled = false;
                };
            });
            
            // Set share button click handler
            document.getElementById('share-submit-btn').onclick = function() {
                const selectedOption = document.querySelector('.share-option.selected');
                if (!selectedOption) return;
                
                const method = selectedOption.getAttribute('data-method');
                let shareMessage = '';
                
                if (method === 'users') {
                    const selectedUsers = getSelectedShareUsers();
                    if (selectedUsers.length === 0) {
                        showToast('Please select at least one user to share with.', 'error');
                        return;
                    }
                    
                    shareMessage = `Task shared with ${selectedUsers.length} user(s)`;
                } else if (method === 'email') {
                    const email = document.getElementById('share-email').value;
                    if (!email) {
                        showToast('Please enter at least one email address.', 'error');
                        return;
                    }
                    
                    shareMessage = `Task shared via email`;
                } else if (method === 'link') {
                    navigator.clipboard.writeText(document.getElementById('share-link-input').value)
                        .then(() => {
                            showToast('Link copied to clipboard!', 'success');
                        })
                        .catch(() => {
                            showToast('Failed to copy link. Please copy it manually.', 'error');
                        });
                    
                    shareMessage = `Share link generated`;
                } else if (method === 'social') {
                    shareMessage = `Task shared via social media`;
                }
                
                showToast(shareMessage, 'success');
                
                // Add notification
                addNotification({
                    id: generateId(),
                    type: 'info',
                    message: `Task "${task.title}" was shared`,
                    time: new Date().toISOString(),
                    read: false
                });
                
                closePopup('share-popup');
            };
            
            // Set copy link button handler
            document.getElementById('copy-link-btn').onclick = function() {
                navigator.clipboard.writeText(document.getElementById('share-link-input').value)
                    .then(() => {
                        showToast('Link copied to clipboard!', 'success');
                    })
                    .catch(() => {
                        showToast('Failed to copy link. Please copy it manually.', 'error');
                    });
            };
            
            // Open share popup
            openPopup('share-popup');
        }
        
        // Render users list for sharing
        function renderShareUsersList() {
            const usersList = document.getElementById('share-user-list');
            usersList.innerHTML = '';
            
            // Filter out current user
            const otherUsers = users.filter(user => !currentUser || user.id !== currentUser.id);
            
            if (otherUsers.length === 0) {
                usersList.innerHTML = '<div style="text-align: center; padding: 20px;">No other users available</div>';
                return;
            }
            
            // Add users to list
            otherUsers.forEach(user => {
                const userItem = document.createElement('div');
                userItem.className = 'share-user-item';
                
                userItem.innerHTML = `
                    <img src="${user.profilePicture}" alt="${user.firstName}" class="share-user-avatar">
                    <div class="share-user-info">
                        <div class="share-user-name">${user.firstName} ${user.lastName}</div>
                        <div class="share-user-email">${user.email}</div>
                    </div>
                    <input type="checkbox" class="share-user-checkbox" data-user-id="${user.id}">
                `;
                
                usersList.appendChild(userItem);
            });
        }
        
        // Get selected users for sharing
        function getSelectedShareUsers() {
            const checkboxes = document.querySelectorAll('.share-user-checkbox:checked');
            const selectedUsers = [];
            
            checkboxes.forEach(checkbox => {
                const userId = checkbox.getAttribute('data-user-id');
                const user = users.find(u => u.id === userId);
                if (user) {
                    selectedUsers.push(user);
                }
            });
            
            return selectedUsers;
        }
        
        // Toggle task selection
        function toggleTaskSelection(taskId) {
            const index = selectedTasks.indexOf(taskId);
            
            if (index === -1) {
                // Add to selected tasks
                selectedTasks.push(taskId);
            } else {
                // Remove from selected tasks
                selectedTasks.splice(index, 1);
            }
            
            // Update UI
            updateMultiActionBar();
        }
        
        // Update multi-action bar
        function updateMultiActionBar() {
            const multiActionBar = document.getElementById('multi-action-bar');
            const selectedCount = document.getElementById('selected-count');
            
            if (selectedTasks.length > 0) {
                selectedCount.textContent = selectedTasks.length;
                multiActionBar.classList.add('show');
            } else {
                multiActionBar.classList.remove('show');
            }
        }
        
        // Complete selected tasks
        function completeSelectedTasks() {
            if (selectedTasks.length === 0) return;
            
            // Save action for undo
            const oldTasks = [];
            const newTasks = [];
            
            // Mark selected tasks as complete
            selectedTasks.forEach(taskId => {
                const taskIndex = tasks.findIndex(t => t.id === taskId);
                if (taskIndex !== -1) {
                    oldTasks.push({...tasks[taskIndex]});
                    
                    tasks[taskIndex].completed = true;
                    
                    newTasks.push({...tasks[taskIndex]});
                    
                    // If the task is active, stop the timer
                    if (activeTask === taskId) {
                        pauseTaskTimer(taskId);
                    }
                }
            });
            
            // Save action for undo
            saveAction('multi-edit', oldTasks, newTasks);
            
            // Save to local storage
            localStorage.setItem('tasks', JSON.stringify(tasks));
            
            // Reset selected tasks
            selectedTasks = [];
            
            // Re-render tasks
            renderTasks();
            
            // Hide multi-action bar
            document.getElementById('multi-action-bar').classList.remove('show');
            
            // Show success message
            showToast(`${oldTasks.length} tasks marked as complete!`, 'success');
            
            // Update task statistics
            updateTaskStats();
            
            // Update insights
            updateInsights();
            
            // Add notification
            addNotification({
                id: generateId(),
                type: 'success',
                message: `${oldTasks.length} tasks were marked as complete`,
                time: new Date().toISOString(),
                read: false
            });
        }
        
        // Delete selected tasks
        function deleteSelectedTasks() {
            if (selectedTasks.length === 0) return;
            
            if (!confirm(`Are you sure you want to delete ${selectedTasks.length} tasks?`)) return;
            
            // Save deleted tasks for undo
            const deletedTasks = [];
            
            // Delete selected tasks
            selectedTasks.forEach(taskId => {
                const taskIndex = tasks.findIndex(t => t.id === taskId);
                if (taskIndex !== -1) {
                    deletedTasks.push({...tasks[taskIndex]});
                    
                    // If the task is active, stop the timer
                    if (activeTask === taskId) {
                        pauseTaskTimer(taskId);
                        activeTask = null;
                    }
                    
                    // Remove task
                    tasks.splice(taskIndex, 1);
                }
            });
            
            // Save action for undo
            saveAction('multi-delete', deletedTasks, null);
            
            // Save to local storage
            localStorage.setItem('tasks', JSON.stringify(tasks));
            
            // Reset selected tasks
            selectedTasks = [];
            
            // Re-render tasks
            renderTasks();
            
            // Hide multi-action bar
            document.getElementById('multi-action-bar').classList.remove('show');
            
            // Show success message
            showToast(`${deletedTasks.length} tasks deleted.`, 'success');
            
            // Update task statistics
            updateTaskStats();
            
            // Update insights
            updateInsights();
            
            // Add notification
            addNotification({
                id: generateId(),
                type: 'warning',
                message: `${deletedTasks.length} tasks were deleted`,
                time: new Date().toISOString(),
                read: false
            });
        }
        
        // Cancel multi-select
        function cancelMultiSelect() {
            // Reset selected tasks
            selectedTasks = [];
            
            // Re-render tasks
            renderTasks();
            
            // Hide multi-action bar
            document.getElementById('multi-action-bar').classList.remove('show');
        }
        
        // Save action for undo/redo
        function saveAction(type, oldData, newData) {
            // Remove any actions after current index
            if (actionHistoryIndex < actionHistory.length - 1) {
                actionHistory = actionHistory.slice(0, actionHistoryIndex + 1);
            }
            
            // Add new action
            actionHistory.push({ type, oldData, newData });
            
            // Update index
            actionHistoryIndex = actionHistory.length - 1;
            
            // Update undo/redo buttons
            updateUndoRedoButtons();
        }
        
        // Undo action
        function undoAction() {
            if (actionHistoryIndex < 0) return;
            
            const action = actionHistory[actionHistoryIndex];
            
            switch (action.type) {
                case 'add':
                    // Remove the added task
                    const addedTaskIndex = tasks.findIndex(t => t.id === action.newData.id);
                    if (addedTaskIndex !== -1) {
                        tasks.splice(addedTaskIndex, 1);
                    }
                    break;
                
                case 'edit':
                    // Restore the original task
                    const editedTaskIndex = tasks.findIndex(t => t.id === action.oldData.id);
                    if (editedTaskIndex !== -1) {
                        tasks[editedTaskIndex] = {...action.oldData};
                    }
                    break;
                
                case 'delete':
                    // Restore the deleted task
                    tasks.push({...action.oldData});
                    break;
                
                case 'multi-edit':
                    // Restore multiple edited tasks
                    action.oldData.forEach(oldTask => {
                        const taskIndex = tasks.findIndex(t => t.id === oldTask.id);
                        if (taskIndex !== -1) {
                            tasks[taskIndex] = {...oldTask};
                        }
                    });
                    break;
                
                case 'multi-delete':
                    // Restore multiple deleted tasks
                    action.oldData.forEach(oldTask => {
                        tasks.push({...oldTask});
                    });
                    break;
            }
            
            // Save to local storage
            localStorage.setItem('tasks', JSON.stringify(tasks));
            
            // Update index
            actionHistoryIndex--;
            
            // Update undo/redo buttons
            updateUndoRedoButtons();
            
            // Re-render tasks
            renderTasks();
            
            // Update task statistics
            updateTaskStats();
            
            // Update insights
            updateInsights();
            
            // Show message
            showToast('Action undone.', 'info');
        }
        
        // Redo action
        function redoAction() {
            if (actionHistoryIndex >= actionHistory.length - 1) return;
            
            // Update index
            actionHistoryIndex++;
            
            const action = actionHistory[actionHistoryIndex];
            
            switch (action.type) {
                case 'add':
                    // Re-add the task
                    tasks.push({...action.newData});
                    break;
                
                case 'edit':
                    // Re-apply the edit
                    const editedTaskIndex = tasks.findIndex(t => t.id === action.newData.id);
                    if (editedTaskIndex !== -1) {
                        tasks[editedTaskIndex] = {...action.newData};
                    }
                    break;
                
                case 'delete':
                    // Re-delete the task
                    const deletedTaskIndex = tasks.findIndex(t => t.id === action.oldData.id);
                    if (deletedTaskIndex !== -1) {
                        tasks.splice(deletedTaskIndex, 1);
                    }
                    break;
                
                case 'multi-edit':
                    // Re-apply multiple edits
                    action.newData.forEach(newTask => {
                        const taskIndex = tasks.findIndex(t => t.id === newTask.id);
                        if (taskIndex !== -1) {
                            tasks[taskIndex] = {...newTask};
                        }
                    });
                    break;
                
                case 'multi-delete':
                    // Re-delete multiple tasks
                    action.oldData.forEach(oldTask => {
                        const taskIndex = tasks.findIndex(t => t.id === oldTask.id);
                        if (taskIndex !== -1) {
                            tasks.splice(taskIndex, 1);
                        }
                    });
                    break;
            }
            
            // Save to local storage
            localStorage.setItem('tasks', JSON.stringify(tasks));
            
            // Update undo/redo buttons
            updateUndoRedoButtons();
            
            // Re-render tasks
            renderTasks();
            
            // Update task statistics
            updateTaskStats();
            
            // Update insights
            updateInsights();
            
            // Show message
            showToast('Action redone.', 'info');
        }
        
        // Update undo/redo buttons
        function updateUndoRedoButtons() {
            const undoBtn = document.getElementById('undo-btn');
            const redoBtn = document.getElementById('redo-btn');
            
            // Enable/disable undo button
            if (actionHistoryIndex >= 0) {
                undoBtn.disabled = false;
            } else {
                undoBtn.disabled = true;
            }
            
            // Enable/disable redo button
            if (actionHistoryIndex < actionHistory.length - 1) {
                redoBtn.disabled = false;
            } else {
                redoBtn.disabled = true;
            }
        }
        
        // Update task statistics
        function updateTaskStats() {
            const totalCount = tasks.length;
            const completedCount = tasks.filter(task => task.completed).length;
            const pendingCount = totalCount - completedCount;
            
            document.getElementById('total-tasks-count').textContent = totalCount;
            document.getElementById('completed-tasks-count').textContent = completedCount;
            document.getElementById('pending-tasks-count').textContent = pendingCount;
        }
        
        // Initialize graphs
        function initializeGraphs() {
            // Destroy existing charts if they exist
            if (window.completionChart) {
                window.completionChart.destroy();
            }
            if (window.distributionChart) {
                window.distributionChart.destroy();
            }
            
            // Create completion chart (Tasks over time)
            createCompletionChart();
            
            // Create distribution chart (Pie chart)
            createDistributionChart();
        }
        
        // Create tasks completion over time chart
        function createCompletionChart() {
            const ctx = document.getElementById('completion-chart').getContext('2d');
            
            // Group tasks by date
            const tasksByDate = {};
            const now = new Date();
            
            // Create data for the last 7 days
            for (let i = 6; i >= 0; i--) {
                const date = new Date(now);
                date.setDate(now.getDate() - i);
                const dateString = date.toISOString().split('T')[0];
                tasksByDate[dateString] = { completed: 0, pending: 0 };
            }
            
            // Count tasks for each date
            tasks.forEach(task => {
                const createdDate = task.createdAt ? task.createdAt.split('T')[0] : null;
                
                if (createdDate && tasksByDate[createdDate]) {
                    if (task.completed) {
                        tasksByDate[createdDate].completed++;
                    } else {
                        tasksByDate[createdDate].pending++;
                    }
                }
            });
            
            // Prepare data for the chart
            const labels = Object.keys(tasksByDate).map(date => formatDate(date, true));
            const completedData = Object.values(tasksByDate).map(data => data.completed);
            const pendingData = Object.values(tasksByDate).map(data => data.pending);
            
            // Create chart
            window.completionChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: labels,
                    datasets: [
                        {
                            label: 'Completed',
                            data: completedData,
                            backgroundColor: '#28A745',
                            borderColor: '#218838',
                            borderWidth: 1
                        },
                        {
                            label: 'Pending',
                            data: pendingData,
                            backgroundColor: '#FFC107',
                            borderColor: '#E0A800',
                            borderWidth: 1
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        x: {
                            stacked: true,
                            grid: {
                                display: false
                            }
                        },
                        y: {
                            stacked: true,
                            beginAtZero: true,
                            ticks: {
                                precision: 0
                            }
                        }
                    },
                    animation: {
                        duration: 1500,
                        easing: 'easeOutQuart'
                    },
                    plugins: {
                        legend: {
                            position: 'top'
                        },
                        tooltip: {
                            mode: 'index',
                            intersect: false
                        }
                    }
                }
            });
        }
        
        // Create task distribution chart
        function createDistributionChart() {
            const ctx = document.getElementById('distribution-chart').getContext('2d');
            
            // Count tasks by category
            const tasksByCategory = {};
            
            tasks.forEach(task => {
                if (!tasksByCategory[task.category]) {
                    tasksByCategory[task.category] = 0;
                }
                tasksByCategory[task.category]++;
            });
            
            // Prepare data for the chart
            const labels = Object.keys(tasksByCategory);
            const data = Object.values(tasksByCategory);
            
            // Generate colors
            const colors = generatePieChartColors(labels.length);
            
            // Create chart
            window.distributionChart = new Chart(ctx, {
                type: 'pie',
                data: {
                    labels: labels,
                    datasets: [
                        {
                            data: data,
                            backgroundColor: colors.background,
                            borderColor: colors.border,
                            borderWidth: 1
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    animation: {
                        animateRotate: true,
                        animateScale: true,
                        duration: 1500,
                        easing: 'easeOutQuart'
                    },
                    plugins: {
                        legend: {
                            position: 'bottom'
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    const label = context.label || '';
                                    const value = context.raw;
                                    const total = context.dataset.data.reduce((a, b) => a + b, 0);
                                    const percentage = Math.round((value / total) * 100);
                                    return `${label}: ${value} (${percentage}%)`;
                                }
                            }
                        }
                    }
                }
            });
        }
        
        // Generate pie chart colors
        function generatePieChartColors(count) {
            const backgroundColors = [
                'rgba(93, 92, 222, 0.7)',
                'rgba(40, 167, 69, 0.7)',
                'rgba(255, 193, 7, 0.7)',
                'rgba(220, 53, 69, 0.7)',
                'rgba(253, 126, 20, 0.7)',
                'rgba(108, 117, 125, 0.7)',
                'rgba(23, 162, 184, 0.7)',
                'rgba(134, 142, 150, 0.7)',
                'rgba(111, 66, 193, 0.7)',
                'rgba(248, 108, 107, 0.7)'
            ];
            
            const borderColors = [
                'rgba(93, 92, 222, 1)',
                'rgba(40, 167, 69, 1)',
                'rgba(255, 193, 7, 1)',
                'rgba(220, 53, 69, 1)',
                'rgba(253, 126, 20, 1)',
                'rgba(108, 117, 125, 1)',
                'rgba(23, 162, 184, 1)',
                'rgba(134, 142, 150, 1)',
                'rgba(111, 66, 193, 1)',
                'rgba(248, 108, 107, 1)'
            ];
            
            // If we need more colors than we have predefined, generate them
            if (count > backgroundColors.length) {
                for (let i = backgroundColors.length; i < count; i++) {
                    const r = Math.floor(Math.random() * 255);
                    const g = Math.floor(Math.random() * 255);
                    const b = Math.floor(Math.random() * 255);
                    
                    backgroundColors.push(`rgba(${r}, ${g}, ${b}, 0.7)`);
                    borderColors.push(`rgba(${r}, ${g}, ${b}, 1)`);
                }
            }
            
            return {
                background: backgroundColors.slice(0, count),
                border: borderColors.slice(0, count)
            };
        }
        
        // Update insights
        function updateInsights() {
            // Productivity rate
            const totalTasks = tasks.length;
            const completedTasks = tasks.filter(task => task.completed).length;
            const productivityRate = totalTasks > 0 ? Math.round((completedTasks / totalTasks) * 100) : 0;
            
            document.getElementById('productivity-rate').textContent = `${productivityRate}%`;
            
            // Expired tasks
            const now = new Date();
            const expiredTasks = tasks.filter(task => !task.completed && new Date(task.dueDate) < now);
            
            document.getElementById('expired-count').textContent = expiredTasks.length;
            
            const expiredTasksList = document.getElementById('expired-tasks-list');
            expiredTasksList.innerHTML = '';
            
            if (expiredTasks.length > 0) {
                expiredTasks.slice(0, 3).forEach(task => {
                    const item = document.createElement('div');
                    item.className = 'insight-item';
                    item.innerHTML = `
                        <div class="insight-label">${task.title}</div>
                        <div class="insight-number">${formatDate(task.dueDate)}</div>
                    `;
                    expiredTasksList.appendChild(item);
                });
                
                if (expiredTasks.length > 3) {
                    const moreItem = document.createElement('div');
                    moreItem.className = 'insight-item';
                    moreItem.innerHTML = `
                        <div class="insight-label">And ${expiredTasks.length - 3} more...</div>
                        <div class="insight-number"></div>
                    `;
                    expiredTasksList.appendChild(moreItem);
                }
            } else {
                const noItem = document.createElement('div');
                noItem.className = 'insight-item';
                noItem.innerHTML = `
                    <div class="insight-label">No expired tasks</div>
                    <div class="insight-number"></div>
                `;
                expiredTasksList.appendChild(noItem);
            }
            
            // Due soon tasks
            const twoDaysLater = new Date(now.getTime() + 48 * 60 * 60 * 1000);
            const dueSoonTasks = tasks.filter(task => 
                !task.completed && 
                new Date(task.dueDate) >= now && 
                new Date(task.dueDate) <= twoDaysLater
            );
            
            document.getElementById('due-soon-count').textContent = dueSoonTasks.length;
            
            const dueSoonTasksList = document.getElementById('due-soon-tasks-list');
            dueSoonTasksList.innerHTML = '';
            
            if (dueSoonTasks.length > 0) {
                dueSoonTasks.slice(0, 3).forEach(task => {
                    const item = document.createElement('div');
                    item.className = 'insight-item';
                    item.innerHTML = `
                        <div class="insight-label">${task.title}</div>
                        <div class="insight-number">${formatDate(task.dueDate)}</div>
                    `;
                    dueSoonTasksList.appendChild(item);
                });
                
                if (dueSoonTasks.length > 3) {
                    const moreItem = document.createElement('div');
                    moreItem.className = 'insight-item';
                    moreItem.innerHTML = `
                        <div class="insight-label">And ${dueSoonTasks.length - 3} more...</div>
                        <div class="insight-number"></div>
                    `;
                    dueSoonTasksList.appendChild(moreItem);
                }
            } else {
                const noItem = document.createElement('div');
                noItem.className = 'insight-item';
                noItem.innerHTML = `
                    <div class="insight-label">No tasks due soon</div>
                    <div class="insight-number"></div>
                `;
                dueSoonTasksList.appendChild(noItem);
            }
        }
        
        // Export tasks
        function exportTasks() {
            const selectedFormat = document.querySelector('.export-option.selected');
            
            if (!selectedFormat) {
                showToast('Please select a format.', 'error');
                return;
            }
            
            const format = selectedFormat.getAttribute('data-format');
            const fileName = `tasks_export_${new Date().toISOString().split('T')[0]}`;
            
            try {
                switch (format) {
                    case 'pdf':
                        exportToPDF(fileName);
                        break;
                    case 'excel':
                        exportToExcel(fileName);
                        break;
                    case 'json':
                        exportToJSON(fileName);
                        break;
                    case 'docx':
                        exportToDocx(fileName);
                        break;
                }
                
                // Close export popup
                closePopup('export-popup');
                
                // Show success message
                showToast(`Tasks exported to ${format.toUpperCase()} successfully!`, 'success');
            } catch (error) {
                console.error('Export error:', error);
                showToast(`Failed to export tasks: ${error.message}`, 'error');
            }
        }
        
        // Export to PDF
        function exportToPDF(fileName) {
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();
            
            // Add title
            doc.setFontSize(18);
            doc.text('Tasks Export', 105, 15, { align: 'center' });
            
            // Add date
            doc.setFontSize(12);
            doc.text(`Generated on: ${new Date().toLocaleDateString()}`, 105, 25, { align: 'center' });
            
            // Add summary
            doc.setFontSize(14);
            doc.text('Summary:', 20, 40);
            
            doc.setFontSize(12);
            doc.text(`Total Tasks: ${tasks.length}`, 25, 50);
            doc.text(`Completed Tasks: ${tasks.filter(t => t.completed).length}`, 25, 57);
            doc.text(`Pending Tasks: ${tasks.filter(t => !t.completed).length}`, 25, 64);
            
            // Add task list
            doc.setFontSize(14);
            doc.text('Task List:', 20, 80);
            
            let y = 90;
            tasks.forEach((task, index) => {
                // Check if we need a new page
                if (y > 270) {
                    doc.addPage();
                    y = 20;
                }
                
                // Add task details
                doc.setFontSize(12);
                doc.setTextColor(0, 0, 0);
                doc.text(`${index + 1}. ${task.title} ${task.completed ? '(Completed)' : ''}`, 25, y);
                
                y += 7;
                doc.setFontSize(10);
                doc.text(`Due: ${formatDate(task.dueDate)} | Priority: ${capitalizeFirstLetter(task.priority)} | Category: ${task.category}`, 30, y);
                
                if (task.description) {
                    y += 7;
                    const descLines = doc.splitTextToSize(`Description: ${task.description}`, 150);
                    doc.text(descLines, 30, y);
                    y += descLines.length * 5;
                }
                
                if (task.subtasks.length > 0) {
                    y += 7;
                    doc.text('Subtasks:', 30, y);
                    
                    task.subtasks.forEach(subtask => {
                        y += 5;
                        doc.text(`- ${subtask.text}`, 35, y);
                    });
                }
                
                y += 10;
            });
            
            // Save PDF
            doc.save(`${fileName}.pdf`);
        }
        
        // Export to Excel
        function exportToExcel(fileName) {
            // Prepare data for Excel
            const excelData = [
                ['ID', 'Title', 'Description', 'Due Date', 'Priority', 'Category', 'Status', 'Time Spent', 'Subtasks', 'Notes']
            ];
            
            tasks.forEach(task => {
                const subtasksText = task.subtasks.map(s => s.text).join(', ');
                
                excelData.push([
                    task.id,
                    task.title,
                    task.description,
                    task.dueDate,
                    task.priority,
                    task.category,
                    task.completed ? 'Completed' : 'Pending',
                    formatTimeDisplay(task.timeSpent),
                    subtasksText,
                    task.notes
                ]);
            });
            
            // Create worksheet
            const ws = XLSX.utils.aoa_to_sheet(excelData);
            
            // Create workbook
            const wb = XLSX.utils.book_new();
            XLSX.utils.book_append_sheet(wb, ws, 'Tasks');
            
            // Save Excel file
            XLSX.writeFile(wb, `${fileName}.xlsx`);
        }
        
        // Export to JSON
        function exportToJSON(fileName) {
            // Create a Blob with the JSON data
            const data = JSON.stringify(tasks, null, 2);
            const blob = new Blob([data], { type: 'application/json' });
            
            // Create a link and trigger download
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `${fileName}.json`;
            document.body.appendChild(a);
            a.click();
            
            // Clean up
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }
        
        // Export to DOCX (simple text representation)
        function exportToDocx(fileName) {
            // Create a text representation of tasks
            let text = 'TASKS EXPORT\n\n';
            text += `Generated on: ${new Date().toLocaleDateString()}\n\n`;
            
            text += 'SUMMARY:\n';
            text += `Total Tasks: ${tasks.length}\n`;
            text += `Completed Tasks: ${tasks.filter(t => t.completed).length}\n`;
            text += `Pending Tasks: ${tasks.filter(t => !t.completed).length}\n\n`;
            
            text += 'TASK LIST:\n\n';
            
            tasks.forEach((task, index) => {
                text += `${index + 1}. ${task.title} ${task.completed ? '(Completed)' : ''}\n`;
                text += `   Due: ${formatDate(task.dueDate)} | Priority: ${capitalizeFirstLetter(task.priority)} | Category: ${task.category}\n`;
                
                if (task.description) {
                    text += `   Description: ${task.description}\n`;
                }
                
                if (task.subtasks.length > 0) {
                    text += '   Subtasks:\n';
                    task.subtasks.forEach(subtask => {
                        text += `   - ${subtask.text}\n`;
                    });
                }
                
                if (task.notes) {
                    text += `   Notes: ${task.notes}\n`;
                }
                
                text += `   Time Spent: ${formatTimeDisplay(task.timeSpent)}\n\n`;
            });
            
            // Create a Blob with the text data
            const blob = new Blob([text], { type: 'application/vnd.openxmlformats-officedocument.wordprocessingml.document' });
            
            // Create a link and trigger download
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `${fileName}.docx`;
            document.body.appendChild(a);
            a.click();
            
            // Clean up
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }
        
        // Select export format
        function selectExportFormat() {
            // Remove selected class from all options
            document.querySelectorAll('.export-option').forEach(option => {
                option.classList.remove('selected');
            });
            
            // Add selected class to clicked option
            this.classList.add('selected');
            
            // Enable download button
            document.getElementById('export-download-btn').disabled = false;
        }
        
        // Import tasks
        function importTasks() {
            const fileInput = document.getElementById('import-file-input');
            const urlInput = document.getElementById('import-url');
            
            if (fileInput.files.length > 0) {
                // Import from file
                importFromFile(fileInput.files[0]);
            } else if (urlInput.value.trim()) {
                // Import from URL
                importFromUrl(urlInput.value.trim());
            } else {
                showToast('Please select a file or enter a URL.', 'error');
            }
        }
        
        // Import tasks from file
        function importFromFile(file) {
            const reader = new FileReader();
            
            reader.onload = function(e) {
                try {
                    const importedTasks = JSON.parse(e.target.result);
                    processImportedTasks(importedTasks);
                } catch (error) {
                    showToast('Invalid JSON file. Please check the file format.', 'error');
                }
            };
            
            reader.onerror = function() {
                showToast('Error reading file.', 'error');
            };
            
            reader.readAsText(file);
        }
        
        // Import tasks from URL
        function importFromUrl(url) {
            // Show loading toast
            showToast('Importing tasks from URL...', 'info');
            
            // Simplified import from URL (in real app, would use fetch API)
            setTimeout(() => {
                showToast('URL import not implemented in this demo.', 'error');
            }, 1000);
        }
        
        // Process imported tasks
        function processImportedTasks(importedTasks) {
            if (!Array.isArray(importedTasks)) {
                showToast('Invalid data format. Expected an array of tasks.', 'error');
                return;
            }
            
            // Check if imported tasks have the required fields
            const validTasks = importedTasks.filter(task => {
                return task.title && task.dueDate;
            });
            
            if (validTasks.length === 0) {
                showToast('No valid tasks found in the imported data.', 'error');
                return;
            }
            
            // Add IDs to tasks if missing
            validTasks.forEach(task => {
                if (!task.id) {
                    task.id = generateId();
                }
                
                // Add default values for missing fields
                task.completed = task.completed || false;
                task.priority = task.priority || 'medium';
                task.category = task.category || categories[0];
                task.description = task.description || '';
                task.notes = task.notes || '';
                task.subtasks = task.subtasks || [];
                task.timeSpent = task.timeSpent || 0;
                task.createdAt = task.createdAt || new Date().toISOString();
            });
            
            // Add imported tasks to existing tasks
            tasks = [...validTasks, ...tasks];
            
            // Save to local storage
            localStorage.setItem('tasks', JSON.stringify(tasks));
            
            // Close popup
            closePopup('import-popup');
            
            // Re-render tasks
            renderTasks();
            
            // Update task statistics
            updateTaskStats();
            
            // Update insights
            updateInsights();
            
            // Show success message
            showToast(`${validTasks.length} tasks imported successfully!`, 'success');
            
            // Add notification
            addNotification({
                id: generateId(),
                type: 'success',
                message: `${validTasks.length} tasks were imported`,
                time: new Date().toISOString(),
                read: false
            });
            
            // Reset file input
            document.getElementById('import-file-input').value = '';
            document.getElementById('import-url').value = '';
        }
        
        // Render tasks
        function renderTasks() {
            // Update task list
            renderTasksList(tasks);
            
            // Update task counts
            updateTaskStats();
        }
        
        // Render tasks list
        function renderTasksList(tasksList) {
            const taskListContainer = document.getElementById('task-list');
            
            // Clear previous tasks
            taskListContainer.innerHTML = '';
            
            if (tasksList.length === 0) {
                taskListContainer.innerHTML = `
                    <div style="text-align: center; padding: 50px 20px; color: var(--secondary-color);">
                        <i class="fas fa-tasks" style="font-size: 48px; margin-bottom: 15px;"></i>
                        <p>No tasks found. Click "Add Task" to create a new task.</p>
                    </div>
                `;
                return;
            }
            
            // Add tasks to list
            tasksList.forEach(task => {
                const taskElement = document.createElement('div');
                taskElement.className = 'task-item';
                taskElement.setAttribute('data-task-id', task.id);
                taskElement.draggable = true;
                
                // Add task status class
                if (task.completed) {
                    taskElement.classList.add('completed');
                } else {
                    const now = new Date();
                    const dueDate = new Date(task.dueDate);
                    
                    if (dueDate < now) {
                        taskElement.classList.add('expired');
                    } else if (dueDate < new Date(now.getTime() + 48 * 60 * 60 * 1000)) {
                        taskElement.classList.add('due-soon');
                    } else {
                        taskElement.classList.add('due-later');
                    }
                }
                
                taskElement.innerHTML = `
                    <div class="task-checkbox">
                        <input type="checkbox" ${task.completed ? 'checked' : ''}>
                    </div>
                    <div class="task-content">
                        <div class="task-header">
                            <h3 class="task-title">${task.title}</h3>
                        </div>
                        <div class="task-meta">
                            <div class="task-due-date">
                                <i class="far fa-calendar-alt"></i> ${formatDate(task.dueDate)}
                            </div>
                            <div class="task-priority ${task.priority}">
                                <i class="fas fa-flag"></i> ${capitalizeFirstLetter(task.priority)}
                            </div>
                            <div class="task-category">
                                <i class="fas fa-tag"></i> ${task.category}
                            </div>
                        </div>
                        <div class="task-description">${task.description}</div>
                        ${task.subtasks.length > 0 ? `
                            <div class="subtasks">
                                ${task.subtasks.map(subtask => `
                                    <div class="subtask-item">
                                        <i class="${subtask.completed ? 'fas fa-check-circle' : 'far fa-circle'}"></i>
                                        <span>${subtask.text}</span>
                                    </div>
                                `).join('')}
                            </div>
                        ` : ''}
                        <div class="task-actions">
                            <div class="task-time">
                                <i class="far fa-clock"></i> ${formatTimeDisplay(task.timeSpent)}
                            </div>
                            <button class="action-btn view-btn-task">
                                <i class="fas fa-eye"></i> View
                            </button>
                            <button class="action-btn edit-btn">
                                <i class="fas fa-edit"></i> Edit
                            </button>
                            <button class="action-btn delete-btn">
                                <i class="fas fa-trash-alt"></i> Delete
                            </button>
                            <button class="action-btn timer-btn-task">
                                <i class="fas fa-play"></i> Start
                            </button>
                            <button class="action-btn share-btn">
                                <i class="fas fa-share-alt"></i> Share
                            </button>
                            <button class="action-btn complete-btn">
                                <i class="fas fa-check"></i> ${task.completed ? 'Incomplete' : 'Complete'}
                            </button>
                        </div>
                    </div>
                `;
                
                // Add to task list
                taskListContainer.appendChild(taskElement);
                
                // Add event listeners
                const checkbox = taskElement.querySelector('input[type="checkbox"]');
                checkbox.addEventListener('change', () => toggleTaskCompletion(task.id));
                
                const viewButton = taskElement.querySelector('.view-btn-task');
                viewButton.addEventListener('click', () => openViewTaskPopup(task.id));
                
                const editButton = taskElement.querySelector('.edit-btn');
                editButton.addEventListener('click', () => openEditTaskPopup(task.id));
                
                const deleteButton = taskElement.querySelector('.delete-btn');
                deleteButton.addEventListener('click', () => deleteTask(task.id));
                
                const timerButton = taskElement.querySelector('.timer-btn-task');
                timerButton.addEventListener('click', () => toggleTaskTimer(task.id));
                
                const shareButton = taskElement.querySelector('.share-btn');
                shareButton.addEventListener('click', () => shareTask(task.id));
                
                const completeButton = taskElement.querySelector('.complete-btn');
                completeButton.addEventListener('click', () => toggleTaskCompletion(task.id));
                
                // Update timer button state if this is the active task
                if (activeTask === task.id) {
                    timerButton.innerHTML = '<i class="fas fa-pause"></i> Pause';
                }
                
                // Drag and drop events
                taskElement.addEventListener('dragstart', handleDragStart);
                taskElement.addEventListener('dragend', handleDragEnd);
                taskElement.addEventListener('dragover', handleDragOver);
                taskElement.addEventListener('dragenter', handleDragEnter);
                taskElement.addEventListener('dragleave', handleDragLeave);
                taskElement.addEventListener('drop', handleDrop);
            });
        }
        
        // Drag and drop event handlers
        let draggedTask = null;
        
        function handleDragStart(e) {
            draggedTask = this;
            this.classList.add('dragging');
            
            // If multi-select is active, don't allow drag and drop
            if (selectedTasks.length > 0) {
                e.preventDefault();
                return false;
            }
            
            // Required for Firefox
            e.dataTransfer.effectAllowed = 'move';
            e.dataTransfer.setData('text/plain', this.getAttribute('data-task-id'));
            
            // Hide multi-action bar if visible
            document.getElementById('multi-action-bar').classList.remove('show');
        }
        
        function handleDragEnd(e) {
            this.classList.remove('dragging');
            
            // Remove dragover class from all tasks
            document.querySelectorAll('.task-item').forEach(task => {
                task.classList.remove('drag-over');
            });
        }
        
        function handleDragOver(e) {
            e.preventDefault();
            return false;
        }
        
        function handleDragEnter(e) {
            e.preventDefault();
            this.classList.add('drag-over');
        }
        
        function handleDragLeave(e) {
            this.classList.remove('drag-over');
        }
        
        function handleDrop(e) {
            e.preventDefault();
            this.classList.remove('drag-over');
            
            // Don't do anything if dropping onto the same task
            if (draggedTask === this) return;
            
            // Get the IDs of both tasks
            const draggedTaskId = draggedTask.getAttribute('data-task-id');
            const targetTaskId = this.getAttribute('data-task-id');
            
            // Find task indices
            const draggedTaskIndex = tasks.findIndex(t => t.id === draggedTaskId);
            const targetTaskIndex = tasks.findIndex(t => t.id === targetTaskId);
            
            if (draggedTaskIndex === -1 || targetTaskIndex === -1) return;
            
            // Save original tasks array for undo
            const originalTasks = [...tasks];
            
            // Reorder tasks
            const [movedTask] = tasks.splice(draggedTaskIndex, 1);
            tasks.splice(targetTaskIndex, 0, movedTask);
            
            // Save action for undo
            saveAction('reorder', originalTasks, tasks);
            
            // Save to local storage
            localStorage.setItem('tasks', JSON.stringify(tasks));
            
            // Re-render tasks
            renderTasks();
            
            // Show toast
            showToast('Task reordered successfully!', 'success');
        }
        
        // Open profile popup
        function openProfilePopup() {
            // Close profile dropdown
            document.getElementById('profile-dropdown').classList.remove('show');
            
            // Update profile details
            updateProfileDetails();
            
            // Open popup
            openPopup('profile-popup');
        }
        
        // Open users popup
        function openUsersPopup() {
            // Close profile dropdown
            document.getElementById('profile-dropdown').classList.remove('show');
            
            // Render users
            renderUsers();
            
            // Open popup
            openPopup('users-popup');
        }
        
        // Render users
        function renderUsers() {
            const usersGrid = document.getElementById('users-grid');
            
            // Clear previous users
            usersGrid.innerHTML = '';
            
            // Add users to grid
            users.forEach(user => {
                const userCard = document.createElement('div');
                userCard.className = 'user-card';
                
                userCard.innerHTML = `
                    <img src="${user.profilePicture}" alt="${user.firstName}" class="user-avatar">
                    <div class="user-name">${user.firstName} ${user.lastName}</div>
                    <div class="user-email">${user.email}</div>
                    <div class="user-role">${user.role}</div>
                `;
                
                usersGrid.appendChild(userCard);
            });
        }
        
        // Open popup
        function openPopup(popupId) {
            const popupOverlay = document.getElementById(`${popupId}-overlay`);
            const popup = document.getElementById(popupId);
            
            popupOverlay.classList.add('show');
            setTimeout(() => {
                popup.classList.add('show');
            }, 10);
        }
        
        // Close popup
        function closePopup(popupId) {
            const popupOverlay = document.getElementById(`${popupId}-overlay`);
            const popup = document.getElementById(popupId);
            
            popup.classList.remove('show');
            setTimeout(() => {
                popupOverlay.classList.remove('show');
            }, 300);
        }
        
        // Show toast notification
        function showToast(message, type = 'info') {
            const toastContainer = document.getElementById('toast-container');
            
            // Create toast element
            const toast = document.createElement('div');
            toast.className = `toast ${type}`;
            
            // Set icon based on type
            let icon = 'info-circle';
            switch (type) {
                case 'success':
                    icon = 'check-circle';
                    break;
                case 'warning':
                    icon = 'exclamation-triangle';
                    break;
                case 'error':
                    icon = 'times-circle';
                    break;
            }
            
            toast.innerHTML = `
                <div class="toast-icon">
                    <i class="fas fa-${icon}"></i>
                </div>
                <div class="toast-content">
                    <div class="toast-message">${message}</div>
                </div>
                <button class="toast-close">
                    <i class="fas fa-times"></i>
                </button>
            `;
            
            // Add to container
            toastContainer.appendChild(toast);
            
            // Add event listener to close button
            toast.querySelector('.toast-close').addEventListener('click', () => {
                toast.remove();
            });
            
            // Remove toast after 5 seconds
            setTimeout(() => {
                if (toast.parentNode) {
                    toast.remove();
                }
            }, 5000);
        }
        
        // Add notification
        function addNotification(notification) {
            notifications.unshift(notification);
            
            // Limit to 50 notifications
            if (notifications.length > 50) {
                notifications.pop();
            }
            
            // Save to local storage
            localStorage.setItem('notifications', JSON.stringify(notifications));
            
            // Update notification badge
            updateNotificationBadge();
            
            // If notification dropdown is open, re-render notifications
            if (document.getElementById('notification-dropdown').classList.contains('show')) {
                renderNotifications();
            }
        }
        
        // Format date
        function formatDate(dateString, short = false) {
            const date = new Date(dateString);
            
            if (short) {
                return date.toLocaleDateString();
            }
            
            const options = { year: 'numeric', month: 'short', day: 'numeric' };
            return date.toLocaleDateString(undefined, options);
        }
        
        // Format time ago
        function formatTimeAgo(dateString) {
            const date = new Date(dateString);
            const now = new Date();
            const seconds = Math.floor((now - date) / 1000);
            
            // Less than a minute
            if (seconds < 60) {
                return 'Just now';
            }
            
            // Less than an hour
            const minutes = Math.floor(seconds / 60);
            if (minutes < 60) {
                return `${minutes} minute${minutes !== 1 ? 's' : ''} ago`;
            }
            
            // Less than a day
            const hours = Math.floor(minutes / 60);
            if (hours < 24) {
                return `${hours} hour${hours !== 1 ? 's' : ''} ago`;
            }
            
            // Less than a week
            const days = Math.floor(hours / 24);
            if (days < 7) {
                return `${days} day${days !== 1 ? 's' : ''} ago`;
            }
            
            // Format date
            return formatDate(dateString);
        }
        
        // Capitalize first letter
        function capitalizeFirstLetter(string) {
            return string.charAt(0).toUpperCase() + string.slice(1);
        }
        
        // Get country name from code
        function getCountryName(code) {
            const countries = {
                'US': 'United States',
                'GB': 'United Kingdom',
                'CA': 'Canada',
                'AU': 'Australia',
                'FR': 'France',
                'DE': 'Germany',
                'JP': 'Japan',
                'CN': 'China',
                'IN': 'India',
                'BR': 'Brazil'
            };
            
            return countries[code] || code;
        }
        
        // Generate random users
        function generateRandomUsers() {
            return [
                {
                    id: generateId(),
                    firstName: 'John',
                    lastName: 'Doe',
                    email: 'test@example.com',
                    password: '123456',
                    birthdate: '1990-01-01',
                    nationality: 'US',
                    role: 'Admin',
                    profilePicture: 'https://i.imgur.com/Q9qFt3m.png',
                    joinDate: '2023-01-01'
                },
                {
                    id: generateId(),
                    firstName: 'Jane',
                    lastName: 'Smith',
                    email: 'jane@example.com',
                    password: 'password',
                    birthdate: '1992-05-15',
                    nationality: 'GB',
                    role: 'Manager',
                    profilePicture: 'https://i.imgur.com/FigUz3k.png',
                    joinDate: '2023-02-15'
                },
                {
                    id: generateId(),
                    firstName: 'Mike',
                    lastName: 'Johnson',
                    email: 'mike@example.com',
                    password: 'password',
                    birthdate: '1988-11-23',
                    nationality: 'CA',
                    role: 'Staff',
                    profilePicture: 'https://i.imgur.com/J6wWVYJ.png',
                    joinDate: '2023-03-10'
                },
                {
                    id: generateId(),
                    firstName: 'Sarah',
                    lastName: 'Williams',
                    email: 'sarah@example.com',
                    password: 'password',
                    birthdate: '1995-07-08',
                    nationality: 'AU',
                    role: 'Customer',
                    profilePicture: 'https://i.imgur.com/6nWFzMV.png',
                    joinDate: '2023-04-05'
                },
                {
                    id: generateId(),
                    firstName: 'David',
                    lastName: 'Brown',
                    email: 'david@example.com',
                    password: 'password',
                    birthdate: '1991-03-17',
                    nationality: 'FR',
                    role: 'Staff',
                    profilePicture: 'https://i.imgur.com/kBN0UXw.png',
                    joinDate: '2023-05-20'
                }
            ];
        }
        
        // Generate random tasks
        function generateRandomTasks() {
            const taskTitles = [
                'Complete project proposal',
                'Prepare presentation for meeting',
                'Review client feedback',
                'Update website content',
                'Implement new feature',
                'Fix bugs in latest release',
                'Create marketing campaign',
                'Develop mobile app UI',
                'Research competitor products',
                'Schedule team building event',
                'Optimize database queries',
                'Write documentation'
            ];
            
            const taskDescriptions = [
                'This task requires attention to detail and thorough research.',
                'Collaborate with the design team to ensure consistency.',
                'Make sure to address all client concerns and incorporate their feedback.',
                'Update the content to reflect the latest product changes.',
                'Follow the specifications provided in the requirements document.',
                'Identify and fix all reported issues before the next release.',
                'Create a comprehensive marketing strategy to boost product visibility.',
                'Design a user-friendly interface that aligns with our brand guidelines.',
                'Analyze competitors to identify market opportunities and gaps.',
                'Plan a fun and engaging activity to improve team morale.',
                'Improve query performance to reduce page load times.',
                'Create clear and concise documentation for developers and users.'
            ];
            
            const subtaskOptions = [
                'Research industry trends',
                'Schedule a team meeting',
                'Create wireframes',
                'Review with stakeholders',
                'Prepare draft version',
                'Update documentation',
                'Test functionality',
                'Gather user feedback',
                'Implement feedback',
                'Final review',
                'Deploy to production',
                'Send status update'
            ];
            
            const categories = ['Work', 'Personal', 'Shopping', 'Health', 'Education'];
            const priorities = ['high', 'medium', 'low'];
            
            const randomTasks = [];
            
            // Generate random tasks
            for (let i = 0; i < taskTitles.length; i++) {
                const dueDate = new Date();
                dueDate.setDate(dueDate.getDate() + Math.floor(Math.random() * 14) - 3); // Due between 3 days ago and 10 days from now
                
                const priority = priorities[Math.floor(Math.random() * priorities.length)];
                const category = categories[Math.floor(Math.random() * categories.length)];
                const completed = Math.random() > 0.7; // 30% chance of being completed
                
                // Generate random subtasks (0-3)
                const subtaskCount = Math.floor(Math.random() * 4);
                const subtasks = [];
                
                for (let j = 0; j < subtaskCount; j++) {
                    const subtask = {
                        id: generateId(),
                        text: subtaskOptions[Math.floor(Math.random() * subtaskOptions.length)],
                        completed: Math.random() > 0.5 // 50% chance of being completed
                    };
                    subtasks.push(subtask);
                }
                
                // Create task
                const task = {
                    id: generateId(),
                    title: taskTitles[i],
                    description: taskDescriptions[i],
                    dueDate: dueDate.toISOString().split('T')[0],
                    priority,
                    category,
                    completed,
                    subtasks,
                    notes: Math.random() > 0.7 ? 'Additional notes for this task...' : '',
                    timeSpent: Math.floor(Math.random() * 3600), // Random time spent (0-3600 seconds)
                    createdAt: new Date(Date.now() - Math.floor(Math.random() * 7 * 24 * 60 * 60 * 1000)).toISOString() // Created within the last week
                };
                
                randomTasks.push(task);
            }
            
            return randomTasks;
        }
        
        // Generate random notifications
        function generateRandomNotifications() {
            const notificationMessages = [
                'New task "Complete project proposal" was added',
                'Task "Fix bugs in latest release" was updated',
                'Task "Update website content" was completed',
                'You have 3 tasks due today',
                'Team meeting scheduled for tomorrow',
                'New comment on "Implement new feature"',
                'Project deadline approaching',
                'Task "Create marketing campaign" was deleted',
                'New task assigned to you',
                'Your profile has been updated'
            ];
            
            const notificationTypes = ['info', 'success', 'warning', 'error'];
            
            const randomNotifications = [];
            
            // Generate random notifications
            for (let i = 0; i < 10; i++) {
                const time = new Date();
                time.setHours(time.getHours() - Math.floor(Math.random() * 24 * 7)); // Within the last week
                
                const notification = {
                    id: generateId(),
                    message: notificationMessages[i],
                    type: notificationTypes[Math.floor(Math.random() * notificationTypes.length)],
                    time: time.toISOString(),
                    read: i >= 3 // First 3 are unread
                };
                
                randomNotifications.push(notification);
            }
            
            return randomNotifications;
        }
        
        // Get random profile picture
        function getRandomProfilePicture() {
            const profilePictures = [
                'https://i.imgur.com/Q9qFt3m.png',
                'https://i.imgur.com/FigUz3k.png',
                'https://i.imgur.com/J6wWVYJ.png',
                'https://i.imgur.com/6nWFzMV.png',
                'https://i.imgur.com/kBN0UXw.png'
            ];
            
            return profilePictures[Math.floor(Math.random() * profilePictures.length)];
        }
        
        // Generate unique ID
        function generateId() {
            return 'id-' + Math.random().toString(36).substring(2, 15) + Math.random().toString(36).substring(2, 15);
        }
        
        // Debounce function to limit function calls
        function debounce(func, delay) {
            let timeoutId;
            return function(...args) {
                clearTimeout(timeoutId);
                timeoutId = setTimeout(() => {
                    func.apply(this, args);
                }, delay);
            };
        }
        
        // Initialize event listeners for add task popup when document is ready
        document.getElementById('add-task-popup-overlay').addEventListener('click', function(e) {
            if (e.target === this) {
                closePopup('add-task-popup');
            }
        });
        
        // Initialize event listeners for edit task popup
        document.getElementById('edit-task-popup-overlay').addEventListener('click', function(e) {
            if (e.target === this) {
                closePopup('edit-task-popup');
            }
        });
        
        document.getElementById('edit-add-subtask-btn').addEventListener('click', function() {
            addSubtaskField('edit-subtasks-container');
        });
        
        document.getElementById('edit-task-cancel-btn').addEventListener('click', function() {
            closePopup('edit-task-popup');
        });
        
        document.getElementById('edit-task-submit-btn').addEventListener('click', saveEditedTask);
    </script>


</body></html>