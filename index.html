<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Modern To-Do App</title>
    
    <!-- External Libraries -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    
    <style>
        :root {
            --primary-color: #5D5CDE;
            --success-color: #28A745;
            --warning-color: #FFC107;
            --danger-color: #DC3545;
            --info-color: #17A2B8;
            --dark-color: #343A40;
            --light-color: #F8F9FA;
            --gray-color: #6C757D;
            --orange-color: #FD7E14;
            --white-color: #FFFFFF;
            --dark-red: #8B0000;
            --light-red: #4B0000;
            --dark-black: #1C2526;
            --light-black: #000000;
            --box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            --hover-shadow: 0 10px 15px rgba(0, 0, 0, 0.2);
            --transition-speed: 0.3s;
            --border-radius: 8px;
            --font-family: 'Poppins', sans-serif;
        }

        .dark {
            --bg-primary: linear-gradient(135deg, var(--dark-red), var(--light-red));
            --bg-secondary: #2D3748;
            --text-primary: #FFFFFF;
            --text-secondary: #E2E8F0;
            --card-bg: #1A202C;
            --border-color: #4A5568;
            --hover-color: #4A5568;
        }

        .light {
            --bg-primary: linear-gradient(135deg, var(--dark-black), var(--light-black));
            --bg-secondary: #FFFFFF;
            --text-primary: #2D3748;
            --text-secondary: #4A5568;
            --card-bg: #FFFFFF;
            --border-color: #E2E8F0;
            --hover-color: #EDF2F7;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: var(--font-family);
            transition: background-color var(--transition-speed), color var(--transition-speed), transform var(--transition-speed), box-shadow var(--transition-speed);
        }

        body {
            background: var(--bg-primary);
            color: var(--text-primary);
            min-height: 100vh;
            overflow-x: hidden;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .login-container {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            background: var(--bg-primary);
        }

        .login-form {
            background: var(--card-bg);
            padding: 40px;
            border-radius: var(--border-radius);
            width: 100%;
            max-width: 450px;
            box-shadow: var(--box-shadow);
            position: relative;
            overflow: hidden;
        }

        .login-form h2 {
            text-align: center;
            margin-bottom: 30px;
            color: var(--text-primary);
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            color: var(--text-primary);
            font-weight: 500;
        }

        .form-control {
            width: 100%;
            padding: 12px 15px;
            border: 1px solid var(--border-color);
            border-radius: var(--border-radius);
            font-size: 16px;
            background-color: var(--card-bg);
            color: var(--text-primary);
            transition: border-color var(--transition-speed), box-shadow var(--transition-speed);
        }

        .form-control:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(93, 92, 222, 0.25);
        }

        .login-btn {
            width: 100%;
            padding: 12px;
            background: linear-gradient(45deg, var(--primary-color), #4a49b3);
            color: white;
            border: none;
            border-radius: var(--border-radius);
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            position: relative;
            overflow: hidden;
            margin-top: 10px;
        }

        .login-btn::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(255,255,255,0.3) 0%, rgba(255,255,255,0) 70%);
            animation: shinyEffect 3s infinite linear;
            pointer-events: none;
        }

        @keyframes shinyEffect {
            0% {
                transform: rotate(0deg);
            }
            100% {
                transform: rotate(360deg);
            }
        }

        .login-btn:hover {
            background: linear-gradient(45deg, #4a49b3, var(--primary-color));
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(74, 73, 179, 0.4);
        }

        .login-btn:active {
            transform: translateY(0);
            box-shadow: 0 2px 5px rgba(74, 73, 179, 0.4);
        }

        .register-link {
            text-align: center;
            margin-top: 20px;
            color: var(--text-secondary);
        }

        .register-link a {
            color: #00008B;
            text-decoration: none;
            font-weight: 600;
        }

        .register-link a:hover {
            text-decoration: underline;
        }

        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transition: opacity var(--transition-speed), visibility var(--transition-speed);
        }

        .modal.active {
            opacity: 1;
            visibility: visible;
        }

        .modal-content {
            background: var(--card-bg);
            padding: 30px;
            border-radius: var(--border-radius);
            width: 90%;
            max-width: 600px;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: var(--hover-shadow);
            transform: scale(0.9);
            transition: transform var(--transition-speed);
        }

        .modal.active .modal-content {
            transform: scale(1);
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            border-bottom: 1px solid var(--border-color);
            padding-bottom: 15px;
        }

        .modal-header h3 {
            color: var(--text-primary);
            margin: 0;
        }

        .close-btn {
            background: transparent;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: var(--text-primary);
        }

        .modal-footer {
            display: flex;
            justify-content: flex-end;
            gap: 10px;
            margin-top: 20px;
            border-top: 1px solid var(--border-color);
            padding-top: 15px;
        }

        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: var(--border-radius);
            cursor: pointer;
            font-weight: 500;
            transition: background-color var(--transition-speed), transform var(--transition-speed), box-shadow var(--transition-speed);
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: var(--hover-shadow);
        }

        .btn:active {
            transform: translateY(0);
        }

        .btn-primary {
            background-color: var(--primary-color);
            color: white;
        }

        .btn-success {
            background-color: var(--success-color);
            color: white;
        }

        .btn-danger {
            background-color: var(--danger-color);
            color: white;
        }

        .btn-warning {
            background-color: var(--warning-color);
            color: #212529;
        }

        .btn-secondary {
            background-color: var(--gray-color);
            color: white;
        }

        .btn-primary:hover {
            background-color: #4a49b3;
        }

        .btn-success:hover {
            background-color: #218838;
        }

        .btn-danger:hover {
            background-color: #c82333;
        }

        .btn-warning:hover {
            background-color: #e0a800;
        }

        .btn-secondary:hover {
            background-color: #5a6268;
        }

        .dashboard {
            display: none;
        }

        .header {
            background-color: var(--card-bg);
            padding: 15px 20px;
            border-radius: var(--border-radius);
            margin-bottom: 20px;
            box-shadow: var(--box-shadow);
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .app-title {
            font-size: 24px;
            font-weight: 700;
            color: var(--primary-color);
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .header-actions {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .timer-container {
            display: flex;
            align-items: center;
            background-color: var(--bg-secondary);
            border-radius: var(--border-radius);
            padding: 5px 10px;
            border: 1px solid var(--border-color);
            box-shadow: var(--box-shadow);
        }

        .task-timer {
            font-size: 20px;
            font-weight: 600;
            color: var(--text-primary);
            margin: 0 10px;
        }

        .timer-btn {
            background: transparent;
            border: none;
            cursor: pointer;
            color: var(--text-primary);
            font-size: 16px;
        }

        .mode-switch {
            cursor: pointer;
            font-size: 24px;
            color: var(--text-primary);
            position: relative;
        }

        .user-profile {
            position: relative;
        }

        .profile-img {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            cursor: pointer;
            object-fit: cover;
            border: 2px solid var(--success-color);
        }

        .status-indicator {
            position: absolute;
            top: -5px;
            right: -5px;
            width: 15px;
            height: 15px;
            border-radius: 50%;
            background-color: var(--success-color);
            border: 2px solid var(--card-bg);
        }

        .notification-badge {
            position: absolute;
            top: -5px;
            right: -5px;
            background-color: var(--danger-color);
            color: white;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            font-size: 12px;
            display: flex;
            justify-content: center;
            align-items: center;
            font-weight: 700;
        }

        .dropdown {
            position: absolute;
            top: 50px;
            right: 0;
            background-color: var(--card-bg);
            border-radius: var(--border-radius);
            box-shadow: var(--hover-shadow);
            width: 200px;
            z-index: 100;
            display: none;
            border: 1px solid var(--border-color);
            opacity: 0;
            transform: translateY(-10px);
            transition: opacity var(--transition-speed), transform var(--transition-speed);
        }

        .dropdown.active {
            display: block;
            opacity: 1;
            transform: translateY(0);
        }

        .dropdown-item {
            padding: 12px 15px;
            cursor: pointer;
            color: var(--text-primary);
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 10px;
            transition: background-color var(--transition-speed);
        }

        .dropdown-item:hover {
            background-color: var(--hover-color);
        }

        .dropdown-item i {
            width: 20px;
            text-align: center;
        }

        .dropdown-divider {
            height: 1px;
            background-color: var(--border-color);
            margin: 5px 0;
        }

        .main-content {
            margin-top: 20px;
        }

        .summary-section {
            display: flex;
            flex-direction: column;
            gap: 20px;
            margin-bottom: 30px;
        }

        .total-tasks-card {
            background-color: var(--primary-color);
            border-radius: var(--border-radius);
            padding: 20px;
            color: white;
            box-shadow: var(--box-shadow);
            transition: transform var(--transition-speed), box-shadow var(--transition-speed);
        }

        .total-tasks-card:hover {
            transform: translateY(-5px);
            box-shadow: var(--hover-shadow);
        }

        .total-tasks-card h3 {
            font-size: 18px;
            margin-bottom: 10px;
        }

        .total-tasks-card .count {
            font-size: 36px;
            font-weight: 700;
        }

        .cards-container {
            display: flex;
            gap: 20px;
        }

        .status-card {
            flex: 1;
            border-radius: var(--border-radius);
            padding: 20px;
            box-shadow: var(--box-shadow);
            transition: transform var(--transition-speed), box-shadow var(--transition-speed);
            color: white;
        }

        .status-card:hover {
            transform: translateY(-5px);
            box-shadow: var(--hover-shadow);
        }

        .status-card h3 {
            font-size: 18px;
            margin-bottom: 10px;
        }

        .status-card .count {
            font-size: 36px;
            font-weight: 700;
        }

        .completed-card {
            background-color: var(--success-color);
        }

        .pending-card {
            background-color: var(--warning-color);
            color: #212529;
        }

        .tasks-section {
            background-color: var(--card-bg);
            border-radius: var(--border-radius);
            padding: 20px;
            margin-bottom: 30px;
            box-shadow: var(--box-shadow);
        }

        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid var(--border-color);
        }

        .section-title {
            font-size: 22px;
            font-weight: 600;
            color: var(--text-primary);
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .section-actions {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .search-container {
            position: relative;
            margin-bottom: 20px;
        }

        .search-input {
            width: 100%;
            padding: 12px 15px 12px 40px;
            border: 1px solid var(--border-color);
            border-radius: var(--border-radius);
            font-size: 16px;
            background-color: var(--card-bg);
            color: var(--text-primary);
        }

        .search-icon {
            position: absolute;
            left: 15px;
            top: 50%;
            transform: translateY(-50%);
            color: var(--text-secondary);
        }

        .filters-container {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            margin-bottom: 20px;
        }

        .filter-group {
            flex: 1;
            min-width: 150px;
        }

        .filter-group label {
            display: block;
            margin-bottom: 5px;
            color: var(--text-primary);
            font-weight: 500;
        }

        .filter-select {
            width: 100%;
            padding: 10px;
            border: 1px solid var(--border-color);
            border-radius: var(--border-radius);
            background-color: var(--card-bg);
            color: var(--text-primary);
        }

        .undo-redo-container {
            display: flex;
            gap: 10px;
        }

        .undo-btn, .redo-btn {
            background-color: var(--card-bg);
            border: 1px solid var(--border-color);
            border-radius: var(--border-radius);
            padding: 8px 12px;
            cursor: pointer;
            color: var(--text-primary);
            transition: background-color var(--transition-speed);
        }

        .undo-btn:hover, .redo-btn:hover {
            background-color: var(--hover-color);
        }

        .sort-container {
            position: relative;
        }

        .sort-select {
            padding: 10px 15px;
            border: 1px solid var(--border-color);
            border-radius: var(--border-radius);
            background-color: var(--card-bg);
            color: var(--text-primary);
            cursor: pointer;
            -webkit-appearance: none;
            -moz-appearance: none;
            appearance: none;
            padding-right: 30px;
        }

        .sort-icon {
            position: absolute;
            right: 10px;
            top: 50%;
            transform: translateY(-50%);
            pointer-events: none;
        }

        .view-toggle {
            display: flex;
            border: 1px solid var(--border-color);
            border-radius: var(--border-radius);
            overflow: hidden;
        }

        .view-toggle-btn {
            padding: 10px 15px;
            background-color: var(--card-bg);
            border: none;
            cursor: pointer;
            color: var(--text-primary);
            transition: background-color var(--transition-speed);
        }

        .view-toggle-btn.active {
            background-color: var(--primary-color);
            color: white;
        }

        .view-toggle-btn:hover:not(.active) {
            background-color: var(--hover-color);
        }

        .list-view, .graph-view {
            transition: opacity var(--transition-speed), transform var(--transition-speed);
        }

        .list-view {
            margin-top: 20px;
        }

        .graph-view {
            display: none;
            margin-top: 20px;
        }

        .task-list {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .task-item {
            background-color: var(--bg-secondary);
            border-radius: var(--border-radius);
            padding: 15px;
            box-shadow: var(--box-shadow);
            transition: transform var(--transition-speed), box-shadow var(--transition-speed);
            display: flex;
            flex-direction: column;
            gap: 10px;
            cursor: grab;
            position: relative;
        }

        .task-item:hover {
            transform: translateY(-3px);
            box-shadow: var(--hover-shadow);
        }

        .task-item.dragging {
            opacity: 0.5;
            cursor: grabbing;
        }

        .task-item.expired {
            border-left: 5px solid var(--danger-color);
        }

        .task-item.due-soon {
            border-left: 5px solid var(--warning-color);
        }

        .task-item.due-later {
            border-left: 5px solid var(--success-color);
        }

        .task-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
        }

        .task-title {
            font-size: 18px;
            font-weight: 600;
            color: var(--text-primary);
            margin-right: 10px;
            word-break: break-word;
        }

        .task-priority {
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: 600;
            color: white;
        }

        .priority-high {
            background-color: var(--danger-color);
        }

        .priority-medium {
            background-color: var(--orange-color);
        }

        .priority-low {
            background-color: var(--gray-color);
        }

        .task-details {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            margin-top: 5px;
        }

        .task-detail {
            display: flex;
            align-items: center;
            gap: 5px;
            color: var(--text-secondary);
            font-size: 14px;
        }

        .task-description {
            color: var(--text-secondary);
            font-size: 14px;
            margin: 10px 0;
            word-break: break-word;
        }

        .task-actions {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-top: 10px;
        }

        .task-btn {
            padding: 6px 10px;
            border-radius: var(--border-radius);
            font-size: 13px;
            cursor: pointer;
            transition: background-color var(--transition-speed), transform var(--transition-speed);
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .task-btn:hover {
            transform: translateY(-2px);
        }

        .task-timer-display {
            background-color: var(--bg-secondary);
            padding: 5px 10px;
            border-radius: var(--border-radius);
            font-size: 14px;
            font-weight: 500;
            color: var(--text-primary);
            margin-left: auto;
        }

        .task-checkbox {
            position: relative;
            display: inline-block;
            width: 20px;
            height: 20px;
            margin-right: 10px;
        }

        .checkbox-input {
            position: absolute;
            opacity: 0;
            cursor: pointer;
            height: 0;
            width: 0;
        }

        .checkbox-custom {
            position: absolute;
            top: 0;
            left: 0;
            height: 20px;
            width: 20px;
            background-color: var(--bg-secondary);
            border: 2px solid var(--border-color);
            border-radius: 4px;
            transition: background-color var(--transition-speed), border-color var(--transition-speed);
        }

        .checkbox-input:checked ~ .checkbox-custom {
            background-color: var(--success-color);
            border-color: var(--success-color);
        }

        .checkbox-custom:after {
            content: "";
            position: absolute;
            display: none;
        }

        .checkbox-input:checked ~ .checkbox-custom:after {
            display: block;
        }

        .checkbox-custom:after {
            left: 6px;
            top: 2px;
            width: 5px;
            height: 10px;
            border: solid white;
            border-width: 0 2px 2px 0;
            transform: rotate(45deg);
        }

        .multi-select-bar {
            position: sticky;
            bottom: 20px;
            left: 0;
            right: 0;
            background: linear-gradient(135deg, var(--primary-color), #4a49b3);
            border-radius: var(--border-radius);
            padding: 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: var(--hover-shadow);
            color: white;
            margin-top: 20px;
            transform: translateY(100px);
            opacity: 0;
            visibility: hidden;
            transition: transform var(--transition-speed), opacity var(--transition-speed), visibility var(--transition-speed);
            z-index: 90;
        }

        .multi-select-bar.active {
            transform: translateY(0);
            opacity: 1;
            visibility: visible;
        }

        .multi-select-info {
            font-weight: 500;
        }

        .multi-select-actions {
            display: flex;
            gap: 10px;
        }

        .graphs-container {
            display: flex;
            gap: 20px;
            margin-top: 20px;
        }

        .graph-card {
            flex: 1;
            background-color: var(--bg-secondary);
            border-radius: var(--border-radius);
            padding: 20px;
            box-shadow: var(--box-shadow);
            display: flex;
            flex-direction: column;
        }

        .graph-title {
            font-size: 18px;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 15px;
            text-align: center;
        }

        .chart-container {
            flex: 1;
            position: relative;
            height: 300px;
        }

        .toast {
            position: fixed;
            bottom: 20px;
            left: 20px;
            background-color: var(--card-bg);
            color: var(--text-primary);
            padding: 15px 20px;
            border-radius: var(--border-radius);
            box-shadow: var(--hover-shadow);
            display: flex;
            align-items: center;
            gap: 10px;
            transform: translateY(100px);
            opacity: 0;
            transition: transform var(--transition-speed), opacity var(--transition-speed);
            z-index: 1000;
            max-width: 350px;
        }

        .toast.active {
            transform: translateY(0);
            opacity: 1;
        }

        .toast-icon {
            font-size: 24px;
        }

        .toast-success .toast-icon {
            color: var(--success-color);
        }

        .toast-error .toast-icon {
            color: var(--danger-color);
        }

        .toast-warning .toast-icon {
            color: var(--warning-color);
        }

        .toast-info .toast-icon {
            color: var(--info-color);
        }

        .toast-content {
            flex: 1;
        }

        .toast-title {
            font-weight: 600;
            margin-bottom: 5px;
        }

        .toast-message {
            font-size: 14px;
            color: var(--text-secondary);
        }

        .toast-close {
            background: transparent;
            border: none;
            color: var(--text-secondary);
            cursor: pointer;
            font-size: 16px;
        }

        /* Responsive styles */
        @media (max-width: 991px) {
            .cards-container {
                flex-direction: column;
            }

            .graphs-container {
                flex-direction: column;
            }
        }

        @media (max-width: 768px) {
            .header {
                flex-direction: column;
                gap: 15px;
                align-items: flex-start;
            }

            .header-actions {
                width: 100%;
                justify-content: space-between;
            }

            .section-header {
                flex-direction: column;
                gap: 15px;
                align-items: flex-start;
            }

            .section-actions {
                width: 100%;
                justify-content: space-between;
                flex-wrap: wrap;
            }

            .task-header {
                flex-direction: column;
                gap: 10px;
            }

            .task-actions {
                flex-direction: column;
                width: 100%;
            }

            .task-btn {
                width: 100%;
                justify-content: center;
            }

            .multi-select-bar {
                flex-direction: column;
                gap: 15px;
            }

            .multi-select-actions {
                width: 100%;
                justify-content: space-between;
            }
        }

        @media (max-width: 480px) {
            .filters-container {
                flex-direction: column;
            }

            .filter-group {
                width: 100%;
            }
        }

        .completed {
            opacity: 0.7;
            text-decoration: line-through;
        }

        .category-badge {
            background-color: var(--primary-color);
            color: white;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: 600;
        }

        .sub-tasks {
            margin-top: 10px;
            padding-left: 20px;
        }

        .sub-task {
            display: flex;
            align-items: center;
            margin-bottom: 5px;
            color: var(--text-secondary);
            font-size: 14px;
        }

        .sub-task.completed {
            text-decoration: line-through;
            opacity: 0.7;
        }
    </style>
</head>
<body class="light">
    <!-- Login Page -->
    <div class="login-container" id="loginPage">
        <div class="login-form">
            <h2>Welcome to To-Do App</h2>
            <div class="form-group">
                <label for="email">Email</label>
                <input type="email" id="email" class="form-control" value="test@example.com">
            </div>
            <div class="form-group">
                <label for="password">Password</label>
                <input type="password" id="password" class="form-control" value="123456">
            </div>
            <button class="login-btn" id="loginBtn">Login</button>
            <div class="register-link">
                Don't have an account? <a href="#" id="registerLink">Register now</a>
            </div>
        </div>
    </div>

    <!-- Registration Modal -->
    <div class="modal" id="registerModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Create an Account</h3>
                <button class="close-btn" id="closeRegisterModal">&times;</button>
            </div>
            <div class="form-group">
                <label for="lastName">Last Name</label>
                <input type="text" id="lastName" class="form-control">
            </div>
            <div class="form-group">
                <label for="firstName">First Name</label>
                <input type="text" id="firstName" class="form-control">
            </div>
            <div class="form-group">
                <label for="regEmail">Email</label>
                <input type="email" id="regEmail" class="form-control">
            </div>
            <div class="form-group">
                <label for="confirmEmail">Confirm Email</label>
                <input type="email" id="confirmEmail" class="form-control">
            </div>
            <div class="form-group">
                <label for="regPassword">Password</label>
                <input type="password" id="regPassword" class="form-control">
            </div>
            <div class="form-group">
                <label for="confirmPassword">Confirm Password</label>
                <input type="password" id="confirmPassword" class="form-control">
            </div>
            <div class="form-group">
                <label for="birthdate">Birthdate</label>
                <input type="text" id="birthdate" class="form-control" placeholder="Select your birthdate">
            </div>
            <div class="form-group">
                <label for="nationality">Nationality</label>
                <select id="nationality" class="form-control">
                    <option value="">Select your nationality</option>
                </select>
            </div>
            <div class="form-group">
                <label for="role">Role</label>
                <select id="role" class="form-control">
                    <option value="">Select your role</option>
                    <option value="Manager">Manager</option>
                    <option value="Staff">Staff</option>
                    <option value="Customer">Customer</option>
                    <option value="Admin">Admin</option>
                </select>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" id="cancelRegister">Cancel</button>
                <button class="btn btn-success" id="createAccount">Create</button>
            </div>
        </div>
    </div>

    <!-- Dashboard -->
    <div class="dashboard" id="dashboard">
        <div class="container">
            <div class="header">
                <div class="app-title">
                    <i class="fas fa-tasks"></i>
                    To-Do App
                </div>
                <div class="header-actions">
                    <div class="timer-container">
                        <button class="timer-btn" id="pauseTimer"><i class="fas fa-pause"></i></button>
                        <div class="task-timer" id="globalTimer">00:00:00</div>
                        <button class="timer-btn" id="resetTimer"><i class="fas fa-undo"></i></button>
                    </div>
                    <div class="mode-switch" id="modeSwitch">
                        <i class="fas fa-moon"></i>
                    </div>
                    <button class="btn btn-primary" id="usersBtn">
                        <i class="fas fa-users"></i> Users
                    </button>
                    <div class="user-profile" id="userProfile">
                        <img src="https://randomuser.me/api/portraits/men/1.jpg" alt="User" class="profile-img" id="profileImage">
                        <div class="status-indicator" id="statusIndicator"></div>
                        <div class="notification-badge" id="notificationBadge">0</div>
                        <div class="dropdown" id="profileDropdown">
                            <div class="dropdown-item" id="viewProfile">
                                <i class="fas fa-user"></i> View Profile
                            </div>
                            <div class="dropdown-item" id="switchStatus">
                                <i class="fas fa-circle"></i> Status: Online
                            </div>
                            <div class="dropdown-divider"></div>
                            <div class="dropdown-item" id="logoutBtn">
                                <i class="fas fa-sign-out-alt"></i> Logout
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="main-content">
                <div class="summary-section">
                    <div class="total-tasks-card">
                        <h3>Total Tasks</h3>
                        <div class="count" id="totalTasksCount">0</div>
                    </div>
                    <div class="cards-container">
                        <div class="status-card completed-card">
                            <h3>Completed Tasks</h3>
                            <div class="count" id="completedTasksCount">0</div>
                        </div>
                        <div class="status-card pending-card">
                            <h3>Pending Tasks</h3>
                            <div class="count" id="pendingTasksCount">0</div>
                        </div>
                    </div>
                </div>

                <div class="tasks-section">
                    <div class="section-header">
                        <div class="section-title">
                            <i class="fas fa-clipboard-list"></i>
                            Tasks
                        </div>
                        <div class="section-actions">
                            <button class="btn btn-success" id="addTaskBtn">
                                <i class="fas fa-plus"></i> Add Task
                            </button>
                            <button class="btn btn-primary" id="exportBtn">
                                <i class="fas fa-file-export"></i> Export
                            </button>
                            <button class="btn btn-secondary" id="importBtn">
                                <i class="fas fa-file-import"></i> Import
                            </button>
                            <button class="btn btn-warning" id="categoriesBtn">
                                <i class="fas fa-tags"></i> Categories
                            </button>
                        </div>
                    </div>

                    <div class="search-container">
                        <i class="fas fa-search search-icon"></i>
                        <input type="text" class="search-input" id="searchInput" placeholder="Search tasks...">
                    </div>

                    <div class="filters-container">
                        <div class="filter-group">
                            <label for="statusFilter">Status</label>
                            <select id="statusFilter" class="filter-select">
                                <option value="all">All</option>
                                <option value="active">Active</option>
                                <option value="completed">Completed</option>
                            </select>
                        </div>
                        <div class="filter-group">
                            <label for="categoryFilter">Category</label>
                            <select id="categoryFilter" class="filter-select">
                                <option value="all">All Categories</option>
                            </select>
                        </div>
                        <div class="filter-group">
                            <label for="priorityFilter">Priority</label>
                            <select id="priorityFilter" class="filter-select">
                                <option value="all">All Priorities</option>
                                <option value="high">High</option>
                                <option value="medium">Medium</option>
                                <option value="low">Low</option>
                            </select>
                        </div>
                        <div class="filter-group">
                            <label for="dueDateFilter">Due Date</label>
                            <select id="dueDateFilter" class="filter-select">
                                <option value="all">All</option>
                                <option value="today">Today</option>
                                <option value="week">This Week</option>
                                <option value="month">This Month</option>
                                <option value="custom">Custom...</option>
                            </select>
                        </div>
                    </div>

                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                        <div class="sort-container">
                            <select id="sortSelect" class="sort-select">
                                <option value="titleAsc">Title (A-Z)</option>
                                <option value="titleDesc">Title (Z-A)</option>
                                <option value="dateAsc">Due Date (Earliest)</option>
                                <option value="dateDesc">Due Date (Latest)</option>
                                <option value="priorityDesc">Priority (High-Low)</option>
                                <option value="priorityAsc">Priority (Low-High)</option>
                            </select>
                            <i class="fas fa-sort sort-icon"></i>
                        </div>
                        <div class="undo-redo-container">
                            <button class="undo-btn" id="undoBtn" title="Undo">
                                <i class="fas fa-undo"></i>
                            </button>
                            <button class="redo-btn" id="redoBtn" title="Redo">
                                <i class="fas fa-redo"></i>
                            </button>
                        </div>
                        <div class="view-toggle">
                            <button class="view-toggle-btn active" id="listViewBtn">
                                <i class="fas fa-list"></i> List
                            </button>
                            <button class="view-toggle-btn" id="graphViewBtn">
                                <i class="fas fa-chart-bar"></i> Graph
                            </button>
                        </div>
                    </div>

                    <div class="list-view" id="listView">
                        <div class="task-list" id="taskList">
                            <!-- Tasks will be inserted here -->
                        </div>
                        <div class="multi-select-bar" id="multiSelectBar">
                            <div class="multi-select-info">
                                <span id="selectedCount">0</span> tasks selected
                            </div>
                            <div class="multi-select-actions">
                                <button class="btn btn-success" id="completeSelectedBtn">
                                    <i class="fas fa-check"></i> Complete
                                </button>
                                <button class="btn btn-danger" id="deleteSelectedBtn">
                                    <i class="fas fa-trash"></i> Delete
                                </button>
                                <button class="btn btn-secondary" id="cancelSelectBtn">
                                    <i class="fas fa-times"></i> Cancel
                                </button>
                            </div>
                        </div>
                    </div>

                    <div class="graph-view" id="graphView">
                        <div class="graphs-container">
                            <div class="graph-card">
                                <div class="graph-title">Tasks Progress Over Time</div>
                                <div class="chart-container">
                                    <canvas id="tasksChart"></canvas>
                                </div>
                            </div>
                            <div class="graph-card">
                                <div class="graph-title">Tasks by Status</div>
                                <div class="chart-container">
                                    <canvas id="statusPieChart"></canvas>
                                </div>
                            </div>
                        </div>
                        <div class="graphs-container" style="margin-top: 20px;">
                            <div class="graph-card">
                                <div class="graph-title">Tasks by Priority</div>
                                <div class="chart-container">
                                    <canvas id="priorityChart"></canvas>
                                </div>
                            </div>
                            <div class="graph-card">
                                <div class="graph-title">Tasks by Category</div>
                                <div class="chart-container">
                                    <canvas id="categoryChart"></canvas>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Add/Edit Task Modal -->
    <div class="modal" id="taskModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="taskModalTitle">Add New Task</h3>
                <button class="close-btn" id="closeTaskModal">&times;</button>
            </div>
            <div class="form-group">
                <label for="taskTitle">Title</label>
                <input type="text" id="taskTitle" class="form-control" placeholder="Enter task title">
            </div>
            <div class="form-group">
                <label for="taskDescription">Description</label>
                <textarea id="taskDescription" class="form-control" rows="3" placeholder="Enter task description"></textarea>
            </div>
            <div class="form-group">
                <label>Sub-Tasks</label>
                <div id="subTasksContainer">
                    <!-- Sub-tasks will be added here -->
                </div>
                <button class="btn btn-secondary" id="addSubTaskBtn" style="margin-top: 10px;">
                    <i class="fas fa-plus"></i> Add Sub-Task
                </button>
            </div>
            <div class="form-group">
                <label for="taskDueDate">Due Date</label>
                <input type="text" id="taskDueDate" class="form-control" placeholder="Select due date">
            </div>
            <div class="form-group">
                <label for="taskPriority">Priority</label>
                <select id="taskPriority" class="form-control">
                    <option value="high">High</option>
                    <option value="medium" selected>Medium</option>
                    <option value="low">Low</option>
                </select>
            </div>
            <div class="form-group">
                <label for="taskCategory">Category</label>
                <select id="taskCategory" class="form-control">
                    <!-- Categories will be loaded here -->
                </select>
            </div>
            <div class="form-group">
                <label for="taskNotes">Notes</label>
                <textarea id="taskNotes" class="form-control" rows="3" placeholder="Additional notes..."></textarea>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" id="cancelTaskBtn">Cancel</button>
                <button class="btn btn-success" id="saveTaskBtn">Create</button>
            </div>
        </div>
    </div>

    <!-- View Task Modal -->
    <div class="modal" id="viewTaskModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="viewTaskTitle">Task Details</h3>
                <button class="close-btn" id="closeViewTaskModal">&times;</button>
            </div>
            <div id="viewTaskContent">
                <!-- Task details will be shown here -->
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" id="closeViewBtn">Close</button>
            </div>
        </div>
    </div>

    <!-- Export Modal -->
    <div class="modal" id="exportModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Export Tasks</h3>
                <button class="close-btn" id="closeExportModal">&times;</button>
            </div>
            <div class="form-group">
                <label for="exportFormat">Select Format</label>
                <select id="exportFormat" class="form-control">
                    <option value="json">JSON</option>
                    <option value="pdf">PDF</option>
                    <option value="excel">Excel</option>
                </select>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" id="cancelExportBtn">Cancel</button>
                <button class="btn btn-success" id="confirmExportBtn">Export</button>
            </div>
        </div>
    </div>

    <!-- Import Modal -->
    <div class="modal" id="importModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Import Tasks</h3>
                <button class="close-btn" id="closeImportModal">&times;</button>
            </div>
            <div class="form-group">
                <label for="importFile">Upload JSON File</label>
                <input type="file" id="importFile" class="form-control" accept=".json">
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" id="cancelImportBtn">Cancel</button>
                <button class="btn btn-success" id="confirmImportBtn">Import</button>
            </div>
        </div>
    </div>

    <!-- Categories Modal -->
    <div class="modal" id="categoriesModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Manage Categories</h3>
                <button class="close-btn" id="closeCategoriesModal">&times;</button>
            </div>
            <div class="form-group">
                <label for="newCategory">New Category</label>
                <div style="display: flex; gap: 10px;">
                    <input type="text" id="newCategory" class="form-control" placeholder="Enter category name">
                    <button class="btn btn-success" id="addCategoryBtn">Add</button>
                </div>
            </div>
            <div id="categoriesList" style="margin-top: 20px;">
                <!-- Categories will be listed here -->
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" id="closeCategoriesBtn">Close</button>
            </div>
        </div>
    </div>

    <!-- Profile Modal -->
    <div class="modal" id="profileModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>User Profile</h3>
                <button class="close-btn" id="closeProfileModal">&times;</button>
            </div>
            <div id="profileContent" style="text-align: center; padding: 20px 0;">
                <!-- Profile content will be shown here -->
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" id="closeProfileBtn">Close</button>
                <button class="btn btn-primary" id="editProfileBtn">Edit Profile</button>
            </div>
        </div>
    </div>

    <!-- Edit Profile Modal -->
    <div class="modal" id="editProfileModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Edit Profile</h3>
                <button class="close-btn" id="closeEditProfileModal">&times;</button>
            </div>
            <div class="form-group">
                <label for="editFirstName">First Name</label>
                <input type="text" id="editFirstName" class="form-control">
            </div>
            <div class="form-group">
                <label for="editLastName">Last Name</label>
                <input type="text" id="editLastName" class="form-control">
            </div>
            <div class="form-group">
                <label for="editEmail">Email</label>
                <input type="email" id="editEmail" class="form-control">
            </div>
            <div class="form-group">
                <label for="editPhone">Phone</label>
                <input type="text" id="editPhone" class="form-control">
            </div>
            <div class="form-group">
                <label for="editCountry">Country</label>
                <select id="editCountry" class="form-control">
                    <!-- Countries will be loaded here -->
                </select>
            </div>
            <div class="form-group">
                <label for="editRole">Role</label>
                <select id="editRole" class="form-control">
                    <option value="Manager">Manager</option>
                    <option value="Staff">Staff</option>
                    <option value="Customer">Customer</option>
                    <option value="Admin">Admin</option>
                </select>
            </div>
            <div class="form-group">
                <label for="profilePicture">Profile Picture</label>
                <input type="file" id="profilePicture" class="form-control" accept="image/*">
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" id="cancelEditProfileBtn">Cancel</button>
                <button class="btn btn-success" id="saveProfileBtn">Save</button>
            </div>
        </div>
    </div>

    <!-- Status Modal -->
    <div class="modal" id="statusModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Change Status</h3>
                <button class="close-btn" id="closeStatusModal">&times;</button>
            </div>
            <div style="display: flex; flex-direction: column; gap: 10px; padding: 20px 0;">
                <div class="status-option" data-status="online" style="display: flex; align-items: center; padding: 10px; cursor: pointer; border-radius: var(--border-radius);">
                    <div style="width: 15px; height: 15px; border-radius: 50%; background-color: var(--success-color); margin-right: 10px;"></div>
                    <span>Online</span>
                </div>
                <div class="status-option" data-status="break" style="display: flex; align-items: center; padding: 10px; cursor: pointer; border-radius: var(--border-radius);">
                    <div style="width: 15px; height: 15px; border-radius: 50%; background-color: var(--warning-color); margin-right: 10px;"></div>
                    <span>Break</span>
                </div>
                <div class="status-option" data-status="away" style="display: flex; align-items: center; padding: 10px; cursor: pointer; border-radius: var(--border-radius);">
                    <div style="width: 15px; height: 15px; border-radius: 50%; background-color: var(--gray-color); margin-right: 10px;"></div>
                    <span>Away</span>
                </div>
                <div class="status-option" data-status="offline" style="display: flex; align-items: center; padding: 10px; cursor: pointer; border-radius: var(--border-radius);">
                    <div style="width: 15px; height: 15px; border-radius: 50%; background-color: var(--danger-color); margin-right: 10px;"></div>
                    <span>Offline</span>
                </div>
            </div>
        </div>
    </div>

    <!-- Users Modal -->
    <div class="modal" id="usersModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Users</h3>
                <button class="close-btn" id="closeUsersModal">&times;</button>
            </div>
            <div id="usersList" style="display: flex; flex-wrap: wrap; gap: 20px; margin-top: 20px;">
                <!-- Users will be listed here -->
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" id="closeUsersBtn">Close</button>
            </div>
        </div>
    </div>

    <!-- Notifications Modal -->
    <div class="modal" id="notificationsModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Notifications</h3>
                <button class="close-btn" id="closeNotificationsModal">&times;</button>
            </div>
            <div id="notificationsList" style="margin-top: 20px;">
                <!-- Notifications will be listed here -->
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" id="closeNotificationsBtn">Close</button>
                <button class="btn btn-primary" id="markAllReadBtn">Mark All Read</button>
            </div>
        </div>
    </div>

    <!-- Toast Notification -->
    <div class="toast" id="toast">
        <div class="toast-icon"><i class="fas fa-check-circle"></i></div>
        <div class="toast-content">
            <div class="toast-title">Success</div>
            <div class="toast-message">Action completed successfully</div>
        </div>
        <button class="toast-close" id="closeToast">&times;</button>
    </div>

    <!-- Custom Date Range Modal -->
    <div class="modal" id="dateRangeModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Select Date Range</h3>
                <button class="close-btn" id="closeDateRangeModal">&times;</button>
            </div>
            <div class="form-group">
                <label for="startDate">Start Date</label>
                <input type="text" id="startDate" class="form-control" placeholder="Select start date">
            </div>
            <div class="form-group">
                <label for="endDate">End Date</label>
                <input type="text" id="endDate" class="form-control" placeholder="Select end date">
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" id="cancelDateRangeBtn">Cancel</button>
                <button class="btn btn-success" id="applyDateRangeBtn">Apply</button>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Check preferred color scheme
            if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
                document.body.classList.remove('light');
                document.body.classList.add('dark');
            }

            // Listen for color scheme changes
            window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', event => {
                if (event.matches) {
                    document.body.classList.remove('light');
                    document.body.classList.add('dark');
                } else {
                    document.body.classList.remove('dark');
                    document.body.classList.add('light');
                }
            });

            // Initialize flatpickr instances
            const birthdatePicker = flatpickr("#birthdate", {
                dateFormat: "Y-m-d",
                maxDate: "today"
            });

            const dueDatePicker = flatpickr("#taskDueDate", {
                dateFormat: "Y-m-d",
                minDate: "today"
            });

            const startDatePicker = flatpickr("#startDate", {
                dateFormat: "Y-m-d"
            });

            const endDatePicker = flatpickr("#endDate", {
                dateFormat: "Y-m-d"
            });

            // Fetch countries for dropdowns
            fetch('https://restcountries.com/v3.1/all')
                .then(response => response.json())
                .then(data => {
                    const nationalitySelect = document.getElementById('nationality');
                    const editCountrySelect = document.getElementById('editCountry');
                    
                    // Sort countries alphabetically
                    data.sort((a, b) => a.name.common.localeCompare(b.name.common));
                    
                    data.forEach(country => {
                        const option = document.createElement('option');
                        option.value = country.name.common;
                        option.textContent = country.name.common;
                        nationalitySelect.appendChild(option);
                        
                        const editOption = document.createElement('option');
                        editOption.value = country.name.common;
                        editOption.textContent = country.name.common;
                        editCountrySelect.appendChild(editOption);
                    });
                })
                .catch(error => console.error('Error fetching countries:', error));

            // Data structures
            let users = JSON.parse(localStorage.getItem('todo_users')) || [];
            let tasks = JSON.parse(localStorage.getItem('todo_tasks')) || [];
            let categories = JSON.parse(localStorage.getItem('todo_categories')) || [
                { id: 1, name: 'Work' },
                { id: 2, name: 'Personal' },
                { id: 3, name: 'Shopping' },
                { id: 4, name: 'Health' },
                { id: 5, name: 'Finance' }
            ];
            let notifications = JSON.parse(localStorage.getItem('todo_notifications')) || [];
            let currentUser = JSON.parse(localStorage.getItem('todo_current_user')) || null;
            let userStatus = localStorage.getItem('todo_user_status') || 'online';
            
            // History for undo/redo functionality
            let taskHistory = [];
            let historyIndex = -1;
            const MAX_HISTORY = 20;

            // Timer variables
            let globalTimerInterval;
            let globalSeconds = 0;
            let activeTaskTimer = null;
            let taskTimers = {};

            // Get DOM elements
            const loginPage = document.getElementById('loginPage');
            const dashboard = document.getElementById('dashboard');
            const registerModal = document.getElementById('registerModal');
            const taskModal = document.getElementById('taskModal');
            const viewTaskModal = document.getElementById('viewTaskModal');
            const exportModal = document.getElementById('exportModal');
            const importModal = document.getElementById('importModal');
            const categoriesModal = document.getElementById('categoriesModal');
            const profileModal = document.getElementById('profileModal');
            const editProfileModal = document.getElementById('editProfileModal');
            const statusModal = document.getElementById('statusModal');
            const usersModal = document.getElementById('usersModal');
            const notificationsModal = document.getElementById('notificationsModal');
            const dateRangeModal = document.getElementById('dateRangeModal');
            const toast = document.getElementById('toast');
            const multiSelectBar = document.getElementById('multiSelectBar');
            
            // Toggle between List and Graph views
            const listViewBtn = document.getElementById('listViewBtn');
            const graphViewBtn = document.getElementById('graphViewBtn');
            const listView = document.getElementById('listView');
            const graphView = document.getElementById('graphView');
            
            // Create random users if none exist
            if (users.length === 0) {
                for (let i = 1; i <= 10; i++) {
                    const gender = Math.random() > 0.5 ? 'men' : 'women';
                    const randomNum = Math.floor(Math.random() * 70) + 1;
                    
                    users.push({
                        id: i,
                        firstName: `User${i}`,
                        lastName: `Test${i}`,
                        email: i === 1 ? 'test@example.com' : `user${i}@example.com`,
                        password: i === 1 ? '123456' : `password${i}`,
                        birthdate: '1990-01-01',
                        nationality: 'United States',
                        role: i === 1 ? 'Admin' : (i % 4 === 0 ? 'Manager' : (i % 3 === 0 ? 'Staff' : 'Customer')),
                        profileImage: `https://randomuser.me/api/portraits/${gender}/${randomNum}.jpg`,
                        phone: `+1 555-${Math.floor(1000 + Math.random() * 9000)}`,
                        joinDate: new Date().toISOString().split('T')[0]
                    });
                }
                localStorage.setItem('todo_users', JSON.stringify(users));
            }
            
            // Create random tasks if none exist
            if (tasks.length === 0) {
                const getRandomDate = (start, end) => {
                    return new Date(start.getTime() + Math.random() * (end.getTime() - start.getTime())).toISOString().split('T')[0];
                };
                
                const today = new Date();
                const oneMonthAgo = new Date(today);
                oneMonthAgo.setMonth(today.getMonth() - 1);
                
                const oneMonthFromNow = new Date(today);
                oneMonthFromNow.setMonth(today.getMonth() + 1);
                
                const taskTitles = [
                    'Finalize project proposal',
                    'Review marketing materials',
                    'Update website content',
                    'Prepare quarterly report',
                    'Schedule team meeting',
                    'Complete client presentation',
                    'Research new technologies',
                    'Run system backups',
                    'Implement new feature',
                    'Fix reported bugs'
                ];
                
                const descriptions = [
                    'This needs to be done ASAP to meet the deadline',
                    'Include feedback from last week\'s meeting',
                    'Make sure to follow the brand guidelines',
                    'Coordinate with the marketing team for input',
                    'Send to all stakeholders for approval',
                    'Requires careful attention to detail',
                    'Focus on user experience improvements',
                    'Ensure compliance with all regulations',
                    'Be thorough and document all changes',
                    'Follow up with team members for status updates'
                ];
                
                for (let i = 0; i < 10; i++) {
                    const dueDate = getRandomDate(today, oneMonthFromNow);
                    const hasSubTasks = Math.random() > 0.5;
                    
                    const newTask = {
                        id: i + 1,
                        title: taskTitles[i],
                        description: descriptions[i],
                        dueDate: dueDate,
                        priority: i % 3 === 0 ? 'high' : (i % 3 === 1 ? 'medium' : 'low'),
                        category: categories[Math.floor(Math.random() * categories.length)].name,
                        notes: `Additional notes for task ${i + 1}`,
                        completed: Math.random() > 0.7,
                        createdAt: getRandomDate(oneMonthAgo, today),
                        subTasks: []
                    };
                    
                    if (hasSubTasks) {
                        const numSubTasks = Math.floor(Math.random() * 3) + 1;
                        for (let j = 0; j < numSubTasks; j++) {
                            newTask.subTasks.push({
                                id: `${i + 1}-${j + 1}`,
                                title: `Sub-task ${j + 1} for ${newTask.title}`,
                                completed: Math.random() > 0.5
                            });
                        }
                    }
                    
                    tasks.push(newTask);
                }
                
                localStorage.setItem('todo_tasks', JSON.stringify(tasks));
                
                // Add task creation notifications
                for (let i = 0; i < 5; i++) {
                    addNotification(`Task "${tasks[i].title}" has been created`, 'info');
                }
                
                // Add due soon notifications
                const twoDaysFromNow = new Date(today);
                twoDaysFromNow.setDate(today.getDate() + 2);
                
                tasks.forEach(task => {
                    const dueDate = new Date(task.dueDate);
                    if (dueDate <= twoDaysFromNow && dueDate >= today && !task.completed) {
                        addNotification(`Task "${task.title}" is due soon`, 'warning');
                    }
                });
            }
            
            // Save tasks to history for undo/redo
            function saveToHistory() {
                // If we have moved back in history and are adding a new state,
                // remove all future states
                if (historyIndex !== taskHistory.length - 1 && historyIndex !== -1) {
                    taskHistory = taskHistory.slice(0, historyIndex + 1);
                }
                
                // Add current state to history
                taskHistory.push(JSON.stringify(tasks));
                
                // Limit history size
                if (taskHistory.length > MAX_HISTORY) {
                    taskHistory.shift();
                }
                
                historyIndex = taskHistory.length - 1;
                
                // Enable/disable undo/redo buttons
                document.getElementById('undoBtn').disabled = historyIndex <= 0;
                document.getElementById('redoBtn').disabled = historyIndex >= taskHistory.length - 1;
            }
            
            // Initialize history with current tasks
            if (tasks.length > 0 && taskHistory.length === 0) {
                taskHistory.push(JSON.stringify(tasks));
                historyIndex = 0;
            }
            
            // Undo function
            function undoAction() {
                if (historyIndex > 0) {
                    historyIndex--;
                    tasks = JSON.parse(taskHistory[historyIndex]);
                    localStorage.setItem('todo_tasks', JSON.stringify(tasks));
                    renderTasks();
                    updateTaskCounts();
                    updateGraphs();
                    showToast('Undo', 'Previous action has been undone', 'info');
                    
                    // Enable/disable undo/redo buttons
                    document.getElementById('undoBtn').disabled = historyIndex <= 0;
                    document.getElementById('redoBtn').disabled = historyIndex >= taskHistory.length - 1;
                }
            }
            
            // Redo function
            function redoAction() {
                if (historyIndex < taskHistory.length - 1) {
                    historyIndex++;
                    tasks = JSON.parse(taskHistory[historyIndex]);
                    localStorage.setItem('todo_tasks', JSON.stringify(tasks));
                    renderTasks();
                    updateTaskCounts();
                    updateGraphs();
                    showToast('Redo', 'Action has been redone', 'info');
                    
                    // Enable/disable undo/redo buttons
                    document.getElementById('undoBtn').disabled = historyIndex <= 0;
                    document.getElementById('redoBtn').disabled = historyIndex >= taskHistory.length - 1;
                }
            }
            
            // Format timer function
            function formatTime(seconds) {
                const h = Math.floor(seconds / 3600);
                const m = Math.floor((seconds % 3600) / 60);
                const s = seconds % 60;
                return [
                    h.toString().padStart(2, '0'),
                    m.toString().padStart(2, '0'),
                    s.toString().padStart(2, '0')
                ].join(':');
            }
            
            // Start global timer
            function startGlobalTimer() {
                if (globalTimerInterval) return;
                
                globalTimerInterval = setInterval(() => {
                    globalSeconds++;
                    document.getElementById('globalTimer').textContent = formatTime(globalSeconds);
                    
                    // Update active task timer if any
                    if (activeTaskTimer) {
                        const taskId = activeTaskTimer;
                        if (!taskTimers[taskId]) taskTimers[taskId] = 0;
                        taskTimers[taskId]++;
                        
                        // Update task timer display if visible
                        const timerDisplay = document.querySelector(`.task-timer-display[data-task-id="${taskId}"]`);
                        if (timerDisplay) {
                            timerDisplay.textContent = formatTime(taskTimers[taskId]);
                        }
                    }
                    
                    // Save timer state to localStorage
                    localStorage.setItem('todo_global_timer', globalSeconds.toString());
                    localStorage.setItem('todo_task_timers', JSON.stringify(taskTimers));
                }, 1000);
            }
            
            // Pause global timer
            function pauseGlobalTimer() {
                if (globalTimerInterval) {
                    clearInterval(globalTimerInterval);
                    globalTimerInterval = null;
                }
            }
            
            // Reset global timer
            function resetGlobalTimer() {
                pauseGlobalTimer();
                globalSeconds = 0;
                document.getElementById('globalTimer').textContent = formatTime(globalSeconds);
                localStorage.setItem('todo_global_timer', '0');
            }
            
            // Start task timer
            function startTaskTimer(taskId) {
                // If another task timer is active, pause it
                if (activeTaskTimer && activeTaskTimer !== taskId) {
                    const previousTaskBtn = document.querySelector(`.task-timer-btn[data-task-id="${activeTaskTimer}"]`);
                    if (previousTaskBtn) {
                        previousTaskBtn.innerHTML = '<i class="fas fa-play"></i>';
                        previousTaskBtn.setAttribute('title', 'Start Timer');
                    }
                }
                
                activeTaskTimer = taskId;
                startGlobalTimer();
                localStorage.setItem('todo_active_task', taskId);
                
                // Show toast notification
                showToast('Timer Started', `Timer started for task`, 'info');
            }
            
            // Pause task timer
            function pauseTaskTimer(taskId) {
                if (activeTaskTimer === taskId) {
                    activeTaskTimer = null;
                    localStorage.removeItem('todo_active_task');
                    
                    // Show toast with time spent
                    const timeSpent = taskTimers[taskId] || 0;
                    showToast('Timer Paused', `Time spent: ${formatTime(timeSpent)}`, 'info');
                }
            }
            
            // Toggle task timer
            function toggleTaskTimer(taskId) {
                const btn = document.querySelector(`.task-timer-btn[data-task-id="${taskId}"]`);
                
                if (activeTaskTimer === taskId) {
                    pauseTaskTimer(taskId);
                    btn.innerHTML = '<i class="fas fa-play"></i>';
                    btn.setAttribute('title', 'Start Timer');
                } else {
                    startTaskTimer(taskId);
                    btn.innerHTML = '<i class="fas fa-pause"></i>';
                    btn.setAttribute('title', 'Pause Timer');
                }
            }
            
            // Load timer state
            function loadTimerState() {
                const savedGlobalTime = localStorage.getItem('todo_global_timer');
                const savedTaskTimers = localStorage.getItem('todo_task_timers');
                const savedActiveTask = localStorage.getItem('todo_active_task');
                
                if (savedGlobalTime) {
                    globalSeconds = parseInt(savedGlobalTime);
                    document.getElementById('globalTimer').textContent = formatTime(globalSeconds);
                }
                
                if (savedTaskTimers) {
                    taskTimers = JSON.parse(savedTaskTimers);
                }
                
                if (savedActiveTask) {
                    activeTaskTimer = savedActiveTask;
                    startGlobalTimer();
                    
                    // Update UI to show active timer
                    const timerBtn = document.querySelector(`.task-timer-btn[data-task-id="${activeTaskTimer}"]`);
                    if (timerBtn) {
                        timerBtn.innerHTML = '<i class="fas fa-pause"></i>';
                        timerBtn.setAttribute('title', 'Pause Timer');
                    }
                }
            }
            
            // Event listener for global timer buttons
            document.getElementById('pauseTimer').addEventListener('click', function() {
                if (globalTimerInterval) {
                    pauseGlobalTimer();
                    this.innerHTML = '<i class="fas fa-play"></i>';
                    
                    // Also pause active task timer if any
                    if (activeTaskTimer) {
                        const taskBtn = document.querySelector(`.task-timer-btn[data-task-id="${activeTaskTimer}"]`);
                        if (taskBtn) {
                            taskBtn.innerHTML = '<i class="fas fa-play"></i>';
                            taskBtn.setAttribute('title', 'Start Timer');
                        }
                        
                        // Don't reset activeTaskTimer, just pause the timer
                    }
                } else {
                    startGlobalTimer();
                    this.innerHTML = '<i class="fas fa-pause"></i>';
                }
            });
            
            document.getElementById('resetTimer').addEventListener('click', function() {
                if (confirm('Are you sure you want to reset the timer?')) {
                    resetGlobalTimer();
                    document.getElementById('pauseTimer').innerHTML = '<i class="fas fa-play"></i>';
                }
            });
            
            // Add notification function
            function addNotification(message, type = 'info') {
                const notification = {
                    id: Date.now(),
                    message: message,
                    type: type,
                    createdAt: new Date().toISOString(),
                    read: false
                };
                
                notifications.unshift(notification);
                
                // Limit to 50 notifications
                if (notifications.length > 50) {
                    notifications.pop();
                }
                
                localStorage.setItem('todo_notifications', JSON.stringify(notifications));
                updateNotificationBadge();
            }
            
            // Update notification badge
            function updateNotificationBadge() {
                const unreadCount = notifications.filter(n => !n.read).length;
                const badge = document.getElementById('notificationBadge');
                
                badge.textContent = unreadCount;
                
                if (unreadCount > 0) {
                    badge.style.display = 'flex';
                } else {
                    badge.style.display = 'none';
                }
            }
            
            // Render notifications
            function renderNotifications() {
                const container = document.getElementById('notificationsList');
                container.innerHTML = '';
                
                if (notifications.length === 0) {
                    container.innerHTML = '<div style="text-align: center; padding: 20px;">No notifications</div>';
                    return;
                }
                
                notifications.forEach(notification => {
                    const date = new Date(notification.createdAt);
                    const formattedDate = date.toLocaleString();
                    
                    const div = document.createElement('div');
                    div.style.padding = '15px';
                    div.style.borderBottom = '1px solid var(--border-color)';
                    div.style.cursor = 'pointer';
                    div.style.display = 'flex';
                    div.style.alignItems = 'flex-start';
                    div.style.gap = '10px';
                    
                    if (!notification.read) {
                        div.style.backgroundColor = 'rgba(93, 92, 222, 0.1)';
                    }
                    
                    let iconClass = 'fas fa-info-circle';
                    let iconColor = 'var(--info-color)';
                    
                    switch (notification.type) {
                        case 'success':
                            iconClass = 'fas fa-check-circle';
                            iconColor = 'var(--success-color)';
                            break;
                        case 'error':
                            iconClass = 'fas fa-exclamation-circle';
                            iconColor = 'var(--danger-color)';
                            break;
                        case 'warning':
                            iconClass = 'fas fa-exclamation-triangle';
                            iconColor = 'var(--warning-color)';
                            break;
                    }
                    
                    div.innerHTML = `
                        <div style="color: ${iconColor}; font-size: 18px;"><i class="${iconClass}"></i></div>
                        <div style="flex: 1;">
                            <div style="margin-bottom: 5px;">${notification.message}</div>
                            <div style="font-size: 12px; color: var(--text-secondary);">${formattedDate}</div>
                        </div>
                        <div>
                            ${notification.read ? 
                                '<button style="background: none; border: none; color: var(--text-secondary); cursor: pointer;"><i class="fas fa-trash"></i></button>' : 
                                '<button style="background: none; border: none; color: var(--text-secondary); cursor: pointer;"><i class="fas fa-check"></i></button>'}
                        </div>
                    `;
                    
                    div.querySelector('button').addEventListener('click', (e) => {
                        e.stopPropagation();
                        
                        if (notification.read) {
                            // Remove notification
                            notifications = notifications.filter(n => n.id !== notification.id);
                            localStorage.setItem('todo_notifications', JSON.stringify(notifications));
                            renderNotifications();
                            updateNotificationBadge();
                        } else {
                            // Mark as read
                            notification.read = true;
                            localStorage.setItem('todo_notifications', JSON.stringify(notifications));
                            renderNotifications();
                            updateNotificationBadge();
                        }
                    });
                    
                    div.addEventListener('click', () => {
                        if (!notification.read) {
                            notification.read = true;
                            localStorage.setItem('todo_notifications', JSON.stringify(notifications));
                            updateNotificationBadge();
                            renderNotifications();
                        }
                    });
                    
                    container.appendChild(div);
                });
            }
            
            // Show toast notification
            function showToast(title, message, type = 'success') {
                const toast = document.getElementById('toast');
                const toastTitle = toast.querySelector('.toast-title');
                const toastMessage = toast.querySelector('.toast-message');
                const toastIcon = toast.querySelector('.toast-icon i');
                
                toast.className = 'toast';
                toast.classList.add(`toast-${type}`);
                
                toastTitle.textContent = title;
                toastMessage.textContent = message;
                
                // Set appropriate icon
                switch (type) {
                    case 'success':
                        toastIcon.className = 'fas fa-check-circle';
                        break;
                    case 'error':
                        toastIcon.className = 'fas fa-exclamation-circle';
                        break;
                    case 'warning':
                        toastIcon.className = 'fas fa-exclamation-triangle';
                        break;
                    case 'info':
                        toastIcon.className = 'fas fa-info-circle';
                        break;
                }
                
                // Show toast
                toast.classList.add('active');
                
                // Auto-hide after 5 seconds
                setTimeout(() => {
                    toast.classList.remove('active');
                }, 5000);
            }
            
            // Close toast on click
            document.getElementById('closeToast').addEventListener('click', function() {
                document.getElementById('toast').classList.remove('active');
            });
            
            // Update task counts
            function updateTaskCounts() {
                const totalTasks = tasks.length;
                const completedTasks = tasks.filter(task => task.completed).length;
                const pendingTasks = totalTasks - completedTasks;
                
                document.getElementById('totalTasksCount').textContent = totalTasks;
                document.getElementById('completedTasksCount').textContent = completedTasks;
                document.getElementById('pendingTasksCount').textContent = pendingTasks;
            }
            
            // Render tasks
            function renderTasks() {
                const taskList = document.getElementById('taskList');
                taskList.innerHTML = '';
                
                // Apply filters
                let filteredTasks = [...tasks];
                
                // Status filter
                const statusFilter = document.getElementById('statusFilter').value;
                if (statusFilter !== 'all') {
                    filteredTasks = filteredTasks.filter(task => 
                        statusFilter === 'active' ? !task.completed : task.completed
                    );
                }
                
                // Category filter
                const categoryFilter = document.getElementById('categoryFilter').value;
                if (categoryFilter !== 'all') {
                    filteredTasks = filteredTasks.filter(task => task.category === categoryFilter);
                }
                
                // Priority filter
                const priorityFilter = document.getElementById('priorityFilter').value;
                if (priorityFilter !== 'all') {
                    filteredTasks = filteredTasks.filter(task => task.priority === priorityFilter);
                }
                
                // Due date filter
                const dueDateFilter = document.getElementById('dueDateFilter').value;
                const today = new Date();
                today.setHours(0, 0, 0, 0);
                
                const weekStart = new Date(today);
                weekStart.setDate(today.getDate() - today.getDay());
                
                const monthStart = new Date(today);
                monthStart.setDate(1);
                
                const nextWeek = new Date(today);
                nextWeek.setDate(today.getDate() + 7);
                
                const nextMonth = new Date(today);
                nextMonth.setMonth(today.getMonth() + 1);
                
                if (dueDateFilter !== 'all') {
                    if (dueDateFilter === 'today') {
                        filteredTasks = filteredTasks.filter(task => {
                            const dueDate = new Date(task.dueDate);
                            dueDate.setHours(0, 0, 0, 0);
                            return dueDate.getTime() === today.getTime();
                        });
                    } else if (dueDateFilter === 'week') {
                        filteredTasks = filteredTasks.filter(task => {
                            const dueDate = new Date(task.dueDate);
                            return dueDate >= weekStart && dueDate < nextWeek;
                        });
                    } else if (dueDateFilter === 'month') {
                        filteredTasks = filteredTasks.filter(task => {
                            const dueDate = new Date(task.dueDate);
                            return dueDate >= monthStart && dueDate < nextMonth;
                        });
                    } else if (dueDateFilter === 'custom') {
                        const startDate = document.getElementById('startDate').value;
                        const endDate = document.getElementById('endDate').value;
                        
                        if (startDate && endDate) {
                            const start = new Date(startDate);
                            const end = new Date(endDate);
                            end.setHours(23, 59, 59, 999);
                            
                            filteredTasks = filteredTasks.filter(task => {
                                const dueDate = new Date(task.dueDate);
                                return dueDate >= start && dueDate <= end;
                            });
                        }
                    }
                }
                
                // Search filter
                const searchQuery = document.getElementById('searchInput').value.toLowerCase();
                if (searchQuery) {
                    filteredTasks = filteredTasks.filter(task => 
                        task.title.toLowerCase().includes(searchQuery) || 
                        task.description.toLowerCase().includes(searchQuery)
                    );
                }
                
                // Sort tasks
                const sortValue = document.getElementById('sortSelect').value;
                filteredTasks.sort((a, b) => {
                    switch (sortValue) {
                        case 'titleAsc':
                            return a.title.localeCompare(b.title);
                        case 'titleDesc':
                            return b.title.localeCompare(a.title);
                        case 'dateAsc':
                            return new Date(a.dueDate) - new Date(b.dueDate);
                        case 'dateDesc':
                            return new Date(b.dueDate) - new Date(a.dueDate);
                        case 'priorityDesc':
                            const priorities = { high: 3, medium: 2, low: 1 };
                            return priorities[b.priority] - priorities[a.priority];
                        case 'priorityAsc':
                            const prioritiesAsc = { high: 3, medium: 2, low: 1 };
                            return prioritiesAsc[a.priority] - prioritiesAsc[b.priority];
                        default:
                            return 0;
                    }
                });
                
                // Check if there are any tasks after filtering
                if (filteredTasks.length === 0) {
                    const emptyMessage = document.createElement('div');
                    emptyMessage.style.textAlign = 'center';
                    emptyMessage.style.padding = '40px 0';
                    emptyMessage.style.color = 'var(--text-secondary)';
                    emptyMessage.innerHTML = `
                        <i class="fas fa-clipboard-check" style="font-size: 48px; margin-bottom: 20px;"></i>
                        <h3>No tasks found</h3>
                        <p>Try changing your filters or create a new task</p>
                    `;
                    taskList.appendChild(emptyMessage);
                    return;
                }
                
                // Render tasks
                filteredTasks.forEach(task => {
                    const taskItem = document.createElement('div');
                    taskItem.className = 'task-item';
                    taskItem.setAttribute('data-id', task.id);
                    taskItem.draggable = true;
                    
                    // Add border color based on due date
                    const dueDate = new Date(task.dueDate);
                    const today = new Date();
                    today.setHours(0, 0, 0, 0);
                    
                    const twoDaysFromNow = new Date(today);
                    twoDaysFromNow.setDate(today.getDate() + 2);
                    
                    if (dueDate < today) {
                        taskItem.classList.add('expired');
                    } else if (dueDate <= twoDaysFromNow) {
                        taskItem.classList.add('due-soon');
                    } else {
                        taskItem.classList.add('due-later');
                    }
                    
                    // Add completed class if task is completed
                    if (task.completed) {
                        taskItem.classList.add('completed');
                    }
                    
                    let taskTimerDisplay = '';
                    if (taskTimers[task.id]) {
                        taskTimerDisplay = `<div class="task-timer-display" data-task-id="${task.id}">${formatTime(taskTimers[task.id])}</div>`;
                    } else {
                        taskTimerDisplay = `<div class="task-timer-display" data-task-id="${task.id}">00:00:00</div>`;
                    }
                    
                    let subTasksHtml = '';
                    if (task.subTasks && task.subTasks.length > 0) {
                        subTasksHtml = '<div class="sub-tasks">';
                        task.subTasks.forEach(subTask => {
                            subTasksHtml += `
                                <div class="sub-task ${subTask.completed ? 'completed' : ''}">
                                    <label class="task-checkbox">
                                        <input type="checkbox" class="checkbox-input sub-task-checkbox" data-task-id="${task.id}" data-subtask-id="${subTask.id}" ${subTask.completed ? 'checked' : ''}>
                                        <span class="checkbox-custom"></span>
                                    </label>
                                    ${subTask.title}
                                </div>
                            `;
                        });
                        subTasksHtml += '</div>';
                    }
                    
                    taskItem.innerHTML = `
                        <div class="task-header">
                            <div style="display: flex; align-items: flex-start;">
                                <label class="task-checkbox">
                                    <input type="checkbox" class="checkbox-input task-checkbox" data-id="${task.id}" ${task.completed ? 'checked' : ''}>
                                    <span class="checkbox-custom"></span>
                                </label>
                                <h3 class="task-title">${task.title}</h3>
                            </div>
                            <div class="task-priority priority-${task.priority}">${task.priority}</div>
                        </div>
                        <div class="task-description">${task.description}</div>
                        ${subTasksHtml}
                        <div class="task-details">
                            <div class="task-detail">
                                <i class="fas fa-calendar"></i>
                                ${task.dueDate}
                            </div>
                            <div class="task-detail">
                                <i class="fas fa-tag"></i>
                                <span class="category-badge">${task.category}</span>
                            </div>
                            ${taskTimerDisplay}
                        </div>
                        <div class="task-actions">
                            <button class="task-btn btn-primary" data-action="view" data-id="${task.id}">
                                <i class="fas fa-eye"></i> View
                            </button>
                            <button class="task-btn btn-secondary" data-action="edit" data-id="${task.id}">
                                <i class="fas fa-edit"></i> Edit
                            </button>
                            <button class="task-btn btn-danger" data-action="delete" data-id="${task.id}">
                                <i class="fas fa-trash"></i> Delete
                            </button>
                            <button class="task-btn btn-warning task-timer-btn" data-action="timer" data-task-id="${task.id}" title="${activeTaskTimer === task.id.toString() ? 'Pause Timer' : 'Start Timer'}">
                                <i class="fas ${activeTaskTimer === task.id.toString() ? 'fa-pause' : 'fa-play'}"></i> ${activeTaskTimer === task.id.toString() ? 'Pause' : 'Start'}
                            </button>
                        </div>
                    `;
                    
                    taskList.appendChild(taskItem);
                    
                    // Add event listeners for task checkboxes
                    const checkbox = taskItem.querySelector(`.task-checkbox[data-id="${task.id}"]`);
                    checkbox.addEventListener('change', function() {
                        const taskId = this.getAttribute('data-id');
                        const task = tasks.find(t => t.id.toString() === taskId);
                        if (task) {
                            task.completed = this.checked;
                            
                            // Also mark all subtasks as completed/incomplete
                            if (task.subTasks) {
                                task.subTasks.forEach(subTask => {
                                    subTask.completed = task.completed;
                                });
                            }
                            
                            localStorage.setItem('todo_tasks', JSON.stringify(tasks));
                            saveToHistory();
                            renderTasks();
                            updateTaskCounts();
                            updateGraphs();
                            
                            if (task.completed) {
                                addNotification(`Task "${task.title}" marked as completed`, 'success');
                                showToast('Task Completed', `Task "${task.title}" marked as completed`, 'success');
                            } else {
                                addNotification(`Task "${task.title}" marked as incomplete`, 'info');
                                showToast('Task Updated', `Task "${task.title}" marked as incomplete`, 'info');
                            }
                        }
                    });
                    
                    // Add event listeners for sub-task checkboxes
                    const subTaskCheckboxes = taskItem.querySelectorAll('.sub-task-checkbox');
                    subTaskCheckboxes.forEach(checkbox => {
                        checkbox.addEventListener('change', function() {
                            const taskId = this.getAttribute('data-task-id');
                            const subTaskId = this.getAttribute('data-subtask-id');
                            const task = tasks.find(t => t.id.toString() === taskId);
                            
                            if (task && task.subTasks) {
                                const subTask = task.subTasks.find(st => st.id === subTaskId);
                                if (subTask) {
                                    subTask.completed = this.checked;
                                    
                                    // Update parent task completed status
                                    // If all subtasks are completed, mark the task as completed
                                    const allSubTasksCompleted = task.subTasks.every(st => st.completed);
                                    task.completed = allSubTasksCompleted;
                                    
                                    localStorage.setItem('todo_tasks', JSON.stringify(tasks));
                                    saveToHistory();
                                    renderTasks();
                                    updateTaskCounts();
                                    updateGraphs();
                                }
                            }
                        });
                    });
                    
                    // Add event listeners for task buttons
                    const actionButtons = taskItem.querySelectorAll('.task-btn');
                    actionButtons.forEach(button => {
                        button.addEventListener('click', function(e) {
                            e.preventDefault();
                            const action = this.getAttribute('data-action');
                            const id = this.getAttribute('data-id');
                            
                            if (action === 'view') {
                                viewTask(id);
                            } else if (action === 'edit') {
                                editTask(id);
                            } else if (action === 'delete') {
                                deleteTask(id);
                            } else if (action === 'timer') {
                                const taskId = this.getAttribute('data-task-id');
                                toggleTaskTimer(taskId);
                            }
                        });
                    });
                    
                    // Add drag and drop event listeners
                    taskItem.addEventListener('dragstart', function(e) {
                        e.dataTransfer.setData('text/plain', task.id);
                        this.classList.add('dragging');
                    });
                    
                    taskItem.addEventListener('dragend', function() {
                        this.classList.remove('dragging');
                    });
                });
                
                // Add event listeners for task list (drop zone)
                taskList.addEventListener('dragover', function(e) {
                    e.preventDefault();
                    const dragging = document.querySelector('.dragging');
                    if (!dragging) return;
                    
                    const afterElement = getDragAfterElement(taskList, e.clientY);
                    if (afterElement) {
                        taskList.insertBefore(dragging, afterElement);
                    } else {
                        taskList.appendChild(dragging);
                    }
                });
                
                taskList.addEventListener('drop', function(e) {
                    e.preventDefault();
                    const draggedId = e.dataTransfer.getData('text/plain');
                    const draggedTask = tasks.find(t => t.id.toString() === draggedId);
                    
                    if (!draggedTask) return;
                    
                    // Get the new order of tasks
                    const newOrderedTasks = Array.from(taskList.querySelectorAll('.task-item'))
                        .map(item => item.getAttribute('data-id'))
                        .map(id => tasks.find(t => t.id.toString() === id));
                    
                    // Update tasks array to match the new order
                    tasks = newOrderedTasks.concat(tasks.filter(t => !newOrderedTasks.some(nt => nt.id === t.id)));
                    
                    localStorage.setItem('todo_tasks', JSON.stringify(tasks));
                    saveToHistory();
                    showToast('Task Reordered', 'Task order has been updated', 'success');
                });
            }
            
            // Helper function for drag and drop
            function getDragAfterElement(container, y) {
                const draggableElements = [...container.querySelectorAll('.task-item:not(.dragging)')];
                
                return draggableElements.reduce((closest, child) => {
                    const box = child.getBoundingClientRect();
                    const offset = y - box.top - box.height / 2;
                    
                    if (offset < 0 && offset > closest.offset) {
                        return { offset: offset, element: child };
                    } else {
                        return closest;
                    }
                }, { offset: Number.NEGATIVE_INFINITY }).element;
            }
            
            // Update graph data
            function updateGraphs() {
                // Tasks progress over time (X-Y Graph)
                const tasksChart = document.getElementById('tasksChart');
                
                // Group tasks by date
                const tasksByDate = {};
                const sortedDates = [];
                
                // Get date range (last 30 days)
                const today = new Date();
                const thirtyDaysAgo = new Date();
                thirtyDaysAgo.setDate(today.getDate() - 30);
                
                // Initialize all dates in the range
                for (let d = new Date(thirtyDaysAgo); d <= today; d.setDate(d.getDate() + 1)) {
                    const dateStr = d.toISOString().split('T')[0];
                    tasksByDate[dateStr] = { total: 0, completed: 0 };
                    sortedDates.push(dateStr);
                }
                
                // Count tasks for each date
                tasks.forEach(task => {
                    const createdDate = task.createdAt.split('T')[0];
                    if (tasksByDate[createdDate]) {
                        tasksByDate[createdDate].total++;
                        if (task.completed) {
                            tasksByDate[createdDate].completed++;
                        }
                    }
                });
                
                // Calculate running totals
                let runningTotal = 0;
                let runningCompleted = 0;
                
                const totalData = [];
                const completedData = [];
                
                sortedDates.forEach(date => {
                    runningTotal += tasksByDate[date].total;
                    runningCompleted += tasksByDate[date].completed;
                    
                    totalData.push(runningTotal);
                    completedData.push(runningCompleted);
                });
                
                // Create chart or update if it exists
                if (window.tasksProgressChart) {
                    window.tasksProgressChart.data.labels = sortedDates;
                    window.tasksProgressChart.data.datasets[0].data = totalData;
                    window.tasksProgressChart.data.datasets[1].data = completedData;
                    window.tasksProgressChart.update();
                } else {
                    window.tasksProgressChart = new Chart(tasksChart, {
                        type: 'line',
                        data: {
                            labels: sortedDates,
                            datasets: [{
                                label: 'Total Tasks',
                                data: totalData,
                                backgroundColor: 'rgba(93, 92, 222, 0.2)',
                                borderColor: 'rgba(93, 92, 222, 1)',
                                borderWidth: 2,
                                tension: 0.4,
                                fill: true
                            }, {
                                label: 'Completed Tasks',
                                data: completedData,
                                backgroundColor: 'rgba(40, 167, 69, 0.2)',
                                borderColor: 'rgba(40, 167, 69, 1)',
                                borderWidth: 2,
                                tension: 0.4,
                                fill: true
                            }]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            plugins: {
                                legend: {
                                    position: 'top',
                                    labels: {
                                        color: 'var(--text-primary)'
                                    }
                                },
                                tooltip: {
                                    mode: 'index',
                                    intersect: false
                                }
                            },
                            scales: {
                                x: {
                                    ticks: {
                                        maxTicksLimit: 10,
                                        color: 'var(--text-secondary)'
                                    },
                                    grid: {
                                        color: 'rgba(255, 255, 255, 0.1)'
                                    }
                                },
                                y: {
                                    beginAtZero: true,
                                    ticks: {
                                        color: 'var(--text-secondary)'
                                    },
                                    grid: {
                                        color: 'rgba(255, 255, 255, 0.1)'
                                    }
                                }
                            },
                            interaction: {
                                mode: 'nearest',
                                axis: 'x',
                                intersect: false
                            }
                        }
                    });
                }
                
                // Tasks by status (Pie Chart)
                const statusPieChart = document.getElementById('statusPieChart');
                const completedTasks = tasks.filter(task => task.completed).length;
                const pendingTasks = tasks.length - completedTasks;
                
                // Create chart or update if it exists
                if (window.statusPieChart) {
                    window.statusPieChart.data.datasets[0].data = [completedTasks, pendingTasks];
                    window.statusPieChart.update();
                } else {
                    window.statusPieChart = new Chart(statusPieChart, {
                        type: 'pie',
                        data: {
                            labels: ['Completed', 'Pending'],
                            datasets: [{
                                data: [completedTasks, pendingTasks],
                                backgroundColor: [
                                    'rgba(40, 167, 69, 0.8)',
                                    'rgba(255, 193, 7, 0.8)'
                                ],
                                borderColor: [
                                    'rgba(40, 167, 69, 1)',
                                    'rgba(255, 193, 7, 1)'
                                ],
                                borderWidth: 1
                            }]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            plugins: {
                                legend: {
                                    position: 'bottom',
                                    labels: {
                                        color: 'var(--text-primary)'
                                    }
                                }
                            }
                        }
                    });
                }
                
                // Tasks by priority (Bar Chart)
                const priorityChart = document.getElementById('priorityChart');
                const highPriorityTasks = tasks.filter(task => task.priority === 'high').length;
                const mediumPriorityTasks = tasks.filter(task => task.priority === 'medium').length;
                const lowPriorityTasks = tasks.filter(task => task.priority === 'low').length;
                
                // Create chart or update if it exists
                if (window.priorityChart) {
                    window.priorityChart.data.datasets[0].data = [highPriorityTasks, mediumPriorityTasks, lowPriorityTasks];
                    window.priorityChart.update();
                } else {
                    window.priorityChart = new Chart(priorityChart, {
                        type: 'bar',
                        data: {
                            labels: ['High', 'Medium', 'Low'],
                            datasets: [{
                                label: 'Tasks by Priority',
                                data: [highPriorityTasks, mediumPriorityTasks, lowPriorityTasks],
                                backgroundColor: [
                                    'rgba(220, 53, 69, 0.8)',
                                    'rgba(253, 126, 20, 0.8)',
                                    'rgba(108, 117, 125, 0.8)'
                                ],
                                borderColor: [
                                    'rgba(220, 53, 69, 1)',
                                    'rgba(253, 126, 20, 1)',
                                    'rgba(108, 117, 125, 1)'
                                ],
                                borderWidth: 1
                            }]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            plugins: {
                                legend: {
                                    display: false
                                }
                            },
                            scales: {
                                x: {
                                    ticks: {
                                        color: 'var(--text-secondary)'
                                    },
                                    grid: {
                                        color: 'rgba(255, 255, 255, 0.1)'
                                    }
                                },
                                y: {
                                    beginAtZero: true,
                                    ticks: {
                                        color: 'var(--text-secondary)'
                                    },
                                    grid: {
                                        color: 'rgba(255, 255, 255, 0.1)'
                                    }
                                }
                            }
                        }
                    });
                }
                
                // Tasks by category (Doughnut Chart)
                const categoryChart = document.getElementById('categoryChart');
                const categoryCounts = {};
                const categoryColors = {
                    'Work': ['rgba(93, 92, 222, 0.8)', 'rgba(93, 92, 222, 1)'],
                    'Personal': ['rgba(23, 162, 184, 0.8)', 'rgba(23, 162, 184, 1)'],
                    'Shopping': ['rgba(255, 193, 7, 0.8)', 'rgba(255, 193, 7, 1)'],
                    'Health': ['rgba(40, 167, 69, 0.8)', 'rgba(40, 167, 69, 1)'],
                    'Finance': ['rgba(220, 53, 69, 0.8)', 'rgba(220, 53, 69, 1)']
                };
                
                // Count tasks for each category
                tasks.forEach(task => {
                    if (!categoryCounts[task.category]) {
                        categoryCounts[task.category] = 0;
                    }
                    categoryCounts[task.category]++;
                });
                
                const categoryLabels = Object.keys(categoryCounts);
                const categoryData = Object.values(categoryCounts);
                const backgroundColors = [];
                const borderColors = [];
                
                categoryLabels.forEach(category => {
                    if (categoryColors[category]) {
                        backgroundColors.push(categoryColors[category][0]);
                        borderColors.push(categoryColors[category][1]);
                    } else {
                        // Generate random color for new categories
                        const r = Math.floor(Math.random() * 200) + 55;
                        const g = Math.floor(Math.random() * 200) + 55;
                        const b = Math.floor(Math.random() * 200) + 55;
                        backgroundColors.push(`rgba(${r}, ${g}, ${b}, 0.8)`);
                        borderColors.push(`rgba(${r}, ${g}, ${b}, 1)`);
                    }
                });
                
                // Create chart or update if it exists
                if (window.categoryChart) {
                    window.categoryChart.data.labels = categoryLabels;
                    window.categoryChart.data.datasets[0].data = categoryData;
                    window.categoryChart.data.datasets[0].backgroundColor = backgroundColors;
                    window.categoryChart.data.datasets[0].borderColor = borderColors;
                    window.categoryChart.update();
                } else {
                    window.categoryChart = new Chart(categoryChart, {
                        type: 'doughnut',
                        data: {
                            labels: categoryLabels,
                            datasets: [{
                                data: categoryData,
                                backgroundColor: backgroundColors,
                                borderColor: borderColors,
                                borderWidth: 1
                            }]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            plugins: {
                                legend: {
                                    position: 'bottom',
                                    labels: {
                                        color: 'var(--text-primary)'
                                    }
                                }
                            }
                        }
                    });
                }
            }
            
            // Function to populate category selects
            function populateCategorySelect() {
                const categorySelect = document.getElementById('taskCategory');
                const categoryFilter = document.getElementById('categoryFilter');
                
                // Clear existing options
                categorySelect.innerHTML = '';
                categoryFilter.innerHTML = '<option value="all">All Categories</option>';
                
                // Add categories to the selects
                categories.forEach(category => {
                    const option = document.createElement('option');
                    option.value = category.name;
                    option.textContent = category.name;
                    categorySelect.appendChild(option);
                    
                    const filterOption = document.createElement('option');
                    filterOption.value = category.name;
                    filterOption.textContent = category.name;
                    categoryFilter.appendChild(filterOption);
                });
            }
            
            // View task function
            function viewTask(id) {
                const task = tasks.find(t => t.id.toString() === id);
                if (!task) return;
                
                const viewTaskContent = document.getElementById('viewTaskContent');
                const viewTaskTitle = document.getElementById('viewTaskTitle');
                
                viewTaskTitle.textContent = task.title;
                
                let subTasksHtml = '';
                if (task.subTasks && task.subTasks.length > 0) {
                    subTasksHtml = '<div style="margin-top: 15px;"><h4>Sub-Tasks</h4><ul>';
                    task.subTasks.forEach(subTask => {
                        subTasksHtml += `<li style="margin-bottom: 5px;"><span style="margin-right: 5px;">${subTask.completed ? '✅' : '⬜'}</span> ${subTask.title}</li>`;
                    });
                    subTasksHtml += '</ul></div>';
                }
                
                let notesHtml = '';
                if (task.notes) {
                    notesHtml = `
                        <div style="margin-top: 15px;">
                            <h4>Notes</h4>
                            <p>${task.notes}</p>
                        </div>
                    `;
                }
                
                viewTaskContent.innerHTML = `
                    <div style="margin-bottom: 15px;">
                        <span class="task-priority priority-${task.priority}" style="margin-bottom: 15px; display: inline-block;">
                            ${task.priority}
                        </span>
                        <p style="margin-top: 15px;">${task.description}</p>
                    </div>
                    <div style="display: flex; flex-wrap: wrap; gap: 20px; margin-top: 15px;">
                        <div>
                            <h4>Due Date</h4>
                            <p>${task.dueDate}</p>
                        </div>
                        <div>
                            <h4>Category</h4>
                            <p>${task.category}</p>
                        </div>
                        <div>
                            <h4>Status</h4>
                            <p>${task.completed ? 'Completed' : 'Pending'}</p>
                        </div>
                        <div>
                            <h4>Time Spent</h4>
                            <p>${formatTime(taskTimers[task.id] || 0)}</p>
                        </div>
                    </div>
                    ${subTasksHtml}
                    ${notesHtml}
                `;
                
                viewTaskModal.classList.add('active');
            }
            
            // Add/Edit task function
            function openTaskModal(isEdit = false, taskId = null) {
                const taskModalTitle = document.getElementById('taskModalTitle');
                const taskTitle = document.getElementById('taskTitle');
                const taskDescription = document.getElementById('taskDescription');
                const taskDueDate = document.getElementById('taskDueDate');
                const taskPriority = document.getElementById('taskPriority');
                const taskCategory = document.getElementById('taskCategory');
                const taskNotes = document.getElementById('taskNotes');
                const saveTaskBtn = document.getElementById('saveTaskBtn');
                const subTasksContainer = document.getElementById('subTasksContainer');
                
                taskModalTitle.textContent = isEdit ? 'Edit Task' : 'Add New Task';
                saveTaskBtn.textContent = isEdit ? 'Update' : 'Create';
                
                // Clear fields
                taskTitle.value = '';
                taskDescription.value = '';
                taskDueDate.value = '';
                taskPriority.value = 'medium';
                taskCategory.value = categories[0].name;
                taskNotes.value = '';
                subTasksContainer.innerHTML = '';
                
                // If editing, populate fields with task data
                if (isEdit && taskId) {
                    const task = tasks.find(t => t.id.toString() === taskId);
                    if (task) {
                        taskTitle.value = task.title;
                        taskDescription.value = task.description;
                        taskDueDate.value = task.dueDate;
                        taskPriority.value = task.priority;
                        taskCategory.value = task.category;
                        taskNotes.value = task.notes || '';
                        
                        // Add sub-tasks
                        if (task.subTasks && task.subTasks.length > 0) {
                            task.subTasks.forEach(subTask => {
                                addSubTaskField(subTask.title, subTask.completed);
                            });
                        }
                    }
                }
                
                // Save button action
                saveTaskBtn.onclick = function() {
                    // Validate input
                    if (!taskTitle.value) {
                        showToast('Error', 'Please enter a task title', 'error');
                        return;
                    }
                    
                    if (!taskDueDate.value) {
                        showToast('Error', 'Please select a due date', 'error');
                        return;
                    }
                    
                    // Get sub-tasks
                    const subTasks = [];
                    const subTaskInputs = subTasksContainer.querySelectorAll('.sub-task-input');
                    subTaskInputs.forEach((input, index) => {
                        const subTaskTitle = input.value.trim();
                        if (subTaskTitle) {
                            const completed = input.nextElementSibling.querySelector('input[type="checkbox"]').checked;
                            subTasks.push({
                                id: isEdit && taskId ? `${taskId}-${index + 1}` : `new-${Date.now()}-${index + 1}`,
                                title: subTaskTitle,
                                completed: completed
                            });
                        }
                    });
                    
                    if (isEdit && taskId) {
                        // Update existing task
                        const task = tasks.find(t => t.id.toString() === taskId);
                        if (task) {
                            task.title = taskTitle.value;
                            task.description = taskDescription.value;
                            task.dueDate = taskDueDate.value;
                            task.priority = taskPriority.value;
                            task.category = taskCategory.value;
                            task.notes = taskNotes.value;
                            task.subTasks = subTasks;
                            
                            addNotification(`Task "${task.title}" has been updated`, 'info');
                            showToast('Task Updated', `Task "${task.title}" has been updated`, 'success');
                        }
                    } else {
                        // Add new task
                        const newTask = {
                            id: Date.now(),
                            title: taskTitle.value,
                            description: taskDescription.value,
                            dueDate: taskDueDate.value,
                            priority: taskPriority.value,
                            category: taskCategory.value,
                            notes: taskNotes.value,
                            completed: false,
                            createdAt: new Date().toISOString(),
                            subTasks: subTasks
                        };
                        
                        tasks.push(newTask);
                        addNotification(`Task "${newTask.title}" has been created`, 'success');
                        showToast('Task Created', `Task "${newTask.title}" has been created`, 'success');
                    }
                    
                    localStorage.setItem('todo_tasks', JSON.stringify(tasks));
                    saveToHistory();
                    renderTasks();
                    updateTaskCounts();
                    updateGraphs();
                    taskModal.classList.remove('active');
                };
                
                taskModal.classList.add('active');
            }
            
            // Add sub-task field function
            function addSubTaskField(value = '', completed = false) {
                const subTasksContainer = document.getElementById('subTasksContainer');
                const subTaskDiv = document.createElement('div');
                subTaskDiv.className = 'sub-task-field';
                subTaskDiv.style.display = 'flex';
                subTaskDiv.style.alignItems = 'center';
                subTaskDiv.style.gap = '10px';
                subTaskDiv.style.marginBottom = '10px';
                
                subTaskDiv.innerHTML = `
                    <input type="text" class="form-control sub-task-input" placeholder="Enter sub-task title" value="${value}" style="flex: 1;">
                    <div style="display: flex; align-items: center;">
                        <label style="margin-left: 10px; display: flex; align-items: center; gap: 5px; white-space: nowrap;">
                            <input type="checkbox" ${completed ? 'checked' : ''}>
                            Completed
                        </label>
                    </div>
                    <button class="btn btn-danger remove-sub-task" style="padding: 5px 10px;">
                        <i class="fas fa-times"></i>
                    </button>
                `;
                
                subTasksContainer.appendChild(subTaskDiv);
                
                // Add event listener for remove button
                subTaskDiv.querySelector('.remove-sub-task').addEventListener('click', function() {
                    subTaskDiv.remove();
                });
            }
            
            // Edit task function
            function editTask(id) {
                openTaskModal(true, id);
            }
            
            // Delete task function
            function deleteTask(id) {
                if (confirm('Are you sure you want to delete this task?')) {
                    const taskIndex = tasks.findIndex(t => t.id.toString() === id);
                    if (taskIndex !== -1) {
                        const deletedTask = tasks[taskIndex];
                        tasks.splice(taskIndex, 1);
                        localStorage.setItem('todo_tasks', JSON.stringify(tasks));
                        saveToHistory();
                        renderTasks();
                        updateTaskCounts();
                        updateGraphs();
                        addNotification(`Task "${deletedTask.title}" has been deleted`, 'error');
                        showToast('Task Deleted', `Task "${deletedTask.title}" has been deleted`, 'success');
                    }
                }
            }
            
            // Render categories
            function renderCategories() {
                const categoriesList = document.getElementById('categoriesList');
                categoriesList.innerHTML = '';
                
                if (categories.length === 0) {
                    categoriesList.innerHTML = '<div style="text-align: center; padding: 20px;">No categories</div>';
                    return;
                }
                
                categories.forEach(category => {
                    const categoryDiv = document.createElement('div');
                    categoryDiv.style.display = 'flex';
                    categoryDiv.style.justifyContent = 'space-between';
                    categoryDiv.style.alignItems = 'center';
                    categoryDiv.style.padding = '10px';
                    categoryDiv.style.borderBottom = '1px solid var(--border-color)';
                    
                    categoryDiv.innerHTML = `
                        <div>${category.name}</div>
                        <div>
                            <button class="btn btn-danger delete-category" data-id="${category.id}" style="padding: 5px 10px;">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    `;
                    
                    categoriesList.appendChild(categoryDiv);
                });
                
                // Add event listeners for delete buttons
                const deleteButtons = document.querySelectorAll('.delete-category');
                deleteButtons.forEach(button => {
                    button.addEventListener('click', function() {
                        const categoryId = parseInt(this.getAttribute('data-id'));
                        deleteCategory(categoryId);
                    });
                });
            }
            
            // Delete category function
            function deleteCategory(id) {
                const category = categories.find(c => c.id === id);
                
                if (!category) return;
                
                // Check if category is used by any tasks
                const categoryInUse = tasks.some(task => task.category === category.name);
                
                if (categoryInUse) {
                    showToast('Error', `Category "${category.name}" cannot be deleted because it is used by tasks`, 'error');
                    return;
                }
                
                if (confirm(`Are you sure you want to delete the category "${category.name}"?`)) {
                    categories = categories.filter(c => c.id !== id);
                    localStorage.setItem('todo_categories', JSON.stringify(categories));
                    renderCategories();
                    populateCategorySelect();
                    showToast('Category Deleted', `Category "${category.name}" has been deleted`, 'success');
                }
            }
            
            // Render users
            function renderUsers() {
                const usersList = document.getElementById('usersList');
                usersList.innerHTML = '';
                
                users.forEach(user => {
                    const userCard = document.createElement('div');
                    userCard.className = 'user-card';
                    userCard.style.backgroundColor = 'var(--card-bg)';
                    userCard.style.borderRadius = 'var(--border-radius)';
                    userCard.style.padding = '20px';
                    userCard.style.boxShadow = 'var(--box-shadow)';
                    userCard.style.transition = 'transform var(--transition-speed), box-shadow var(--transition-speed)';
                    userCard.style.display = 'flex';
                    userCard.style.flexDirection = 'column';
                    userCard.style.alignItems = 'center';
                    userCard.style.gap = '10px';
                    userCard.style.flex = '1 0 calc(33.33% - 20px)';
                    userCard.style.minWidth = '200px';
                    
                    userCard.innerHTML = `
                        <img src="${user.profileImage}" alt="${user.firstName}" style="width: 80px; height: 80px; border-radius: 50%; object-fit: cover; margin-bottom: 10px;">
                        <h3 style="margin: 0; text-align: center;">${user.firstName} ${user.lastName}</h3>
                        <p style="margin: 0; text-align: center; color: var(--text-secondary);">${user.email}</p>
                        <div style="background-color: var(--primary-color); color: white; padding: 5px 10px; border-radius: 20px; font-size: 12px;">${user.role}</div>
                    `;
                    
                    userCard.onmouseover = function() {
                        this.style.transform = 'translateY(-5px)';
                        this.style.boxShadow = 'var(--hover-shadow)';
                    };
                    
                    userCard.onmouseout = function() {
                        this.style.transform = 'translateY(0)';
                        this.style.boxShadow = 'var(--box-shadow)';
                    };
                    
                    usersList.appendChild(userCard);
                });
            }
            
            // Render user profile
            function renderProfile() {
                const profileContent = document.getElementById('profileContent');
                
                if (!currentUser) {
                    profileContent.innerHTML = '<div style="text-align: center; padding: 20px;">User not found</div>';
                    return;
                }
                
                profileContent.innerHTML = `
                    <img src="${currentUser.profileImage}" alt="${currentUser.firstName}" style="width: 100px; height: 100px; border-radius: 50%; object-fit: cover; margin-bottom: 20px;">
                    <h3 style="margin: 0;">${currentUser.firstName} ${currentUser.lastName}</h3>
                    <p style="margin: 5px 0; color: var(--text-secondary);">${currentUser.email}</p>
                    <div style="background-color: var(--primary-color); color: white; padding: 5px 15px; border-radius: 20px; font-size: 14px; margin: 10px 0;">${currentUser.role}</div>
                    
                    <div style="margin-top: 20px; width: 100%;">
                        <div style="display: flex; justify-content: space-between; padding: 10px 0; border-bottom: 1px solid var(--border-color);">
                            <span>Phone:</span>
                            <span>${currentUser.phone || 'Not provided'}</span>
                        </div>
                        <div style="display: flex; justify-content: space-between; padding: 10px 0; border-bottom: 1px solid var(--border-color);">
                            <span>Country:</span>
                            <span>${currentUser.nationality}</span>
                        </div>
                        <div style="display: flex; justify-content: space-between; padding: 10px 0; border-bottom: 1px solid var(--border-color);">
                            <span>Birthdate:</span>
                            <span>${currentUser.birthdate}</span>
                        </div>
                        <div style="display: flex; justify-content: space-between; padding: 10px 0; border-bottom: 1px solid var(--border-color);">
                            <span>Joined:</span>
                            <span>${currentUser.joinDate}</span>
                        </div>
                    </div>
                `;
            }
            
            // Update status function
            function updateStatus(status) {
                const statusIndicator = document.getElementById('statusIndicator');
                const statusText = document.querySelector('#switchStatus i');
                const statusTextSpan = document.querySelector('#switchStatus span');
                const profileImage = document.getElementById('profileImage');
                
                userStatus = status;
                
                // Update status color
                switch (status) {
                    case 'online':
                        statusIndicator.style.backgroundColor = 'var(--success-color)';
                        statusText.className = 'fas fa-circle';
                        statusText.style.color = 'var(--success-color)';
                        statusTextSpan.textContent = 'Status: Online';
                        profileImage.style.borderColor = 'var(--success-color)';
                        break;
                    case 'break':
                        statusIndicator.style.backgroundColor = 'var(--warning-color)';
                        statusText.className = 'fas fa-circle';
                        statusText.style.color = 'var(--warning-color)';
                        statusTextSpan.textContent = 'Status: Break';
                        profileImage.style.borderColor = 'var(--warning-color)';
                        break;
                    case 'away':
                        statusIndicator.style.backgroundColor = 'var(--gray-color)';
                        statusText.className = 'fas fa-circle';
                        statusText.style.color = 'var(--gray-color)';
                        statusTextSpan.textContent = 'Status: Away';
                        profileImage.style.borderColor = 'var(--gray-color)';
                        break;
                    case 'offline':
                        statusIndicator.style.backgroundColor = 'var(--danger-color)';
                        statusText.className = 'fas fa-circle';
                        statusText.style.color = 'var(--danger-color)';
                        statusTextSpan.textContent = 'Status: Offline';
                        profileImage.style.borderColor = 'var(--danger-color)';
                        break;
                }
                
                localStorage.setItem('todo_user_status', status);
            }
            
            // Event listeners
            document.addEventListener('DOMContentLoaded', function() {
                // Login button
                document.getElementById('loginBtn').addEventListener('click', function() {
                    const email = document.getElementById('email').value;
                    const password = document.getElementById('password').value;
                    
                    const user = users.find(u => u.email === email && u.password === password);
                    
                    if (user) {
                        currentUser = user;
                        localStorage.setItem('todo_current_user', JSON.stringify(user));
                        
                        // Update profile picture
                        document.getElementById('profileImage').src = user.profileImage;
                        
                        // Show dashboard
                        loginPage.style.display = 'none';
                        dashboard.style.display = 'block';
                        
                        // Render tasks and counts
                        renderTasks();
                        updateTaskCounts();
                        updateGraphs();
                        populateCategorySelect();
                        updateNotificationBadge();
                        loadTimerState();
                        
                        // Show welcome toast
                        showToast('Welcome', `Welcome back, ${user.firstName}!`, 'success');
                    } else {
                        showToast('Error', 'Invalid email or password', 'error');
                    }
                });
                
                // Register link
                document.getElementById('registerLink').addEventListener('click', function(e) {
                    e.preventDefault();
                    registerModal.classList.add('active');
                });
                
                // Close register modal
                document.getElementById('closeRegisterModal').addEventListener('click', function() {
                    registerModal.classList.remove('active');
                });
                
                document.getElementById('cancelRegister').addEventListener('click', function() {
                    registerModal.classList.remove('active');
                });
                
                // Create account button
                document.getElementById('createAccount').addEventListener('click', function() {
                    const lastName = document.getElementById('lastName').value;
                    const firstName = document.getElementById('firstName').value;
                    const email = document.getElementById('regEmail').value;
                    const confirmEmail = document.getElementById('confirmEmail').value;
                    const password = document.getElementById('regPassword').value;
                    const confirmPassword = document.getElementById('confirmPassword').value;
                    const birthdate = document.getElementById('birthdate').value;
                    const nationality = document.getElementById('nationality').value;
                    const role = document.getElementById('role').value;
                    
                    // Validate input
                    if (!lastName || !firstName || !email || !confirmEmail || !password || !confirmPassword || !birthdate || !nationality || !role) {
                        showToast('Error', 'Please fill in all fields', 'error');
                        return;
                    }
                    
                    if (email !== confirmEmail) {
                        showToast('Error', 'Emails do not match', 'error');
                        return;
                    }
                    
                    if (password !== confirmPassword) {
                        showToast('Error', 'Passwords do not match', 'error');
                        return;
                    }
                    
                    // Check if email already exists
                    if (users.some(u => u.email === email)) {
                        showToast('Error', 'Email already exists', 'error');
                        return;
                    }
                    
                    // Generate random profile image
                    const gender = Math.random() > 0.5 ? 'men' : 'women';
                    const randomNum = Math.floor(Math.random() * 70) + 1;
                    const profileImage = `https://randomuser.me/api/portraits/${gender}/${randomNum}.jpg`;
                    
                    // Create new user
                    const newUser = {
                        id: users.length + 1,
                        lastName,
                        firstName,
                        email,
                        password,
                        birthdate,
                        nationality,
                        role,
                        profileImage,
                        phone: '',
                        joinDate: new Date().toISOString().split('T')[0]
                    };
                    
                    users.push(newUser);
                    localStorage.setItem('todo_users', JSON.stringify(users));
                    
                    // Show success message
                    showToast('Success', 'Account created successfully', 'success');
                    
                    // Close modal
                    registerModal.classList.remove('active');
                    
                    // Pre-fill login form
                    document.getElementById('email').value = email;
                    document.getElementById('password').value = password;
                });
                
                // Add task button
                document.getElementById('addTaskBtn').addEventListener('click', function() {
                    openTaskModal();
                });
                
                // Close task modal
                document.getElementById('closeTaskModal').addEventListener('click', function() {
                    taskModal.classList.remove('active');
                });
                
                document.getElementById('cancelTaskBtn').addEventListener('click', function() {
                    taskModal.classList.remove('active');
                });
                
                // Add sub-task button
                document.getElementById('addSubTaskBtn').addEventListener('click', function() {
                    addSubTaskField();
                });
                
                // Close view task modal
                document.getElementById('closeViewTaskModal').addEventListener('click', function() {
                    viewTaskModal.classList.remove('active');
                });
                
                document.getElementById('closeViewBtn').addEventListener('click', function() {
                    viewTaskModal.classList.remove('active');
                });
                
                // Export button
                document.getElementById('exportBtn').addEventListener('click', function() {
                    exportModal.classList.add('active');
                });
                
                // Close export modal
                document.getElementById('closeExportModal').addEventListener('click', function() {
                    exportModal.classList.remove('active');
                });
                
                document.getElementById('cancelExportBtn').addEventListener('click', function() {
                    exportModal.classList.remove('active');
                });
                
                // Confirm export button
                document.getElementById('confirmExportBtn').addEventListener('click', function() {
                    const format = document.getElementById('exportFormat').value;
                    
                    if (format === 'json') {
                        // Export as JSON
                        const data = JSON.stringify(tasks, null, 2);
                        const dataUri = `data:application/json;charset=utf-8,${encodeURIComponent(data)}`;
                        const fileName = `tasks_${new Date().toISOString().split('T')[0]}.json`;
                        
                        // Create link for the user to save
                        const exportElement = document.createElement('a');
                        exportElement.setAttribute('href', dataUri);
                        exportElement.setAttribute('download', fileName);
                        exportElement.style.display = 'none';
                        document.body.appendChild(exportElement);
                        
                        // Simulate click to trigger download
                        exportElement.click();
                        
                        document.body.removeChild(exportElement);
                        showToast('Success', 'Tasks exported as JSON', 'success');
                    } else if (format === 'pdf') {
                        // Display message about how to save PDF
                        showToast('Info', 'Due to iframe limitations, use browser print function (Ctrl+P) to save as PDF', 'info');
                    } else if (format === 'excel') {
                        // Export as Excel
                        showToast('Info', 'Due to iframe limitations, use browser save function to save Excel data', 'info');
                    }
                    
                    exportModal.classList.remove('active');
                });
                
                // Import button
                document.getElementById('importBtn').addEventListener('click', function() {
                    importModal.classList.add('active');
                });
                
                // Close import modal
                document.getElementById('closeImportModal').addEventListener('click', function() {
                    importModal.classList.remove('active');
                });
                
                document.getElementById('cancelImportBtn').addEventListener('click', function() {
                    importModal.classList.remove('active');
                });
                
                // Confirm import button
                document.getElementById('confirmImportBtn').addEventListener('click', function() {
                    const fileInput = document.getElementById('importFile');
                    const file = fileInput.files[0];
                    
                    if (!file) {
                        showToast('Error', 'Please select a file to import', 'error');
                        return;
                    }
                    
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        try {
                            const importedTasks = JSON.parse(e.target.result);
                            
                            if (!Array.isArray(importedTasks)) {
                                showToast('Error', 'Invalid data format', 'error');
                                return;
                            }
                            
                            // Merge imported tasks with existing tasks
                            const existingIds = tasks.map(t => t.id);
                            
                            importedTasks.forEach(task => {
                                if (!existingIds.includes(task.id)) {
                                    tasks.push(task);
                                }
                            });
                            
                            localStorage.setItem('todo_tasks', JSON.stringify(tasks));
                            saveToHistory();
                            renderTasks();
                            updateTaskCounts();
                            updateGraphs();
                            
                            showToast('Success', 'Tasks imported successfully', 'success');
                            importModal.classList.remove('active');
                        } catch (error) {
                            showToast('Error', 'Failed to parse imported data', 'error');
                        }
                    };
                    
                    reader.readAsText(file);
                });
                
                // Categories button
                document.getElementById('categoriesBtn').addEventListener('click', function() {
                    renderCategories();
                    categoriesModal.classList.add('active');
                });
                
                // Close categories modal
                document.getElementById('closeCategoriesModal').addEventListener('click', function() {
                    categoriesModal.classList.remove('active');
                });
                
                document.getElementById('closeCategoriesBtn').addEventListener('click', function() {
                    categoriesModal.classList.remove('active');
                });
                
                // Add category button
                document.getElementById('addCategoryBtn').addEventListener('click', function() {
                    const newCategoryInput = document.getElementById('newCategory');
                    const categoryName = newCategoryInput.value.trim();
                    
                    if (!categoryName) {
                        showToast('Error', 'Please enter a category name', 'error');
                        return;
                    }
                    
                    // Check if category already exists
                    if (categories.some(c => c.name === categoryName)) {
                        showToast('Error', 'Category already exists', 'error');
                        return;
                    }
                    
                    // Add new category
                    const newCategory = {
                        id: categories.length > 0 ? Math.max(...categories.map(c => c.id)) + 1 : 1,
                        name: categoryName
                    };
                    
                    categories.push(newCategory);
                    localStorage.setItem('todo_categories', JSON.stringify(categories));
                    
                    newCategoryInput.value = '';
                    renderCategories();
                    populateCategorySelect();
                    
                    showToast('Success', `Category "${categoryName}" added`, 'success');
                });
                
                // Dark/light mode switch
                document.getElementById('modeSwitch').addEventListener('click', function() {
                    document.body.classList.toggle('dark');
                    document.body.classList.toggle('light');
                    
                    const isDark = document.body.classList.contains('dark');
                    this.innerHTML = isDark ? '<i class="fas fa-sun"></i>' : '<i class="fas fa-moon"></i>';
                    
                    // Update graphs with new theme colors
                    updateGraphs();
                });
                
                // User profile dropdown
                document.getElementById('userProfile').addEventListener('click', function(e) {
                    e.stopPropagation();
                    document.getElementById('profileDropdown').classList.toggle('active');
                });
                
                // Close dropdowns when clicking elsewhere
                document.addEventListener('click', function() {
                    document.getElementById('profileDropdown').classList.remove('active');
                });
                
                // View profile
                document.getElementById('viewProfile').addEventListener('click', function() {
                    renderProfile();
                    profileModal.classList.add('active');
                });
                
                // Close profile modal
                document.getElementById('closeProfileModal').addEventListener('click', function() {
                    profileModal.classList.remove('active');
                });
                
                document.getElementById('closeProfileBtn').addEventListener('click', function() {
                    profileModal.classList.remove('active');
                });
                
                // Edit profile button
                document.getElementById('editProfileBtn').addEventListener('click', function() {
                    // Populate edit form with current user data
                    document.getElementById('editFirstName').value = currentUser.firstName;
                    document.getElementById('editLastName').value = currentUser.lastName;
                    document.getElementById('editEmail').value = currentUser.email;
                    document.getElementById('editPhone').value = currentUser.phone || '';
                    document.getElementById('editCountry').value = currentUser.nationality;
                    document.getElementById('editRole').value = currentUser.role;
                    
                    profileModal.classList.remove('active');
                    editProfileModal.classList.add('active');
                });
                
                // Close edit profile modal
                document.getElementById('closeEditProfileModal').addEventListener('click', function() {
                    editProfileModal.classList.remove('active');
                });
                
                document.getElementById('cancelEditProfileBtn').addEventListener('click', function() {
                    editProfileModal.classList.remove('active');
                });
                
                // Save profile button
                document.getElementById('saveProfileBtn').addEventListener('click', function() {
                    const firstName = document.getElementById('editFirstName').value;
                    const lastName = document.getElementById('editLastName').value;
                    const email = document.getElementById('editEmail').value;
                    const phone = document.getElementById('editPhone').value;
                    const country = document.getElementById('editCountry').value;
                    const role = document.getElementById('editRole').value;
                    const profilePictureInput = document.getElementById('profilePicture');
                    
                    // Validate input
                    if (!firstName || !lastName || !email || !country || !role) {
                        showToast('Error', 'Please fill in all required fields', 'error');
                        return;
                    }
                    
                    // Check if email already exists (excluding current user)
                    if (email !== currentUser.email && users.some(u => u.email === email)) {
                        showToast('Error', 'Email already exists', 'error');
                        return;
                    }
                    
                    // Update user data
                    currentUser.firstName = firstName;
                    currentUser.lastName = lastName;
                    currentUser.email = email;
                    currentUser.phone = phone;
                    currentUser.nationality = country;
                    currentUser.role = role;
                    
                    // Update profile picture if selected
                    if (profilePictureInput.files.length > 0) {
                        const file = profilePictureInput.files[0];
                        const reader = new FileReader();
                        
                        reader.onload = function(e) {
                            currentUser.profileImage = e.target.result;
                            updateUserData();
                        };
                        
                        reader.readAsDataURL(file);
                    } else {
                        updateUserData();
                    }
                    
                    function updateUserData() {
                        // Update users array
                        const userIndex = users.findIndex(u => u.id === currentUser.id);
                        if (userIndex !== -1) {
                            users[userIndex] = currentUser;
                        }
                        
                        localStorage.setItem('todo_users', JSON.stringify(users));
                        localStorage.setItem('todo_current_user', JSON.stringify(currentUser));
                        
                        // Update profile picture in UI
                        document.getElementById('profileImage').src = currentUser.profileImage;
                        
                        showToast('Success', 'Profile updated successfully', 'success');
                        editProfileModal.classList.remove('active');
                    }
                });
                
                // Logout button
                document.getElementById('logoutBtn').addEventListener('click', function() {
                    if (confirm('Are you sure you want to logout?')) {
                        currentUser = null;
                        localStorage.removeItem('todo_current_user');
                        
                        // Reset timers
                        pauseGlobalTimer();
                        activeTaskTimer = null;
                        
                        // Show login page
                        dashboard.style.display = 'none';
                        loginPage.style.display = 'flex';
                    }
                });
                
                // Switch status
                document.getElementById('switchStatus').addEventListener('click', function() {
                    statusModal.classList.add('active');
                });
                
                // Close status modal
                document.getElementById('closeStatusModal').addEventListener('click', function() {
                    statusModal.classList.remove('active');
                });
                
                // Status options
                const statusOptions = document.querySelectorAll('.status-option');
                statusOptions.forEach(option => {
                    option.addEventListener('click', function() {
                        const status = this.getAttribute('data-status');
                        updateStatus(status);
                        statusModal.classList.remove('active');
                        showToast('Status Updated', `Status changed to ${status}`, 'success');
                    });
                    
                    // Add hover effect
                    option.addEventListener('mouseover', function() {
                        this.style.backgroundColor = 'var(--hover-color)';
                    });
                    
                    option.addEventListener('mouseout', function() {
                        this.style.backgroundColor = '';
                    });
                });
                
                // Users button
                document.getElementById('usersBtn').addEventListener('click', function() {
                    renderUsers();
                    usersModal.classList.add('active');
                });
                
                // Close users modal
                document.getElementById('closeUsersModal').addEventListener('click', function() {
                    usersModal.classList.remove('active');
                });
                
                document.getElementById('closeUsersBtn').addEventListener('click', function() {
                    usersModal.classList.remove('active');
                });
                
                // Notification badge
                document.getElementById('notificationBadge').addEventListener('click', function(e) {
                    e.stopPropagation();
                    renderNotifications();
                    notificationsModal.classList.add('active');
                });
                
                // Close notifications modal
                document.getElementById('closeNotificationsModal').addEventListener('click', function() {
                    notificationsModal.classList.remove('active');
                });
                
                document.getElementById('closeNotificationsBtn').addEventListener('click', function() {
                    notificationsModal.classList.remove('active');
                });
                
                // Mark all notifications as read
                document.getElementById('markAllReadBtn').addEventListener('click', function() {
                    notifications.forEach(notification => {
                        notification.read = true;
                    });
                    
                    localStorage.setItem('todo_notifications', JSON.stringify(notifications));
                    updateNotificationBadge();
                    renderNotifications();
                    showToast('Notifications', 'All notifications marked as read', 'success');
                });
                
                // Due date filter change
                document.getElementById('dueDateFilter').addEventListener('change', function() {
                    if (this.value === 'custom') {
                        dateRangeModal.classList.add('active');
                    } else {
                        renderTasks();
                    }
                });
                
                // Close date range modal
                document.getElementById('closeDateRangeModal').addEventListener('click', function() {
                    dateRangeModal.classList.remove('active');
                    document.getElementById('dueDateFilter').value = 'all';
                });
                
                document.getElementById('cancelDateRangeBtn').addEventListener('click', function() {
                    dateRangeModal.classList.remove('active');
                    document.getElementById('dueDateFilter').value = 'all';
                });
                
                // Apply date range
                document.getElementById('applyDateRangeBtn').addEventListener('click', function() {
                    const startDate = document.getElementById('startDate').value;
                    const endDate = document.getElementById('endDate').value;
                    
                    if (!startDate || !endDate) {
                        showToast('Error', 'Please select both start and end dates', 'error');
                        return;
                    }
                    
                    dateRangeModal.classList.remove('active');
                    renderTasks();
                });
                
                // Filter change events
                document.getElementById('statusFilter').addEventListener('change', renderTasks);
                document.getElementById('categoryFilter').addEventListener('change', renderTasks);
                document.getElementById('priorityFilter').addEventListener('change', renderTasks);
                
                // Sort change event
                document.getElementById('sortSelect').addEventListener('change', renderTasks);
                
                // Search input
                document.getElementById('searchInput').addEventListener('input', renderTasks);
                
                // Undo/redo buttons
                document.getElementById('undoBtn').addEventListener('click', undoAction);
                document.getElementById('redoBtn').addEventListener('click', redoAction);
                
                // View toggle
                document.getElementById('listViewBtn').addEventListener('click', function() {
                    this.classList.add('active');
                    document.getElementById('graphViewBtn').classList.remove('active');
                    document.getElementById('listView').style.display = 'block';
                    document.getElementById('graphView').style.display = 'none';
                });
                
                document.getElementById('graphViewBtn').addEventListener('click', function() {
                    this.classList.add('active');
                    document.getElementById('listViewBtn').classList.remove('active');
                    document.getElementById('listView').style.display = 'none';
                    document.getElementById('graphView').style.display = 'block';
                    
                    // Update graphs when switching to graph view
                    updateGraphs();
                });
                
                // Multi-select actions
                document.getElementById('completeSelectedBtn').addEventListener('click', function() {
                    const selectedCheckboxes = document.querySelectorAll('.task-checkbox:checked');
                    const selectedIds = Array.from(selectedCheckboxes).map(checkbox => checkbox.getAttribute('data-id'));
                    
                    if (selectedIds.length === 0) return;
                    
                    // Mark selected tasks as completed
                    selectedIds.forEach(id => {
                        const task = tasks.find(t => t.id.toString() === id);
                        if (task) {
                            task.completed = true;
                            
                            // Also mark all subtasks as completed
                            if (task.subTasks) {
                                task.subTasks.forEach(subTask => {
                                    subTask.completed = true;
                                });
                            }
                        }
                    });
                    
                    localStorage.setItem('todo_tasks', JSON.stringify(tasks));
                    saveToHistory();
                    renderTasks();
                    updateTaskCounts();
                    updateGraphs();
                    toggleMultiSelectBar();
                    
                    showToast('Tasks Completed', `${selectedIds.length} tasks marked as completed`, 'success');
                });
                
                document.getElementById('deleteSelectedBtn').addEventListener('click', function() {
                    const selectedCheckboxes = document.querySelectorAll('.task-checkbox:checked');
                    const selectedIds = Array.from(selectedCheckboxes).map(checkbox => checkbox.getAttribute('data-id'));
                    
                    if (selectedIds.length === 0) return;
                    
                    if (confirm(`Are you sure you want to delete ${selectedIds.length} tasks?`)) {
                        // Remove selected tasks
                        tasks = tasks.filter(task => !selectedIds.includes(task.id.toString()));
                        
                        localStorage.setItem('todo_tasks', JSON.stringify(tasks));
                        saveToHistory();
                        renderTasks();
                        updateTaskCounts();
                        updateGraphs();
                        toggleMultiSelectBar();
                        
                        showToast('Tasks Deleted', `${selectedIds.length} tasks deleted`, 'success');
                    }
                });
                
                document.getElementById('cancelSelectBtn').addEventListener('click', function() {
                    // Uncheck all checkboxes
                    const checkboxes = document.querySelectorAll('.task-checkbox');
                    checkboxes.forEach(checkbox => {
                        checkbox.checked = false;
                    });
                    
                    toggleMultiSelectBar();
                });
                
                // Helper function to toggle multi-select bar
                function toggleMultiSelectBar() {
                    const selectedCheckboxes = document.querySelectorAll('.task-checkbox:checked');
                    const multiSelectBar = document.getElementById('multiSelectBar');
                    const selectedCount = document.getElementById('selectedCount');
                    
                    if (selectedCheckboxes.length > 0) {
                        selectedCount.textContent = selectedCheckboxes.length;
                        multiSelectBar.classList.add('active');
                    } else {
                        multiSelectBar.classList.remove('active');
                    }
                }
                
                // Add event listener for checkbox changes to toggle multi-select bar
                document.addEventListener('change', function(e) {
                    if (e.target.classList.contains('task-checkbox')) {
                        toggleMultiSelectBar();
                    }
                });
                
                // Initialize app with saved status
                if (userStatus) {
                    updateStatus(userStatus);
                }
                
                // Check if user is logged in
                if (currentUser) {
                    // Update profile picture
                    document.getElementById('profileImage').src = currentUser.profileImage;
                    
                    // Show dashboard
                    loginPage.style.display = 'none';
                    dashboard.style.display = 'block';
                    
                    // Render tasks and counts
                    renderTasks();
                    updateTaskCounts();
                    updateGraphs();
                    populateCategorySelect();
                    updateNotificationBadge();
                    loadTimerState();
                }
            });
        });
    </script>
</body>
</html>
