<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>To-Do App</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        primary: '#5D5CDE',
                        secondary: '#6366F1',
                        success: '#10B981',
                        warning: '#F59E0B',
                        danger: '#EF4444',
                        dark: {
                            primary: '#333',
                            secondary: '#1F2937'
                        }
                    },
                    animation: {
                        'fade-in': 'fadeIn 0.3s ease-in-out',
                        'slide-in': 'slideIn 0.3s ease-in-out',
                    },
                    keyframes: {
                        fadeIn: {
                            '0%': { opacity: '0' },
                            '100%': { opacity: '1' },
                        },
                        slideIn: {
                            '0%': { transform: 'translateY(20px)', opacity: '0' },
                            '100%': { transform: 'translateY(0)', opacity: '1' },
                        },
                    }
                }
            }
        }
    </script>
    <style>
        :root {
            --primary: #5D5CDE;
            --primary-hover: #4848c4;
            --secondary: #6366F1;
            --success: #10B981;
            --warning: #F59E0B;
            --danger: #EF4444;
            --light: #FFFFFF;
            --dark: #181818;
            --gray-light: #F3F4F6;
            --gray-dark: #374151;
            --text-light: #333333;
            --text-dark: #F3F4F6;
            --border-light: #E5E7EB;
            --border-dark: #4B5563;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            transition: background-color 0.3s, color 0.3s;
        }

        /* Light mode */
        body {
            background-color: var(--light);
            color: var(--text-light);
        }

        /* Dark mode */
        body.dark {
            background-color: var(--dark);
            color: var(--text-dark);
        }
        
        .dark .card {
            background-color: #1F2937;
            border-color: var(--border-dark);
        }
        
        .dark .input,
        .dark .select,
        .dark .textarea {
            background-color: #374151;
            border-color: var(--border-dark);
            color: var(--text-dark);
        }
        
        /* Transitions */
        .fade-transition {
            transition: opacity 0.3s ease;
        }
        
        .scale-transition {
            transition: transform 0.3s ease;
        }

        /* Task Drag & Drop */
        .draggable {
            cursor: grab;
        }
        
        .draggable:active {
            cursor: grabbing;
        }
        
        .drag-over {
            border: 2px dashed var(--primary);
            opacity: 0.5;
        }

        /* Custom scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
        }
        
        ::-webkit-scrollbar-track {
            background: transparent;
        }
        
        ::-webkit-scrollbar-thumb {
            background-color: rgba(155, 155, 155, 0.5);
            border-radius: 20px;
        }
        
        ::-webkit-scrollbar-thumb:hover {
            background-color: rgba(155, 155, 155, 0.8);
        }

        /* Modals */
        .modal-backdrop {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(4px);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 50;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s, visibility 0.3s;
        }
        
        .modal-backdrop.active {
            opacity: 1;
            visibility: visible;
        }
        
        .modal-content {
            background-color: var(--light);
            border-radius: 8px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.15);
            width: 90%;
            max-width: 500px;
            max-height: 90vh;
            overflow-y: auto;
            transform: scale(0.9);
            opacity: 0;
            transition: transform 0.3s, opacity 0.3s;
        }
        
        .dark .modal-content {
            background-color: #1F2937;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.4);
        }
        
        .modal-backdrop.active .modal-content {
            transform: scale(1);
            opacity: 1;
        }
        
        /* Notification badge */
        .notification-badge {
            position: absolute;
            top: -5px;
            right: -5px;
            background-color: var(--danger);
            color: white;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 12px;
            font-weight: bold;
        }

        /* Profile picture borders */
        .status-online {
            border: 2px solid var(--success);
        }
        
        .status-offline {
            border: 2px solid var(--danger);
        }
        
        .status-break {
            border: 2px solid var(--warning);
        }
        
        .status-shadow {
            border: 2px solid #9CA3AF;
        }

        /* Task priority indicators */
        .priority-high {
            border-left: 4px solid var(--danger);
        }
        
        .priority-medium {
            border-left: 4px solid var(--warning);
        }
        
        .priority-low {
            border-left: 4px solid #9CA3AF;
        }

        /* Dropdown menu */
        .dropdown {
            position: relative;
        }
        
        .dropdown-menu {
            position: absolute;
            right: 0;
            top: 100%;
            background-color: var(--light);
            border: 1px solid var(--border-light);
            border-radius: 6px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            min-width: 180px;
            z-index: 10;
            opacity: 0;
            visibility: hidden;
            transform: translateY(10px);
            transition: opacity 0.2s, visibility 0.2s, transform 0.2s;
        }
        
        .dark .dropdown-menu {
            background-color: #1F2937;
            border-color: var(--border-dark);
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.3);
        }
        
        .dropdown-menu.active {
            opacity: 1;
            visibility: visible;
            transform: translateY(0);
        }
        
        .dropdown-item {
            padding: 10px 15px;
            cursor: pointer;
            transition: background-color 0.2s;
        }
        
        .dropdown-item:hover {
            background-color: var(--gray-light);
        }
        
        .dark .dropdown-item:hover {
            background-color: var(--gray-dark);
        }
        
        .nested-dropdown {
            position: relative;
        }
        
        .nested-menu {
            position: absolute;
            left: 100%;
            top: 0;
            background-color: var(--light);
            border: 1px solid var(--border-light);
            border-radius: 6px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            min-width: 150px;
            opacity: 0;
            visibility: hidden;
            transform: translateX(10px);
            transition: opacity 0.2s, visibility 0.2s, transform 0.2s;
        }
        
        .dark .nested-menu {
            background-color: #1F2937;
            border-color: var(--border-dark);
        }
        
        .nested-dropdown:hover .nested-menu {
            opacity: 1;
            visibility: visible;
            transform: translateX(0);
        }

        /* Custom Toggle Switch */
        .switch {
            position: relative;
            display: inline-block;
            width: 50px;
            height: 24px;
        }
        
        .switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }
        
        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            transition: .4s;
            border-radius: 34px;
        }
        
        .slider:before {
            position: absolute;
            content: "";
            height: 18px;
            width: 18px;
            left: 3px;
            bottom: 3px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }
        
        input:checked + .slider {
            background-color: var(--primary);
        }
        
        input:focus + .slider {
            box-shadow: 0 0 1px var(--primary);
        }
        
        input:checked + .slider:before {
            transform: translateX(26px);
        }

        .auth-container {
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            background: linear-gradient(135deg, #5D5CDE 0%, #4848c4 100%);
            padding: 20px;
        }

        .auth-card {
            width: 100%;
            max-width: 450px;
            background-color: white;
            border-radius: 12px;
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.15);
            overflow: hidden;
        }

        .dark .auth-card {
            background-color: #1F2937;
        }

        .auth-header {
            background-color: var(--primary);
            color: white;
            padding: 20px;
            text-align: center;
        }

        .auth-body {
            padding: 30px;
        }

        .auth-footer {
            padding: 15px 30px;
            border-top: 1px solid var(--border-light);
            text-align: center;
        }

        .dark .auth-footer {
            border-top: 1px solid var(--border-dark);
        }

        /* Task layouts and transitions */
        .task-list {
            transition: all 0.3s ease;
        }

        .task-card {
            transition: all 0.3s ease;
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.08);
            overflow: hidden;
        }

        .dark .task-card {
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
        }

        .task-card.completed {
            border-left-color: var(--success) !important;
            background-color: rgba(16, 185, 129, 0.1);
        }

        .dark .task-card.completed {
            background-color: rgba(16, 185, 129, 0.05);
        }

        .selected-task {
            box-shadow: 0 0 0 2px var(--primary);
        }
    </style>
</head>
<body>
    <!-- Auth Pages -->
    <div id="authPages" class="auth-container">
        <!-- Login Page -->
        <div id="loginPage" class="auth-card animate-fade-in">
            <div class="auth-header">
                <h2 class="text-xl font-bold">Welcome to To-Do App</h2>
                <p class="mt-1 text-sm opacity-80">Login to access your tasks</p>
            </div>
            <div class="auth-body">
                <form id="loginForm" class="space-y-4">
                    <div>
                        <label for="loginEmail" class="block text-sm font-medium mb-1">Email</label>
                        <input type="email" id="loginEmail" class="w-full px-4 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent text-base dark:bg-gray-700 dark:border-gray-600 dark:text-white" required>
                    </div>
                    <div>
                        <label for="loginPassword" class="block text-sm font-medium mb-1">Password</label>
                        <input type="password" id="loginPassword" class="w-full px-4 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent text-base dark:bg-gray-700 dark:border-gray-600 dark:text-white" required>
                    </div>
                    <div>
                        <button type="submit" class="w-full bg-primary hover:bg-primary-hover text-white font-medium py-2 px-4 rounded-md transition duration-200">Login</button>
                    </div>
                </form>
            </div>
            <div class="auth-footer">
                <p class="text-sm">Don't have an account? <a href="#" id="showRegister" class="text-primary hover:text-primary-hover font-medium">Register</a></p>
            </div>
        </div>

        <!-- Register Page -->
        <div id="registerPage" class="auth-card hidden animate-fade-in">
            <div class="auth-header">
                <h2 class="text-xl font-bold">Create a New Account</h2>
                <p class="mt-1 text-sm opacity-80">Fill in the details to get started</p>
            </div>
            <div class="auth-body">
                <form id="registerForm" class="space-y-4">
                    <div>
                        <label for="regName" class="block text-sm font-medium mb-1">Full Name</label>
                        <input type="text" id="regName" class="w-full px-4 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent text-base dark:bg-gray-700 dark:border-gray-600 dark:text-white" required>
                    </div>
                    <div>
                        <label for="regEmail" class="block text-sm font-medium mb-1">Email</label>
                        <input type="email" id="regEmail" class="w-full px-4 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent text-base dark:bg-gray-700 dark:border-gray-600 dark:text-white" required>
                    </div>
                    <div>
                        <label for="regEmailConfirm" class="block text-sm font-medium mb-1">Confirm Email</label>
                        <input type="email" id="regEmailConfirm" class="w-full px-4 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent text-base dark:bg-gray-700 dark:border-gray-600 dark:text-white" required>
                    </div>
                    <div>
                        <label for="regPassword" class="block text-sm font-medium mb-1">Password</label>
                        <input type="password" id="regPassword" class="w-full px-4 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent text-base dark:bg-gray-700 dark:border-gray-600 dark:text-white" required>
                    </div>
                    <div>
                        <label for="regPasswordConfirm" class="block text-sm font-medium mb-1">Confirm Password</label>
                        <input type="password" id="regPasswordConfirm" class="w-full px-4 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent text-base dark:bg-gray-700 dark:border-gray-600 dark:text-white" required>
                    </div>
                    <div>
                        <label for="regPhone" class="block text-sm font-medium mb-1">Phone Number</label>
                        <input type="tel" id="regPhone" class="w-full px-4 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent text-base dark:bg-gray-700 dark:border-gray-600 dark:text-white" required>
                    </div>
                    <div>
                        <label for="regCountry" class="block text-sm font-medium mb-1">Country</label>
                        <select id="regCountry" class="w-full px-4 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent text-base dark:bg-gray-700 dark:border-gray-600 dark:text-white" required>
                            <option value="">Select a country</option>
                            <!-- Countries will be populated via JavaScript -->
                        </select>
                    </div>
                    <div>
                        <label for="regRole" class="block text-sm font-medium mb-1">Role</label>
                        <select id="regRole" class="w-full px-4 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent text-base dark:bg-gray-700 dark:border-gray-600 dark:text-white" required>
                            <option value="">Select a role</option>
                            <option value="manager">Manager</option>
                            <option value="admin">Admin</option>
                            <option value="staff">Staff</option>
                            <option value="customer">Customer</option>
                        </select>
                    </div>
                    <div>
                        <button type="submit" class="w-full bg-primary hover:bg-primary-hover text-white font-medium py-2 px-4 rounded-md transition duration-200">Register</button>
                    </div>
                </form>
            </div>
            <div class="auth-footer">
                <p class="text-sm">Already have an account? <a href="#" id="showLogin" class="text-primary hover:text-primary-hover font-medium">Login</a></p>
            </div>
        </div>
    </div>

    <!-- Main App -->
    <div id="appContainer" class="hidden min-h-screen flex flex-col">
        <!-- Header/Title Bar -->
        <header class="bg-white dark:bg-gray-800 border-b border-gray-200 dark:border-gray-700 shadow-sm">
            <div class="container mx-auto px-4 py-3">
                <div class="flex justify-between items-center">
                    <!-- Logo & App Name -->
                    <div class="flex items-center">
                        <div class="h-10 w-10 rounded-md bg-primary flex items-center justify-center text-white text-xl font-bold">
                            <i class="fas fa-check-double"></i>
                        </div>
                        <h1 class="ml-3 text-xl font-bold">To-Do App</h1>
                    </div>
                    
                    <!-- Right Side Items -->
                    <div class="flex items-center space-x-6">
                        <!-- Timer -->
                        <div class="hidden md:flex items-center space-x-2">
                            <i class="fas fa-clock text-gray-500 dark:text-gray-400"></i>
                            <div>
                                <p class="text-xs text-gray-500 dark:text-gray-400">Working Hours</p>
                                <p id="workTimer" class="font-mono font-medium">00:00:00</p>
                            </div>
                        </div>
                        
                        <!-- Dark Mode Toggle -->
                        <div class="flex items-center space-x-2">
                            <i class="fas fa-sun text-yellow-500 dark:text-yellow-400"></i>
                            <label class="switch">
                                <input type="checkbox" id="darkModeToggle">
                                <span class="slider"></span>
                            </label>
                            <i class="fas fa-moon text-gray-500 dark:text-gray-300"></i>
                        </div>
                        
                        <!-- Notifications -->
                        <div class="relative">
                            <button id="notificationBtn" class="relative text-gray-600 dark:text-gray-300 hover:text-primary dark:hover:text-primary-hover transition duration-200">
                                <i class="fas fa-bell text-xl"></i>
                                <span id="notificationBadge" class="notification-badge">3</span>
                            </button>
                            <div id="notificationDropdown" class="dropdown-menu w-80">
                                <div class="p-3 border-b border-gray-200 dark:border-gray-700">
                                    <h3 class="font-medium">Notifications</h3>
                                </div>
                                <div id="notificationList" class="max-h-80 overflow-y-auto">
                                    <div class="notification-item p-3 border-b border-gray-200 dark:border-gray-700 hover:bg-gray-50 dark:hover:bg-gray-700 cursor-pointer">
                                        <p class="text-sm font-medium">Task "Redesign Homepage" is due soon</p>
                                        <p class="text-xs text-gray-500 dark:text-gray-400 mt-1">2 hours ago</p>
                                    </div>
                                    <div class="notification-item p-3 border-b border-gray-200 dark:border-gray-700 hover:bg-gray-50 dark:hover:bg-gray-700 cursor-pointer">
                                        <p class="text-sm font-medium">John assigned you a new task</p>
                                        <p class="text-xs text-gray-500 dark:text-gray-400 mt-1">Yesterday</p>
                                    </div>
                                    <div class="notification-item p-3 border-b border-gray-200 dark:border-gray-700 hover:bg-gray-50 dark:hover:bg-gray-700 cursor-pointer">
                                        <p class="text-sm font-medium">Your account was successfully created</p>
                                        <p class="text-xs text-gray-500 dark:text-gray-400 mt-1">3 days ago</p>
                                    </div>
                                </div>
                                <div class="p-2 text-center">
                                    <a href="#" class="text-sm text-primary hover:text-primary-hover">View all notifications</a>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Profile -->
                        <div class="dropdown">
                            <button id="profileBtn" class="flex items-center focus:outline-none">
                                <div id="profilePic" class="h-10 w-10 rounded-full bg-gray-300 overflow-hidden border-2 status-online">
                                    <img id="profileImage" src="" alt="Profile" class="h-full w-full object-cover">
                                </div>
                            </button>
                            <div id="profileDropdown" class="dropdown-menu">
                                <div class="p-3 border-b border-gray-200 dark:border-gray-700">
                                    <p id="profileName" class="font-medium">John Doe</p>
                                    <p id="profileEmail" class="text-sm text-gray-500 dark:text-gray-400">john@example.com</p>
                                </div>
                                <div class="py-1">
                                    <div class="dropdown-item" id="viewProfileBtn">
                                        <i class="fas fa-user mr-2 text-gray-500 dark:text-gray-400"></i> View Profile
                                    </div>
                                    <div class="dropdown-item nested-dropdown">
                                        <div class="flex justify-between items-center">
                                            <div>
                                                <i class="fas fa-circle mr-2 text-gray-500 dark:text-gray-400"></i> Status
                                            </div>
                                            <i class="fas fa-chevron-right text-xs text-gray-500 dark:text-gray-400"></i>
                                        </div>
                                        <div class="nested-menu">
                                            <div class="dropdown-item status-item" data-status="online">
                                                <i class="fas fa-circle mr-2 text-green-500"></i> Login
                                            </div>
                                            <div class="dropdown-item status-item" data-status="shadow">
                                                <i class="fas fa-circle mr-2 text-gray-500"></i> Shadow
                                            </div>
                                            <div class="dropdown-item status-item" data-status="break">
                                                <i class="fas fa-circle mr-2 text-yellow-500"></i> Break
                                            </div>
                                            <div class="dropdown-item status-item" data-status="offline">
                                                <i class="fas fa-circle mr-2 text-red-500"></i> Logout
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="border-t border-gray-200 dark:border-gray-700 py-1">
                                    <div class="dropdown-item" id="logoutBtn">
                                        <i class="fas fa-sign-out-alt mr-2 text-gray-500 dark:text-gray-400"></i> Logout
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </header>

        <!-- Main Content -->
        <main class="flex-grow bg-gray-50 dark:bg-gray-900 p-4 md:p-6">
            <div class="container mx-auto">
                <!-- Statistics Section -->
                <div class="grid grid-cols-1 lg:grid-cols-3 gap-4 mb-6">
                    <!-- Total Tasks -->
                    <div class="bg-blue-100 dark:bg-blue-900/30 p-4 rounded-lg shadow-sm col-span-1 lg:col-span-3">
                        <div class="flex justify-between items-center">
                            <div>
                                <h3 class="text-blue-800 dark:text-blue-300 font-medium">Total Tasks</h3>
                                <p id="totalTasksCount" class="text-2xl font-bold text-blue-900 dark:text-blue-200">12</p>
                            </div>
                            <div class="h-10 w-10 rounded-full bg-blue-200 dark:bg-blue-800 flex items-center justify-center">
                                <i class="fas fa-tasks text-blue-600 dark:text-blue-300"></i>
                            </div>
                        </div>
                    </div>

                    <!-- Completed Tasks -->
                    <div class="bg-green-100 dark:bg-green-900/30 p-4 rounded-lg shadow-sm">
                        <div class="flex justify-between items-center">
                            <div>
                                <h3 class="text-green-800 dark:text-green-300 font-medium">Completed Tasks</h3>
                                <p id="completedTasksCount" class="text-2xl font-bold text-green-900 dark:text-green-200">5</p>
                            </div>
                            <div class="h-10 w-10 rounded-full bg-green-200 dark:bg-green-800 flex items-center justify-center">
                                <i class="fas fa-check-circle text-green-600 dark:text-green-300"></i>
                            </div>
                        </div>
                    </div>

                    <!-- Pending Tasks -->
                    <div class="bg-yellow-100 dark:bg-yellow-900/30 p-4 rounded-lg shadow-sm">
                        <div class="flex justify-between items-center">
                            <div>
                                <h3 class="text-yellow-800 dark:text-yellow-300 font-medium">Pending Tasks</h3>
                                <p id="pendingTasksCount" class="text-2xl font-bold text-yellow-900 dark:text-yellow-200">7</p>
                            </div>
                            <div class="h-10 w-10 rounded-full bg-yellow-200 dark:bg-yellow-800 flex items-center justify-center">
                                <i class="fas fa-clock text-yellow-600 dark:text-yellow-300"></i>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Task Controls -->
                <div class="bg-white dark:bg-gray-800 rounded-lg shadow-sm p-4 mb-6">
                    <div class="flex flex-wrap justify-between items-center gap-3">
                        <h2 class="text-xl font-bold">Tasks</h2>
                        
                        <div class="flex flex-wrap items-center gap-3">
                            <!-- View Toggle -->
                            <div class="bg-gray-100 dark:bg-gray-700 rounded-md flex">
                                <button id="listViewBtn" class="px-3 py-1.5 rounded-md bg-primary text-white">
                                    <i class="fas fa-list mr-1"></i> List
                                </button>
                                <button id="graphViewBtn" class="px-3 py-1.5 rounded-md text-gray-700 dark:text-gray-300">
                                    <i class="fas fa-chart-bar mr-1"></i> Graph
                                </button>
                            </div>
                            
                            <!-- Control Buttons -->
                            <button id="importTasksBtn" class="px-3 py-1.5 rounded-md bg-gray-100 hover:bg-gray-200 dark:bg-gray-700 dark:hover:bg-gray-600 text-gray-700 dark:text-gray-300 transition duration-200">
                                <i class="fas fa-file-import mr-1"></i> Import
                            </button>
                            
                            <button id="exportTasksBtn" class="px-3 py-1.5 rounded-md bg-gray-100 hover:bg-gray-200 dark:bg-gray-700 dark:hover:bg-gray-600 text-gray-700 dark:text-gray-300 transition duration-200">
                                <i class="fas fa-file-export mr-1"></i> Export
                            </button>
                            
                            <button id="showUsersBtn" class="px-3 py-1.5 rounded-md bg-gray-100 hover:bg-gray-200 dark:bg-gray-700 dark:hover:bg-gray-600 text-gray-700 dark:text-gray-300 transition duration-200">
                                <i class="fas fa-users mr-1"></i> Users
                            </button>
                            
                            <button id="addTaskBtn" class="px-3 py-1.5 rounded-md bg-primary hover:bg-primary-hover text-white transition duration-200">
                                <i class="fas fa-plus mr-1"></i> Add Task
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Tasks Section -->
                <div class="bg-white dark:bg-gray-800 rounded-lg shadow-sm p-4 mb-6">
                    <!-- Task Filters & Search -->
                    <div class="mb-4 grid grid-cols-1 lg:grid-cols-6 gap-3">
                        <div class="lg:col-span-2">
                            <div class="relative">
                                <input type="text" id="taskSearch" placeholder="Search tasks..." class="w-full pl-10 pr-4 py-2 border border-gray-300 dark:border-gray-600 rounded-md focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent dark:bg-gray-700 dark:text-white text-base">
                                <i class="fas fa-search absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400"></i>
                            </div>
                        </div>

                        <div>
                            <select id="categoryFilter" class="w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-md focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent dark:bg-gray-700 dark:text-white text-base">
                                <option value="">All Categories</option>
                                <option value="work">Work</option>
                                <option value="personal">Personal</option>
                                <option value="home">Home</option>
                                <option value="health">Health</option>
                                <option value="finance">Finance</option>
                            </select>
                        </div>

                        <div>
                            <select id="priorityFilter" class="w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-md focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent dark:bg-gray-700 dark:text-white text-base">
                                <option value="">All Priorities</option>
                                <option value="high">High</option>
                                <option value="medium">Medium</option>
                                <option value="low">Low</option>
                            </select>
                        </div>

                        <div>
                            <select id="statusFilter" class="w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-md focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent dark:bg-gray-700 dark:text-white text-base">
                                <option value="">All Status</option>
                                <option value="active">Active</option>
                                <option value="completed">Completed</option>
                            </select>
                        </div>

                        <div>
                            <select id="dateFilter" class="w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-md focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent dark:bg-gray-700 dark:text-white text-base">
                                <option value="">All Dates</option>
                                <option value="today">Today</option>
                                <option value="week">In a Week</option>
                                <option value="month">In a Month</option>
                                <option value="custom">Custom Range</option>
                            </select>
                        </div>
                    </div>

                    <!-- Date Range Picker (initially hidden) -->
                    <div id="dateRangePicker" class="mb-4 grid grid-cols-1 md:grid-cols-2 gap-3 hidden">
                        <div>
                            <label for="startDate" class="block text-sm font-medium mb-1">Start Date</label>
                            <input type="date" id="startDate" class="w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-md focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent dark:bg-gray-700 dark:text-white text-base">
                        </div>
                        <div>
                            <label for="endDate" class="block text-sm font-medium mb-1">End Date</label>
                            <input type="date" id="endDate" class="w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-md focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent dark:bg-gray-700 dark:text-white text-base">
                        </div>
                    </div>

                    <!-- Task Action Buttons -->
                    <div class="mb-4 flex flex-wrap items-center justify-between gap-3">
                        <div class="flex items-center gap-2">
                            <button id="undoBtn" class="px-2 py-1 rounded-md bg-gray-100 hover:bg-gray-200 dark:bg-gray-700 dark:hover:bg-gray-600 text-gray-700 dark:text-gray-300 transition duration-200 disabled:opacity-50 disabled:cursor-not-allowed" disabled>
                                <i class="fas fa-undo"></i>
                            </button>
                            <button id="redoBtn" class="px-2 py-1 rounded-md bg-gray-100 hover:bg-gray-200 dark:bg-gray-700 dark:hover:bg-gray-600 text-gray-700 dark:text-gray-300 transition duration-200 disabled:opacity-50 disabled:cursor-not-allowed" disabled>
                                <i class="fas fa-redo"></i>
                            </button>
                            <div class="mx-2 h-5 border-r border-gray-300 dark:border-gray-600"></div>
                            <button id="completeSelectedBtn" class="px-2 py-1 rounded-md bg-green-100 hover:bg-green-200 dark:bg-green-900/30 dark:hover:bg-green-900/50 text-green-700 dark:text-green-300 transition duration-200 disabled:opacity-50 disabled:cursor-not-allowed" disabled>
                                <i class="fas fa-check"></i>
                            </button>
                            <button id="deleteSelectedBtn" class="px-2 py-1 rounded-md bg-red-100 hover:bg-red-200 dark:bg-red-900/30 dark:hover:bg-red-900/50 text-red-700 dark:text-red-300 transition duration-200 disabled:opacity-50 disabled:cursor-not-allowed" disabled>
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                        
                        <div>
                            <select id="sortTasks" class="px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-md focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent dark:bg-gray-700 dark:text-white text-base">
                                <option value="dueDate">Sort by: Due Date</option>
                                <option value="priority">Sort by: Priority</option>
                                <option value="title">Sort by: Title</option>
                                <option value="dateCreated">Sort by: Date Created</option>
                            </select>
                        </div>
                    </div>

                    <!-- List View -->
                    <div id="taskListView" class="task-list">
                        <div id="taskList" class="space-y-3">
                            <!-- Task items will be inserted here via JavaScript -->
                        </div>
                        
                        <div id="emptyTaskList" class="hidden text-center py-8">
                            <i class="fas fa-clipboard-list text-4xl text-gray-400 mb-2"></i>
                            <p class="text-gray-500 dark:text-gray-400">No tasks found. Add a new task to get started!</p>
                        </div>
                    </div>

                    <!-- Graph View -->
                    <div id="taskGraphView" class="task-list hidden">
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <div class="bg-white dark:bg-gray-800 p-4 rounded-lg shadow-sm">
                                <h3 class="text-lg font-medium mb-4">Task Status</h3>
                                <div class="h-60">
                                    <canvas id="taskStatusChart"></canvas>
                                </div>
                            </div>
                            
                            <div class="bg-white dark:bg-gray-800 p-4 rounded-lg shadow-sm">
                                <h3 class="text-lg font-medium mb-4">Tasks by Priority</h3>
                                <div class="h-60">
                                    <canvas id="taskPriorityChart"></canvas>
                                </div>
                            </div>
                            
                            <div class="bg-white dark:bg-gray-800 p-4 rounded-lg shadow-sm">
                                <h3 class="text-lg font-medium mb-4">Tasks by Category</h3>
                                <div class="h-60">
                                    <canvas id="taskCategoryChart"></canvas>
                                </div>
                            </div>
                            
                            <div class="bg-white dark:bg-gray-800 p-4 rounded-lg shadow-sm">
                                <h3 class="text-lg font-medium mb-4">Tasks by Due Date</h3>
                                <div class="h-60">
                                    <canvas id="taskDueDateChart"></canvas>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Insights Section -->
                <div class="bg-white dark:bg-gray-800 rounded-lg shadow-sm p-4 mb-6">
                    <h2 class="text-xl font-bold mb-4">Insights</h2>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
                        <div class="bg-purple-100 dark:bg-purple-900/30 p-4 rounded-lg">
                            <h3 class="text-purple-800 dark:text-purple-300 font-medium">Productivity Score</h3>
                            <div class="flex items-end mt-2">
                                <p id="productivityScore" class="text-2xl font-bold text-purple-900 dark:text-purple-200">85</p>
                                <p class="ml-1 text-purple-800 dark:text-purple-300">/100</p>
                            </div>
                            <div class="mt-2 h-1.5 bg-purple-200 dark:bg-purple-800 rounded-full overflow-hidden">
                                <div id="productivityBar" class="h-full bg-purple-600 rounded-full" style="width: 85%;"></div>
                            </div>
                        </div>
                        
                        <div class="bg-indigo-100 dark:bg-indigo-900/30 p-4 rounded-lg">
                            <h3 class="text-indigo-800 dark:text-indigo-300 font-medium">Completion Rate</h3>
                            <div class="flex items-end mt-2">
                                <p id="completionRate" class="text-2xl font-bold text-indigo-900 dark:text-indigo-200">70</p>
                                <p class="ml-1 text-indigo-800 dark:text-indigo-300">%</p>
                            </div>
                            <div class="mt-2 h-1.5 bg-indigo-200 dark:bg-indigo-800 rounded-full overflow-hidden">
                                <div id="completionBar" class="h-full bg-indigo-600 rounded-full" style="width: 70%;"></div>
                            </div>
                        </div>
                        
                        <div class="bg-pink-100 dark:bg-pink-900/30 p-4 rounded-lg">
                            <h3 class="text-pink-800 dark:text-pink-300 font-medium">On-Time Completion</h3>
                            <div class="flex items-end mt-2">
                                <p id="onTimeRate" class="text-2xl font-bold text-pink-900 dark:text-pink-200">65</p>
                                <p class="ml-1 text-pink-800 dark:text-pink-300">%</p>
                            </div>
                            <div class="mt-2 h-1.5 bg-pink-200 dark:bg-pink-800 rounded-full overflow-hidden">
                                <div id="onTimeBar" class="h-full bg-pink-600 rounded-full" style="width: 65%;"></div>
                            </div>
                        </div>
                        
                        <div class="bg-teal-100 dark:bg-teal-900/30 p-4 rounded-lg">
                            <h3 class="text-teal-800 dark:text-teal-300 font-medium">Avg. Completion Time</h3>
                            <p id="avgCompletionTime" class="text-2xl font-bold text-teal-900 dark:text-teal-200 mt-2">2.4 days</p>
                            <p class="text-sm text-teal-700 dark:text-teal-400 mt-1">
                                <i class="fas fa-arrow-down text-green-600 dark:text-green-400"></i>
                                <span>0.3 days from last week</span>
                            </p>
                        </div>
                    </div>
                    
                    <div class="mt-6">
                        <h3 class="text-lg font-medium mb-4">Task Completion Trend</h3>
                        <div class="h-80">
                            <canvas id="taskTrendChart"></canvas>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- Modals -->
    <!-- Profile Modal -->
    <div id="profileModal" class="modal-backdrop">
        <div class="modal-content">
            <div class="p-4 border-b border-gray-200 dark:border-gray-700 flex justify-between items-center">
                <h3 class="text-lg font-bold">User Profile</h3>
                <button class="close-modal text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="p-4">
                <div class="flex flex-col items-center mb-6">
                    <div class="relative mb-3">
                        <div id="profileModalPic" class="h-24 w-24 rounded-full overflow-hidden border-2 status-online">
                            <img id="profileModalImage" src="" alt="Profile" class="h-full w-full object-cover">
                        </div>
                        <button id="changeProfilePicBtn" class="absolute bottom-0 right-0 bg-primary text-white rounded-full h-8 w-8 flex items-center justify-center hover:bg-primary-hover transition duration-200">
                            <i class="fas fa-camera"></i>
                        </button>
                        <input type="file" id="profilePicInput" class="hidden" accept="image/*">
                    </div>
                    <p id="profileModalName" class="text-lg font-bold">John Doe</p>
                    <p id="profileModalRole" class="text-sm text-gray-500 dark:text-gray-400">Manager</p>
                </div>
                
                <form id="profileEditForm">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label for="profileName" class="block text-sm font-medium mb-1">Full Name</label>
                            <input type="text" id="profileName" class="w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-md focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent dark:bg-gray-700 dark:text-white text-base">
                        </div>
                        <div>
                            <label for="profileEmail" class="block text-sm font-medium mb-1">Email</label>
                            <input type="email" id="profileEmailInput" class="w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-md focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent dark:bg-gray-700 dark:text-white text-base">
                        </div>
                        <div>
                            <label for="profilePhone" class="block text-sm font-medium mb-1">Phone Number</label>
                            <input type="tel" id="profilePhone" class="w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-md focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent dark:bg-gray-700 dark:text-white text-base">
                        </div>
                        <div>
                            <label for="profileCountry" class="block text-sm font-medium mb-1">Country</label>
                            <select id="profileCountry" class="w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-md focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent dark:bg-gray-700 dark:text-white text-base">
                                <!-- Countries will be populated via JavaScript -->
                            </select>
                        </div>
                        <div>
                            <label for="profileRole" class="block text-sm font-medium mb-1">Role</label>
                            <select id="profileRole" class="w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-md focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent dark:bg-gray-700 dark:text-white text-base">
                                <option value="manager">Manager</option>
                                <option value="admin">Admin</option>
                                <option value="staff">Staff</option>
                                <option value="customer">Customer</option>
                            </select>
                        </div>
                        <div>
                            <label for="profilePassword" class="block text-sm font-medium mb-1">Password</label>
                            <input type="password" id="profilePassword" placeholder="••••••••" class="w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-md focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent dark:bg-gray-700 dark:text-white text-base">
                        </div>
                    </div>
                </form>
            </div>
            <div class="p-4 border-t border-gray-200 dark:border-gray-700 flex justify-end space-x-3">
                <button class="close-modal px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-md hover:bg-gray-100 dark:hover:bg-gray-700 transition duration-200">
                    Cancel
                </button>
                <button id="saveProfileBtn" class="px-4 py-2 bg-primary hover:bg-primary-hover text-white rounded-md transition duration-200">
                    Save Changes
                </button>
            </div>
        </div>
    </div>

    <!-- Add Task Modal -->
    <div id="addTaskModal" class="modal-backdrop">
        <div class="modal-content">
            <div class="p-4 border-b border-gray-200 dark:border-gray-700 flex justify-between items-center">
                <h3 class="text-lg font-bold">Add New Task</h3>
                <button class="close-modal text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="p-4">
                <form id="addTaskForm">
                    <div class="space-y-4">
                        <div>
                            <label for="taskTitle" class="block text-sm font-medium mb-1">Title</label>
                            <input type="text" id="taskTitle" class="w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-md focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent dark:bg-gray-700 dark:text-white text-base" required>
                        </div>
                        <div>
                            <label for="taskDescription" class="block text-sm font-medium mb-1">Description</label>
                            <textarea id="taskDescription" rows="3" class="w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-md focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent dark:bg-gray-700 dark:text-white text-base"></textarea>
                        </div>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <label for="taskCategory" class="block text-sm font-medium mb-1">Category</label>
                                <select id="taskCategory" class="w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-md focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent dark:bg-gray-700 dark:text-white text-base" required>
                                    <option value="">Select a category</option>
                                    <option value="work">Work</option>
                                    <option value="personal">Personal</option>
                                    <option value="home">Home</option>
                                    <option value="health">Health</option>
                                    <option value="finance">Finance</option>
                                </select>
                            </div>
                            <div>
                                <label for="taskPriority" class="block text-sm font-medium mb-1">Priority</label>
                                <select id="taskPriority" class="w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-md focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent dark:bg-gray-700 dark:text-white text-base" required>
                                    <option value="">Select a priority</option>
                                    <option value="high">High</option>
                                    <option value="medium">Medium</option>
                                    <option value="low">Low</option>
                                </select>
                            </div>
                        </div>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <label for="taskDueDate" class="block text-sm font-medium mb-1">Due Date</label>
                                <input type="date" id="taskDueDate" class="w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-md focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent dark:bg-gray-700 dark:text-white text-base" required>
                            </div>
                            <div>
                                <label for="taskAssignee" class="block text-sm font-medium mb-1">Assign To</label>
                                <select id="taskAssignee" class="w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-md focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent dark:bg-gray-700 dark:text-white text-base">
                                    <option value="">Select a user</option>
                                    <!-- Users will be populated via JavaScript -->
                                </select>
                            </div>
                        </div>
                        <div>
                            <label class="block text-sm font-medium mb-1">Subtasks</label>
                            <div id="subtasksList" class="space-y-2 mb-2">
                                <!-- Subtasks will be added here -->
                            </div>
                            <button type="button" id="addSubtaskBtn" class="text-primary hover:text-primary-hover text-sm flex items-center">
                                <i class="fas fa-plus mr-1"></i> Add Subtask
                            </button>
                        </div>
                        <div>
                            <label for="taskNotes" class="block text-sm font-medium mb-1">Notes</label>
                            <textarea id="taskNotes" rows="2" class="w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-md focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent dark:bg-gray-700 dark:text-white text-base"></textarea>
                        </div>
                    </div>
                </form>
            </div>
            <div class="p-4 border-t border-gray-200 dark:border-gray-700 flex justify-end space-x-3">
                <button class="close-modal px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-md hover:bg-gray-100 dark:hover:bg-gray-700 transition duration-200">
                    Cancel
                </button>
                <button id="saveTaskBtn" class="px-4 py-2 bg-primary hover:bg-primary-hover text-white rounded-md transition duration-200">
                    Save Task
                </button>
            </div>
        </div>
    </div>

    <!-- Users Modal -->
    <div id="usersModal" class="modal-backdrop">
        <div class="modal-content max-w-4xl">
            <div class="p-4 border-b border-gray-200 dark:border-gray-700 flex justify-between items-center">
                <h3 class="text-lg font-bold">Users</h3>
                <button class="close-modal text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="p-4">
                <div class="mb-4 flex items-center justify-between">
                    <div class="relative w-64">
                        <input type="text" id="userSearch" placeholder="Search users..." class="w-full pl-10 pr-4 py-2 border border-gray-300 dark:border-gray-600 rounded-md focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent dark:bg-gray-700 dark:text-white text-base">
                        <i class="fas fa-search absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400"></i>
                    </div>
                    <div>
                        <select id="userRoleFilter" class="px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-md focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent dark:bg-gray-700 dark:text-white text-base">
                            <option value="">All Roles</option>
                            <option value="manager">Manager</option>
                            <option value="admin">Admin</option>
                            <option value="staff">Staff</option>
                            <option value="customer">Customer</option>
                        </select>
                    </div>
                </div>
                <div class="overflow-x-auto">
                    <table class="min-w-full divide-y divide-gray-200 dark:divide-gray-700">
                        <thead class="bg-gray-50 dark:bg-gray-800">
                            <tr>
                                <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">User</th>
                                <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">Email</th>
                                <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">Role</th>
                                <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">Status</th>
                                <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">Actions</th>
                            </tr>
                        </thead>
                        <tbody id="usersList" class="bg-white dark:bg-gray-800 divide-y divide-gray-200 dark:divide-gray-700">
                            <!-- Users will be populated via JavaScript -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <!-- Import Tasks Modal -->
    <div id="importTasksModal" class="modal-backdrop">
        <div class="modal-content">
            <div class="p-4 border-b border-gray-200 dark:border-gray-700 flex justify-between items-center">
                <h3 class="text-lg font-bold">Import Tasks</h3>
                <button class="close-modal text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="p-4">
                <p class="mb-4 text-gray-600 dark:text-gray-400">Upload a JSON file containing your tasks.</p>
                <div class="border-2 border-dashed border-gray-300 dark:border-gray-600 rounded-lg p-6 text-center" id="importDropZone">
                    <i class="fas fa-file-upload text-4xl text-gray-400 mb-2"></i>
                    <p class="mb-2">Drag and drop your file here</p>
                    <p class="text-sm text-gray-500 dark:text-gray-400">or</p>
                    <button id="browseFilesBtn" class="mt-2 px-4 py-2 bg-primary hover:bg-primary-hover text-white rounded-md transition duration-200">
                        Browse Files
                    </button>
                    <input type="file" id="importFileInput" class="hidden" accept=".json">
                </div>
                <div id="importFileDetails" class="mt-4 hidden">
                    <div class="flex items-center p-3 bg-gray-100 dark:bg-gray-700 rounded-lg">
                        <i class="fas fa-file-alt text-gray-500 mr-3"></i>
                        <div class="flex-grow">
                            <p id="importFileName" class="font-medium">filename.json</p>
                            <p id="importFileSize" class="text-sm text-gray-500 dark:text-gray-400">25 KB</p>
                        </div>
                        <button id="removeImportFile" class="text-gray-500 hover:text-red-500">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                </div>
            </div>
            <div class="p-4 border-t border-gray-200 dark:border-gray-700 flex justify-end space-x-3">
                <button class="close-modal px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-md hover:bg-gray-100 dark:hover:bg-gray-700 transition duration-200">
                    Cancel
                </button>
                <button id="importTasksBtn" class="px-4 py-2 bg-primary hover:bg-primary-hover text-white rounded-md transition duration-200 disabled:opacity-50 disabled:cursor-not-allowed" disabled>
                    Import
                </button>
            </div>
        </div>
    </div>

    <!-- Export Tasks Modal -->
    <div id="exportTasksModal" class="modal-backdrop">
        <div class="modal-content">
            <div class="p-4 border-b border-gray-200 dark:border-gray-700 flex justify-between items-center">
                <h3 class="text-lg font-bold">Export Tasks</h3>
                <button class="close-modal text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="p-4">
                <p class="mb-4 text-gray-600 dark:text-gray-400">Choose a format to export your tasks.</p>
                <div class="space-y-3">
                    <div class="export-option flex items-center p-3 bg-gray-100 dark:bg-gray-700 rounded-lg cursor-pointer hover:bg-gray-200 dark:hover:bg-gray-600 transition duration-200" data-format="json">
                        <div class="h-10 w-10 rounded-full bg-blue-100 dark:bg-blue-900/50 flex items-center justify-center text-blue-600 dark:text-blue-400 mr-3">
                            <i class="fas fa-file-code"></i>
                        </div>
                        <div>
                            <p class="font-medium">JSON</p>
                            <p class="text-sm text-gray-500 dark:text-gray-400">Export as JSON file</p>
                        </div>
                    </div>
                    
                    <div class="export-option flex items-center p-3 bg-gray-100 dark:bg-gray-700 rounded-lg cursor-pointer hover:bg-gray-200 dark:hover:bg-gray-600 transition duration-200" data-format="csv">
                        <div class="h-10 w-10 rounded-full bg-green-100 dark:bg-green-900/50 flex items-center justify-center text-green-600 dark:text-green-400 mr-3">
                            <i class="fas fa-file-csv"></i>
                        </div>
                        <div>
                            <p class="font-medium">CSV</p>
                            <p class="text-sm text-gray-500 dark:text-gray-400">Export as CSV file</p>
                        </div>
                    </div>
                    
                    <div class="export-option flex items-center p-3 bg-gray-100 dark:bg-gray-700 rounded-lg cursor-pointer hover:bg-gray-200 dark:hover:bg-gray-600 transition duration-200" data-format="pdf">
                        <div class="h-10 w-10 rounded-full bg-red-100 dark:bg-red-900/50 flex items-center justify-center text-red-600 dark:text-red-400 mr-3">
                            <i class="fas fa-file-pdf"></i>
                        </div>
                        <div>
                            <p class="font-medium">PDF</p>
                            <p class="text-sm text-gray-500 dark:text-gray-400">Export as PDF document</p>
                        </div>
                    </div>
                </div>
            </div>
            <div class="p-4 border-t border-gray-200 dark:border-gray-700 flex justify-end space-x-3">
                <button class="close-modal px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-md hover:bg-gray-100 dark:hover:bg-gray-700 transition duration-200">
                    Cancel
                </button>
                <button id="exportBtn" class="px-4 py-2 bg-primary hover:bg-primary-hover text-white rounded-md transition duration-200 disabled:opacity-50 disabled:cursor-not-allowed" disabled>
                    Export
                </button>
            </div>
        </div>
    </div>

    <!-- Task Details Modal -->
    <div id="taskDetailsModal" class="modal-backdrop">
        <div class="modal-content">
            <div class="p-4 border-b border-gray-200 dark:border-gray-700 flex justify-between items-center">
                <h3 class="text-lg font-bold" id="taskDetailsTitle">Task Details</h3>
                <button class="close-modal text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="p-4">
                <div class="mb-4">
                    <div class="flex justify-between items-start">
                        <div>
                            <span id="taskDetailsPriority" class="inline-block px-2 py-1 text-xs font-medium rounded-full text-white bg-red-500 mb-2">High Priority</span>
                            <h4 id="taskDetailsName" class="text-xl font-medium">Task Name</h4>
                        </div>
                        
                        <div>
                            <button id="editTaskBtn" class="text-gray-500 hover:text-primary">
                                <i class="fas fa-pen"></i>
                            </button>
                        </div>
                    </div>
                    
                    <p id="taskDetailsDescription" class="text-gray-600 dark:text-gray-400 mt-2">Task description will appear here.</p>
                </div>
                
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                    <div>
                        <p class="text-sm text-gray-500 dark:text-gray-400">Category</p>
                        <p id="taskDetailsCategory" class="font-medium">Work</p>
                    </div>
                    <div>
                        <p class="text-sm text-gray-500 dark:text-gray-400">Due Date</p>
                        <p id="taskDetailsDueDate" class="font-medium">May 15, 2023</p>
                    </div>
                    <div>
                        <p class="text-sm text-gray-500 dark:text-gray-400">Assigned To</p>
                        <div class="flex items-center mt-1">
                            <div class="h-6 w-6 rounded-full overflow-hidden mr-2">
                                <img id="taskDetailsAssigneeImg" src="" alt="Assignee" class="h-full w-full object-cover">
                            </div>
                            <p id="taskDetailsAssignee" class="font-medium">John Doe</p>
                        </div>
                    </div>
                    <div>
                        <p class="text-sm text-gray-500 dark:text-gray-400">Status</p>
                        <p id="taskDetailsStatus" class="font-medium">In Progress</p>
                    </div>
                </div>
                
                <div class="mb-4">
                    <h5 class="font-medium mb-2">Subtasks</h5>
                    <div id="taskDetailsSubtasks" class="space-y-2">
                        <!-- Subtasks will be added here -->
                    </div>
                </div>
                
                <div>
                    <h5 class="font-medium mb-2">Notes</h5>
                    <p id="taskDetailsNotes" class="text-gray-600 dark:text-gray-400">Task notes will appear here.</p>
                </div>
                
                <div class="mt-4 pt-4 border-t border-gray-200 dark:border-gray-700">
                    <div class="flex justify-between items-center">
                        <p class="text-sm text-gray-500 dark:text-gray-400">Created on <span id="taskDetailsCreatedDate">May 10, 2023</span></p>
                        <div class="flex space-x-2">
                            <button id="shareTaskBtn" class="text-primary hover:text-primary-hover">
                                <i class="fas fa-share-alt"></i>
                            </button>
                            <button id="startTimerBtn" class="text-primary hover:text-primary-hover">
                                <i class="fas fa-play"></i>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
            <div class="p-4 border-t border-gray-200 dark:border-gray-700 flex justify-between">
                <button id="deleteTaskBtn" class="px-4 py-2 text-red-600 hover:text-red-700 dark:text-red-400 dark:hover:text-red-300 transition duration-200">
                    <i class="fas fa-trash mr-1"></i> Delete
                </button>
                <div class="space-x-3">
                    <button class="close-modal px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-md hover:bg-gray-100 dark:hover:bg-gray-700 transition duration-200">
                        Close
                    </button>
                    <button id="toggleTaskCompleteBtn" class="px-4 py-2 bg-green-500 hover:bg-green-600 text-white rounded-md transition duration-200">
                        <i class="fas fa-check mr-1"></i> Mark Complete
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Share Task Modal -->
    <div id="shareTaskModal" class="modal-backdrop">
        <div class="modal-content">
            <div class="p-4 border-b border-gray-200 dark:border-gray-700 flex justify-between items-center">
                <h3 class="text-lg font-bold">Share Task</h3>
                <button class="close-modal text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="p-4">
                <p class="mb-4 text-gray-600 dark:text-gray-400">Share this task with others using one of the methods below:</p>
                
                <div class="mb-4">
                    <label for="shareTaskLink" class="block text-sm font-medium mb-1">Task Link</label>
                    <div class="flex">
                        <input type="text" id="shareTaskLink" class="flex-grow px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-l-md focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent dark:bg-gray-700 dark:text-white text-base" value="https://todo-app.com/tasks/abc123" readonly>
                        <button id="copyLinkBtn" class="px-4 py-2 bg-gray-100 dark:bg-gray-700 border border-gray-300 dark:border-gray-600 border-l-0 rounded-r-md hover:bg-gray-200 dark:hover:bg-gray-600 transition duration-200">
                            <i class="fas fa-copy"></i>
                        </button>
                    </div>
                </div>
                
                <div class="mb-4">
                    <label class="block text-sm font-medium mb-2">Share via Email</label>
                    <div class="flex">
                        <input type="email" id="shareEmail" placeholder="Enter email address" class="flex-grow px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-l-md focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent dark:bg-gray-700 dark:text-white text-base">
                        <button id="sendEmailBtn" class="px-4 py-2 bg-primary hover:bg-primary-hover text-white rounded-r-md transition duration-200">
                            <i class="fas fa-paper-plane"></i>
                        </button>
                    </div>
                </div>
                
                <div>
                    <label class="block text-sm font-medium mb-2">Share via</label>
                    <div class="flex space-x-3">
                        <button class="share-btn flex-1 py-2 bg-blue-500 hover:bg-blue-600 text-white rounded-md transition duration-200">
                            <i class="fab fa-facebook-f"></i>
                        </button>
                        <button class="share-btn flex-1 py-2 bg-blue-400 hover:bg-blue-500 text-white rounded-md transition duration-200">
                            <i class="fab fa-twitter"></i>
                        </button>
                        <button class="share-btn flex-1 py-2 bg-green-500 hover:bg-green-600 text-white rounded-md transition duration-200">
                            <i class="fab fa-whatsapp"></i>
                        </button>
                        <button class="share-btn flex-1 py-2 bg-blue-700 hover:bg-blue-800 text-white rounded-md transition duration-200">
                            <i class="fab fa-linkedin-in"></i>
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Utility Functions
        function generateRandomId() {
            return Math.random().toString(36).substring(2, 15);
        }

        function formatDate(date) {
            if (!date) return '';
            const options = { year: 'numeric', month: 'short', day: 'numeric' };
            return new Date(date).toLocaleDateString(undefined, options);
        }

        function formatDateTime(date) {
            if (!date) return '';
            const options = { year: 'numeric', month: 'short', day: 'numeric', hour: '2-digit', minute: '2-digit' };
            return new Date(date).toLocaleDateString(undefined, options);
        }

        function formatTime(seconds) {
            const hours = Math.floor(seconds / 3600);
            const minutes = Math.floor((seconds % 3600) / 60);
            const secs = seconds % 60;
            return `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;
        }

        function getDaysUntil(dateString) {
            const today = new Date();
            today.setHours(0, 0, 0, 0);
            const dueDate = new Date(dateString);
            dueDate.setHours(0, 0, 0, 0);
            const timeDiff = dueDate.getTime() - today.getTime();
            return Math.ceil(timeDiff / (1000 * 3600 * 24));
        }

        // Random Data Generators
        function generateRandomUser() {
            const firstNames = ['John', 'Jane', 'Michael', 'Sarah', 'David', 'Emily', 'Robert', 'Olivia', 'James', 'Emma'];
            const lastNames = ['Smith', 'Johnson', 'Williams', 'Brown', 'Jones', 'Garcia', 'Miller', 'Davis', 'Martinez', 'Taylor'];
            const roles = ['Manager', 'Admin', 'Staff', 'Customer'];
            const firstName = firstNames[Math.floor(Math.random() * firstNames.length)];
            const lastName = lastNames[Math.floor(Math.random() * lastNames.length)];
            const role = roles[Math.floor(Math.random() * roles.length)];
            const email = `${firstName.toLowerCase()}.${lastName.toLowerCase()}@example.com`;
            
            return {
                id: generateRandomId(),
                name: `${firstName} ${lastName}`,
                email: email,
                role: role.toLowerCase(),
                phone: `+1 ${Math.floor(100 + Math.random() * 900)}-${Math.floor(100 + Math.random() * 900)}-${Math.floor(1000 + Math.random() * 9000)}`,
                country: countries[Math.floor(Math.random() * countries.length)].name,
                status: ['online', 'offline', 'break', 'shadow'][Math.floor(Math.random() * 4)],
                profilePic: `https://randomuser.me/api/portraits/${Math.random() > 0.5 ? 'men' : 'women'}/${Math.floor(Math.random() * 70)}.jpg`
            };
        }

        function generateRandomTask() {
            const titles = [
                'Complete project proposal', 'Review marketing materials', 'Prepare presentation slides', 
                'Schedule team meeting', 'Update website content', 'Research competitors', 
                'Develop social media strategy', 'Create monthly report', 'Fix software bug', 
                'Call client for feedback', 'Organize file system', 'Update customer database'
            ];
            
            const categories = ['work', 'personal', 'home', 'health', 'finance'];
            const priorities = ['high', 'medium', 'low'];
            
            const today = new Date();
            const dueDate = new Date(today);
            dueDate.setDate(today.getDate() + Math.floor(Math.random() * 14) - 2); // Due date between 2 days ago and 12 days from now
            
            const createdDate = new Date(today);
            createdDate.setDate(today.getDate() - Math.floor(Math.random() * 5)); // Created 0-4 days ago
            
            const task = {
                id: generateRandomId(),
                title: titles[Math.floor(Math.random() * titles.length)],
                description: 'This is a sample task description. It includes details about what needs to be done.',
                category: categories[Math.floor(Math.random() * categories.length)],
                priority: priorities[Math.floor(Math.random() * priorities.length)],
                dueDate: dueDate.toISOString().split('T')[0],
                createdDate: createdDate.toISOString(),
                assignee: users[Math.floor(Math.random() * users.length)].id,
                completed: Math.random() > 0.7, // 30% chance of being completed
                status: Math.random() > 0.7 ? 'completed' : 'active',
                notes: 'Additional notes about this task.',
                time: Math.floor(Math.random() * 3600), // Time spent on task in seconds
                subtasks: []
            };
            
            // Add 0-3 subtasks
            const numSubtasks = Math.floor(Math.random() * 4);
            for (let i = 0; i < numSubtasks; i++) {
                task.subtasks.push({
                    id: generateRandomId(),
                    title: `Subtask ${i + 1}`,
                    completed: Math.random() > 0.5 // 50% chance of being completed
                });
            }
            
            return task;
        }

        // Countries Array
        const countries = [
            { name: 'United States', code: 'US' },
            { name: 'United Kingdom', code: 'GB' },
            { name: 'Canada', code: 'CA' },
            { name: 'Australia', code: 'AU' },
            { name: 'Germany', code: 'DE' },
            { name: 'France', code: 'FR' },
            { name: 'Japan', code: 'JP' },
            { name: 'China', code: 'CN' },
            { name: 'India', code: 'IN' },
            { name: 'Brazil', code: 'BR' },
            { name: 'Mexico', code: 'MX' },
            { name: 'South Africa', code: 'ZA' },
            { name: 'Spain', code: 'ES' },
            { name: 'Italy', code: 'IT' },
            { name: 'Russia', code: 'RU' }
        ];

        // Data Storage
        let currentUser = null;
        let users = [];
        let tasks = [];
        let notifications = [];
        
        // Task History for Undo/Redo
        let taskHistory = [];
        let historyIndex = -1;
        
        // Timer Variables
        let workTimer = {
            startTime: null,
            elapsed: 0,
            status: 'offline',
            intervalId: null
        };
        
        let taskTimers = {};

        // Dark Mode Toggle
        function initializeDarkMode() {
            const darkModeToggle = document.getElementById('darkModeToggle');
            
            // Check for system preference
            if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
                document.documentElement.classList.add('dark');
                document.body.classList.add('dark');
                darkModeToggle.checked = true;
            }
            
            // Listen for changes to system preference
            window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', event => {
                if (event.matches) {
                    document.documentElement.classList.add('dark');
                    document.body.classList.add('dark');
                    darkModeToggle.checked = true;
                } else {
                    document.documentElement.classList.remove('dark');
                    document.body.classList.remove('dark');
                    darkModeToggle.checked = false;
                }
            });
            
            // Toggle handler
            darkModeToggle.addEventListener('change', function() {
                if (this.checked) {
                    document.documentElement.classList.add('dark');
                    document.body.classList.add('dark');
                } else {
                    document.documentElement.classList.remove('dark');
                    document.body.classList.remove('dark');
                }
                
                // Save preference
                localStorage.setItem('darkMode', this.checked ? 'dark' : 'light');
            });
            
            // Apply saved preference
            const savedMode = localStorage.getItem('darkMode');
            if (savedMode === 'dark') {
                document.documentElement.classList.add('dark');
                document.body.classList.add('dark');
                darkModeToggle.checked = true;
            } else if (savedMode === 'light') {
                document.documentElement.classList.remove('dark');
                document.body.classList.remove('dark');
                darkModeToggle.checked = false;
            }
        }

        // Work Timer Functions
        function startWorkTimer() {
            if (workTimer.intervalId) {
                clearInterval(workTimer.intervalId);
            }
            
            if (!workTimer.startTime) {
                workTimer.startTime = new Date();
            }
            
            workTimer.intervalId = setInterval(() => {
                const now = new Date();
                workTimer.elapsed = Math.floor((now - workTimer.startTime) / 1000);
                document.getElementById('workTimer').textContent = formatTime(workTimer.elapsed);
            }, 1000);
        }
        
        function pauseWorkTimer() {
            if (workTimer.intervalId) {
                clearInterval(workTimer.intervalId);
                workTimer.intervalId = null;
            }
        }
        
        function resetWorkTimer() {
            pauseWorkTimer();
            workTimer.startTime = new Date();
            workTimer.elapsed = 0;
            document.getElementById('workTimer').textContent = formatTime(0);
        }
        
        function updateWorkTimer(status) {
            workTimer.status = status;
            
            if (status === 'online') {
                startWorkTimer();
            } else {
                pauseWorkTimer();
            }
            
            // Update profile picture border
            const profilePic = document.getElementById('profilePic');
            profilePic.className = profilePic.className.replace(/status-\w+/, `status-${status === 'online' ? 'online' : status === 'offline' ? 'offline' : status === 'break' ? 'break' : 'shadow'}`);
            
            // Also update modal profile pic if visible
            const modalPic = document.getElementById('profileModalPic');
            if (modalPic) {
                modalPic.className = modalPic.className.replace(/status-\w+/, `status-${status === 'online' ? 'online' : status === 'offline' ? 'offline' : status === 'break' ? 'break' : 'shadow'}`);
            }
        }

        // Task Timer Functions
        function startTaskTimer(taskId) {
            if (!taskTimers[taskId]) {
                taskTimers[taskId] = {
                    startTime: new Date(),
                    elapsed: 0,
                    intervalId: null
                };
            } else if (taskTimers[taskId].intervalId) {
                // Already running
                return;
            }
            
            taskTimers[taskId].intervalId = setInterval(() => {
                const timer = taskTimers[taskId];
                const now = new Date();
                timer.elapsed = Math.floor((now - timer.startTime) / 1000);
                
                // Update timer display if exists
                const timerElement = document.querySelector(`#task-${taskId} .task-timer`);
                if (timerElement) {
                    timerElement.textContent = formatTime(timer.elapsed);
                }
                
                // Also update the task object
                const taskIndex = tasks.findIndex(t => t.id === taskId);
                if (taskIndex !== -1) {
                    tasks[taskIndex].time = timer.elapsed;
                    saveTasksToStorage();
                }
            }, 1000);
        }
        
        function pauseTaskTimer(taskId) {
            if (taskTimers[taskId] && taskTimers[taskId].intervalId) {
                clearInterval(taskTimers[taskId].intervalId);
                taskTimers[taskId].intervalId = null;
            }
        }

        // Data Storage Functions
        function saveToStorage() {
            localStorage.setItem('currentUser', JSON.stringify(currentUser));
            localStorage.setItem('users', JSON.stringify(users));
            localStorage.setItem('tasks', JSON.stringify(tasks));
            localStorage.setItem('notifications', JSON.stringify(notifications));
            localStorage.setItem('workTimer', JSON.stringify({
                startTime: workTimer.startTime ? workTimer.startTime.toISOString() : null,
                elapsed: workTimer.elapsed,
                status: workTimer.status
            }));
        }
        
        function saveTasksToStorage() {
            localStorage.setItem('tasks', JSON.stringify(tasks));
            updateTaskCounts();
        }
        
        function loadFromStorage() {
            const storedCurrentUser = localStorage.getItem('currentUser');
            const storedUsers = localStorage.getItem('users');
            const storedTasks = localStorage.getItem('tasks');
            const storedNotifications = localStorage.getItem('notifications');
            const storedWorkTimer = localStorage.getItem('workTimer');
            
            if (storedCurrentUser) {
                currentUser = JSON.parse(storedCurrentUser);
            }
            
            if (storedUsers) {
                users = JSON.parse(storedUsers);
            } else {
                // Generate random users if none exist
                users = Array.from({ length: 10 }, generateRandomUser);
            }
            
            if (storedTasks) {
                tasks = JSON.parse(storedTasks);
            } else {
                // Generate random tasks if none exist
                tasks = Array.from({ length: 12 }, generateRandomTask);
            }
            
            if (storedNotifications) {
                notifications = JSON.parse(storedNotifications);
            } else {
                // Generate random notifications
                notifications = [
                    {
                        id: generateRandomId(),
                        message: 'Task "Redesign Homepage" is due soon',
                        date: new Date(Date.now() - 2 * 60 * 60 * 1000).toISOString(),
                        read: false
                    },
                    {
                        id: generateRandomId(),
                        message: 'John assigned you a new task',
                        date: new Date(Date.now() - 24 * 60 * 60 * 1000).toISOString(),
                        read: false
                    },
                    {
                        id: generateRandomId(),
                        message: 'Your account was successfully created',
                        date: new Date(Date.now() - 3 * 24 * 60 * 60 * 1000).toISOString(),
                        read: false
                    }
                ];
            }
            
            if (storedWorkTimer) {
                const timerData = JSON.parse(storedWorkTimer);
                workTimer.elapsed = timerData.elapsed || 0;
                workTimer.status = timerData.status || 'offline';
                if (timerData.startTime) {
                    workTimer.startTime = new Date(timerData.startTime);
                }
                
                // Update timer display
                document.getElementById('workTimer').textContent = formatTime(workTimer.elapsed);
                
                // If status is online, restart timer
                if (workTimer.status === 'online') {
                    startWorkTimer();
                }
                
                // Update profile picture border
                updateWorkTimer(workTimer.status);
            }
        }

        // Auth Functions
        function setupAuthPages() {
            const showRegister = document.getElementById('showRegister');
            const showLogin = document.getElementById('showLogin');
            const loginPage = document.getElementById('loginPage');
            const registerPage = document.getElementById('registerPage');
            const loginForm = document.getElementById('loginForm');
            const registerForm = document.getElementById('registerForm');
            
            // Populate country dropdown
            const regCountry = document.getElementById('regCountry');
            countries.forEach(country => {
                const option = document.createElement('option');
                option.value = country.code;
                option.textContent = country.name;
                regCountry.appendChild(option);
            });
            
            // Switch between login and register
            showRegister.addEventListener('click', (e) => {
                e.preventDefault();
                loginPage.classList.add('hidden');
                registerPage.classList.remove('hidden');
            });
            
            showLogin.addEventListener('click', (e) => {
                e.preventDefault();
                registerPage.classList.add('hidden');
                loginPage.classList.remove('hidden');
            });
            
            // Handle login
            loginForm.addEventListener('submit', (e) => {
                e.preventDefault();
                const email = document.getElementById('loginEmail').value;
                const password = document.getElementById('loginPassword').value;
                
                const user = users.find(u => u.email === email && u.password === password);
                
                if (user) {
                    currentUser = user;
                    saveToStorage();
                    showApp();
                } else {
                    alert('Invalid email or password. Please try again.');
                }
            });
            
            // Handle registration
            registerForm.addEventListener('submit', (e) => {
                e.preventDefault();
                
                const name = document.getElementById('regName').value;
                const email = document.getElementById('regEmail').value;
                const emailConfirm = document.getElementById('regEmailConfirm').value;
                const password = document.getElementById('regPassword').value;
                const passwordConfirm = document.getElementById('regPasswordConfirm').value;
                const phone = document.getElementById('regPhone').value;
                const country = document.getElementById('regCountry').value;
                const role = document.getElementById('regRole').value;
                
                // Basic validation
                if (email !== emailConfirm) {
                    alert('Emails do not match.');
                    return;
                }
                
                if (password !== passwordConfirm) {
                    alert('Passwords do not match.');
                    return;
                }
                
                if (users.some(u => u.email === email)) {
                    alert('Email already exists. Please use a different email.');
                    return;
                }
                
                // Create new user
                const newUser = {
                    id: generateRandomId(),
                    name,
                    email,
                    password,
                    phone,
                    country,
                    role,
                    status: 'online',
                    profilePic: `https://randomuser.me/api/portraits/${Math.random() > 0.5 ? 'men' : 'women'}/${Math.floor(Math.random() * 70)}.jpg`
                };
                
                users.push(newUser);
                currentUser = newUser;
                saveToStorage();
                showApp();
            });
        }
        
        function showAuth() {
            document.getElementById('authPages').style.display = 'flex';
            document.getElementById('appContainer').classList.add('hidden');
        }
        
        function showApp() {
            document.getElementById('authPages').style.display = 'none';
            document.getElementById('appContainer').classList.remove('hidden');
            
            // Update user info in the UI
            updateUserInfo();
            
            // Start timer if user is online
            if (currentUser.status === 'online') {
                updateWorkTimer('online');
            }
            
            // Update tasks display
            renderTasks();
            
            // Update notification badge
            updateNotificationBadge();
        }
        
        function updateUserInfo() {
            if (!currentUser) return;
            
            // Update profile elements
            document.getElementById('profileName').textContent = currentUser.name;
            document.getElementById('profileEmail').textContent = currentUser.email;
            
            // Update profile picture
            const profileImage = document.getElementById('profileImage');
            profileImage.src = currentUser.profilePic;
            
            // Update profile picture status
            updateWorkTimer(currentUser.status);
        }
        
        function logout() {
            pauseWorkTimer();
            currentUser = null;
            saveToStorage();
            showAuth();
        }

        // UI Functions
        function setupModalHandlers() {
            // Close modal buttons
            document.querySelectorAll('.close-modal').forEach(button => {
                button.addEventListener('click', () => {
                    document.querySelectorAll('.modal-backdrop.active').forEach(modal => {
                        modal.classList.remove('active');
                    });
                });
            });
            
            // Close modal when clicking outside
            document.querySelectorAll('.modal-backdrop').forEach(modal => {
                modal.addEventListener('click', (e) => {
                    if (e.target === modal) {
                        modal.classList.remove('active');
                    }
                });
            });
        }
        
        function openModal(modalId) {
            const modal = document.getElementById(modalId);
            if (modal) {
                modal.classList.add('active');
            }
        }
        
        function closeAllModals() {
            document.querySelectorAll('.modal-backdrop').forEach(modal => {
                modal.classList.remove('active');
            });
        }
        
        function toggleDropdown(dropdownId) {
            const dropdown = document.getElementById(dropdownId);
            if (dropdown) {
                dropdown.classList.toggle('active');
            }
            
            // Close other dropdowns
            document.querySelectorAll('.dropdown-menu.active').forEach(menu => {
                if (menu.id !== dropdownId) {
                    menu.classList.remove('active');
                }
            });
        }
        
        function setupProfileDropdown() {
            const profileBtn = document.getElementById('profileBtn');
            const profileDropdown = document.getElementById('profileDropdown');
            const viewProfileBtn = document.getElementById('viewProfileBtn');
            const logoutBtn = document.getElementById('logoutBtn');
            const statusItems = document.querySelectorAll('.status-item');
            
            profileBtn.addEventListener('click', () => {
                toggleDropdown('profileDropdown');
            });
            
            // Close dropdown when clicking outside
            document.addEventListener('click', (e) => {
                if (!profileBtn.contains(e.target) && !profileDropdown.contains(e.target)) {
                    profileDropdown.classList.remove('active');
                }
            });
            
            viewProfileBtn.addEventListener('click', () => {
                profileDropdown.classList.remove('active');
                openModal('profileModal');
                populateProfileModal();
            });
            
            logoutBtn.addEventListener('click', () => {
                logout();
            });
            
            statusItems.forEach(item => {
                item.addEventListener('click', () => {
                    const status = item.getAttribute('data-status');
                    if (currentUser) {
                        currentUser.status = status;
                        saveToStorage();
                        updateWorkTimer(status);
                    }
                    profileDropdown.classList.remove('active');
                });
            });
        }
        
        function setupNotifications() {
            const notificationBtn = document.getElementById('notificationBtn');
            const notificationDropdown = document.getElementById('notificationDropdown');
            
            notificationBtn.addEventListener('click', () => {
                toggleDropdown('notificationDropdown');
            });
            
            // Close dropdown when clicking outside
            document.addEventListener('click', (e) => {
                if (!notificationBtn.contains(e.target) && !notificationDropdown.contains(e.target)) {
                    notificationDropdown.classList.remove('active');
                }
            });
            
            // Mark notification as read when clicked
            document.getElementById('notificationList').addEventListener('click', (e) => {
                const notificationItem = e.target.closest('.notification-item');
                if (notificationItem) {
                    const index = Array.from(notificationItem.parentNode.children).indexOf(notificationItem);
                    if (notifications[index]) {
                        notifications[index].read = true;
                        saveToStorage();
                        updateNotificationBadge();
                        notificationItem.style.opacity = '0.6';
                    }
                }
            });
        }
        
        function updateNotificationBadge() {
            const unreadCount = notifications.filter(n => !n.read).length;
            const badge = document.getElementById('notificationBadge');
            
            if (unreadCount > 0) {
                badge.textContent = unreadCount;
                badge.style.display = 'flex';
            } else {
                badge.style.display = 'none';
            }
        }
        
        function populateProfileModal() {
            if (!currentUser) return;
            
            // Set profile image
            document.getElementById('profileModalImage').src = currentUser.profilePic;
            
            // Set status border
            const profileModalPic = document.getElementById('profileModalPic');
            profileModalPic.className = profileModalPic.className.replace(/status-\w+/, `status-${currentUser.status === 'online' ? 'online' : currentUser.status === 'offline' ? 'offline' : currentUser.status === 'break' ? 'break' : 'shadow'}`);
            
            // Set user info
            document.getElementById('profileModalName').textContent = currentUser.name;
            document.getElementById('profileModalRole').textContent = currentUser.role.charAt(0).toUpperCase() + currentUser.role.slice(1);
            
            // Populate form fields
            document.getElementById('profileName').value = currentUser.name;
            document.getElementById('profileEmailInput').value = currentUser.email;
            document.getElementById('profilePhone').value = currentUser.phone;
            
            // Populate country dropdown
            const profileCountry = document.getElementById('profileCountry');
            profileCountry.innerHTML = '';
            countries.forEach(country => {
                const option = document.createElement('option');
                option.value = country.code;
                option.textContent = country.name;
                if (country.name === currentUser.country) {
                    option.selected = true;
                }
                profileCountry.appendChild(option);
            });
            
            // Set role
            document.getElementById('profileRole').value = currentUser.role;
        }
        
        function setupProfileModal() {
            const changeProfilePicBtn = document.getElementById('changeProfilePicBtn');
            const profilePicInput = document.getElementById('profilePicInput');
            const saveProfileBtn = document.getElementById('saveProfileBtn');
            
            changeProfilePicBtn.addEventListener('click', () => {
                profilePicInput.click();
            });
            
            profilePicInput.addEventListener('change', (e) => {
                const file = e.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = function(event) {
                        document.getElementById('profileModalImage').src = event.target.result;
                    };
                    reader.readAsDataURL(file);
                }
            });
            
            saveProfileBtn.addEventListener('click', () => {
                if (!currentUser) return;
                
                // Update user info
                currentUser.name = document.getElementById('profileName').value;
                currentUser.email = document.getElementById('profileEmailInput').value;
                currentUser.phone = document.getElementById('profilePhone').value;
                const countrySelect = document.getElementById('profileCountry');
                currentUser.country = countries.find(c => c.code === countrySelect.value)?.name || currentUser.country;
                currentUser.role = document.getElementById('profileRole').value;
                
                // Update profile picture if changed
                const newProfilePic = document.getElementById('profileModalImage').src;
                if (newProfilePic !== currentUser.profilePic) {
                    currentUser.profilePic = newProfilePic;
                }
                
                // Save changes
                saveToStorage();
                
                // Update UI
                updateUserInfo();
                
                // Close modal
                closeAllModals();
            });
        }
        
        function setupViewToggles() {
            const listViewBtn = document.getElementById('listViewBtn');
            const graphViewBtn = document.getElementById('graphViewBtn');
            const taskListView = document.getElementById('taskListView');
            const taskGraphView = document.getElementById('taskGraphView');
            
            listViewBtn.addEventListener('click', () => {
                // Update buttons
                listViewBtn.classList.add('bg-primary', 'text-white');
                listViewBtn.classList.remove('text-gray-700', 'dark:text-gray-300');
                graphViewBtn.classList.remove('bg-primary', 'text-white');
                graphViewBtn.classList.add('text-gray-700', 'dark:text-gray-300');
                
                // Show/hide views
                taskListView.classList.remove('hidden');
                taskGraphView.classList.add('hidden');
            });
            
            graphViewBtn.addEventListener('click', () => {
                // Update buttons
                graphViewBtn.classList.add('bg-primary', 'text-white');
                graphViewBtn.classList.remove('text-gray-700', 'dark:text-gray-300');
                listViewBtn.classList.remove('bg-primary', 'text-white');
                listViewBtn.classList.add('text-gray-700', 'dark:text-gray-300');
                
                // Show/hide views
                taskListView.classList.add('hidden');
                taskGraphView.classList.remove('hidden');
                
                // Update charts
                updateCharts();
            });
        }

        // Task Management Functions
        function renderTasks() {
            const taskList = document.getElementById('taskList');
            const emptyTaskList = document.getElementById('emptyTaskList');
            const filters = getTaskFilters();
            
            // Filter tasks
            let filteredTasks = tasks.filter(task => {
                // Search filter
                const searchTerm = filters.search.toLowerCase();
                if (searchTerm && !task.title.toLowerCase().includes(searchTerm) && 
                    !task.description.toLowerCase().includes(searchTerm)) {
                    return false;
                }
                
                // Category filter
                if (filters.category && task.category !== filters.category) {
                    return false;
                }
                
                // Priority filter
                if (filters.priority && task.priority !== filters.priority) {
                    return false;
                }
                
                // Status filter
                if (filters.status && task.status !== filters.status) {
                    return false;
                }
                
                // Date filter
                if (filters.dateRange) {
                    const taskDate = new Date(task.dueDate);
                    if (filters.dateRange.start && taskDate < filters.dateRange.start) {
                        return false;
                    }
                    if (filters.dateRange.end && taskDate > filters.dateRange.end) {
                        return false;
                    }
                }
                
                return true;
            });
            
            // Sort tasks
            filteredTasks = sortTasks(filteredTasks, filters.sort);
            
            // Clear task list
            taskList.innerHTML = '';
            
            // Show/hide empty state
            if (filteredTasks.length === 0) {
                emptyTaskList.classList.remove('hidden');
            } else {
                emptyTaskList.classList.add('hidden');
                
                // Render tasks
                filteredTasks.forEach(task => {
                    const taskElement = createTaskElement(task);
                    taskList.appendChild(taskElement);
                });
            }
            
            // Update task counts
            updateTaskCounts();
        }
        
        function getTaskFilters() {
            const searchInput = document.getElementById('taskSearch');
            const categoryFilter = document.getElementById('categoryFilter');
            const priorityFilter = document.getElementById('priorityFilter');
            const statusFilter = document.getElementById('statusFilter');
            const dateFilter = document.getElementById('dateFilter');
            const sortFilter = document.getElementById('sortTasks');
            
            let dateRange = null;
            
            // Handle date filter
            if (dateFilter.value === 'today') {
                const today = new Date();
                today.setHours(0, 0, 0, 0);
                const tomorrow = new Date(today);
                tomorrow.setDate(tomorrow.getDate() + 1);
                dateRange = { start: today, end: tomorrow };
            } else if (dateFilter.value === 'week') {
                const today = new Date();
                today.setHours(0, 0, 0, 0);
                const nextWeek = new Date(today);
                nextWeek.setDate(nextWeek.getDate() + 7);
                dateRange = { start: today, end: nextWeek };
            } else if (dateFilter.value === 'month') {
                const today = new Date();
                today.setHours(0, 0, 0, 0);
                const nextMonth = new Date(today);
                nextMonth.setMonth(nextMonth.getMonth() + 1);
                dateRange = { start: today, end: nextMonth };
            } else if (dateFilter.value === 'custom') {
                const startDate = document.getElementById('startDate').value;
                const endDate = document.getElementById('endDate').value;
                
                if (startDate) {
                    const start = new Date(startDate);
                    start.setHours(0, 0, 0, 0);
                    
                    if (!dateRange) dateRange = {};
                    dateRange.start = start;
                }
                
                if (endDate) {
                    const end = new Date(endDate);
                    end.setHours(23, 59, 59, 999);
                    
                    if (!dateRange) dateRange = {};
                    dateRange.end = end;
                }
            }
            
            return {
                search: searchInput.value,
                category: categoryFilter.value,
                priority: priorityFilter.value,
                status: statusFilter.value,
                dateRange: dateRange,
                sort: sortFilter.value
            };
        }
        
        function sortTasks(tasks, sortBy) {
            if (sortBy === 'dueDate') {
                return [...tasks].sort((a, b) => new Date(a.dueDate) - new Date(b.dueDate));
            } else if (sortBy === 'priority') {
                const priorityWeight = { high: 0, medium: 1, low: 2 };
                return [...tasks].sort((a, b) => priorityWeight[a.priority] - priorityWeight[b.priority]);
            } else if (sortBy === 'title') {
                return [...tasks].sort((a, b) => a.title.localeCompare(b.title));
            } else if (sortBy === 'dateCreated') {
                return [...tasks].sort((a, b) => new Date(b.createdDate) - new Date(a.createdDate));
            }
            
            return tasks;
        }
        
        function createTaskElement(task) {
            const taskElement = document.createElement('div');
            taskElement.id = `task-${task.id}`;
            taskElement.className = `task-card ${task.completed ? 'completed' : ''} priority-${task.priority} bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 draggable`;
            taskElement.setAttribute('data-id', task.id);
            taskElement.setAttribute('draggable', 'true');
            
            // Calculate days until due
            const daysUntil = getDaysUntil(task.dueDate);
            let dueDateClass = '';
            let dueDateIcon = '';
            
            if (daysUntil < 0) {
                dueDateClass = 'text-red-600 dark:text-red-400';
                dueDateIcon = '<i class="fas fa-exclamation-circle mr-1"></i>';
            } else if (daysUntil <= 2) {
                dueDateClass = 'text-yellow-600 dark:text-yellow-400';
                dueDateIcon = '<i class="fas fa-exclamation-triangle mr-1"></i>';
            } else {
                dueDateClass = 'text-green-600 dark:text-green-400';
                dueDateIcon = '<i class="fas fa-calendar-check mr-1"></i>';
            }
            
            // Find assignee
            const assignee = users.find(u => u.id === task.assignee) || {};
            
            taskElement.innerHTML = `
                <div class="flex items-center p-4">
                    <div class="mr-4">
                        <input type="checkbox" class="task-checkbox h-5 w-5 rounded text-primary focus:ring-primary" 
                            ${task.completed ? 'checked' : ''}>
                    </div>
                    <div class="flex-grow">
                        <div class="flex flex-wrap justify-between mb-1">
                            <h3 class="font-medium ${task.completed ? 'line-through text-gray-500 dark:text-gray-400' : ''}">${task.title}</h3>
                            <div class="task-select-overlay hidden absolute inset-0 bg-primary bg-opacity-10 dark:bg-opacity-20 flex items-center justify-center">
                                <div class="bg-white dark:bg-gray-800 rounded-full p-1">
                                    <i class="fas fa-check text-primary"></i>
                                </div>
                            </div>
                        </div>
                        <p class="text-sm text-gray-600 dark:text-gray-400 line-clamp-2">${task.description}</p>
                        <div class="flex flex-wrap items-center mt-2 text-xs">
                            <span class="mr-3 capitalize bg-gray-100 dark:bg-gray-700 px-2 py-1 rounded-full">${task.category}</span>
                            <span class="mr-3 ${dueDateClass}">${dueDateIcon}${formatDate(task.dueDate)}</span>
                            <span class="task-timer mr-3 text-gray-500 dark:text-gray-400">
                                <i class="fas fa-clock mr-1"></i>${formatTime(task.time || 0)}
                            </span>
                        </div>
                    </div>
                    <div class="ml-4 flex items-center space-x-2">
                        <button class="task-timer-toggle p-1 text-gray-500 hover:text-primary dark:text-gray-400 dark:hover:text-primary-hover transition duration-200" title="Start/pause timer">
                            <i class="fas ${taskTimers[task.id]?.intervalId ? 'fa-pause' : 'fa-play'}"></i>
                        </button>
                        <button class="task-share p-1 text-gray-500 hover:text-primary dark:text-gray-400 dark:hover:text-primary-hover transition duration-200" title="Share task">
                            <i class="fas fa-share-alt"></i>
                        </button>
                        <div class="h-8 w-8 rounded-full overflow-hidden" title="${assignee.name || 'Unassigned'}">
                            <img src="${assignee.profilePic || 'https://randomuser.me/api/portraits/lego/1.jpg'}" alt="${assignee.name || 'Unassigned'}" class="h-full w-full object-cover">
                        </div>
                    </div>
                </div>
            `;
            
            // Add event listeners
            const checkbox = taskElement.querySelector('.task-checkbox');
            checkbox.addEventListener('change', () => {
                toggleTaskCompletion(task.id);
            });
            
            taskElement.addEventListener('click', (e) => {
                if (!e.target.closest('.task-checkbox') && 
                    !e.target.closest('.task-timer-toggle') && 
                    !e.target.closest('.task-share')) {
                    openTaskDetails(task.id);
                }
            });
            
            const timerToggle = taskElement.querySelector('.task-timer-toggle');
            timerToggle.addEventListener('click', () => {
                toggleTaskTimer(task.id);
            });
            
            const shareBtn = taskElement.querySelector('.task-share');
            shareBtn.addEventListener('click', () => {
                openShareTaskModal(task.id);
            });
            
            // Drag and drop event listeners
            taskElement.addEventListener('dragstart', (e) => {
                e.dataTransfer.setData('text/plain', task.id);
                taskElement.classList.add('opacity-50');
            });
            
            taskElement.addEventListener('dragend', () => {
                taskElement.classList.remove('opacity-50');
                document.querySelectorAll('.drag-over').forEach(el => el.classList.remove('drag-over'));
            });
            
            taskElement.addEventListener('dragover', (e) => {
                e.preventDefault();
                taskElement.classList.add('drag-over');
            });
            
            taskElement.addEventListener('dragleave', () => {
                taskElement.classList.remove('drag-over');
            });
            
            taskElement.addEventListener('drop', (e) => {
                e.preventDefault();
                taskElement.classList.remove('drag-over');
                const draggedId = e.dataTransfer.getData('text/plain');
                reorderTasks(draggedId, task.id);
            });
            
            // Multi-select handling
            taskElement.addEventListener('mousedown', (e) => {
                if (e.ctrlKey || e.metaKey) {
                    e.preventDefault();
                    toggleTaskSelection(task.id);
                }
            });
            
            return taskElement;
        }
        
        function updateTaskCounts() {
            const totalCount = tasks.length;
            const completedCount = tasks.filter(t => t.completed).length;
            const pendingCount = totalCount - completedCount;
            
            document.getElementById('totalTasksCount').textContent = totalCount;
            document.getElementById('completedTasksCount').textContent = completedCount;
            document.getElementById('pendingTasksCount').textContent = pendingCount;
            
            // Update insights data
            updateInsightsData();
        }
        
        function toggleTaskCompletion(taskId) {
            const taskIndex = tasks.findIndex(t => t.id === taskId);
            if (taskIndex !== -1) {
                // Save state for undo
                saveTaskStateForUndo();
                
                // Update task
                tasks[taskIndex].completed = !tasks[taskIndex].completed;
                tasks[taskIndex].status = tasks[taskIndex].completed ? 'completed' : 'active';
                
                // Update UI
                const taskElement = document.getElementById(`task-${taskId}`);
                if (taskElement) {
                    if (tasks[taskIndex].completed) {
                        taskElement.classList.add('completed');
                        taskElement.querySelector('h3').classList.add('line-through', 'text-gray-500', 'dark:text-gray-400');
                    } else {
                        taskElement.classList.remove('completed');
                        taskElement.querySelector('h3').classList.remove('line-through', 'text-gray-500', 'dark:text-gray-400');
                    }
                }
                
                // Save changes
                saveTasksToStorage();
            }
        }
        
        function toggleTaskTimer(taskId) {
            const taskIndex = tasks.findIndex(t => t.id === taskId);
            if (taskIndex === -1) return;
            
            const task = tasks[taskIndex];
            const timerButton = document.querySelector(`#task-${taskId} .task-timer-toggle i`);
            
            if (taskTimers[taskId]?.intervalId) {
                // Pause timer
                pauseTaskTimer(taskId);
                timerButton.classList.remove('fa-pause');
                timerButton.classList.add('fa-play');
            } else {
                // Start timer
                startTaskTimer(taskId);
                timerButton.classList.remove('fa-play');
                timerButton.classList.add('fa-pause');
            }
        }
        
        function openTaskDetails(taskId) {
            const task = tasks.find(t => t.id === taskId);
            if (!task) return;
            
            // Populate task details
            document.getElementById('taskDetailsTitle').textContent = 'Task Details';
            document.getElementById('taskDetailsName').textContent = task.title;
            document.getElementById('taskDetailsDescription').textContent = task.description || 'No description provided.';
            
            // Priority badge
            const priorityBadge = document.getElementById('taskDetailsPriority');
            priorityBadge.textContent = `${task.priority.charAt(0).toUpperCase() + task.priority.slice(1)} Priority`;
            priorityBadge.className = 'inline-block px-2 py-1 text-xs font-medium rounded-full text-white';
            
            if (task.priority === 'high') {
                priorityBadge.classList.add('bg-red-500');
            } else if (task.priority === 'medium') {
                priorityBadge.classList.add('bg-yellow-500');
            } else {
                priorityBadge.classList.add('bg-gray-500');
            }
            
            // Category & Due Date
            document.getElementById('taskDetailsCategory').textContent = task.category.charAt(0).toUpperCase() + task.category.slice(1);
            document.getElementById('taskDetailsDueDate').textContent = formatDate(task.dueDate);
            
            // Assignee
            const assignee = users.find(u => u.id === task.assignee);
            if (assignee) {
                document.getElementById('taskDetailsAssignee').textContent = assignee.name;
                document.getElementById('taskDetailsAssigneeImg').src = assignee.profilePic;
            } else {
                document.getElementById('taskDetailsAssignee').textContent = 'Unassigned';
                document.getElementById('taskDetailsAssigneeImg').src = 'https://randomuser.me/api/portraits/lego/1.jpg';
            }
            
            // Status
            document.getElementById('taskDetailsStatus').textContent = task.status === 'completed' ? 'Completed' : 'Active';
            
            // Subtasks
            const subtasksContainer = document.getElementById('taskDetailsSubtasks');
            subtasksContainer.innerHTML = '';
            
            if (task.subtasks && task.subtasks.length > 0) {
                task.subtasks.forEach(subtask => {
                    const subtaskElement = document.createElement('div');
                    subtaskElement.className = 'flex items-center';
                    subtaskElement.innerHTML = `
                        <input type="checkbox" class="h-4 w-4 rounded text-primary focus:ring-primary mr-2" 
                            ${subtask.completed ? 'checked' : ''} disabled>
                        <span class="${subtask.completed ? 'line-through text-gray-500 dark:text-gray-400' : ''}">${subtask.title}</span>
                    `;
                    subtasksContainer.appendChild(subtaskElement);
                });
            } else {
                subtasksContainer.innerHTML = '<p class="text-gray-500 dark:text-gray-400">No subtasks</p>';
            }
            
            // Notes
            document.getElementById('taskDetailsNotes').textContent = task.notes || 'No notes provided.';
            
            // Created date
            document.getElementById('taskDetailsCreatedDate').textContent = formatDate(task.createdDate);
            
            // Toggle complete button
            const toggleCompleteBtn = document.getElementById('toggleTaskCompleteBtn');
            if (task.completed) {
                toggleCompleteBtn.innerHTML = '<i class="fas fa-undo mr-1"></i> Mark Incomplete';
                toggleCompleteBtn.classList.remove('bg-green-500', 'hover:bg-green-600');
                toggleCompleteBtn.classList.add('bg-gray-500', 'hover:bg-gray-600');
            } else {
                toggleCompleteBtn.innerHTML = '<i class="fas fa-check mr-1"></i> Mark Complete';
                toggleCompleteBtn.classList.remove('bg-gray-500', 'hover:bg-gray-600');
                toggleCompleteBtn.classList.add('bg-green-500', 'hover:bg-green-600');
            }
            
            // Setup event listeners
            document.getElementById('toggleTaskCompleteBtn').onclick = () => {
                toggleTaskCompletion(taskId);
                closeAllModals();
            };
            
            document.getElementById('deleteTaskBtn').onclick = () => {
                deleteTask(taskId);
                closeAllModals();
            };
            
            document.getElementById('editTaskBtn').onclick = () => {
                openEditTaskModal(taskId);
            };
            
            document.getElementById('shareTaskBtn').onclick = () => {
                closeAllModals();
                openShareTaskModal(taskId);
            };
            
            document.getElementById('startTimerBtn').onclick = () => {
                toggleTaskTimer(taskId);
            };
            
            // Open modal
            openModal('taskDetailsModal');
        }
        
        function openShareTaskModal(taskId) {
            const task = tasks.find(t => t.id === taskId);
            if (!task) return;
            
            // Generate fake share link
            document.getElementById('shareTaskLink').value = `https://todo-app.com/tasks/${task.id}`;
            
            // Setup copy button
            document.getElementById('copyLinkBtn').onclick = () => {
                const linkInput = document.getElementById('shareTaskLink');
                linkInput.select();
                document.execCommand('copy');
                
                // Show copied feedback
                const copyBtn = document.getElementById('copyLinkBtn');
                const originalContent = copyBtn.innerHTML;
                copyBtn.innerHTML = '<i class="fas fa-check"></i>';
                setTimeout(() => {
                    copyBtn.innerHTML = originalContent;
                }, 2000);
            };
            
            // Setup send email button
            document.getElementById('sendEmailBtn').onclick = () => {
                const emailInput = document.getElementById('shareEmail');
                if (emailInput.value) {
                    // Show sent feedback
                    const sendBtn = document.getElementById('sendEmailBtn');
                    const originalContent = sendBtn.innerHTML;
                    sendBtn.innerHTML = '<i class="fas fa-check"></i>';
                    setTimeout(() => {
                        sendBtn.innerHTML = originalContent;
                        emailInput.value = '';
                    }, 2000);
                }
            };
            
            // Open modal
            openModal('shareTaskModal');
        }
        
        function setupAddTask() {
            const addTaskBtn = document.getElementById('addTaskBtn');
            const saveTaskBtn = document.getElementById('saveTaskBtn');
            const addSubtaskBtn = document.getElementById('addSubtaskBtn');
            
            addTaskBtn.addEventListener('click', () => {
                // Reset form
                document.getElementById('addTaskForm').reset();
                document.getElementById('subtasksList').innerHTML = '';
                
                // Set due date to tomorrow by default
                const tomorrow = new Date();
                tomorrow.setDate(tomorrow.getDate() + 1);
                document.getElementById('taskDueDate').value = tomorrow.toISOString().split('T')[0];
                
                // Populate assignee dropdown
                const assigneeSelect = document.getElementById('taskAssignee');
                assigneeSelect.innerHTML = '<option value="">Select a user</option>';
                users.forEach(user => {
                    const option = document.createElement('option');
                    option.value = user.id;
                    option.textContent = user.name;
                    assigneeSelect.appendChild(option);
                });
                
                // Open modal
                openModal('addTaskModal');
            });
            
            addSubtaskBtn.addEventListener('click', () => {
                addSubtaskField();
            });
            
            saveTaskBtn.addEventListener('click', () => {
                const title = document.getElementById('taskTitle').value.trim();
                const description = document.getElementById('taskDescription').value.trim();
                const category = document.getElementById('taskCategory').value;
                const priority = document.getElementById('taskPriority').value;
                const dueDate = document.getElementById('taskDueDate').value;
                const assignee = document.getElementById('taskAssignee').value;
                const notes = document.getElementById('taskNotes').value.trim();
                
                // Basic validation
                if (!title || !category || !priority || !dueDate) {
                    alert('Please fill out all required fields.');
                    return;
                }
                
                // Collect subtasks
                const subtaskElements = document.querySelectorAll('.subtask-item');
                const subtasks = Array.from(subtaskElements).map(el => {
                    const input = el.querySelector('input');
                    return {
                        id: generateRandomId(),
                        title: input.value.trim(),
                        completed: false
                    };
                }).filter(subtask => subtask.title);
                
                // Save state for undo
                saveTaskStateForUndo();
                
                // Create new task
                const newTask = {
                    id: generateRandomId(),
                    title,
                    description,
                    category,
                    priority,
                    dueDate,
                    assignee,
                    notes,
                    subtasks,
                    createdDate: new Date().toISOString(),
                    completed: false,
                    status: 'active',
                    time: 0
                };
                
                tasks.unshift(newTask);
                saveTasksToStorage();
                renderTasks();
                
                // Close modal
                closeAllModals();
            });
        }
        
        function addSubtaskField() {
            const subtasksList = document.getElementById('subtasksList');
            const subtaskItem = document.createElement('div');
            subtaskItem.className = 'subtask-item flex items-center mb-2';
            subtaskItem.innerHTML = `
                <input type="text" placeholder="Subtask" class="flex-grow px-3 py-1 border border-gray-300 dark:border-gray-600 rounded-md focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent dark:bg-gray-700 dark:text-white text-sm">
                <button type="button" class="remove-subtask ml-2 text-red-500 hover:text-red-700">
                    <i class="fas fa-times"></i>
                </button>
            `;
            
            subtasksList.appendChild(subtaskItem);
            
            // Add event listener to remove button
            const removeBtn = subtaskItem.querySelector('.remove-subtask');
            removeBtn.addEventListener('click', () => {
                subtaskItem.remove();
            });
            
            // Focus the input
            subtaskItem.querySelector('input').focus();
        }
        
        function openEditTaskModal(taskId) {
            const task = tasks.find(t => t.id === taskId);
            if (!task) return;
            
            // Close task details modal
            closeAllModals();
            
            // Reset form
            document.getElementById('addTaskForm').reset();
            document.getElementById('subtasksList').innerHTML = '';
            
            // Populate form with task data
            document.getElementById('taskTitle').value = task.title;
            document.getElementById('taskDescription').value = task.description || '';
            document.getElementById('taskCategory').value = task.category;
            document.getElementById('taskPriority').value = task.priority;
            document.getElementById('taskDueDate').value = task.dueDate;
            document.getElementById('taskNotes').value = task.notes || '';
            
            // Populate assignee dropdown
            const assigneeSelect = document.getElementById('taskAssignee');
            assigneeSelect.innerHTML = '<option value="">Select a user</option>';
            users.forEach(user => {
                const option = document.createElement('option');
                option.value = user.id;
                option.textContent = user.name;
                if (user.id === task.assignee) {
                    option.selected = true;
                }
                assigneeSelect.appendChild(option);
            });
            
            // Add subtasks
            if (task.subtasks && task.subtasks.length > 0) {
                task.subtasks.forEach(subtask => {
                    const subtaskItem = document.createElement('div');
                    subtaskItem.className = 'subtask-item flex items-center mb-2';
                    subtaskItem.innerHTML = `
                        <input type="text" placeholder="Subtask" value="${subtask.title}" class="flex-grow px-3 py-1 border border-gray-300 dark:border-gray-600 rounded-md focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent dark:bg-gray-700 dark:text-white text-sm">
                        <button type="button" class="remove-subtask ml-2 text-red-500 hover:text-red-700">
                            <i class="fas fa-times"></i>
                        </button>
                    `;
                    
                    document.getElementById('subtasksList').appendChild(subtaskItem);
                    
                    // Add event listener to remove button
                    const removeBtn = subtaskItem.querySelector('.remove-subtask');
                    removeBtn.addEventListener('click', () => {
                        subtaskItem.remove();
                    });
                });
            }
            
            // Update modal title
            document.querySelector('#addTaskModal .modal-content > div:first-child h3').textContent = 'Edit Task';
            
            // Update save button
            const saveTaskBtn = document.getElementById('saveTaskBtn');
            saveTaskBtn.textContent = 'Update Task';
            saveTaskBtn.onclick = () => {
                updateTask(taskId);
            };
            
            // Open modal
            openModal('addTaskModal');
        }
        
        function updateTask(taskId) {
            const taskIndex = tasks.findIndex(t => t.id === taskId);
            if (taskIndex === -1) return;
            
            const title = document.getElementById('taskTitle').value.trim();
            const description = document.getElementById('taskDescription').value.trim();
            const category = document.getElementById('taskCategory').value;
            const priority = document.getElementById('taskPriority').value;
            const dueDate = document.getElementById('taskDueDate').value;
            const assignee = document.getElementById('taskAssignee').value;
            const notes = document.getElementById('taskNotes').value.trim();
            
            // Basic validation
            if (!title || !category || !priority || !dueDate) {
                alert('Please fill out all required fields.');
                return;
            }
            
            // Collect subtasks
            const subtaskElements = document.querySelectorAll('.subtask-item');
            const subtasks = Array.from(subtaskElements).map(el => {
                const input = el.querySelector('input');
                return {
                    id: generateRandomId(),
                    title: input.value.trim(),
                    completed: false
                };
            }).filter(subtask => subtask.title);
            
            // Save state for undo
            saveTaskStateForUndo();
            
            // Update task
            tasks[taskIndex] = {
                ...tasks[taskIndex],
                title,
                description,
                category,
                priority,
                dueDate,
                assignee,
                notes,
                subtasks
            };
            
            saveTasksToStorage();
            renderTasks();
            
            // Reset save button
            const saveTaskBtn = document.getElementById('saveTaskBtn');
            saveTaskBtn.textContent = 'Save Task';
            saveTaskBtn.onclick = () => {
                // Save new task logic
                const title = document.getElementById('taskTitle').value.trim();
                const description = document.getElementById('taskDescription').value.trim();
                const category = document.getElementById('taskCategory').value;
                const priority = document.getElementById('taskPriority').value;
                const dueDate = document.getElementById('taskDueDate').value;
                const assignee = document.getElementById('taskAssignee').value;
                const notes = document.getElementById('taskNotes').value.trim();
                
                // Basic validation
                if (!title || !category || !priority || !dueDate) {
                    alert('Please fill out all required fields.');
                    return;
                }
                
                // Collect subtasks
                const subtaskElements = document.querySelectorAll('.subtask-item');
                const subtasks = Array.from(subtaskElements).map(el => {
                    const input = el.querySelector('input');
                    return {
                        id: generateRandomId(),
                        title: input.value.trim(),
                        completed: false
                    };
                }).filter(subtask => subtask.title);
                
                // Save state for undo
                saveTaskStateForUndo();
                
                // Create new task
                const newTask = {
                    id: generateRandomId(),
                    title,
                    description,
                    category,
                    priority,
                    dueDate,
                    assignee,
                    notes,
                    subtasks,
                    createdDate: new Date().toISOString(),
                    completed: false,
                    status: 'active',
                    time: 0
                };
                
                tasks.unshift(newTask);
                saveTasksToStorage();
                renderTasks();
                
                // Close modal
                closeAllModals();
            };
            
            // Close modal
            closeAllModals();
        }
        
        function deleteTask(taskId) {
            // Save state for undo
            saveTaskStateForUndo();
            
            // Remove task
            tasks = tasks.filter(t => t.id !== taskId);
            saveTasksToStorage();
            renderTasks();
        }
        
        function reorderTasks(draggedId, targetId) {
            if (draggedId === targetId) return;
            
            // Save state for undo
            saveTaskStateForUndo();
            
            const draggedIndex = tasks.findIndex(t => t.id === draggedId);
            const targetIndex = tasks.findIndex(t => t.id === targetId);
            
            if (draggedIndex === -1 || targetIndex === -1) return;
            
            // Remove dragged task
            const [draggedTask] = tasks.splice(draggedIndex, 1);
            
            // Insert at new position
            tasks.splice(targetIndex, 0, draggedTask);
            
            saveTasksToStorage();
            renderTasks();
        }
        
        // Task selection and bulk actions
        let selectedTasks = [];
        
        function toggleTaskSelection(taskId) {
            const index = selectedTasks.indexOf(taskId);
            const taskElement = document.getElementById(`task-${taskId}`);
            
            if (index === -1) {
                selectedTasks.push(taskId);
                taskElement.classList.add('selected-task');
                taskElement.querySelector('.task-select-overlay').classList.remove('hidden');
            } else {
                selectedTasks.splice(index, 1);
                taskElement.classList.remove('selected-task');
                taskElement.querySelector('.task-select-overlay').classList.add('hidden');
            }
            
            updateBulkActionButtons();
        }
        
        function updateBulkActionButtons() {
            const completeSelectedBtn = document.getElementById('completeSelectedBtn');
            const deleteSelectedBtn = document.getElementById('deleteSelectedBtn');
            
            if (selectedTasks.length > 0) {
                completeSelectedBtn.disabled = false;
                deleteSelectedBtn.disabled = false;
            } else {
                completeSelectedBtn.disabled = true;
                deleteSelectedBtn.disabled = true;
            }
        }
        
        function setupBulkActions() {
            const completeSelectedBtn = document.getElementById('completeSelectedBtn');
            const deleteSelectedBtn = document.getElementById('deleteSelectedBtn');
            
            completeSelectedBtn.addEventListener('click', () => {
                if (selectedTasks.length === 0) return;
                
                // Save state for undo
                saveTaskStateForUndo();
                
                // Mark selected tasks as complete
                selectedTasks.forEach(taskId => {
                    const taskIndex = tasks.findIndex(t => t.id === taskId);
                    if (taskIndex !== -1) {
                        tasks[taskIndex].completed = true;
                        tasks[taskIndex].status = 'completed';
                    }
                });
                
                saveTasksToStorage();
                renderTasks();
                
                // Clear selection
                selectedTasks = [];
                updateBulkActionButtons();
            });
            
            deleteSelectedBtn.addEventListener('click', () => {
                if (selectedTasks.length === 0) return;
                
                // Save state for undo
                saveTaskStateForUndo();
                
                // Remove selected tasks
                tasks = tasks.filter(t => !selectedTasks.includes(t.id));
                
                saveTasksToStorage();
                renderTasks();
                
                // Clear selection
                selectedTasks = [];
                updateBulkActionButtons();
            });
        }
        
        // Task history for undo/redo
        function saveTaskStateForUndo() {
            // Trim history if we're not at the end
            if (historyIndex < taskHistory.length - 1) {
                taskHistory = taskHistory.slice(0, historyIndex + 1);
            }
            
            // Add current state to history
            taskHistory.push(JSON.stringify(tasks));
            historyIndex = taskHistory.length - 1;
            
            // Enable/disable buttons
            updateUndoRedoButtons();
        }
        
        function undo() {
            if (historyIndex <= 0) return;
            
            historyIndex--;
            tasks = JSON.parse(taskHistory[historyIndex]);
            saveTasksToStorage();
            renderTasks();
            
            updateUndoRedoButtons();
        }
        
        function redo() {
            if (historyIndex >= taskHistory.length - 1) return;
            
            historyIndex++;
            tasks = JSON.parse(taskHistory[historyIndex]);
            saveTasksToStorage();
            renderTasks();
            
            updateUndoRedoButtons();
        }
        
        function updateUndoRedoButtons() {
            const undoBtn = document.getElementById('undoBtn');
            const redoBtn = document.getElementById('redoBtn');
            
            undoBtn.disabled = historyIndex <= 0;
            redoBtn.disabled = historyIndex >= taskHistory.length - 1;
        }

        // Chart functions
        function updateCharts() {
            updateTaskStatusChart();
            updateTaskPriorityChart();
            updateTaskCategoryChart();
            updateTaskDueDateChart();
            updateTaskTrendChart();
        }
        
        function updateTaskStatusChart() {
            const completedCount = tasks.filter(t => t.completed).length;
            const pendingCount = tasks.length - completedCount;
            
            const ctx = document.getElementById('taskStatusChart').getContext('2d');
            
            // Destroy existing chart if it exists
            if (window.taskStatusChart) {
                window.taskStatusChart.destroy();
            }
            
            window.taskStatusChart = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: ['Completed', 'Pending'],
                    datasets: [{
                        data: [completedCount, pendingCount],
                        backgroundColor: ['#10B981', '#F59E0B'],
                        borderWidth: 0
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    cutout: '70%',
                    plugins: {
                        legend: {
                            position: 'bottom',
                            labels: {
                                padding: 20,
                                color: document.documentElement.classList.contains('dark') ? '#F3F4F6' : '#333333'
                            }
                        }
                    }
                }
            });
        }
        
        function updateTaskPriorityChart() {
            const highCount = tasks.filter(t => t.priority === 'high').length;
            const mediumCount = tasks.filter(t => t.priority === 'medium').length;
            const lowCount = tasks.filter(t => t.priority === 'low').length;
            
            const ctx = document.getElementById('taskPriorityChart').getContext('2d');
            
            // Destroy existing chart if it exists
            if (window.taskPriorityChart) {
                window.taskPriorityChart.destroy();
            }
            
            window.taskPriorityChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: ['High', 'Medium', 'Low'],
                    datasets: [{
                        label: 'Tasks',
                        data: [highCount, mediumCount, lowCount],
                        backgroundColor: ['#EF4444', '#F59E0B', '#9CA3AF'],
                        borderWidth: 0,
                        borderRadius: 4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                precision: 0,
                                color: document.documentElement.classList.contains('dark') ? '#F3F4F6' : '#333333'
                            },
                            grid: {
                                color: document.documentElement.classList.contains('dark') ? 'rgba(243, 244, 246, 0.1)' : 'rgba(51, 51, 51, 0.1)'
                            }
                        },
                        x: {
                            ticks: {
                                color: document.documentElement.classList.contains('dark') ? '#F3F4F6' : '#333333'
                            },
                            grid: {
                                display: false
                            }
                        }
                    },
                    plugins: {
                        legend: {
                            display: false
                        }
                    }
                }
            });
        }
        
        function updateTaskCategoryChart() {
            // Count tasks by category
            const categories = {};
            tasks.forEach(task => {
                if (!categories[task.category]) {
                    categories[task.category] = 0;
                }
                categories[task.category]++;
            });
            
            const categoryLabels = Object.keys(categories);
            const categoryCounts = Object.values(categories);
            
            // Generate random colors
            const categoryColors = categoryLabels.map(() => {
                const r = Math.floor(Math.random() * 200);
                const g = Math.floor(Math.random() * 200);
                const b = Math.floor(Math.random() * 200);
                return `rgba(${r}, ${g}, ${b}, 0.8)`;
            });
            
            const ctx = document.getElementById('taskCategoryChart').getContext('2d');
            
            // Destroy existing chart if it exists
            if (window.taskCategoryChart) {
                window.taskCategoryChart.destroy();
            }
            
            window.taskCategoryChart = new Chart(ctx, {
                type: 'pie',
                data: {
                    labels: categoryLabels.map(cat => cat.charAt(0).toUpperCase() + cat.slice(1)),
                    datasets: [{
                        data: categoryCounts,
                        backgroundColor: categoryColors,
                        borderWidth: 0
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'right',
                            labels: {
                                color: document.documentElement.classList.contains('dark') ? '#F3F4F6' : '#333333'
                            }
                        }
                    }
                }
            });
        }
        
        function updateTaskDueDateChart() {
            // Group tasks by due date (this week, next week, future)
            const today = new Date();
            today.setHours(0, 0, 0, 0);
            
            const nextWeek = new Date(today);
            nextWeek.setDate(nextWeek.getDate() + 7);
            
            const overdue = tasks.filter(task => {
                const dueDate = new Date(task.dueDate);
                dueDate.setHours(0, 0, 0, 0);
                return dueDate < today && !task.completed;
            }).length;
            
            const thisWeek = tasks.filter(task => {
                const dueDate = new Date(task.dueDate);
                dueDate.setHours(0, 0, 0, 0);
                return dueDate >= today && dueDate < nextWeek;
            }).length;
            
            const future = tasks.filter(task => {
                const dueDate = new Date(task.dueDate);
                dueDate.setHours(0, 0, 0, 0);
                return dueDate >= nextWeek;
            }).length;
            
            const ctx = document.getElementById('taskDueDateChart').getContext('2d');
            
            // Destroy existing chart if it exists
            if (window.taskDueDateChart) {
                window.taskDueDateChart.destroy();
            }
            
            window.taskDueDateChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: ['Overdue', 'This Week', 'Future'],
                    datasets: [{
                        label: 'Tasks',
                        data: [overdue, thisWeek, future],
                        backgroundColor: ['#EF4444', '#6366F1', '#10B981'],
                        borderWidth: 0,
                        borderRadius: 4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    indexAxis: 'y',
                    scales: {
                        x: {
                            beginAtZero: true,
                            ticks: {
                                precision: 0,
                                color: document.documentElement.classList.contains('dark') ? '#F3F4F6' : '#333333'
                            },
                            grid: {
                                color: document.documentElement.classList.contains('dark') ? 'rgba(243, 244, 246, 0.1)' : 'rgba(51, 51, 51, 0.1)'
                            }
                        },
                        y: {
                            ticks: {
                                color: document.documentElement.classList.contains('dark') ? '#F3F4F6' : '#333333'
                            },
                            grid: {
                                display: false
                            }
                        }
                    },
                    plugins: {
                        legend: {
                            display: false
                        }
                    }
                }
            });
        }
        
        function updateTaskTrendChart() {
            // Generate data for the last 7 days
            const labels = [];
            const completedData = [];
            const createdData = [];
            
            for (let i = 6; i >= 0; i--) {
                const date = new Date();
                date.setDate(date.getDate() - i);
                date.setHours(0, 0, 0, 0);
                
                const dateStr = date.toISOString().split('T')[0];
                const nextDate = new Date(date);
                nextDate.setDate(nextDate.getDate() + 1);
                const nextDateStr = nextDate.toISOString().split('T')[0];
                
                labels.push(formatDate(dateStr));
                
                // Count tasks completed on this day
                const completed = tasks.filter(task => {
                    if (!task.completedDate) return false;
                    const taskDate = new Date(task.completedDate);
                    return taskDate >= date && taskDate < nextDate;
                }).length;
                
                // Count tasks created on this day
                const created = tasks.filter(task => {
                    const taskDate = new Date(task.createdDate);
                    return taskDate >= date && taskDate < nextDate;
                }).length;
                
                completedData.push(completed);
                createdData.push(created);
            }
            
            const ctx = document.getElementById('taskTrendChart').getContext('2d');
            
            // Destroy existing chart if it exists
            if (window.taskTrendChart) {
                window.taskTrendChart.destroy();
            }
            
            window.taskTrendChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [
                        {
                            label: 'Completed',
                            data: completedData,
                            backgroundColor: 'transparent',
                            borderColor: '#10B981',
                            borderWidth: 2,
                            pointBackgroundColor: '#10B981',
                            tension: 0.3
                        },
                        {
                            label: 'Created',
                            data: createdData,
                            backgroundColor: 'transparent',
                            borderColor: '#6366F1',
                            borderWidth: 2,
                            pointBackgroundColor: '#6366F1',
                            tension: 0.3
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                precision: 0,
                                color: document.documentElement.classList.contains('dark') ? '#F3F4F6' : '#333333'
                            },
                            grid: {
                                color: document.documentElement.classList.contains('dark') ? 'rgba(243, 244, 246, 0.1)' : 'rgba(51, 51, 51, 0.1)'
                            }
                        },
                        x: {
                            ticks: {
                                color: document.documentElement.classList.contains('dark') ? '#F3F4F6' : '#333333'
                            },
                            grid: {
                                color: document.documentElement.classList.contains('dark') ? 'rgba(243, 244, 246, 0.1)' : 'rgba(51, 51, 51, 0.1)'
                            }
                        }
                    },
                    plugins: {
                        legend: {
                            labels: {
                                color: document.documentElement.classList.contains('dark') ? '#F3F4F6' : '#333333'
                            }
                        }
                    }
                }
            });
        }

        // Insights functions
        function updateInsightsData() {
            const totalTasks = tasks.length;
            const completedTasks = tasks.filter(t => t.completed).length;
            
            // Productivity Score (example algorithm)
            const overdueTasksCount = tasks.filter(task => {
                if (task.completed) return false;
                const dueDate = new Date(task.dueDate);
                dueDate.setHours(0, 0, 0, 0);
                const today = new Date();
                today.setHours(0, 0, 0, 0);
                return dueDate < today;
            }).length;
            
            const score = Math.max(0, Math.min(100, Math.round(
                (completedTasks / (totalTasks || 1)) * 100 - (overdueTasksCount * 5)
            )));
            
            document.getElementById('productivityScore').textContent = score;
            document.getElementById('productivityBar').style.width = `${score}%`;
            
            // Completion Rate
            const completionRate = totalTasks ? Math.round((completedTasks / totalTasks) * 100) : 0;
            document.getElementById('completionRate').textContent = completionRate;
            document.getElementById('completionBar').style.width = `${completionRate}%`;
            
            // On-Time Completion
            const completedOnTime = tasks.filter(task => {
                if (!task.completed) return false;
                const dueDate = new Date(task.dueDate);
                dueDate.setHours(0, 0, 0, 0);
                const completedDate = task.completedDate ? new Date(task.completedDate) : new Date();
                completedDate.setHours(0, 0, 0, 0);
                return completedDate <= dueDate;
            }).length;
            
            const onTimeRate = completedTasks ? Math.round((completedOnTime / completedTasks) * 100) : 0;
            document.getElementById('onTimeRate').textContent = onTimeRate;
            document.getElementById('onTimeBar').style.width = `${onTimeRate}%`;
            
            // Average Completion Time (example)
            document.getElementById('avgCompletionTime').textContent = '2.4 days';
        }

        // Import/Export functions
        function setupImportExport() {
            // Import
            const importTasksBtn = document.getElementById('importTasksBtn');
            const importFileInput = document.getElementById('importFileInput');
            const browseFilesBtn = document.getElementById('browseFilesBtn');
            const importDropZone = document.getElementById('importDropZone');
            const importFileDetails = document.getElementById('importFileDetails');
            const importFileName = document.getElementById('importFileName');
            const importFileSize = document.getElementById('importFileSize');
            const removeImportFile = document.getElementById('removeImportFile');
            const importBtn = document.getElementById('importBtn');
            
            document.getElementById('importTasksBtn').addEventListener('click', () => {
                openModal('importTasksModal');
            });
            
            browseFilesBtn.addEventListener('click', () => {
                importFileInput.click();
            });
            
            importFileInput.addEventListener('change', handleImportFile);
            
            importDropZone.addEventListener('dragover', (e) => {
                e.preventDefault();
                importDropZone.classList.add('border-primary');
            });
            
            importDropZone.addEventListener('dragleave', () => {
                importDropZone.classList.remove('border-primary');
            });
            
            importDropZone.addEventListener('drop', (e) => {
                e.preventDefault();
                importDropZone.classList.remove('border-primary');
                
                if (e.dataTransfer.files.length) {
                    importFileInput.files = e.dataTransfer.files;
                    handleImportFile();
                }
            });
            
            removeImportFile.addEventListener('click', () => {
                importFileInput.value = '';
                importFileDetails.classList.add('hidden');
                importBtn.disabled = true;
            });
            
            function handleImportFile() {
                const file = importFileInput.files[0];
                if (file) {
                    importFileName.textContent = file.name;
                    importFileSize.textContent = `${Math.round(file.size / 1024)} KB`;
                    importFileDetails.classList.remove('hidden');
                    importBtn.disabled = false;
                }
            }
            
            document.getElementById('importBtn').addEventListener('click', () => {
                const file = importFileInput.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        try {
                            const importedTasks = JSON.parse(e.target.result);
                            if (Array.isArray(importedTasks)) {
                                // Save state for undo
                                saveTaskStateForUndo();
                                
                                // Merge with existing tasks
                                tasks = [...importedTasks, ...tasks];
                                saveTasksToStorage();
                                renderTasks();
                                
                                closeAllModals();
                            } else {
                                alert('Invalid file format. Please upload a valid JSON file.');
                            }
                        } catch (err) {
                            alert('Error parsing file. Please upload a valid JSON file.');
                        }
                    };
                    reader.readAsText(file);
                }
            });
            
            // Export
            document.getElementById('exportTasksBtn').addEventListener('click', () => {
                openModal('exportTasksModal');
            });
            
            const exportOptions = document.querySelectorAll('.export-option');
            const exportBtn = document.getElementById('exportBtn');
            
            exportOptions.forEach(option => {
                option.addEventListener('click', () => {
                    exportOptions.forEach(o => o.classList.remove('ring-2', 'ring-primary'));
                    option.classList.add('ring-2', 'ring-primary');
                    exportBtn.disabled = false;
                    exportBtn.setAttribute('data-format', option.getAttribute('data-format'));
                });
            });
            
            exportBtn.addEventListener('click', () => {
                const format = exportBtn.getAttribute('data-format');
                
                if (format === 'json') {
                    const json = JSON.stringify(tasks, null, 2);
                    const blob = new Blob([json], { type: 'application/json' });
                    const url = URL.createObjectURL(blob);
                    
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = `tasks_export_${new Date().toISOString().slice(0, 10)}.json`;
                    document.body.appendChild(a);
                    a.click();
                    document.body.removeChild(a);
                } else if (format === 'csv') {
                    // Convert tasks to CSV
                    const headers = ['ID', 'Title', 'Description', 'Category', 'Priority', 'Due Date', 'Status'];
                    let csv = headers.join(',') + '\n';
                    
                    tasks.forEach(task => {
                        const row = [
                            task.id,
                            `"${task.title.replace(/"/g, '""')}"`,
                            `"${(task.description || '').replace(/"/g, '""')}"`,
                            task.category,
                            task.priority,
                            task.dueDate,
                            task.status
                        ];
                        csv += row.join(',') + '\n';
                    });
                    
                    const blob = new Blob([csv], { type: 'text/csv' });
                    const url = URL.createObjectURL(blob);
                    
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = `tasks_export_${new Date().toISOString().slice(0, 10)}.csv`;
                    document.body.appendChild(a);
                    a.click();
                    document.body.removeChild(a);
                } else if (format === 'pdf') {
                    alert('PDF export functionality would be implemented here.');
                }
                
                closeAllModals();
            });
        }

        // Users modal
        function setupUsersModal() {
            document.getElementById('showUsersBtn').addEventListener('click', () => {
                openModal('usersModal');
                renderUsersList();
            });
            
            // Filter users
            document.getElementById('userSearch').addEventListener('input', renderUsersList);
            document.getElementById('userRoleFilter').addEventListener('change', renderUsersList);
        }
        
        function renderUsersList() {
            const usersList = document.getElementById('usersList');
            const searchTerm = document.getElementById('userSearch').value.toLowerCase();
            const roleFilter = document.getElementById('userRoleFilter').value;
            
            // Filter users
            let filteredUsers = users.filter(user => {
                // Search filter
                if (searchTerm && !user.name.toLowerCase().includes(searchTerm) && 
                    !user.email.toLowerCase().includes(searchTerm)) {
                    return false;
                }
                
                // Role filter
                if (roleFilter && user.role !== roleFilter) {
                    return false;
                }
                
                return true;
            });
            
            // Clear users list
            usersList.innerHTML = '';
            
            // Render users
            filteredUsers.forEach(user => {
                const userRow = document.createElement('tr');
                userRow.className = 'hover:bg-gray-50 dark:hover:bg-gray-700';
                
                userRow.innerHTML = `
                    <td class="px-6 py-4 whitespace-nowrap">
                        <div class="flex items-center">
                            <div class="flex-shrink-0 h-10 w-10 rounded-full overflow-hidden">
                                <img src="${user.profilePic}" alt="${user.name}" class="h-full w-full object-cover">
                            </div>
                            <div class="ml-4">
                                <div class="text-sm font-medium">${user.name}</div>
                            </div>
                        </div>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap">
                        <div class="text-sm">${user.email}</div>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap">
                        <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-${getRoleColor(user.role)}-100 dark:bg-${getRoleColor(user.role)}-900/30 text-${getRoleColor(user.role)}-800 dark:text-${getRoleColor(user.role)}-300">
                            ${user.role.charAt(0).toUpperCase() + user.role.slice(1)}
                        </span>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap">
                        <span class="inline-flex items-center">
                            <span class="h-2.5 w-2.5 rounded-full ${getStatusColor(user.status)} mr-2"></span>
                            <span class="text-sm">${user.status.charAt(0).toUpperCase() + user.status.slice(1)}</span>
                        </span>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap text-right text-sm font-medium">
                        <button class="text-primary hover:text-primary-hover mr-3">View</button>
                        <button class="text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200">
                            <i class="fas fa-ellipsis-v"></i>
                        </button>
                    </td>
                `;
                
                usersList.appendChild(userRow);
            });
        }
        
        function getRoleColor(role) {
            switch (role) {
                case 'manager': return 'purple';
                case 'admin': return 'red';
                case 'staff': return 'blue';
                case 'customer': return 'green';
                default: return 'gray';
            }
        }
        
        function getStatusColor(status) {
            switch (status) {
                case 'online': return 'bg-green-500';
                case 'offline': return 'bg-red-500';
                case 'break': return 'bg-yellow-500';
                case 'shadow': return 'bg-gray-500';
                default: return 'bg-gray-500';
            }
        }

        // Custom date filter handling
        function setupDateFilter() {
            const dateFilter = document.getElementById('dateFilter');
            const dateRangePicker = document.getElementById('dateRangePicker');
            
            dateFilter.addEventListener('change', () => {
                if (dateFilter.value === 'custom') {
                    dateRangePicker.classList.remove('hidden');
                } else {
                    dateRangePicker.classList.add('hidden');
                }
                
                renderTasks();
            });
            
            document.getElementById('startDate').addEventListener('change', renderTasks);
            document.getElementById('endDate').addEventListener('change', renderTasks);
        }

        // Filter change handlers
        function setupFilterHandlers() {
            document.getElementById('taskSearch').addEventListener('input', renderTasks);
            document.getElementById('categoryFilter').addEventListener('change', renderTasks);
            document.getElementById('priorityFilter').addEventListener('change', renderTasks);
            document.getElementById('statusFilter').addEventListener('change', renderTasks);
            document.getElementById('sortTasks').addEventListener('change', renderTasks);
        }

        // Initialize application
        function init() {
            // Load data from storage
            loadFromStorage();
            
            // Setup basic functionality
            initializeDarkMode();
            setupAuthPages();
            setupModalHandlers();
            setupProfileDropdown();
            setupNotifications();
            setupProfileModal();
            setupViewToggles();
            setupAddTask();
            setupBulkActions();
            setupDateFilter();
            setupFilterHandlers();
            setupImportExport();
            setupUsersModal();
            
            // Setup undo/redo
            document.getElementById('undoBtn').addEventListener('click', undo);
            document.getElementById('redoBtn').addEventListener('click', redo);
            
            // Add initial state to history
            taskHistory.push(JSON.stringify(tasks));
            historyIndex = 0;
            
            // Check if user is logged in
            if (currentUser) {
                showApp();
            } else {
                showAuth();
            }
        }
        
        // Initialize app
        document.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>
