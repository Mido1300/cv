<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>To-Do App</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary-color: #4a6fa5;
            --secondary-color: #166088;
            --accent-color: #4fc3f7;
            --light-color: #f8f9fa;
            --dark-color: #212529;
            --success-color: #28a745;
            --warning-color: #ffc107;
            --danger-color: #dc3545;
            --info-color: #17a2b8;
            --border-radius: 8px;
            --box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            --transition: all 0.3s ease;
        }

        [data-theme="dark"] {
            --primary-color: #5d7fb9;
            --secondary-color: #2a7bb1;
            --light-color: #343a40;
            --dark-color: #f8f9fa;
            --box-shadow: 0 4px 6px rgba(0, 0, 0, 0.3);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background-color: var(--light-color);
            color: var(--dark-color);
            transition: var(--transition);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }

        /* Header Styles */
        header {
            background-color: var(--primary-color);
            color: white;
            padding: 1rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: var(--box-shadow);
            position: sticky;
            top: 0;
            z-index: 1000;
        }

        .logo-container {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .logo {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background-color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            color: var(--primary-color);
        }

        .app-name {
            font-size: 1.5rem;
            font-weight: bold;
        }

        .header-controls {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .profile-container {
            position: relative;
        }

        .profile-pic {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            border: 3px solid var(--success-color);
            cursor: pointer;
            object-fit: cover;
            transition: var(--transition);
        }

        .profile-pic.logged-out {
            border-color: var(--danger-color);
        }

        .profile-pic.on-break {
            border-color: var(--warning-color);
        }

        .profile-pic.shadow {
            border-color: #6c757d;
        }

        .profile-dropdown {
            position: absolute;
            right: 0;
            top: 50px;
            background-color: var(--light-color);
            color: var(--dark-color);
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
            width: 200px;
            padding: 10px;
            display: none;
            z-index: 1001;
        }

        .profile-dropdown.show {
            display: block;
        }

        .dropdown-item {
            padding: 8px 10px;
            border-radius: var(--border-radius);
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .dropdown-item:hover {
            background-color: rgba(0, 0, 0, 0.1);
        }

        .dropdown-item i {
            width: 20px;
            text-align: center;
        }

        .status-submenu {
            margin-left: 20px;
            display: none;
        }

        .status-submenu.show {
            display: block;
        }

        .notification-icon {
            position: relative;
            cursor: pointer;
            font-size: 1.2rem;
        }

        .notification-badge {
            position: absolute;
            top: -8px;
            right: -8px;
            background-color: var(--danger-color);
            color: white;
            border-radius: 50%;
            width: 18px;
            height: 18px;
            font-size: 0.7rem;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .theme-toggle {
            position: relative;
            display: inline-block;
            width: 50px;
            height: 24px;
        }

        .theme-toggle input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            transition: var(--transition);
            border-radius: 24px;
        }

        .slider:before {
            position: absolute;
            content: "";
            height: 16px;
            width: 16px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: var(--transition);
            border-radius: 50%;
        }

        input:checked + .slider {
            background-color: var(--primary-color);
        }

        input:checked + .slider:before {
            transform: translateX(26px);
        }

        .timer {
            font-size: 0.9rem;
            font-family: monospace;
            padding: 5px 10px;
            border-radius: var(--border-radius);
            background-color: rgba(255, 255, 255, 0.2);
        }

        .hamburger-menu {
            display: none;
            font-size: 1.5rem;
            cursor: pointer;
        }

        /* Main Content Styles */
        main {
            flex: 1;
            padding: 1rem;
            max-width: 1200px;
            margin: 0 auto;
            width: 100%;
        }

        /* Login Page Styles */
        .login-page {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 80vh;
        }

        .auth-container {
            background-color: var(--light-color);
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
            padding: 2rem;
            width: 100%;
            max-width: 500px;
            margin: 1rem;
        }

        .auth-title {
            text-align: center;
            margin-bottom: 1.5rem;
            color: var(--primary-color);
        }

        .auth-form {
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        .form-group {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }

        .form-group label {
            font-weight: 500;
        }

        .form-control {
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: var(--border-radius);
            font-size: 1rem;
            transition: var(--transition);
        }

        .form-control:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 2px rgba(74, 111, 165, 0.2);
        }

        .btn {
            padding: 12px;
            border: none;
            border-radius: var(--border-radius);
            font-size: 1rem;
            font-weight: 500;
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .btn-primary {
            background-color: var(--primary-color);
            color: white;
        }

        .btn-primary:hover {
            background-color: var(--secondary-color);
        }

        .btn-secondary {
            background-color: #6c757d;
            color: white;
        }

        .btn-secondary:hover {
            background-color: #5a6268;
        }

        .btn-outline {
            background-color: transparent;
            border: 1px solid var(--primary-color);
            color: var(--primary-color);
        }

        .btn-outline:hover {
            background-color: rgba(74, 111, 165, 0.1);
        }

        .auth-toggle {
            text-align: center;
            margin-top: 1rem;
        }

        .auth-toggle-btn {
            background: none;
            border: none;
            color: var(--primary-color);
            cursor: pointer;
            font-weight: 500;
            text-decoration: underline;
        }

        .error-message {
            color: var(--danger-color);
            font-size: 0.9rem;
            margin-top: -0.5rem;
        }

        /* Task Overview Styles */
        .task-overview {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1rem;
            margin-bottom: 1.5rem;
        }

        .total-tasks {
            grid-column: 1 / -1;
        }

        .task-card {
            background-color: var(--light-color);
            border-radius: var(--border-radius);
            padding: 1rem;
            box-shadow: var(--box-shadow);
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }

        .task-card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .task-card-title {
            font-weight: 600;
            font-size: 1.1rem;
        }

        .task-card-count {
            font-size: 1.5rem;
            font-weight: bold;
        }

        .total-tasks .task-card-count {
            color: var(--info-color);
        }

        .completed-tasks .task-card-count {
            color: var(--success-color);
        }

        .pending-tasks .task-card-count {
            color: var(--warning-color);
        }

        /* Content Layout */
        .content-wrapper {
            display: flex;
            gap: 1.5rem;
            margin-top: 1.5rem;
        }

        .tasks-section {
            flex: 1;
        }

        .sidebar {
            width: 250px;
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        /* Task Controls */
        .tasks-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }

        .section-title {
            font-size: 1.5rem;
            font-weight: 600;
        }

        .view-toggle {
            display: flex;
            gap: 0.5rem;
        }

        .view-btn {
            padding: 8px 12px;
            border: 1px solid #ddd;
            background-color: transparent;
            border-radius: var(--border-radius);
            cursor: pointer;
            transition: var(--transition);
        }

        .view-btn.active {
            background-color: var(--primary-color);
            color: white;
            border-color: var(--primary-color);
        }

        /* Task List Styles */
        .task-list {
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        .task-item {
            background-color: var(--light-color);
            border-radius: var(--border-radius);
            padding: 1rem;
            box-shadow: var(--box-shadow);
            position: relative;
            transition: var(--transition);
        }

        .task-item.high-priority {
            border-left: 4px solid var(--danger-color);
        }

        .task-item.medium-priority {
            border-left: 4px solid var(--warning-color);
        }

        .task-item.low-priority {
            border-left: 4px solid #6c757d;
        }

        .task-item.completed {
            opacity: 0.7;
            position: relative;
        }

        .task-item.completed::after {
            content: "";
            position: absolute;
            top: 50%;
            left: 0;
            right: 0;
            height: 2px;
            background-color: var(--success-color);
        }

        .task-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 0.5rem;
        }

        .task-title {
            font-weight: 600;
            font-size: 1.1rem;
            flex: 1;
        }

        .task-priority {
            padding: 4px 8px;
            border-radius: var(--border-radius);
            font-size: 0.8rem;
            font-weight: 500;
            margin-left: 8px;
        }

        .high-priority .task-priority {
            background-color: rgba(220, 53, 69, 0.2);
            color: var(--danger-color);
        }

        .medium-priority .task-priority {
            background-color: rgba(255, 193, 7, 0.2);
            color: var(--warning-color);
        }

        .low-priority .task-priority {
            background-color: rgba(108, 117, 125, 0.2);
            color: #6c757d;
        }

        .task-due-date {
            display: flex;
            align-items: center;
            gap: 4px;
            font-size: 0.9rem;
            margin-top: 4px;
        }

        .due-date-icon {
            font-size: 0.8rem;
        }

        .task-due-date.overdue {
            color: var(--danger-color);
        }

        .task-due-date.soon {
            color: var(--warning-color);
        }

        .task-due-date.future {
            color: var(--success-color);
        }

        .task-description {
            color: #6c757d;
            margin: 0.5rem 0;
            font-size: 0.9rem;
            line-height: 1.5;
        }

        .task-footer {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 0.5rem;
        }

        .task-actions {
            display: flex;
            gap: 8px;
        }

        .task-btn {
            background: none;
            border: none;
            cursor: pointer;
            color: #6c757d;
            font-size: 1rem;
            transition: var(--transition);
            width: 32px;
            height: 32px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .task-btn:hover {
            background-color: rgba(0, 0, 0, 0.1);
        }

        .task-btn.complete-btn {
            color: var(--success-color);
        }

        .task-btn.delete-btn {
            color: var(--danger-color);
        }

        .task-btn.share-btn {
            color: var(--primary-color);
        }

        .task-timer {
            display: flex;
            align-items: center;
            gap: 8px;
            font-family: monospace;
            font-size: 0.9rem;
        }

        .timer-btn {
            background: none;
            border: none;
            cursor: pointer;
            color: var(--primary-color);
            font-size: 0.9rem;
        }

        /* Graph View Styles */
        .graph-view {
            display: none;
            flex-direction: column;
            gap: 1.5rem;
        }

        .graph-view.active {
            display: flex;
        }

        .graph-container {
            background-color: var(--light-color);
            border-radius: var(--border-radius);
            padding: 1rem;
            box-shadow: var(--box-shadow);
            height: 300px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .graph-placeholder {
            text-align: center;
            color: #6c757d;
        }

        /* Filter and Sort Styles */
        .task-controls {
            display: flex;
            flex-wrap: wrap;
            gap: 1rem;
            margin-bottom: 1.5rem;
            align-items: center;
        }

        .search-bar {
            flex: 1;
            min-width: 200px;
            position: relative;
        }

        .search-bar input {
            width: 100%;
            padding: 10px 15px 10px 35px;
            border: 1px solid #ddd;
            border-radius: var(--border-radius);
        }

        .search-icon {
            position: absolute;
            left: 10px;
            top: 50%;
            transform: translateY(-50%);
            color: #6c757d;
        }

        .filter-btn, .sort-btn {
            padding: 10px 15px;
            background-color: var(--light-color);
            border: 1px solid #ddd;
            border-radius: var(--border-radius);
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: var(--transition);
        }

        .filter-btn:hover, .sort-btn:hover {
            background-color: rgba(0, 0, 0, 0.05);
        }

        .filter-dropdown, .sort-dropdown {
            position: absolute;
            background-color: var(--light-color);
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
            padding: 10px;
            z-index: 100;
            display: none;
            min-width: 200px;
        }

        .filter-dropdown.show, .sort-dropdown.show {
            display: block;
        }

        .filter-group {
            margin-bottom: 10px;
        }

        .filter-group-title {
            font-weight: 600;
            margin-bottom: 5px;
            font-size: 0.9rem;
        }

        .filter-options {
            display: flex;
            flex-wrap: wrap;
            gap: 5px;
        }

        .filter-option {
            padding: 5px 10px;
            background-color: rgba(0, 0, 0, 0.05);
            border-radius: var(--border-radius);
            font-size: 0.8rem;
            cursor: pointer;
        }

        .filter-option.selected {
            background-color: var(--primary-color);
            color: white;
        }

        .date-range-picker {
            display: flex;
            flex-direction: column;
            gap: 5px;
            margin-top: 5px;
        }

        .date-range-picker input {
            padding: 5px;
            border: 1px solid #ddd;
            border-radius: var(--border-radius);
        }

        .sort-options {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }

        .sort-option {
            padding: 8px;
            border-radius: var(--border-radius);
            cursor: pointer;
        }

        .sort-option:hover {
            background-color: rgba(0, 0, 0, 0.05);
        }

        .sort-option.selected {
            background-color: var(--primary-color);
            color: white;
        }

        /* Modal Styles */
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0, 0, 0, 0.5);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 2000;
            opacity: 0;
            pointer-events: none;
            transition: var(--transition);
        }

        .modal.show {
            opacity: 1;
            pointer-events: all;
        }

        .modal-content {
            background-color: var(--light-color);
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
            width: 90%;
            max-width: 500px;
            max-height: 90vh;
            overflow-y: auto;
            padding: 1.5rem;
            position: relative;
            transform: translateY(-20px);
            transition: var(--transition);
        }

        .modal.show .modal-content {
            transform: translateY(0);
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }

        .modal-title {
            font-size: 1.3rem;
            font-weight: 600;
        }

        .close-btn {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: #6c757d;
        }

        .modal-body {
            margin-bottom: 1.5rem;
        }

        .modal-footer {
            display: flex;
            justify-content: flex-end;
            gap: 10px;
        }

        /* Profile Modal Styles */
        .profile-form {
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        .profile-picture-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 10px;
            margin-bottom: 1rem;
        }

        .profile-picture-large {
            width: 100px;
            height: 100px;
            border-radius: 50%;
            object-fit: cover;
            border: 3px solid var(--primary-color);
        }

        .profile-upload-btn {
            position: relative;
            overflow: hidden;
            display: inline-block;
        }

        .profile-upload-btn input {
            position: absolute;
            left: 0;
            top: 0;
            opacity: 0;
            width: 100%;
            height: 100%;
            cursor: pointer;
        }

        /* Add Task Modal Styles */
        .subtask-list {
            margin-top: 10px;
            display: flex;
            flex-direction: column;
            gap: 5px;
        }

        .subtask-item {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .subtask-input {
            flex: 1;
        }

        .subtask-remove {
            color: var(--danger-color);
            cursor: pointer;
        }

        .add-subtask-btn {
            margin-top: 5px;
            align-self: flex-start;
        }

        /* Users Modal Styles */
        .users-list {
            display: flex;
            flex-direction: column;
            gap: 10px;
            max-height: 400px;
            overflow-y: auto;
            padding-right: 5px;
        }

        .user-item {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 10px;
            border-radius: var(--border-radius);
            transition: var(--transition);
        }

        .user-item:hover {
            background-color: rgba(0, 0, 0, 0.05);
        }

        .user-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            object-fit: cover;
        }

        .user-info {
            flex: 1;
        }

        .user-name {
            font-weight: 600;
        }

        .user-email {
            font-size: 0.8rem;
            color: #6c757d;
        }

        .user-role {
            font-size: 0.8rem;
            padding: 3px 8px;
            border-radius: var(--border-radius);
            background-color: rgba(74, 111, 165, 0.2);
            color: var(--primary-color);
        }

        /* Notification Styles */
        .notifications-modal .modal-content {
            max-width: 400px;
        }

        .notifications-list {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .notification-item {
            padding: 10px;
            border-radius: var(--border-radius);
            background-color: rgba(0, 0, 0, 0.05);
            display: flex;
            gap: 10px;
        }

        .notification-item.unread {
            background-color: rgba(74, 111, 165, 0.1);
            border-left: 3px solid var(--primary-color);
        }

        .notification-icon-small {
            font-size: 1.2rem;
            color: var(--primary-color);
        }

        .notification-content {
            flex: 1;
        }

        .notification-time {
            font-size: 0.8rem;
            color: #6c757d;
            margin-top: 3px;
        }

        /* Bulk Actions */
        .bulk-actions {
            display: none;
            justify-content: space-between;
            align-items: center;
            padding: 10px;
            background-color: rgba(0, 0, 0, 0.05);
            border-radius: var(--border-radius);
            margin-bottom: 1rem;
        }

        .bulk-actions.show {
            display: flex;
        }

        .bulk-count {
            font-weight: 500;
        }

        .bulk-buttons {
            display: flex;
            gap: 8px;
        }

        /* Undo/Redo Buttons */
        .history-buttons {
            display: flex;
            gap: 8px;
            margin-bottom: 1rem;
        }

        /* Insights Section */
        .insights-section {
            margin-top: 2rem;
        }

        .insights-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }

        .insights-cards {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 1rem;
        }

        .insight-card {
            background-color: var(--light-color);
            border-radius: var(--border-radius);
            padding: 1rem;
            box-shadow: var(--box-shadow);
        }

        .insight-title {
            font-size: 0.9rem;
            color: #6c757d;
            margin-bottom: 0.5rem;
        }

        .insight-value {
            font-size: 1.5rem;
            font-weight: bold;
        }

        /* Responsive Styles */
        @media (max-width: 992px) {
            .content-wrapper {
                flex-direction: column;
            }

            .sidebar {
                width: 100%;
                flex-direction: row;
                flex-wrap: wrap;
            }

            .sidebar-btn {
                flex: 1;
                min-width: 120px;
            }
        }

        @media (max-width: 768px) {
            .task-overview {
                grid-template-columns: 1fr;
            }

            .header-controls .timer, .header-controls .theme-toggle {
                display: none;
            }

            .hamburger-menu {
                display: block;
            }

            .mobile-menu {
                position: fixed;
                top: 70px;
                right: -250px;
                width: 250px;
                height: calc(100vh - 70px);
                background-color: var(--light-color);
                box-shadow: var(--box-shadow);
                transition: var(--transition);
                z-index: 1000;
                padding: 1rem;
                display: flex;
                flex-direction: column;
                gap: 1rem;
            }

            .mobile-menu.show {
                right: 0;
            }

            .mobile-controls {
                display: flex;
                flex-direction: column;
                gap: 1rem;
            }
        }

        @media (max-width: 576px) {
            .auth-container {
                padding: 1.5rem;
            }

            .task-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 5px;
            }

            .task-priority {
                margin-left: 0;
            }

            .task-footer {
                flex-direction: column;
                align-items: flex-start;
                gap: 10px;
            }

            .task-actions {
                align-self: flex-end;
            }

            .modal-content {
                width: 95%;
                padding: 1rem;
            }

            .sidebar-btn {
                min-width: 100%;
            }
        }

        /* Drag and Drop Styles */
        .task-item.dragging {
            opacity: 0.5;
            background-color: rgba(0, 0, 0, 0.05);
        }

        .task-item.drop-area {
            border: 2px dashed var(--primary-color);
            background-color: rgba(74, 111, 165, 0.1);
        }

        /* Animation Styles */
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .fade-in {
            animation: fadeIn 0.3s ease-in-out;
        }
    </style>
</head>
<body>
    <!-- Login Page -->
    <div class="login-page" id="loginPage">
        <div class="auth-container">
            <h2 class="auth-title">Welcome to To-Do App</h2>
            <form class="auth-form" id="loginForm">
                <div class="form-group">
                    <label for="loginEmail">Email</label>
                    <input type="email" id="loginEmail" class="form-control" required placeholder="Enter your email">
                </div>
                <div class="form-group">
                    <label for="loginPassword">Password</label>
                    <input type="password" id="loginPassword" class="form-control" required placeholder="Enter your password">
                </div>
                <button type="submit" class="btn btn-primary">Login</button>
                <div class="auth-toggle">
                    <button type="button" class="auth-toggle-btn" id="showRegisterBtn">Don't have an account? Register</button>
                </div>
            </form>

            <form class="auth-form" id="registerForm" style="display: none;">
                <div class="form-group">
                    <label for="registerName">Name</label>
                    <input type="text" id="registerName" class="form-control" required placeholder="Enter your name">
                </div>
                <div class="form-group">
                    <label for="registerEmail">Email</label>
                    <input type="email" id="registerEmail" class="form-control" required placeholder="Enter your email">
                </div>
                <div class="form-group">
                    <label for="registerConfirmEmail">Confirm Email</label>
                    <input type="email" id="registerConfirmEmail" class="form-control" required placeholder="Confirm your email">
                    <div class="error-message" id="emailError"></div>
                </div>
                <div class="form-group">
                    <label for="registerPassword">Password</label>
                    <input type="password" id="registerPassword" class="form-control" required placeholder="Enter your password">
                </div>
                <div class="form-group">
                    <label for="registerConfirmPassword">Confirm Password</label>
                    <input type="password" id="registerConfirmPassword" class="form-control" required placeholder="Confirm your password">
                    <div class="error-message" id="passwordError"></div>
                </div>
                <div class="form-group">
                    <label for="registerPhone">Phone Number</label>
                    <input type="tel" id="registerPhone" class="form-control" placeholder="Enter your phone number">
                </div>
                <div class="form-group">
                    <label for="registerCountry">Country</label>
                    <select id="registerCountry" class="form-control" required>
                        <option value="">Select your country</option>
                        <option value="US">United States</option>
                        <option value="UK">United Kingdom</option>
                        <option value="CA">Canada</option>
                        <option value="AU">Australia</option>
                        <option value="IN">India</option>
                        <option value="JP">Japan</option>
                        <option value="DE">Germany</option>
                        <option value="FR">France</option>
                        <option value="BR">Brazil</option>
                        <option value="CN">China</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="registerRole">Role</label>
                    <select id="registerRole" class="form-control" required>
                        <option value="">Select your role</option>
                        <option value="Manager">Manager</option>
                        <option value="Admin">Admin</option>
                        <option value="Staff">Staff</option>
                        <option value="Customer">Customer</option>
                        <option value="Developer">Developer</option>
                        <option value="Designer">Designer</option>
                    </select>
                </div>
                <button type="submit" class="btn btn-primary">Register</button>
                <div class="auth-toggle">
                    <button type="button" class="auth-toggle-btn" id="showLoginBtn">Already have an account? Login</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Main App -->
    <div id="appContainer" style="display: none;">
        <!-- Header -->
        <header>
            <div class="logo-container">
                <div class="logo">TD</div>
                <div class="app-name">To-Do App</div>
            </div>
            
            <div class="header-controls">
                <div class="timer" id="workingTimer">00:00:00</div>
                <label class="theme-toggle">
                    <input type="checkbox" id="themeToggle">
                    <span class="slider"></span>
                </label>
                <div class="notification-icon" id="notificationIcon">
                    <i class="fas fa-bell"></i>
                    <span class="notification-badge" id="notificationBadge">0</span>
                </div>
                <div class="profile-container">
                    <img src="https://i.pravatar.cc/150?img=3" alt="Profile" class="profile-pic logged-out" id="profilePic">
                    <div class="profile-dropdown" id="profileDropdown">
                        <div class="dropdown-item" id="statusDropdown">
                            <i class="fas fa-circle"></i>
                            <span>Status: Logged Out</span>
                            <i class="fas fa-chevron-down"></i>
                        </div>
                        <div class="status-submenu" id="statusSubmenu">
                            <div class="dropdown-item status-option" data-status="login">
                                <i class="fas fa-sign-in-alt"></i>
                                <span>Login</span>
                            </div>
                            <div class="dropdown-item status-option" data-status="shadow">
                                <i class="fas fa-user-secret"></i>
                                <span>Shadow</span>
                            </div>
                            <div class="dropdown-item status-option" data-status="break">
                                <i class="fas fa-coffee"></i>
                                <span>Break</span>
                            </div>
                            <div class="dropdown-item status-option" data-status="logout">
                                <i class="fas fa-sign-out-alt"></i>
                                <span>Logout</span>
                            </div>
                        </div>
                        <div class="dropdown-item" id="viewProfileBtn">
                            <i class="fas fa-user"></i>
                            <span>View Profile</span>
                        </div>
                        <div class="dropdown-item" id="logoutBtn">
                            <i class="fas fa-power-off"></i>
                            <span>Logout</span>
                        </div>
                    </div>
                </div>
                <div class="hamburger-menu" id="hamburgerMenu">
                    <i class="fas fa-bars"></i>
                </div>
            </div>
        </header>

        <!-- Mobile Menu -->
        <div class="mobile-menu" id="mobileMenu">
            <div class="mobile-controls">
                <div class="timer" id="mobileTimer">00:00:00</div>
                <label class="theme-toggle">
                    <input type="checkbox" id="mobileThemeToggle">
                    <span class="slider"></span>
                </label>
                <div class="notification-icon" id="mobileNotificationIcon">
                    <i class="fas fa-bell"></i>
                    <span class="notification-badge" id="mobileNotificationBadge">0</span>
                </div>
                <button class="btn btn-outline" id="mobileLogoutBtn">
                    <i class="fas fa-power-off"></i>
                    <span>Logout</span>
                </button>
            </div>
        </div>

        <!-- Main Content -->
        <main>
            <!-- Task Overview -->
            <div class="task-overview">
                <div class="task-card total-tasks">
                    <div class="task-card-header">
                        <div class="task-card-title">Total Tasks</div>
                    </div>
                    <div class="task-card-count" id="totalTasksCount">0</div>
                </div>
                <div class="task-card completed-tasks">
                    <div class="task-card-header">
                        <div class="task-card-title">Completed Tasks</div>
                    </div>
                    <div class="task-card-count" id="completedTasksCount">0</div>
                </div>
                <div class="task-card pending-tasks">
                    <div class="task-card-header">
                        <div class="task-card-title">Pending Tasks</div>
                    </div>
                    <div class="task-card-count" id="pendingTasksCount">0</div>
                </div>
            </div>

            <!-- Content Wrapper -->
            <div class="content-wrapper">
                <!-- Tasks Section -->
                <div class="tasks-section">
                    <!-- Task Controls -->
                    <div class="task-controls">
                        <div class="search-bar">
                            <i class="fas fa-search search-icon"></i>
                            <input type="text" id="taskSearch" placeholder="Search tasks...">
                        </div>
                        <button class="filter-btn" id="filterBtn">
                            <i class="fas fa-filter"></i>
                            <span>Filter</span>
                        </button>
                        <div class="filter-dropdown" id="filterDropdown">
                            <div class="filter-group">
                                <div class="filter-group-title">Priority</div>
                                <div class="filter-options">
                                    <div class="filter-option" data-filter="priority" data-value="all">All</div>
                                    <div class="filter-option" data-filter="priority" data-value="high">High</div>
                                    <div class="filter-option" data-filter="priority" data-value="medium">Medium</div>
                                    <div class="filter-option" data-filter="priority" data-value="low">Low</div>
                                </div>
                            </div>
                            <div class="filter-group">
                                <div class="filter-group-title">Status</div>
                                <div class="filter-options">
                                    <div class="filter-option" data-filter="status" data-value="all">All</div>
                                    <div class="filter-option" data-filter="status" data-value="active">Active</div>
                                    <div class="filter-option" data-filter="status" data-value="completed">Completed</div>
                                </div>
                            </div>
                            <div class="filter-group">
                                <div class="filter-group-title">Due Date</div>
                                <div class="filter-options">
                                    <div class="filter-option" data-filter="dueDate" data-value="all">All</div>
                                    <div class="filter-option" data-filter="dueDate" data-value="today">Today</div>
                                    <div class="filter-option" data-filter="dueDate" data-value="week">This Week</div>
                                    <div class="filter-option" data-filter="dueDate" data-value="month">This Month</div>
                                    <div class="filter-option" data-filter="dueDate" data-value="custom">Custom</div>
                                </div>
                                <div class="date-range-picker" id="dateRangePicker" style="display: none;">
                                    <input type="date" id="startDate" placeholder="Start Date">
                                    <input type="date" id="endDate" placeholder="End Date">
                                </div>
                            </div>
                        </div>
                        <button class="sort-btn" id="sortBtn">
                            <i class="fas fa-sort"></i>
                            <span>Sort</span>
                        </button>
                        <div class="sort-dropdown" id="sortDropdown">
                            <div class="sort-options">
                                <div class="sort-option" data-sort="dueDate-asc">Due Date (Ascending)</div>
                                <div class="sort-option" data-sort="dueDate-desc">Due Date (Descending)</div>
                                <div class="sort-option" data-sort="priority-asc">Priority (High to Low)</div>
                                <div class="sort-option" data-sort="priority-desc">Priority (Low to High)</div>
                                <div class="sort-option" data-sort="createdAt-asc">Created At (Oldest First)</div>
                                <div class="sort-option" data-sort="createdAt-desc">Created At (Newest First)</div>
                            </div>
                        </div>
                    </div>

                    <!-- Bulk Actions -->
                    <div class="bulk-actions" id="bulkActions">
                        <div class="bulk-count" id="bulkCount">0 tasks selected</div>
                        <div class="bulk-buttons">
                            <button class="btn btn-outline" id="bulkCompleteBtn">
                                <i class="fas fa-check"></i>
                                <span>Complete</span>
                            </button>
                            <button class="btn btn-outline" id="bulkDeleteBtn">
                                <i class="fas fa-trash"></i>
                                <span>Delete</span>
                            </button>
                            <button class="btn btn-outline" id="bulkClearBtn">
                                <i class="fas fa-times"></i>
                                <span>Clear</span>
                            </button>
                        </div>
                    </div>

                    <!-- History Buttons -->
                    <div class="history-buttons">
                        <button class="btn btn-outline" id="undoBtn" disabled>
                            <i class="fas fa-undo"></i>
                            <span>Undo</span>
                        </button>
                        <button class="btn btn-outline" id="redoBtn" disabled>
                            <i class="fas fa-redo"></i>
                            <span>Redo</span>
                        </button>
                    </div>

                    <!-- Tasks Header -->
                    <div class="tasks-header">
                        <h2 class="section-title">Tasks</h2>
                        <div class="view-toggle">
                            <button class="view-btn active" data-view="list">
                                <i class="fas fa-list"></i>
                                <span>List</span>
                            </button>
                            <button class="view-btn" data-view="graph">
                                <i class="fas fa-chart-bar"></i>
                                <span>Graph</span>
                            </button>
                        </div>
                    </div>

                    <!-- Task List View -->
                    <div class="task-list" id="taskList">
                        <!-- Tasks will be dynamically inserted here -->
                    </div>

                    <!-- Graph View -->
                    <div class="graph-view" id="graphView">
                        <div class="graph-container">
                            <div class="graph-placeholder">
                                <i class="fas fa-chart-pie fa-3x"></i>
                                <p>Task Completion Overview</p>
                            </div>
                        </div>
                        <div class="graph-container">
                            <div class="graph-placeholder">
                                <i class="fas fa-chart-bar fa-3x"></i>
                                <p>Tasks by Priority</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Sidebar -->
                <div class="sidebar">
                    <button class="btn btn-primary sidebar-btn" id="importBtn">
                        <i class="fas fa-file-import"></i>
                        <span>Import</span>
                    </button>
                    <button class="btn btn-primary sidebar-btn" id="exportBtn">
                        <i class="fas fa-file-export"></i>
                        <span>Export</span>
                    </button>
                    <button class="btn btn-primary sidebar-btn" id="usersBtn">
                        <i class="fas fa-users"></i>
                        <span>Users</span>
                    </button>
                    <button class="btn btn-primary sidebar-btn" id="addTaskBtn">
                        <i class="fas fa-plus"></i>
                        <span>Add Task</span>
                    </button>
                </div>
            </div>

            <!-- Insights Section -->
            <div class="insights-section">
                <div class="insights-header">
                    <h2 class="section-title">Insights</h2>
                </div>
                <div class="insights-cards">
                    <div class="insight-card">
                        <div class="insight-title">Completion Rate</div>
                        <div class="insight-value" id="completionRate">0%</div>
                    </div>
                    <div class="insight-card">
                        <div class="insight-title">Avg. Time per Task</div>
                        <div class="insight-value" id="avgTaskTime">0m</div>
                    </div>
                    <div class="insight-card">
                        <div class="insight-title">High Priority Tasks</div>
                        <div class="insight-value" id="highPriorityTasks">0</div>
                    </div>
                    <div class="insight-card">
                        <div class="insight-title">Tasks Due Soon</div>
                        <div class="insight-value" id="dueSoonTasks">0</div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- Modals -->
    <!-- Profile Modal -->
    <div class="modal" id="profileModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">My Profile</h3>
                <button class="close-btn" id="closeProfileModal">&times;</button>
            </div>
            <div class="modal-body">
                <form class="profile-form" id="profileForm">
                    <div class="profile-picture-container">
                        <img src="https://i.pravatar.cc/150?img=3" alt="Profile" class="profile-picture-large" id="profilePictureLarge">
                        <button type="button" class="btn btn-outline profile-upload-btn">
                            <i class="fas fa-camera"></i>
                            <span>Change Photo</span>
                            <input type="file" id="profilePhotoUpload" accept="image/*">
                        </button>
                    </div>
                    <div class="form-group">
                        <label for="profileName">Name</label>
                        <input type="text" id="profileName" class="form-control" required>
                    </div>
                    <div class="form-group">
                        <label for="profileEmail">Email</label>
                        <input type="email" id="profileEmail" class="form-control" required readonly>
                    </div>
                    <div class="form-group">
                        <label for="profilePhone">Phone Number</label>
                        <input type="tel" id="profilePhone" class="form-control">
                    </div>
                    <div class="form-group">
                        <label for="profilePassword">Password</label>
                        <input type="password" id="profilePassword" class="form-control" placeholder="Enter new password">
                    </div>
                    <div class="form-group">
                        <label for="profileConfirmPassword">Confirm Password</label>
                        <input type="password" id="profileConfirmPassword" class="form-control" placeholder="Confirm new password">
                        <div class="error-message" id="profilePasswordError"></div>
                    </div>
                    <div class="form-group">
                        <label for="profileRole">Role</label>
                        <input type="text" id="profileRole" class="form-control" readonly>
                    </div>
                    <div class="form-group">
                        <label for="profileCountry">Country</label>
                        <input type="text" id="profileCountry" class="form-control" readonly>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" id="cancelProfileChanges">Cancel</button>
                <button class="btn btn-primary" id="saveProfileChanges">Save Changes</button>
            </div>
        </div>
    </div>

    <!-- Add/Edit Task Modal -->
    <div class="modal" id="taskModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title" id="taskModalTitle">Add New Task</h3>
                <button class="close-btn" id="closeTaskModal">&times;</button>
            </div>
            <div class="modal-body">
                <form id="taskForm">
                    <div class="form-group">
                        <label for="taskTitle">Title</label>
                        <input type="text" id="taskTitle" class="form-control" required placeholder="Enter task title">
                    </div>
                    <div class="form-group">
                        <label for="taskDescription">Description</label>
                        <textarea id="taskDescription" class="form-control" rows="3" placeholder="Enter task description"></textarea>
                    </div>
                    <div class="form-group">
                        <label for="taskPriority">Priority</label>
                        <select id="taskPriority" class="form-control" required>
                            <option value="">Select priority</option>
                            <option value="high">High</option>
                            <option value="medium">Medium</option>
                            <option value="low">Low</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="taskDueDate">Due Date</label>
                        <input type="date" id="taskDueDate" class="form-control">
                    </div>
                    <div class="form-group">
                        <label>Subtasks</label>
                        <div class="subtask-list" id="subtaskList">
                            <!-- Subtasks will be added here -->
                        </div>
                        <button type="button" class="btn btn-outline add-subtask-btn" id="addSubtaskBtn">
                            <i class="fas fa-plus"></i>
                            <span>Add Subtask</span>
                        </button>
                    </div>
                    <div class="form-group">
                        <label for="taskAssignTo">Assign To</label>
                        <select id="taskAssignTo" class="form-control">
                            <option value="">Select user</option>
                            <!-- Users will be populated here -->
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="taskNotes">Notes</label>
                        <textarea id="taskNotes" class="form-control" rows="2" placeholder="Additional notes"></textarea>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" id="cancelTask">Cancel</button>
                <button class="btn btn-primary" id="saveTask">Save Task</button>
            </div>
        </div>
    </div>

    <!-- Users Modal -->
    <div class="modal" id="usersModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">All Users</h3>
                <button class="close-btn" id="closeUsersModal">&times;</button>
            </div>
            <div class="modal-body">
                <div class="users-list" id="usersList">
                    <!-- Users will be populated here -->
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" id="closeUsersModalBtn">Close</button>
            </div>
        </div>
    </div>

    <!-- Notifications Modal -->
    <div class="modal notifications-modal" id="notificationsModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Notifications</h3>
                <button class="close-btn" id="closeNotificationsModal">&times;</button>
            </div>
            <div class="modal-body">
                <div class="notifications-list" id="notificationsList">
                    <!-- Notifications will be populated here -->
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" id="markAllAsReadBtn">Mark All as Read</button>
                <button class="btn btn-primary" id="closeNotificationsModalBtn">Close</button>
            </div>
        </div>
    </div>

    <!-- Import Modal -->
    <div class="modal" id="importModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Import Tasks</h3>
                <button class="close-btn" id="closeImportModal">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label for="importFile">Select File</label>
                    <input type="file" id="importFile" class="form-control" accept=".json,.csv,.txt">
                </div>
                <div class="form-group">
                    <label for="importFormat">File Format</label>
                    <select id="importFormat" class="form-control">
                        <option value="json">JSON</option>
                        <option value="csv">CSV</option>
                        <option value="txt">Plain Text</option>
                    </select>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" id="cancelImport">Cancel</button>
                <button class="btn btn-primary" id="confirmImport">Import</button>
            </div>
        </div>
    </div>

    <!-- Export Modal -->
    <div class="modal" id="exportModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Export Tasks</h3>
                <button class="close-btn" id="closeExportModal">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label for="exportFormat">Export Format</label>
                    <select id="exportFormat" class="form-control">
                        <option value="json">JSON</option>
                        <option value="csv">CSV</option>
                        <option value="pdf">PDF</option>
                        <option value="docx">Word (DOCX)</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="exportScope">Export Scope</label>
                    <select id="exportScope" class="form-control">
                        <option value="all">All Tasks</option>
                        <option value="completed">Completed Tasks Only</option>
                        <option value="pending">Pending Tasks Only</option>
                        <option value="selected">Selected Tasks Only</option>
                    </select>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" id="cancelExport">Cancel</button>
                <button class="btn btn-primary" id="confirmExport">Export</button>
            </div>
        </div>
    </div>

    <script>
        // DOM Elements
        const loginPage = document.getElementById('loginPage');
        const appContainer = document.getElementById('appContainer');
        const loginForm = document.getElementById('loginForm');
        const registerForm = document.getElementById('registerForm');
        const showRegisterBtn = document.getElementById('showRegisterBtn');
        const showLoginBtn = document.getElementById('showLoginBtn');
        const registerEmail = document.getElementById('registerEmail');
        const registerConfirmEmail = document.getElementById('registerConfirmEmail');
        const registerPassword = document.getElementById('registerPassword');
        const registerConfirmPassword = document.getElementById('registerConfirmPassword');
        const emailError = document.getElementById('emailError');
        const passwordError = document.getElementById('passwordError');
        const profilePasswordError = document.getElementById('profilePasswordError');

        // Header Elements
        const profilePic = document.getElementById('profilePic');
        const profileDropdown = document.getElementById('profileDropdown');
        const statusDropdown = document.getElementById('statusDropdown');
        const statusSubmenu = document.getElementById('statusSubmenu');
        const statusOptions = document.querySelectorAll('.status-option');
        const viewProfileBtn = document.getElementById('viewProfileBtn');
        const logoutBtn = document.getElementById('logoutBtn');
        const notificationIcon = document.getElementById('notificationIcon');
        const notificationBadge = document.getElementById('notificationBadge');
        const themeToggle = document.getElementById('themeToggle');
        const workingTimer = document.getElementById('workingTimer');
        const hamburgerMenu = document.getElementById('hamburgerMenu');
        const mobileMenu = document.getElementById('mobileMenu');
        const mobileTimer = document.getElementById('mobileTimer');
        const mobileThemeToggle = document.getElementById('mobileThemeToggle');
        const mobileNotificationIcon = document.getElementById('mobileNotificationIcon');
        const mobileNotificationBadge = document.getElementById('mobileNotificationBadge');
        const mobileLogoutBtn = document.getElementById('mobileLogoutBtn');

        // Modal Elements
        const profileModal = document.getElementById('profileModal');
        const closeProfileModal = document.getElementById('closeProfileModal');
        const profilePictureLarge = document.getElementById('profilePictureLarge');
        const profilePhotoUpload = document.getElementById('profilePhotoUpload');
        const profileName = document.getElementById('profileName');
        const profileEmail = document.getElementById('profileEmail');
        const profilePhone = document.getElementById('profilePhone');
        const profilePassword = document.getElementById('profilePassword');
        const profileConfirmPassword = document.getElementById('profileConfirmPassword');
        const profileRole = document.getElementById('profileRole');
        const profileCountry = document.getElementById('profileCountry');
        const cancelProfileChanges = document.getElementById('cancelProfileChanges');
        const saveProfileChanges = document.getElementById('saveProfileChanges');
        const profileForm = document.getElementById('profileForm');

        const taskModal = document.getElementById('taskModal');
        const taskModalTitle = document.getElementById('taskModalTitle');
        const closeTaskModal = document.getElementById('closeTaskModal');
        const taskForm = document.getElementById('taskForm');
        const taskTitle = document.getElementById('taskTitle');
        const taskDescription = document.getElementById('taskDescription');
        const taskPriority = document.getElementById('taskPriority');
        const taskDueDate = document.getElementById('taskDueDate');
        const subtaskList = document.getElementById('subtaskList');
        const addSubtaskBtn = document.getElementById('addSubtaskBtn');
        const taskAssignTo = document.getElementById('taskAssignTo');
        const taskNotes = document.getElementById('taskNotes');
        const cancelTask = document.getElementById('cancelTask');
        const saveTask = document.getElementById('saveTask');

        const usersModal = document.getElementById('usersModal');
        const closeUsersModal = document.getElementById('closeUsersModal');
        const usersList = document.getElementById('usersList');
        const closeUsersModalBtn = document.getElementById('closeUsersModalBtn');

        const notificationsModal = document.getElementById('notificationsModal');
        const closeNotificationsModal = document.getElementById('closeNotificationsModal');
        const notificationsList = document.getElementById('notificationsList');
        const markAllAsReadBtn = document.getElementById('markAllAsReadBtn');
        const closeNotificationsModalBtn = document.getElementById('closeNotificationsModalBtn');

        const importModal = document.getElementById('importModal');
        const closeImportModal = document.getElementById('closeImportModal');
        const importFile = document.getElementById('importFile');
        const importFormat = document.getElementById('importFormat');
        const cancelImport = document.getElementById('cancelImport');
        const confirmImport = document.getElementById('confirmImport');

        const exportModal = document.getElementById('exportModal');
        const closeExportModal = document.getElementById('closeExportModal');
        const exportFormat = document.getElementById('exportFormat');
        const exportScope = document.getElementById('exportScope');
        const cancelExport = document.getElementById('cancelExport');
        const confirmExport = document.getElementById('confirmExport');

        // Sidebar Buttons
        const importBtn = document.getElementById('importBtn');
        const exportBtn = document.getElementById('exportBtn');
        const usersBtn = document.getElementById('usersBtn');
        const addTaskBtn = document.getElementById('addTaskBtn');

        // Task Elements
        const taskList = document.getElementById('taskList');
        const totalTasksCount = document.getElementById('totalTasksCount');
        const completedTasksCount = document.getElementById('completedTasksCount');
        const pendingTasksCount = document.getElementById('pendingTasksCount');
        const taskSearch = document.getElementById('taskSearch');
        const filterBtn = document.getElementById('filterBtn');
        const filterDropdown = document.getElementById('filterDropdown');
        const filterOptions = document.querySelectorAll('.filter-option');
        const dateRangePicker = document.getElementById('dateRangePicker');
        const startDate = document.getElementById('startDate');
        const endDate = document.getElementById('endDate');
        const sortBtn = document.getElementById('sortBtn');
        const sortDropdown = document.getElementById('sortDropdown');
        const sortOptions = document.querySelectorAll('.sort-option');
        const bulkActions = document.getElementById('bulkActions');
        const bulkCount = document.getElementById('bulkCount');
        const bulkCompleteBtn = document.getElementById('bulkCompleteBtn');
        const bulkDeleteBtn = document.getElementById('bulkDeleteBtn');
        const bulkClearBtn = document.getElementById('bulkClearBtn');
        const undoBtn = document.getElementById('undoBtn');
        const redoBtn = document.getElementById('redoBtn');
        const viewToggle = document.querySelectorAll('.view-btn');
        const graphView = document.getElementById('graphView');
        const completionRate = document.getElementById('completionRate');
        const avgTaskTime = document.getElementById('avgTaskTime');
        const highPriorityTasks = document.getElementById('highPriorityTasks');
        const dueSoonTasks = document.getElementById('dueSoonTasks');

        // App State
        let currentUser = null;
        let users = [];
        let tasks = [];
        let notifications = [];
        let selectedTasks = [];
        let taskHistory = [];
        let historyIndex = -1;
        let timerInterval;
        let workingSeconds = 0;
        let currentStatus = 'logged-out';
        let isDarkMode = false;

        // Initialize the app
        function initApp() {
            loadData();
            setupEventListeners();
            checkAuth();
            updateTheme();
        }

        // Load data from localStorage
        function loadData() {
            const savedUsers = localStorage.getItem('todoAppUsers');
            const savedTasks = localStorage.getItem('todoAppTasks');
            const savedNotifications = localStorage.getItem('todoAppNotifications');
            const savedTheme = localStorage.getItem('todoAppTheme');

            if (savedUsers) {
                users = JSON.parse(savedUsers);
            } else {
                // Default users
                users = [
                    {
                        id: 1,
                        name: 'Admin User',
                        email: 'admin@example.com',
                        password: 'admin123',
                        phone: '+1234567890',
                        country: 'US',
                        role: 'Admin',
                        profilePic: 'https://i.pravatar.cc/150?img=1',
                        createdAt: new Date().toISOString()
                    },
                    {
                        id: 2,
                        name: 'Manager User',
                        email: 'manager@example.com',
                        password: 'manager123',
                        phone: '+1987654321',
                        country: 'UK',
                        role: 'Manager',
                        profilePic: 'https://i.pravatar.cc/150?img=2',
                        createdAt: new Date().toISOString()
                    }
                ];
                saveUsers();
            }

            if (savedTasks) {
                tasks = JSON.parse(savedTasks);
            } else {
                // Default tasks
                tasks = [
                    {
                        id: 1,
                        title: 'Complete project proposal',
                        description: 'Finish the project proposal document and send for review',
                        priority: 'high',
                        dueDate: new Date(Date.now() + 86400000).toISOString().split('T')[0],
                        subtasks: [
                            { id: 1, title: 'Research competitors', completed: true },
                            { id: 2, title: 'Create outline', completed: false }
                        ],
                        assignedTo: 1,
                        notes: 'Need to highlight our unique value proposition',
                        completed: false,
                        createdAt: new Date().toISOString(),
                        timeSpent: 0,
                        timerRunning: false
                    },
                    {
                        id: 2,
                        title: 'Team meeting',
                        description: 'Weekly team sync to discuss progress and blockers',
                        priority: 'medium',
                        dueDate: new Date(Date.now() + 172800000).toISOString().split('T')[0],
                        subtasks: [],
                        assignedTo: 2,
                        notes: 'Prepare agenda and send invites',
                        completed: false,
                        createdAt: new Date().toISOString(),
                        timeSpent: 0,
                        timerRunning: false
                    },
                    {
                        id: 3,
                        title: 'Update documentation',
                        description: 'Update API documentation for new endpoints',
                        priority: 'low',
                        dueDate: new Date(Date.now() - 86400000).toISOString().split('T')[0],
                        subtasks: [
                            { id: 1, title: 'Review current docs', completed: false },
                            { id: 2, title: 'Add new endpoints', completed: false }
                        ],
                        assignedTo: 1,
                        notes: 'Include examples for each endpoint',
                        completed: false,
                        createdAt: new Date().toISOString(),
                        timeSpent: 0,
                        timerRunning: false
                    }
                ];
                saveTasks();
            }

            if (savedNotifications) {
                notifications = JSON.parse(savedNotifications);
            } else {
                // Default notifications
                notifications = [
                    {
                        id: 1,
                        title: 'Welcome to To-Do App',
                        message: 'You have successfully logged in to your account.',
                        read: false,
                        createdAt: new Date().toISOString()
                    },
                    {
                        id: 2,
                        title: 'Task Due Soon',
                        message: 'Your task "Complete project proposal" is due in 2 days.',
                        read: false,
                        createdAt: new Date().toISOString()
                    }
                ];
                saveNotifications();
            }

            if (savedTheme) {
                isDarkMode = savedTheme === 'dark';
                document.documentElement.setAttribute('data-theme', isDarkMode ? 'dark' : 'light');
            }
        }

        // Save data to localStorage
        function saveUsers() {
            localStorage.setItem('todoAppUsers', JSON.stringify(users));
        }

        function saveTasks() {
            localStorage.setItem('todoAppTasks', JSON.stringify(tasks));
            updateTaskCounts();
            renderTasks();
        }

        function saveNotifications() {
            localStorage.setItem('todoAppNotifications', JSON.stringify(notifications));
            updateNotificationBadge();
        }

        function saveTheme() {
            localStorage.setItem('todoAppTheme', isDarkMode ? 'dark' : 'light');
        }

        // Setup event listeners
        function setupEventListeners() {
            // Auth events
            showRegisterBtn.addEventListener('click', showRegisterForm);
            showLoginBtn.addEventListener('click', showLoginForm);
            loginForm.addEventListener('submit', handleLogin);
            registerForm.addEventListener('submit', handleRegister);
            registerEmail.addEventListener('input', validateEmailMatch);
            registerConfirmEmail.addEventListener('input', validateEmailMatch);
            registerPassword.addEventListener('input', validatePasswordMatch);
            registerConfirmPassword.addEventListener('input', validatePasswordMatch);

            // Header events
            profilePic.addEventListener('click', toggleProfileDropdown);
            statusDropdown.addEventListener('click', toggleStatusSubmenu);
            statusOptions.forEach(option => {
                option.addEventListener('click', () => changeStatus(option.dataset.status));
            });
            viewProfileBtn.addEventListener('click', openProfileModal);
            logoutBtn.addEventListener('click', handleLogout);
            notificationIcon.addEventListener('click', openNotificationsModal);
            themeToggle.addEventListener('change', toggleTheme);
            hamburgerMenu.addEventListener('click', toggleMobileMenu);
            mobileThemeToggle.addEventListener('change', toggleTheme);
            mobileNotificationIcon.addEventListener('click', openNotificationsModal);
            mobileLogoutBtn.addEventListener('click', handleLogout);

            // Profile modal events
            closeProfileModal.addEventListener('click', closeModal.bind(null, profileModal));
            profilePhotoUpload.addEventListener('change', handleProfilePhotoUpload);
            cancelProfileChanges.addEventListener('click', closeModal.bind(null, profileModal));
            saveProfileChanges.addEventListener('click', saveProfile);
            profilePassword.addEventListener('input', validateProfilePasswordMatch);
            profileConfirmPassword.addEventListener('input', validateProfilePasswordMatch);

            // Task modal events
            addTaskBtn.addEventListener('click', openAddTaskModal);
            closeTaskModal.addEventListener('click', closeModal.bind(null, taskModal));
            cancelTask.addEventListener('click', closeModal.bind(null, taskModal));
            saveTask.addEventListener('click', saveTaskHandler);
            addSubtaskBtn.addEventListener('click', addSubtask);

            // Users modal events
            usersBtn.addEventListener('click', openUsersModal);
            closeUsersModal.addEventListener('click', closeModal.bind(null, usersModal));
            closeUsersModalBtn.addEventListener('click', closeModal.bind(null, usersModal));

            // Notifications modal events
            closeNotificationsModal.addEventListener('click', closeModal.bind(null, notificationsModal));
            markAllAsReadBtn.addEventListener('click', markAllNotificationsAsRead);
            closeNotificationsModalBtn.addEventListener('click', closeModal.bind(null, notificationsModal));

            // Import/Export events
            importBtn.addEventListener('click', openImportModal);
            closeImportModal.addEventListener('click', closeModal.bind(null, importModal));
            cancelImport.addEventListener('click', closeModal.bind(null, importModal));
            confirmImport.addEventListener('click', handleImport);

            exportBtn.addEventListener('click', openExportModal);
            closeExportModal.addEventListener('click', closeModal.bind(null, exportModal));
            cancelExport.addEventListener('click', closeModal.bind(null, exportModal));
            confirmExport.addEventListener('click', handleExport);

            // Task events
            taskSearch.addEventListener('input', debounce(renderTasks, 300));
            filterBtn.addEventListener('click', toggleFilterDropdown);
            filterOptions.forEach(option => {
                option.addEventListener('click', () => {
                    option.classList.toggle('selected');
                    if (option.dataset.filter === 'dueDate' && option.dataset.value === 'custom') {
                        dateRangePicker.style.display = 'flex';
                    } else if (option.dataset.filter === 'dueDate') {
                        dateRangePicker.style.display = 'none';
                    }
                    renderTasks();
                });
            });
            sortBtn.addEventListener('click', toggleSortDropdown);
            sortOptions.forEach(option => {
                option.addEventListener('click', () => {
                    document.querySelector('.sort-option.selected')?.classList.remove('selected');
                    option.classList.add('selected');
                    renderTasks();
                });
            });
            viewToggle.forEach(btn => {
                btn.addEventListener('click', () => toggleView(btn.dataset.view));
            });
            bulkCompleteBtn.addEventListener('click', completeSelectedTasks);
            bulkDeleteBtn.addEventListener('click', deleteSelectedTasks);
            bulkClearBtn.addEventListener('click', clearSelectedTasks);
            undoBtn.addEventListener('click', undoAction);
            redoBtn.addEventListener('click', redoAction);

            // Window events
            window.addEventListener('click', (e) => {
                if (!e.target.closest('.profile-container') && !e.target.closest('.profile-dropdown')) {
                    profileDropdown.classList.remove('show');
                    statusSubmenu.classList.remove('show');
                }
                if (!e.target.closest('.filter-btn') && !e.target.closest('.filter-dropdown')) {
                    filterDropdown.classList.remove('show');
                }
                if (!e.target.closest('.sort-btn') && !e.target.closest('.sort-dropdown')) {
                    sortDropdown.classList.remove('show');
                }
            });

            // Drag and drop events
            taskList.addEventListener('dragstart', handleDragStart);
            taskList.addEventListener('dragover', handleDragOver);
            taskList.addEventListener('dragleave', handleDragLeave);
            taskList.addEventListener('drop', handleDrop);
            taskList.addEventListener('dragend', handleDragEnd);
        }

        // Auth functions
        function checkAuth() {
            const loggedInUser = localStorage.getItem('todoAppCurrentUser');
            if (loggedInUser) {
                currentUser = JSON.parse(loggedInUser);
                loginPage.style.display = 'none';
                appContainer.style.display = 'block';
                updateUI();
                startTimer();
                changeStatus('login');
            }
        }

        function showRegisterForm() {
            loginForm.style.display = 'none';
            registerForm.style.display = 'block';
            emailError.textContent = '';
            passwordError.textContent = '';
        }

        function showLoginForm() {
            registerForm.style.display = 'none';
            loginForm.style.display = 'block';
            emailError.textContent = '';
            passwordError.textContent = '';
        }

        function validateEmailMatch() {
            if (registerEmail.value !== registerConfirmEmail.value) {
                emailError.textContent = 'Emails do not match';
                return false;
            } else {
                emailError.textContent = '';
                return true;
            }
        }

        function validatePasswordMatch() {
            if (registerPassword.value !== registerConfirmPassword.value) {
                passwordError.textContent = 'Passwords do not match';
                return false;
            } else {
                passwordError.textContent = '';
                return true;
            }
        }

        function validateProfilePasswordMatch() {
            if (profilePassword.value !== profileConfirmPassword.value) {
                profilePasswordError.textContent = 'Passwords do not match';
                return false;
            } else {
                profilePasswordError.textContent = '';
                return true;
            }
        }

        function handleLogin(e) {
            e.preventDefault();
            const email = document.getElementById('loginEmail').value;
            const password = document.getElementById('loginPassword').value;

            const user = users.find(u => u.email === email && u.password === password);
            if (user) {
                currentUser = user;
                localStorage.setItem('todoAppCurrentUser', JSON.stringify(user));
                loginPage.style.display = 'none';
                appContainer.style.display = 'block';
                updateUI();
                startTimer();
                changeStatus('login');
                addNotification('Login Successful', `Welcome back, ${user.name}!`);
            } else {
                alert('Invalid email or password');
            }
        }

        function handleRegister(e) {
            e.preventDefault();
            if (!validateEmailMatch() || !validatePasswordMatch()) return;

            const name = document.getElementById('registerName').value;
            const email = document.getElementById('registerEmail').value;
            const password = document.getElementById('registerPassword').value;
            const phone = document.getElementById('registerPhone').value;
            const country = document.getElementById('registerCountry').value;
            const role = document.getElementById('registerRole').value;

            const newUser = {
                id: users.length > 0 ? Math.max(...users.map(u => u.id)) + 1 : 1,
                name,
                email,
                password,
                phone,
                country,
                role,
                profilePic: `https://i.pravatar.cc/150?img=${Math.floor(Math.random() * 70) + 1}`,
                createdAt: new Date().toISOString()
            };

            users.push(newUser);
            saveUsers();
            currentUser = newUser;
            localStorage.setItem('todoAppCurrentUser', JSON.stringify(newUser));
            loginPage.style.display = 'none';
            appContainer.style.display = 'block';
            updateUI();
            startTimer();
            changeStatus('login');
            addNotification('Welcome!', 'Your account has been created successfully.');
            showLoginForm();
        }

        function handleLogout() {
            currentUser = null;
            localStorage.removeItem('todoAppCurrentUser');
            loginPage.style.display = 'flex';
            appContainer.style.display = 'none';
            stopTimer();
            changeStatus('logout');
            document.getElementById('loginEmail').value = '';
            document.getElementById('loginPassword').value = '';
        }

        // Profile functions
        function toggleProfileDropdown() {
            profileDropdown.classList.toggle('show');
            statusSubmenu.classList.remove('show');
        }

        function toggleStatusSubmenu(e) {
            e.stopPropagation();
            statusSubmenu.classList.toggle('show');
        }

        function changeStatus(status) {
            currentStatus = status;
            profilePic.className = 'profile-pic';
            
            switch (status) {
                case 'login':
                    profilePic.classList.add('logged-in');
                    statusDropdown.innerHTML = `<i class="fas fa-sign-in-alt"></i><span>Status: Logged In</span><i class="fas fa-chevron-down"></i>`;
                    startTimer();
                    break;
                case 'shadow':
                    profilePic.classList.add('shadow');
                    statusDropdown.innerHTML = `<i class="fas fa-user-secret"></i><span>Status: Shadow</span><i class="fas fa-chevron-down"></i>`;
                    break;
                case 'break':
                    profilePic.classList.add('on-break');
                    statusDropdown.innerHTML = `<i class="fas fa-coffee"></i><span>Status: On Break</span><i class="fas fa-chevron-down"></i>`;
                    break;
                case 'logout':
                    profilePic.classList.add('logged-out');
                    statusDropdown.innerHTML = `<i class="fas fa-sign-out-alt"></i><span>Status: Logged Out</span><i class="fas fa-chevron-down"></i>`;
                    stopTimer();
                    break;
            }

            profileDropdown.classList.remove('show');
            statusSubmenu.classList.remove('show');
        }

        function openProfileModal() {
            if (!currentUser) return;
            
            profileName.value = currentUser.name;
            profileEmail.value = currentUser.email;
            profilePhone.value = currentUser.phone || '';
            profilePassword.value = '';
            profileConfirmPassword.value = '';
            profileRole.value = currentUser.role;
            profileCountry.value = currentUser.country;
            profilePictureLarge.src = currentUser.profilePic;
            profileDropdown.classList.remove('show');
            
            profileModal.classList.add('show');
            setTimeout(() => {
                profileModal.style.opacity = '1';
                document.querySelector('.modal-content').style.transform = 'translateY(0)';
            }, 10);
        }

        function handleProfilePhotoUpload(e) {
            const file = e.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(event) {
                    profilePictureLarge.src = event.target.result;
                };
                reader.readAsDataURL(file);
            }
        }

        function saveProfile() {
            if (!validateProfilePasswordMatch()) return;

            currentUser.name = profileName.value;
            currentUser.phone = profilePhone.value;
            
            if (profilePassword.value) {
                currentUser.password = profilePassword.value;
            }
            
            if (profilePhotoUpload.files[0]) {
                const reader = new FileReader();
                reader.onload = function(event) {
                    currentUser.profilePic = event.target.result;
                    profilePic.src = event.target.result;
                    saveUsers();
                    localStorage.setItem('todoAppCurrentUser', JSON.stringify(currentUser));
                };
                reader.readAsDataURL(profilePhotoUpload.files[0]);
            } else {
                saveUsers();
                localStorage.setItem('todoAppCurrentUser', JSON.stringify(currentUser));
            }
            
            closeModal(profileModal);
            addNotification('Profile Updated', 'Your profile information has been updated.');
        }

        // Notification functions
        function updateNotificationBadge() {
            const unreadCount = notifications.filter(n => !n.read).length;
            notificationBadge.textContent = unreadCount;
            mobileNotificationBadge.textContent = unreadCount;
            notificationBadge.style.display = unreadCount > 0 ? 'flex' : 'none';
            mobileNotificationBadge.style.display = unreadCount > 0 ? 'flex' : 'none';
        }

        function addNotification(title, message) {
            const newNotification = {
                id: notifications.length > 0 ? Math.max(...notifications.map(n => n.id)) + 1 : 1,
                title,
                message,
                read: false,
                createdAt: new Date().toISOString()
            };
            notifications.unshift(newNotification);
            saveNotifications();
        }

        function openNotificationsModal() {
            notificationsList.innerHTML = '';
            notifications.forEach(notification => {
                const notificationItem = document.createElement('div');
                notificationItem.className = `notification-item ${notification.read ? '' : 'unread'}`;
                notificationItem.innerHTML = `
                    <div class="notification-icon-small">
                        <i class="fas fa-bell"></i>
                    </div>
                    <div class="notification-content">
                        <div class="notification-title">${notification.title}</div>
                        <div class="notification-message">${notification.message}</div>
                        <div class="notification-time">${formatDate(notification.createdAt)}</div>
                    </div>
                `;
                notificationItem.addEventListener('click', () => markNotificationAsRead(notification.id));
                notificationsList.appendChild(notificationItem);
            });
            
            notificationsModal.classList.add('show');
            setTimeout(() => {
                notificationsModal.style.opacity = '1';
                document.querySelector('.notifications-modal .modal-content').style.transform = 'translateY(0)';
            }, 10);
        }

        function markNotificationAsRead(id) {
            const notification = notifications.find(n => n.id === id);
            if (notification && !notification.read) {
                notification.read = true;
                saveNotifications();
            }
        }

        function markAllNotificationsAsRead() {
            notifications.forEach(notification => {
                notification.read = true;
            });
            saveNotifications();
            openNotificationsModal();
        }

        // Timer functions
        function startTimer() {
            if (timerInterval) clearInterval(timerInterval);
            
            // Load saved timer state
            const savedTimer = localStorage.getItem('todoAppTimer');
            if (savedTimer) {
                const { seconds, date } = JSON.parse(savedTimer);
                const today = new Date().toDateString();
                const savedDate = new Date(date).toDateString();
                
                if (today === savedDate) {
                    workingSeconds = seconds;
                } else {
                    workingSeconds = 0;
                }
            }
            
            updateTimerDisplay();
            timerInterval = setInterval(() => {
                if (currentStatus === 'login') {
                    workingSeconds++;
                    updateTimerDisplay();
                    // Save timer state every minute
                    if (workingSeconds % 60 === 0) {
                        saveTimerState();
                    }
                }
            }, 1000);
        }

        function stopTimer() {
            if (timerInterval) {
                clearInterval(timerInterval);
                timerInterval = null;
                saveTimerState();
            }
        }

        function saveTimerState() {
            localStorage.setItem('todoAppTimer', JSON.stringify({
                seconds: workingSeconds,
                date: new Date().toISOString()
            }));
        }

        function updateTimerDisplay() {
            const hours = Math.floor(workingSeconds / 3600);
            const minutes = Math.floor((workingSeconds % 3600) / 60);
            const seconds = workingSeconds % 60;
            
            const timeString = `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
            workingTimer.textContent = timeString;
            mobileTimer.textContent = timeString;
        }

        // Theme functions
        function toggleTheme() {
            isDarkMode = !isDarkMode;
            updateTheme();
        }

        function updateTheme() {
            if (isDarkMode) {
                document.documentElement.setAttribute('data-theme', 'dark');
                themeToggle.checked = true;
                if (mobileThemeToggle) mobileThemeToggle.checked = true;
            } else {
                document.documentElement.removeAttribute('data-theme');
                themeToggle.checked = false;
                if (mobileThemeToggle) mobileThemeToggle.checked = false;
            }
            saveTheme();
        }

        // Mobile menu functions
        function toggleMobileMenu() {
            mobileMenu.classList.toggle('show');
        }

        // Modal functions
        function openModal(modal) {
            modal.classList.add('show');
            setTimeout(() => {
                modal.style.opacity = '1';
                modal.querySelector('.modal-content').style.transform = 'translateY(0)';
            }, 10);
            document.body.style.overflow = 'hidden';
        }

        function closeModal(modal) {
            modal.style.opacity = '0';
            modal.querySelector('.modal-content').style.transform = 'translateY(-20px)';
            setTimeout(() => {
                modal.classList.remove('show');
                document.body.style.overflow = '';
            }, 300);
        }

        function openAddTaskModal() {
            taskModalTitle.textContent = 'Add New Task';
            taskForm.reset();
            subtaskList.innerHTML = '';
            taskDueDate.value = new Date(Date.now() + 86400000).toISOString().split('T')[0];
            
            // Populate assign to dropdown
            taskAssignTo.innerHTML = '<option value="">Select user</option>';
            users.forEach(user => {
                const option = document.createElement('option');
                option.value = user.id;
                option.textContent = user.name;
                taskAssignTo.appendChild(option);
            });
            
            openModal(taskModal);
        }

        function openEditTaskModal(taskId) {
            const task = tasks.find(t => t.id === taskId);
            if (!task) return;
            
            taskModalTitle.textContent = 'Edit Task';
            taskForm.reset();
            subtaskList.innerHTML = '';
            
            taskTitle.value = task.title;
            taskDescription.value = task.description || '';
            taskPriority.value = task.priority;
            taskDueDate.value = task.dueDate;
            taskNotes.value = task.notes || '';
            
            // Populate subtasks
            task.subtasks.forEach(subtask => {
                addSubtask(subtask.id, subtask.title, subtask.completed);
            });
            
            // Populate assign to dropdown
            taskAssignTo.innerHTML = '<option value="">Select user</option>';
            users.forEach(user => {
                const option = document.createElement('option');
                option.value = user.id;
                option.textContent = user.name;
                option.selected = user.id === task.assignedTo;
                taskAssignTo.appendChild(option);
            });
            
            openModal(taskModal);
        }

        function addSubtask(id, title, completed) {
            const subtaskId = id || Date.now();
            const subtaskTitle = title || '';
            const subtaskCompleted = completed || false;
            
            const subtaskItem = document.createElement('div');
            subtaskItem.className = 'subtask-item';
            subtaskItem.innerHTML = `
                <input type="checkbox" ${subtaskCompleted ? 'checked' : ''} class="subtask-complete">
                <input type="text" class="form-control subtask-input" value="${subtaskTitle}" placeholder="Enter subtask">
                <i class="fas fa-times subtask-remove"></i>
            `;
            
            const removeBtn = subtaskItem.querySelector('.subtask-remove');
            removeBtn.addEventListener('click', () => {
                subtaskList.removeChild(subtaskItem);
            });
            
            subtaskList.appendChild(subtaskItem);
        }

        function saveTaskHandler() {
            const taskId = taskModalTitle.textContent === 'Add New Task' ? 
                (tasks.length > 0 ? Math.max(...tasks.map(t => t.id)) + 1 : 1) : 
                tasks.find(t => t.title === taskTitle.value && t.description === taskDescription.value)?.id || 
                (tasks.length > 0 ? Math.max(...tasks.map(t => t.id)) + 1 : 1);
            
            const subtasks = [];
            subtaskList.querySelectorAll('.subtask-item').forEach(item => {
                subtasks.push({
                    id: Date.now(),
                    title: item.querySelector('.subtask-input').value,
                    completed: item.querySelector('.subtask-complete').checked
                });
            });
            
            const newTask = {
                id: taskId,
                title: taskTitle.value,
                description: taskDescription.value,
                priority: taskPriority.value,
                dueDate: taskDueDate.value,
                subtasks,
                assignedTo: parseInt(taskAssignTo.value) || null,
                notes: taskNotes.value,
                completed: false,
                createdAt: new Date().toISOString(),
                timeSpent: 0,
                timerRunning: false
            };
            
            if (taskModalTitle.textContent === 'Add New Task') {
                tasks.unshift(newTask);
                addNotification('New Task Added', `"${newTask.title}" has been added to your tasks.`);
            } else {
                const existingTask = tasks.find(t => t.id === taskId);
                if (existingTask) {
                    Object.assign(existingTask, newTask);
                    addNotification('Task Updated', `"${newTask.title}" has been updated.`);
                }
            }
            
            saveTasks();
            closeModal(taskModal);
        }

        function openUsersModal() {
            usersList.innerHTML = '';
            users.forEach(user => {
                const userItem = document.createElement('div');
                userItem.className = 'user-item';
                userItem.innerHTML = `
                    <img src="${user.profilePic}" alt="${user.name}" class="user-avatar">
                    <div class="user-info">
                        <div class="user-name">${user.name}</div>
                        <div class="user-email">${user.email}</div>
                    </div>
                    <div class="user-role">${user.role}</div>
                `;
                usersList.appendChild(userItem);
            });
            
            openModal(usersModal);
        }

        function openImportModal() {
            importFile.value = '';
            openModal(importModal);
        }

        function handleImport() {
            const file = importFile.files[0];
            if (!file) {
                alert('Please select a file to import');
                return;
            }
            
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const importedTasks = JSON.parse(e.target.result);
                    if (Array.isArray(importedTasks)) {
                        tasks = importedTasks;
                        saveTasks();
                        addNotification('Tasks Imported', `${importedTasks.length} tasks have been imported successfully.`);
                        closeModal(importModal);
                    } else {
                        alert('Invalid file format. Please import a valid JSON file.');
                    }
                } catch (error) {
                    alert('Error parsing the file. Please make sure it is a valid JSON file.');
                }
            };
            reader.readAsText(file);
        }

        function openExportModal() {
            exportFormat.value = 'json';
            exportScope.value = 'all';
            openModal(exportModal);
        }

        function handleExport() {
            let tasksToExport = [];
            
            switch (exportScope.value) {
                case 'all':
                    tasksToExport = tasks;
                    break;
                case 'completed':
                    tasksToExport = tasks.filter(t => t.completed);
                    break;
                case 'pending':
                    tasksToExport = tasks.filter(t => !t.completed);
                    break;
                case 'selected':
                    tasksToExport = tasks.filter(t => selectedTasks.includes(t.id));
                    break;
            }
            
            if (tasksToExport.length === 0) {
                alert('No tasks to export with the selected criteria');
                return;
            }
            
            let exportContent, mimeType, fileName;
            
            switch (exportFormat.value) {
                case 'json':
                    exportContent = JSON.stringify(tasksToExport, null, 2);
                    mimeType = 'application/json';
                    fileName = 'tasks.json';
                    break;
                case 'csv':
                    exportContent = convertToCSV(tasksToExport);
                    mimeType = 'text/csv';
                    fileName = 'tasks.csv';
                    break;
                case 'pdf':
                    // In a real app, you would generate a PDF here
                    alert('PDF export would be implemented in a production app');
                    closeModal(exportModal);
                    return;
                case 'docx':
                    // In a real app, you would generate a DOCX here
                    alert('Word export would be implemented in a production app');
                    closeModal(exportModal);
                    return;
            }
            
            const blob = new Blob([exportContent], { type: mimeType });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = fileName;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            
            addNotification('Tasks Exported', `${tasksToExport.length} tasks have been exported.`);
            closeModal(exportModal);
        }

        function convertToCSV(tasks) {
            const headers = ['ID', 'Title', 'Description', 'Priority', 'Due Date', 'Status', 'Assigned To', 'Created At'];
            const rows = tasks.map(task => [
                task.id,
                `"${task.title.replace(/"/g, '""')}"`,
                `"${(task.description || '').replace(/"/g, '""')}"`,
                task.priority,
                task.dueDate,
                task.completed ? 'Completed' : 'Pending',
                task.assignedTo ? users.find(u => u.id === task.assignedTo)?.name || '' : '',
                task.createdAt
            ]);
            
            return [headers, ...rows].map(row => row.join(',')).join('\n');
        }

        // Task functions
        function updateTaskCounts() {
            const total = tasks.length;
            const completed = tasks.filter(t => t.completed).length;
            const pending = total - completed;
            
            totalTasksCount.textContent = total;
            completedTasksCount.textContent = completed;
            pendingTasksCount.textContent = pending;
            
            // Update insights
            completionRate.textContent = total > 0 ? `${Math.round((completed / total) * 100)}%` : '0%';
            
            const totalTime = tasks.reduce((sum, task) => sum + task.timeSpent, 0);
            const avgTime = total > 0 ? Math.round(totalTime / total / 60) : 0;
            avgTaskTime.textContent = `${avgTime}m`;
            
            highPriorityTasks.textContent = tasks.filter(t => t.priority === 'high').length;
            
            const now = new Date();
            const twoDaysLater = new Date(now.getTime() + 2 * 86400000);
            dueSoonTasks.textContent = tasks.filter(t => {
                if (t.completed) return false;
                const dueDate = new Date(t.dueDate);
                return dueDate > now && dueDate <= twoDaysLater;
            }).length;
        }

        function renderTasks() {
            taskList.innerHTML = '';
            
            // Apply filters
            let filteredTasks = [...tasks];
            
            // Search filter
            const searchTerm = taskSearch.value.toLowerCase();
            if (searchTerm) {
                filteredTasks = filteredTasks.filter(task => 
                    task.title.toLowerCase().includes(searchTerm) || 
                    (task.description && task.description.toLowerCase().includes(searchTerm))
                );
            }
            
            // Priority filter
            const priorityFilter = document.querySelector('.filter-option[data-filter="priority"].selected');
            if (priorityFilter && priorityFilter.dataset.value !== 'all') {
                filteredTasks = filteredTasks.filter(task => task.priority === priorityFilter.dataset.value);
            }
            
            // Status filter
            const statusFilter = document.querySelector('.filter-option[data-filter="status"].selected');
            if (statusFilter) {
                if (statusFilter.dataset.value === 'active') {
                    filteredTasks = filteredTasks.filter(task => !task.completed);
                } else if (statusFilter.dataset.value === 'completed') {
                    filteredTasks = filteredTasks.filter(task => task.completed);
                }
            }
            
            // Due date filter
            const dueDateFilter = document.querySelector('.filter-option[data-filter="dueDate"].selected');
            if (dueDateFilter) {
                const now = new Date();
                const today = new Date(now.getFullYear(), now.getMonth(), now.getDate());
                const tomorrow = new Date(today.getTime() + 86400000);
                const nextWeek = new Date(today.getTime() + 7 * 86400000);
                const nextMonth = new Date(today.getFullYear(), today.getMonth() + 1, today.getDate());
                
                if (dueDateFilter.dataset.value === 'today') {
                    filteredTasks = filteredTasks.filter(task => {
                        const dueDate = new Date(task.dueDate);
                        return dueDate >= today && dueDate < tomorrow;
                    });
                } else if (dueDateFilter.dataset.value === 'week') {
                    filteredTasks = filteredTasks.filter(task => {
                        const dueDate = new Date(task.dueDate);
                        return dueDate >= today && dueDate < nextWeek;
                    });
                } else if (dueDateFilter.dataset.value === 'month') {
                    filteredTasks = filteredTasks.filter(task => {
                        const dueDate = new Date(task.dueDate);
                        return dueDate >= today && dueDate < nextMonth;
                    });
                } else if (dueDateFilter.dataset.value === 'custom' && startDate.value && endDate.value) {
                    const start = new Date(startDate.value);
                    const end = new Date(endDate.value);
                    end.setDate(end.getDate() + 1); // Include the end date
                    
                    filteredTasks = filteredTasks.filter(task => {
                        const dueDate = new Date(task.dueDate);
                        return dueDate >= start && dueDate < end;
                    });
                }
            }
            
            // Apply sorting
            const sortOption = document.querySelector('.sort-option.selected');
            if (sortOption) {
                const [field, order] = sortOption.dataset.sort.split('-');
                
                filteredTasks.sort((a, b) => {
                    if (field === 'priority') {
                        const priorityOrder = { high: 3, medium: 2, low: 1 };
                        return order === 'asc' ? 
                            priorityOrder[b.priority] - priorityOrder[a.priority] : 
                            priorityOrder[a.priority] - priorityOrder[b.priority];
                    } else if (field === 'dueDate') {
                        const dateA = new Date(a.dueDate);
                        const dateB = new Date(b.dueDate);
                        return order === 'asc' ? dateA - dateB : dateB - dateA;
                    } else if (field === 'createdAt') {
                        const dateA = new Date(a.createdAt);
                        const dateB = new Date(b.createdAt);
                        return order === 'asc' ? dateA - dateB : dateB - dateA;
                    }
                    return 0;
                });
            }
            
            // Render tasks
            if (filteredTasks.length === 0) {
                const emptyMessage = document.createElement('div');
                emptyMessage.className = 'empty-message';
                emptyMessage.textContent = 'No tasks found matching your criteria';
                taskList.appendChild(emptyMessage);
            } else {
                filteredTasks.forEach(task => {
                    const taskItem = document.createElement('div');
                    taskItem.className = `task-item ${task.priority}-priority ${task.completed ? 'completed' : ''}`;
                    taskItem.dataset.id = task.id;
                    taskItem.draggable = true;
                    
                    const now = new Date();
                    const dueDate = new Date(task.dueDate);
                    const timeDiff = dueDate - now;
                    const daysDiff = Math.ceil(timeDiff / (1000 * 60 * 60 * 24));
                    
                    let dueDateClass = 'future';
                    let dueDateText = formatDate(task.dueDate);
                    
                    if (task.completed) {
                        dueDateClass = 'completed';
                    } else if (timeDiff < 0) {
                        dueDateClass = 'overdue';
                        dueDateText = `Overdue by ${Math.abs(daysDiff)} day${Math.abs(daysDiff) !== 1 ? 's' : ''}`;
                    } else if (daysDiff <= 2) {
                        dueDateClass = 'soon';
                        dueDateText = `Due in ${daysDiff} day${daysDiff !== 1 ? 's' : ''}`;
                    }
                    
                    const assignedUser = users.find(u => u.id === task.assignedTo);
                    
                    taskItem.innerHTML = `
                        <div class="task-header">
                            <div class="task-title">
                                ${task.title}
                                <span class="task-priority">${task.priority.charAt(0).toUpperCase() + task.priority.slice(1)}</span>
                            </div>
                            <div class="task-due-date ${dueDateClass}">
                                <i class="fas fa-calendar-alt due-date-icon"></i>
                                <span>${dueDateText}</span>
                            </div>
                        </div>
                        ${task.description ? `<div class="task-description">${task.description}</div>` : ''}
                        ${task.subtasks.length > 0 ? `
                            <div class="subtasks-progress">
                                <div class="progress-bar" style="width: ${getSubtasksProgress(task)}%"></div>
                                <span>${getCompletedSubtasksCount(task)} of ${task.subtasks.length} subtasks completed</span>
                            </div>
                        ` : ''}
                        ${assignedUser ? `
                            <div class="task-assigned">
                                <img src="${assignedUser.profilePic}" alt="${assignedUser.name}" class="assigned-user-avatar">
                                <span>Assigned to ${assignedUser.name}</span>
                            </div>
                        ` : ''}
                        <div class="task-footer">
                            <div class="task-timer">
                                <span>${formatTime(task.timeSpent)}</span>
                                <button class="timer-btn" data-action="${task.timerRunning ? 'pause' : 'start'}">
                                    <i class="fas fa-${task.timerRunning ? 'pause' : 'play'}"></i>
                                </button>
                            </div>
                            <div class="task-actions">
                                <button class="task-btn share-btn" title="Share">
                                    <i class="fas fa-share-alt"></i>
                                </button>
                                <button class="task-btn complete-btn" title="${task.completed ? 'Mark as Incomplete' : 'Mark as Complete'}">
                                    <i class="fas fa-${task.completed ? 'undo' : 'check'}"></i>
                                </button>
                                <button class="task-btn delete-btn" title="Delete">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </div>
                        </div>
                        <div class="task-selector">
                            <input type="checkbox" class="task-checkbox" ${selectedTasks.includes(task.id) ? 'checked' : ''}>
                        </div>
                    `;
                    
                    // Add event listeners
                    const completeBtn = taskItem.querySelector('.complete-btn');
                    completeBtn.addEventListener('click', () => toggleTaskComplete(task.id));
                    
                    const deleteBtn = taskItem.querySelector('.delete-btn');
                    deleteBtn.addEventListener('click', () => deleteTask(task.id));
                    
                    const shareBtn = taskItem.querySelector('.share-btn');
                    shareBtn.addEventListener('click', () => shareTask(task));
                    
                    const timerBtn = taskItem.querySelector('.timer-btn');
                    timerBtn.addEventListener('click', () => toggleTaskTimer(task.id));
                    
                    const checkbox = taskItem.querySelector('.task-checkbox');
                    checkbox.addEventListener('change', () => toggleTaskSelection(task.id));
                    
                    taskList.appendChild(taskItem);
                });
            }
            
            // Update bulk actions
            updateBulkActions();
        }

        function getSubtasksProgress(task) {
            if (task.subtasks.length === 0) return 0;
            const completed = task.subtasks.filter(st => st.completed).length;
            return Math.round((completed / task.subtasks.length) * 100);
        }

        function getCompletedSubtasksCount(task) {
            return task.subtasks.filter(st => st.completed).length;
        }

        function toggleTaskComplete(taskId) {
            const task = tasks.find(t => t.id === taskId);
            if (task) {
                task.completed = !task.completed;
                if (task.completed && task.timerRunning) {
                    task.timerRunning = false;
                }
                saveTasks();
                addNotification(
                    task.completed ? 'Task Completed' : 'Task Marked Incomplete',
                    `"${task.title}" has been marked as ${task.completed ? 'completed' : 'incomplete'}.`
                );
            }
        }

        function deleteTask(taskId) {
            if (confirm('Are you sure you want to delete this task?')) {
                const taskIndex = tasks.findIndex(t => t.id === taskId);
                if (taskIndex !== -1) {
                    const task = tasks[taskIndex];
                    tasks.splice(taskIndex, 1);
                    saveTasks();
                    addNotification('Task Deleted', `"${task.title}" has been deleted.`);
                }
            }
        }

        function shareTask(task) {
            // In a real app, this would implement actual sharing functionality
            const shareText = `Task: ${task.title}\nDescription: ${task.description || 'No description'}\nDue: ${task.dueDate}\nPriority: ${task.priority}`;
            if (navigator.share) {
                navigator.share({
                    title: task.title,
                    text: shareText
                }).catch(err => {
                    console.log('Error sharing:', err);
                    alert('Sharing failed. Here is the task info:\n\n' + shareText);
                });
            } else {
                alert('Sharing not supported in your browser. Here is the task info:\n\n' + shareText);
            }
        }

        function toggleTaskTimer(taskId) {
            const task = tasks.find(t => t.id === taskId);
            if (task) {
                task.timerRunning = !task.timerRunning;
                saveTasks();
                renderTasks();
            }
        }

        function updateTaskTimers() {
            tasks.forEach(task => {
                if (task.timerRunning) {
                    task.timeSpent++;
                }
            });
            saveTasks();
        }

        function toggleTaskSelection(taskId) {
            const index = selectedTasks.indexOf(taskId);
            if (index === -1) {
                selectedTasks.push(taskId);
            } else {
                selectedTasks.splice(index, 1);
            }
            updateBulkActions();
        }

        function updateBulkActions() {
            if (selectedTasks.length > 0) {
                bulkActions.classList.add('show');
                bulkCount.textContent = `${selectedTasks.length} task${selectedTasks.length !== 1 ? 's' : ''} selected`;
            } else {
                bulkActions.classList.remove('show');
            }
        }

        function completeSelectedTasks() {
            selectedTasks.forEach(taskId => {
                const task = tasks.find(t => t.id === taskId);
                if (task && !task.completed) {
                    task.completed = true;
                    if (task.timerRunning) {
                        task.timerRunning = false;
                    }
                }
            });
            saveTasks();
            addNotification('Tasks Completed', `${selectedTasks.length} tasks have been marked as completed.`);
            selectedTasks = [];
            updateBulkActions();
        }

        function deleteSelectedTasks() {
            if (confirm(`Are you sure you want to delete ${selectedTasks.length} task${selectedTasks.length !== 1 ? 's' : ''}?`)) {
                tasks = tasks.filter(t => !selectedTasks.includes(t.id));
                saveTasks();
                addNotification('Tasks Deleted', `${selectedTasks.length} tasks have been deleted.`);
                selectedTasks = [];
                updateBulkActions();
            }
        }

        function clearSelectedTasks() {
            selectedTasks = [];
            updateBulkActions();
            renderTasks();
        }

        function toggleFilterDropdown() {
            filterDropdown.classList.toggle('show');
            sortDropdown.classList.remove('show');
        }

        function toggleSortDropdown() {
            sortDropdown.classList.toggle('show');
            filterDropdown.classList.remove('show');
        }

        function toggleView(view) {
            viewToggle.forEach(btn => {
                btn.classList.toggle('active', btn.dataset.view === view);
            });
            
            if (view === 'list') {
                taskList.style.display = 'flex';
                graphView.classList.remove('active');
            } else {
                taskList.style.display = 'none';
                graphView.classList.add('active');
                // In a real app, you would render charts here
            }
        }

        // Drag and drop functions
        function handleDragStart(e) {
            e.target.classList.add('dragging');
            e.dataTransfer.setData('text/plain', e.target.dataset.id);
            e.dataTransfer.effectAllowed = 'move';
        }

        function handleDragOver(e) {
            e.preventDefault();
            const draggingItem = document.querySelector('.dragging');
            const afterElement = getDragAfterElement(taskList, e.clientY);
            
            if (afterElement) {
                taskList.insertBefore(draggingItem, afterElement);
            } else {
                taskList.appendChild(draggingItem);
            }
        }

        function handleDragLeave(e) {
            e.preventDefault();
        }

        function handleDrop(e) {
            e.preventDefault();
            const taskId = parseInt(e.dataTransfer.getData('text/plain'));
            const task = tasks.find(t => t.id === taskId);
            const taskElements = Array.from(taskList.children);
            const newIndex = taskElements.findIndex(el => el.dataset.id === taskId.toString());
            
            if (newIndex !== -1) {
                const oldIndex = tasks.findIndex(t => t.id === taskId);
                if (oldIndex !== -1 && oldIndex !== newIndex) {
                    // Reorder tasks array
                    tasks.splice(newIndex, 0, tasks.splice(oldIndex, 1)[0]);
                    saveTasks();
                }
            }
        }

        function handleDragEnd(e) {
            e.target.classList.remove('dragging');
        }

        function getDragAfterElement(container, y) {
            const draggableElements = [...container.querySelectorAll('.task-item:not(.dragging)')];
            
            return draggableElements.reduce((closest, child) => {
                const box = child.getBoundingClientRect();
                const offset = y - box.top - box.height / 2;
                
                if (offset < 0 && offset > closest.offset) {
                    return { offset: offset, element: child };
                } else {
                    return closest;
                }
            }, { offset: Number.NEGATIVE_INFINITY }).element;
        }

        // History functions
        function saveHistory() {
            // Only keep history up to the current index
            taskHistory = taskHistory.slice(0, historyIndex + 1);
            // Add current state to history
            taskHistory.push(JSON.stringify(tasks));
            historyIndex++;
            
            // Enable/disable undo/redo buttons
            undoBtn.disabled = historyIndex <= 0;
            redoBtn.disabled = historyIndex >= taskHistory.length - 1;
        }

        function undoAction() {
            if (historyIndex > 0) {
                historyIndex--;
                tasks = JSON.parse(taskHistory[historyIndex]);
                saveTasks();
                renderTasks();
            }
        }

        function redoAction() {
            if (historyIndex < taskHistory.length - 1) {
                historyIndex++;
                tasks = JSON.parse(taskHistory[historyIndex]);
                saveTasks();
                renderTasks();
            }
        }

        // Utility functions
        function formatDate(dateString) {
            const date = new Date(dateString);
            return date.toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' });
        }

        function formatTime(seconds) {
            const hours = Math.floor(seconds / 3600);
            const minutes = Math.floor((seconds % 3600) / 60);
            const secs = seconds % 60;
            
            return `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;
        }

        function debounce(func, wait) {
            let timeout;
            return function() {
                const context = this, args = arguments;
                clearTimeout(timeout);
                timeout = setTimeout(() => func.apply(context, args), wait);
            };
        }

        function updateUI() {
            if (!currentUser) return;
            
            // Update profile picture
            profilePic.src = currentUser.profilePic;
            
            // Update task counts
            updateTaskCounts();
            
            // Render tasks
            renderTasks();
            
            // Start task timer updates
            setInterval(updateTaskTimers, 1000);
            
            // Save initial history state
            saveHistory();
        }

        // Initialize the app
        document.addEventListener('DOMContentLoaded', initApp);
    </script>
</body>
</html>
