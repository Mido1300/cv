<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Professional To-Do App</title>
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <!-- Font Awesome for icons -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <!-- Flatpickr for date picker -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
    <!-- Chart.js for graphs -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <!-- jsPDF for PDF export -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <!-- xlsx for Excel export -->
    <script src="https://cdn.jsdelivr.net/npm/xlsx/dist/xlsx.full.min.js"></script>
    <!-- Flatpickr JS -->
    <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
    <style>
        :root {
            --primary-color: #5D5CDE;
            --primary-hover: #4847b3;
            --success-color: #28A745;
            --warning-color: #FFC107;
            --danger-color: #DC3545;
            --orange-color: #FD7E14;
            --grey-color: #6C757D;
            --dark-blue: #00008B;
            --dark-red: #8B0000;
            --light-red: #4B0000;
            --box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            --box-shadow-hover: 0 10px 15px rgba(0, 0, 0, 0.2);
            --transition: all 0.3s ease;
            
            --light-bg-color: #ffffff;
            --light-text-color: #333333;
            --light-card-bg: #f8f9fa;
            --light-border: #dee2e6;
            
            --dark-bg-color: #1C2526;
            --dark-bg-gradient: linear-gradient(135deg, #1C2526, #000000);
            --dark-text-color: #ffffff;
            --dark-card-bg: #2c3e50;
            --dark-border: #4a5568;
        }

        .dark {
            --bg-color: var(--dark-bg-color);
            --bg-gradient: var(--dark-bg-gradient);
            --text-color: var(--dark-text-color);
            --card-bg: var(--dark-card-bg);
            --border-color: var(--dark-border);
            --input-bg: #2a3b4d;
            --placeholder-color: #adb5bd;
        }

        :root:not(.dark) {
            --bg-color: var(--light-bg-color);
            --bg-gradient: none;
            --text-color: var(--light-text-color);
            --card-bg: var(--light-card-bg);
            --border-color: var(--light-border);
            --input-bg: #ffffff;
            --placeholder-color: #6c757d;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Poppins', sans-serif;
            transition: var(--transition);
        }

        body {
            background: var(--bg-gradient);
            background-color: var(--bg-color);
            color: var(--text-color);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            overflow-x: hidden;
        }

        .container {
            width: 100%;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .hidden {
            display: none !important;
        }

        /* Login Page Styles */
        .login-container {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            padding: 20px;
        }

        .login-form {
            background-color: var(--card-bg);
            border-radius: 10px;
            padding: 30px;
            width: 100%;
            max-width: 400px;
            box-shadow: var(--box-shadow);
            text-align: center;
            animation: fadeIn 0.5s ease;
        }

        .login-form h2 {
            margin-bottom: 20px;
            color: var(--text-color);
            font-weight: 600;
        }

        .form-group {
            margin-bottom: 20px;
            text-align: left;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: var(--text-color);
        }

        .form-control {
            width: 100%;
            padding: 12px 15px;
            border-radius: 5px;
            border: 1px solid var(--border-color);
            background-color: var(--input-bg);
            color: var(--text-color);
            font-size: 16px;
            transition: var(--transition);
        }

        .form-control:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 2px rgba(93, 92, 222, 0.25);
        }

        .form-control::placeholder {
            color: var(--placeholder-color);
        }

        .login-btn-container {
            display: flex;
            justify-content: center;
            margin-top: 30px;
            margin-bottom: 20px;
        }

        .btn-login {
            background: linear-gradient(90deg, var(--primary-color), var(--primary-hover));
            color: white;
            border: none;
            border-radius: 5px;
            padding: 12px 0;
            width: 100%;
            font-size: 16px;
            font-weight: 500;
            cursor: pointer;
            position: relative;
            overflow: hidden;
            box-shadow: var(--box-shadow);
        }

        .btn-login:before {
            content: "";
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: linear-gradient(
                to right,
                rgba(255, 255, 255, 0.1),
                rgba(255, 255, 255, 0.3),
                rgba(255, 255, 255, 0.1)
            );
            border-radius: 50%;
            transform: scale(0);
            opacity: 0;
            transition: transform 0.8s, opacity 0.8s;
            z-index: 1;
        }

        .btn-login:hover:before {
            transform: scale(1);
            opacity: 1;
            animation: moveLightEffect 3s infinite linear;
        }

        @keyframes moveLightEffect {
            0% {
                transform: translate(-50%, -50%) rotate(0deg);
            }
            100% {
                transform: translate(-50%, -50%) rotate(360deg);
            }
        }

        .btn-login:hover {
            transform: translateY(-3px);
            box-shadow: var(--box-shadow-hover);
        }

        .btn-login:active {
            transform: translateY(0);
        }

        .btn-register {
            color: var(--dark-blue);
            text-decoration: none;
            font-weight: 500;
            transition: var(--transition);
        }

        .btn-register:hover {
            text-decoration: underline;
        }

        .register-section {
            margin-top: 20px;
            color: var(--text-color);
        }

        /* Modal Styles */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0, 0, 0, 0.7);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s ease, visibility 0.3s ease;
        }

        .modal-overlay.active {
            opacity: 1;
            visibility: visible;
        }

        .modal {
            background-color: var(--card-bg);
            border-radius: 10px;
            box-shadow: var(--box-shadow);
            padding: 25px;
            width: 90%;
            max-width: 500px;
            max-height: 90vh;
            overflow-y: auto;
            transform: translateY(-50px);
            opacity: 0;
            transition: transform 0.3s ease, opacity 0.3s ease;
        }

        .modal-overlay.active .modal {
            transform: translateY(0);
            opacity: 1;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            border-bottom: 1px solid var(--border-color);
            padding-bottom: 15px;
        }

        .modal-title {
            font-size: 1.25rem;
            font-weight: 600;
            color: var(--text-color);
        }

        .modal-close {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: var(--grey-color);
        }

        .modal-close:hover {
            color: var(--danger-color);
        }

        .modal-body {
            margin-bottom: 20px;
        }

        .modal-footer {
            display: flex;
            justify-content: flex-end;
            gap: 10px;
            border-top: 1px solid var(--border-color);
            padding-top: 15px;
        }

        .dropdown-container {
            position: relative;
        }

        .dropdown-menu {
            position: absolute;
            top: 100%;
            right: 0;
            background-color: var(--card-bg);
            border-radius: 5px;
            box-shadow: var(--box-shadow);
            width: 200px;
            z-index: 10;
            opacity: 0;
            transform: translateY(10px);
            visibility: hidden;
            transition: var(--transition);
        }

        .dropdown-menu.show {
            opacity: 1;
            transform: translateY(0);
            visibility: visible;
        }

        .dropdown-item {
            padding: 10px 15px;
            display: block;
            color: var(--text-color);
            text-decoration: none;
            cursor: pointer;
            transition: var(--transition);
        }

        .dropdown-item:hover {
            background-color: rgba(93, 92, 222, 0.1);
        }

        .dropdown-divider {
            border-top: 1px solid var(--border-color);
            margin: 5px 0;
        }

        /* Dashboard Styles */
        .dashboard {
            display: flex;
            flex-direction: column;
            min-height: 100vh;
        }

        .header {
            background-color: var(--card-bg);
            box-shadow: var(--box-shadow);
            padding: 15px 20px;
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .brand {
            display: flex;
            align-items: center;
            color: var(--text-color);
            text-decoration: none;
            font-size: 1.5rem;
            font-weight: 700;
        }

        .header-controls {
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .timer-container {
            display: flex;
            align-items: center;
            background-color: rgba(93, 92, 222, 0.1);
            border-radius: 20px;
            padding: 5px 15px;
            margin-right: 15px;
        }

        .timer {
            font-size: 1.2rem;
            font-weight: 600;
            color: var(--primary-color);
            margin: 0 10px;
        }

        .timer-controls {
            display: flex;
            gap: 5px;
        }

        .timer-btn {
            background: none;
            border: none;
            color: var(--primary-color);
            cursor: pointer;
            font-size: 1rem;
            padding: 3px;
            border-radius: 50%;
            transition: var(--transition);
        }

        .timer-btn:hover {
            background-color: rgba(93, 92, 222, 0.2);
        }

        .mode-toggle {
            background: none;
            border: none;
            cursor: pointer;
            font-size: 1.25rem;
            color: var(--text-color);
            padding: 5px;
            border-radius: 50%;
            transition: var(--transition);
        }

        .mode-toggle:hover {
            background-color: rgba(93, 92, 222, 0.1);
        }

        .profile-container {
            position: relative;
            display: flex;
            align-items: center;
        }

        .status-indicator {
            padding: 5px 10px;
            border-radius: 15px;
            font-weight: 500;
            font-size: 0.8rem;
            margin-right: 10px;
        }

        .status-login {
            background-color: rgba(40, 167, 69, 0.2);
            color: #28A745;
        }

        .status-logout {
            background-color: rgba(220, 53, 69, 0.2);
            color: #DC3545;
        }

        .status-break {
            background-color: rgba(255, 193, 7, 0.2);
            color: #FFC107;
        }

        .status-shadow {
            background-color: rgba(108, 117, 125, 0.2);
            color: #6C757D;
        }

        .profile {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            object-fit: cover;
            cursor: pointer;
            border: 2px solid var(--primary-color);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }

        .profile:hover {
            transform: scale(1.05);
            box-shadow: 0 0 10px rgba(93, 92, 222, 0.5);
        }

        .notification-badge {
            position: absolute;
            top: -5px;
            right: -5px;
            background-color: var(--danger-color);
            color: white;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 0.7rem;
            font-weight: 600;
        }

        /* Main Content Styles */
        .main-content {
            flex: 1;
            padding: 20px;
            max-width: 1200px;
            margin: 0 auto;
            width: 100%;
        }

        .dashboard-title {
            font-size: 1.75rem;
            font-weight: 600;
            margin-bottom: 20px;
            color: var(--text-color);
        }

        .dashboard-summary {
            display: grid;
            grid-template-columns: 1fr;
            gap: 20px;
            margin-bottom: 30px;
        }

        .total-tasks-card {
            background-color: var(--card-bg);
            border-radius: 10px;
            padding: 15px;
            box-shadow: var(--box-shadow);
            transition: var(--transition);
            text-align: center;
        }

        .total-tasks-card:hover {
            transform: translateY(-5px);
            box-shadow: var(--box-shadow-hover);
        }

        .total-tasks-card h3 {
            font-size: 1.5rem;
            margin-bottom: 10px;
            color: var(--primary-color);
        }

        .total-tasks-card p {
            font-size: 2rem;
            font-weight: 700;
            color: var(--text-color);
        }

        .task-summary-container {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 20px;
        }

        .summary-card {
            background-color: var(--card-bg);
            border-radius: 10px;
            padding: 20px;
            box-shadow: var(--box-shadow);
            transition: var(--transition);
            text-align: center;
        }

        .summary-card:hover {
            transform: translateY(-5px);
            box-shadow: var(--box-shadow-hover);
        }

        .summary-card h3 {
            font-size: 1.25rem;
            margin-bottom: 15px;
        }

        .summary-card.completed {
            border-left: 5px solid var(--success-color);
        }

        .summary-card.completed h3 {
            color: var(--success-color);
        }

        .summary-card.pending {
            border-left: 5px solid var(--warning-color);
        }

        .summary-card.pending h3 {
            color: var(--warning-color);
        }

        .summary-card p {
            font-size: 2rem;
            font-weight: 700;
            color: var(--text-color);
        }

        .tasks-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            flex-wrap: wrap;
            gap: 10px;
        }

        .tasks-title {
            font-size: 1.5rem;
            font-weight: 600;
            color: var(--text-color);
        }

        .tasks-actions {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            padding: 8px 16px;
            border-radius: 5px;
            font-weight: 500;
            cursor: pointer;
            transition: var(--transition);
            font-size: 14px;
            border: none;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            color: white;
        }

        .btn i {
            margin-right: 5px;
        }

        .btn-primary {
            background-color: var(--primary-color);
        }

        .btn-primary:hover {
            background-color: var(--primary-hover);
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.15);
        }

        .btn-success {
            background-color: var(--success-color);
        }

        .btn-success:hover {
            background-color: #218838;
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.15);
        }

        .btn-warning {
            background-color: var(--warning-color);
            color: #212529;
        }

        .btn-warning:hover {
            background-color: #e0a800;
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.15);
        }

        .btn-danger {
            background-color: var(--danger-color);
        }

        .btn-danger:hover {
            background-color: #c82333;
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.15);
        }

        .btn-secondary {
            background-color: var(--grey-color);
        }

        .btn-secondary:hover {
            background-color: #5a6268;
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.15);
        }

        .search-filter-container {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            flex-wrap: wrap;
            gap: 15px;
        }

        .search-box {
            display: flex;
            align-items: center;
            background-color: var(--card-bg);
            border-radius: 5px;
            padding: 8px 15px;
            box-shadow: var(--box-shadow);
            flex: 1;
            max-width: 300px;
        }

        .search-box i {
            color: var(--grey-color);
            margin-right: 10px;
        }

        .search-input {
            border: none;
            background: none;
            flex: 1;
            color: var(--text-color);
            font-size: 16px;
        }

        .search-input:focus {
            outline: none;
        }

        .search-input::placeholder {
            color: var(--placeholder-color);
        }

        .filter-container {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .filter-dropdown {
            position: relative;
        }

        .filter-btn {
            background-color: var(--card-bg);
            border: 1px solid var(--border-color);
            border-radius: 5px;
            padding: 8px 15px;
            display: flex;
            align-items: center;
            gap: 8px;
            color: var(--text-color);
            cursor: pointer;
            transition: var(--transition);
            font-size: 14px;
        }

        .filter-btn:hover {
            background-color: rgba(93, 92, 222, 0.1);
        }

        .filter-menu {
            position: absolute;
            top: 100%;
            left: 0;
            background-color: var(--card-bg);
            border-radius: 5px;
            box-shadow: var(--box-shadow);
            width: 200px;
            z-index: 10;
            opacity: 0;
            transform: translateY(10px);
            visibility: hidden;
            transition: var(--transition);
        }

        .filter-menu.show {
            opacity: 1;
            transform: translateY(5px);
            visibility: visible;
        }

        .filter-item {
            padding: 8px 15px;
            color: var(--text-color);
            cursor: pointer;
            transition: var(--transition);
        }

        .filter-item:hover {
            background-color: rgba(93, 92, 222, 0.1);
        }

        .filter-item.active {
            background-color: rgba(93, 92, 222, 0.2);
            font-weight: 500;
        }

        .tasks-container {
            margin-bottom: 30px;
        }

        .task-list {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .task-item {
            background-color: var(--card-bg);
            border-radius: 10px;
            box-shadow: var(--box-shadow);
            padding: 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: var(--transition);
            cursor: move;
            position: relative;
        }

        .task-item:hover {
            transform: translateY(-3px);
            box-shadow: var(--box-shadow-hover);
        }

        .task-item.dragging {
            opacity: 0.5;
            transform: scale(0.95);
        }

        .task-checkbox {
            position: relative;
            width: 20px;
            height: 20px;
            margin-right: 15px;
        }

        .task-checkbox input {
            opacity: 0;
            width: 0;
            height: 0;
            position: absolute;
        }

        .checkmark {
            position: absolute;
            top: 0;
            left: 0;
            width: 20px;
            height: 20px;
            border: 2px solid var(--primary-color);
            border-radius: 4px;
            transition: var(--transition);
        }

        .task-checkbox input:checked ~ .checkmark {
            background-color: var(--primary-color);
        }

        .checkmark:after {
            content: "";
            position: absolute;
            display: none;
            left: 6px;
            top: 2px;
            width: 5px;
            height: 10px;
            border: solid white;
            border-width: 0 2px 2px 0;
            transform: rotate(45deg);
        }

        .task-checkbox input:checked ~ .checkmark:after {
            display: block;
        }

        .task-content {
            flex: 1;
            padding: 0 15px;
            overflow: hidden;
        }

        .task-title {
            font-weight: 600;
            color: var(--text-color);
            margin-bottom: 5px;
            display: -webkit-box;
            -webkit-line-clamp: 1;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }

        .task-description {
            color: var(--grey-color);
            font-size: 0.9rem;
            margin-bottom: 8px;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }

        .task-meta {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            font-size: 0.8rem;
        }

        .task-due {
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .task-priority {
            padding: 2px 8px;
            border-radius: 10px;
            font-weight: 500;
        }

        .priority-high {
            background-color: rgba(220, 53, 69, 0.2);
            color: var(--danger-color);
        }

        .priority-medium {
            background-color: rgba(253, 126, 20, 0.2);
            color: var(--orange-color);
        }

        .priority-low {
            background-color: rgba(108, 117, 125, 0.2);
            color: var(--grey-color);
        }

        .task-category {
            background-color: rgba(93, 92, 222, 0.2);
            color: var(--primary-color);
            padding: 2px 8px;
            border-radius: 10px;
            font-weight: 500;
        }

        .task-actions {
            display: flex;
            gap: 10px;
        }

        .task-btn {
            background: none;
            border: none;
            color: var(--text-color);
            cursor: pointer;
            font-size: 1rem;
            padding: 5px;
            border-radius: 5px;
            transition: var(--transition);
        }

        .task-btn:hover {
            background-color: rgba(93, 92, 222, 0.1);
        }

        .task-btn-view:hover {
            color: var(--primary-color);
        }

        .task-btn-edit:hover {
            color: var(--warning-color);
        }

        .task-btn-delete:hover {
            color: var(--danger-color);
        }

        .task-btn-timer:hover {
            color: var(--success-color);
        }

        .task-toggle {
            position: relative;
            display: inline-block;
            width: 44px;
            height: 24px;
            margin-left: 10px;
        }

        .task-toggle input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .toggle-slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            transition: var(--transition);
            border-radius: 34px;
        }

        .toggle-slider:before {
            position: absolute;
            content: "";
            height: 16px;
            width: 16px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: var(--transition);
            border-radius: 50%;
        }

        .task-toggle input:checked + .toggle-slider {
            background-color: var(--success-color);
        }

        .task-toggle input:checked + .toggle-slider:before {
            transform: translateX(20px);
        }

        .task-border-expired {
            border-left: 4px solid var(--danger-color);
        }

        .task-border-soon {
            border-left: 4px solid var(--warning-color);
        }

        .task-border-future {
            border-left: 4px solid var(--success-color);
        }

        .task-completed {
            background-color: rgba(40, 167, 69, 0.1);
        }

        .task-completed .task-title,
        .task-completed .task-description {
            text-decoration: line-through;
            color: var(--grey-color);
        }

        .view-switcher {
            display: flex;
            justify-content: center;
            margin-bottom: 20px;
        }

        .view-btn {
            background-color: var(--card-bg);
            border: 1px solid var(--border-color);
            padding: 8px 20px;
            cursor: pointer;
            transition: var(--transition);
            color: var(--text-color);
            font-weight: 500;
        }

        .view-btn:first-child {
            border-top-left-radius: 5px;
            border-bottom-left-radius: 5px;
        }

        .view-btn:last-child {
            border-top-right-radius: 5px;
            border-bottom-right-radius: 5px;
        }

        .view-btn.active {
            background-color: var(--primary-color);
            color: white;
            border-color: var(--primary-color);
        }

        .graph-container {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 20px;
            margin-bottom: 30px;
        }

        .graph-card {
            background-color: var(--card-bg);
            border-radius: 10px;
            box-shadow: var(--box-shadow);
            padding: 20px;
            transition: var(--transition);
            height: 100%;
        }

        .graph-card:hover {
            transform: translateY(-5px);
            box-shadow: var(--box-shadow-hover);
        }

        .graph-title {
            font-size: 1.25rem;
            font-weight: 600;
            margin-bottom: 15px;
            text-align: center;
            color: var(--text-color);
        }

        .graph-canvas-container {
            width: 100%;
            height: 300px;
            position: relative;
        }

        .batch-actions {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background-color: var(--card-bg);
            padding: 15px;
            display: flex;
            justify-content: center;
            gap: 15px;
            transform: translateY(100%);
            transition: transform 0.3s ease;
            box-shadow: 0 -2px 10px rgba(0, 0, 0, 0.1);
            z-index: 90;
        }

        .batch-actions.show {
            transform: translateY(0);
        }

        .users-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .user-card {
            background-color: var(--card-bg);
            border-radius: 10px;
            box-shadow: var(--box-shadow);
            padding: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
            transition: var(--transition);
        }

        .user-card:hover {
            transform: translateY(-5px) scale(1.02);
            box-shadow: var(--box-shadow-hover);
        }

        .user-avatar {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            object-fit: cover;
            margin-bottom: 15px;
            border: 3px solid var(--primary-color);
            box-shadow: 0 0 10px rgba(93, 92, 222, 0.3);
        }

        .user-name {
            font-size: 1.2rem;
            font-weight: 600;
            margin-bottom: 5px;
            color: var(--text-color);
            text-align: center;
        }

        .user-email {
            color: var(--grey-color);
            font-size: 0.9rem;
            margin-bottom: 10px;
            text-align: center;
        }

        .user-role {
            background-color: rgba(93, 92, 222, 0.2);
            color: var(--primary-color);
            padding: 3px 12px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 500;
        }

        .toast-container {
            position: fixed;
            bottom: 20px;
            left: 20px;
            z-index: 1000;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .toast {
            background-color: var(--card-bg);
            border-radius: 5px;
            box-shadow: var(--box-shadow);
            padding: 12px 20px;
            display: flex;
            align-items: center;
            transform: translateX(-100%);
            opacity: 0;
            transition: transform 0.3s ease, opacity 0.3s ease;
            max-width: 350px;
        }

        .toast.show {
            transform: translateX(0);
            opacity: 1;
        }

        .toast-icon {
            margin-right: 12px;
            font-size: 1.25rem;
        }

        .toast-success .toast-icon {
            color: var(--success-color);
        }

        .toast-warning .toast-icon {
            color: var(--warning-color);
        }

        .toast-error .toast-icon {
            color: var(--danger-color);
        }

        .toast-info .toast-icon {
            color: var(--primary-color);
        }

        .toast-message {
            flex: 1;
            color: var(--text-color);
        }

        .toast-close {
            background: none;
            border: none;
            color: var(--grey-color);
            cursor: pointer;
            font-size: 1rem;
            transition: var(--transition);
        }

        .toast-close:hover {
            color: var(--danger-color);
        }

        .insights-container {
            margin-bottom: 30px;
        }

        .insights-title {
            font-size: 1.5rem;
            font-weight: 600;
            margin-bottom: 20px;
            color: var(--text-color);
        }

        .insights-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 20px;
        }

        .insight-card {
            background-color: var(--card-bg);
            border-radius: 10px;
            box-shadow: var(--box-shadow);
            padding: 20px;
            transition: var(--transition);
        }

        .insight-card:hover {
            transform: translateY(-5px);
            box-shadow: var(--box-shadow-hover);
        }

        .insight-header {
            display: flex;
            align-items: center;
            margin-bottom: 15px;
        }

        .insight-icon {
            width: 40px;
            height: 40px;
            border-radius: 10px;
            display: flex;
            justify-content: center;
            align-items: center;
            margin-right: 15px;
            font-size: 1.25rem;
        }

        .insight-icon-productivity {
            background-color: rgba(93, 92, 222, 0.2);
            color: var(--primary-color);
        }

        .insight-icon-performance {
            background-color: rgba(40, 167, 69, 0.2);
            color: var(--success-color);
        }

        .insight-icon-overdue {
            background-color: rgba(220, 53, 69, 0.2);
            color: var(--danger-color);
        }

        .insight-icon-categories {
            background-color: rgba(253, 126, 20, 0.2);
            color: var(--orange-color);
        }

        .insight-title {
            font-weight: 600;
            color: var(--text-color);
        }

        .insight-value {
            font-size: 1.75rem;
            font-weight: 700;
            margin: 10px 0;
            color: var(--text-color);
        }

        .insight-description {
            color: var(--grey-color);
            font-size: 0.9rem;
        }

        .notifications-container {
            max-height: 400px;
            overflow-y: auto;
            background-color: var(--card-bg);
            border-radius: 10px;
            box-shadow: var(--box-shadow);
        }

        .notification {
            padding: 15px;
            border-bottom: 1px solid var(--border-color);
            display: flex;
            align-items: center;
            transition: var(--transition);
            cursor: pointer;
        }

        .notification:hover {
            background-color: rgba(93, 92, 222, 0.1);
        }

        .notification:last-child {
            border-bottom: none;
        }

        .notification-icon {
            width: 40px;
            height: 40px;
            border-radius: 10px;
            display: flex;
            justify-content: center;
            align-items: center;
            margin-right: 15px;
            font-size: 1.25rem;
        }

        .notification-icon-task {
            background-color: rgba(93, 92, 222, 0.2);
            color: var(--primary-color);
        }

        .notification-icon-warning {
            background-color: rgba(255, 193, 7, 0.2);
            color: var(--warning-color);
        }

        .notification-icon-alert {
            background-color: rgba(220, 53, 69, 0.2);
            color: var(--danger-color);
        }

        .notification-content {
            flex: 1;
        }

        .notification-title {
            font-weight: 600;
            margin-bottom: 5px;
            color: var(--text-color);
        }

        .notification-message {
            color: var(--grey-color);
            font-size: 0.9rem;
        }

        .notification-time {
            font-size: 0.8rem;
            color: var(--grey-color);
            margin-left: 10px;
        }

        .notification-unread {
            position: relative;
        }

        .notification-unread:before {
            content: "";
            position: absolute;
            top: 15px;
            right: 15px;
            width: 10px;
            height: 10px;
            border-radius: 50%;
            background-color: var(--primary-color);
        }

        .undo-redo-container {
            display: flex;
            gap: 10px;
            margin-left: 20px;
        }

        .subtasks-container {
            margin-top: 10px;
            padding-left: 20px;
        }

        .subtask-item {
            display: flex;
            align-items: center;
            margin-bottom: 5px;
            font-size: 0.9rem;
        }

        .subtask-item i {
            color: var(--grey-color);
            margin-right: 5px;
            font-size: 0.8rem;
        }

        .task-timer-info {
            display: flex;
            align-items: center;
            margin-left: 15px;
            background-color: rgba(93, 92, 222, 0.1);
            padding: 3px 8px;
            border-radius: 4px;
            font-size: 0.8rem;
            color: var(--primary-color);
        }

        .task-timer-info i {
            margin-right: 5px;
        }

        /* Responsive Styles */
        @media (max-width: 991px) {
            .graph-container {
                grid-template-columns: 1fr;
            }
        }

        @media (max-width: 768px) {
            .header-content {
                flex-direction: column;
                gap: 15px;
            }

            .header-controls {
                width: 100%;
                justify-content: space-between;
            }

            .task-summary-container {
                grid-template-columns: 1fr;
            }

            .tasks-header {
                flex-direction: column;
                align-items: flex-start;
            }

            .tasks-actions {
                width: 100%;
                justify-content: space-between;
            }

            .search-filter-container {
                flex-direction: column;
                align-items: flex-start;
            }

            .search-box {
                width: 100%;
                max-width: none;
            }

            .filter-container {
                width: 100%;
                justify-content: space-between;
            }

            .task-item {
                flex-direction: column;
                align-items: flex-start;
            }

            .task-content {
                width: 100%;
                padding: 10px 0;
            }

            .task-actions {
                width: 100%;
                justify-content: flex-end;
                margin-top: 10px;
            }
        }

        @media (max-width: 480px) {
            .login-form,
            .modal {
                padding: 20px;
            }

            .insights-grid {
                grid-template-columns: 1fr;
            }

            .notification {
                flex-direction: column;
                align-items: flex-start;
            }

            .notification-icon {
                margin-bottom: 10px;
            }

            .notification-time {
                margin-left: 0;
                margin-top: 5px;
            }
        }

        /* Animations */
        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(-20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes scaleIn {
            from {
                opacity: 0;
                transform: scale(0.9);
            }
            to {
                opacity: 1;
                transform: scale(1);
            }
        }

        @keyframes slideInRight {
            from {
                opacity: 0;
                transform: translateX(20px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        .fade-in {
            animation: fadeIn 0.5s ease forwards;
        }

        .scale-in {
            animation: scaleIn 0.5s ease forwards;
        }

        .slide-in-right {
            animation: slideInRight 0.5s ease forwards;
        }
    </style>
</head>
<body>
    <!-- Login Page -->
    <div class="login-container" id="loginPage">
        <div class="login-form fade-in">
            <h2>Welcome to Todo App</h2>
            <div class="form-group">
                <label for="email">Email</label>
                <input type="email" class="form-control" id="email" placeholder="Enter your email" value="test@example.com">
            </div>
            <div class="form-group">
                <label for="password">Password</label>
                <input type="password" class="form-control" id="password" placeholder="Enter your password" value="123456">
            </div>
            <div class="login-btn-container">
                <button type="button" class="btn-login" id="loginBtn">Login</button>
            </div>
            <div class="register-section">
                Don't have an account? <a href="#" class="btn-register" id="registerLink">Register now</a>
            </div>
        </div>
    </div>

    <!-- Dashboard -->
    <div class="dashboard hidden" id="dashboard">
        <!-- Header -->
        <header class="header">
            <div class="header-content">
                <a href="#" class="brand">
                    <h1>To-Do App</h1>
                </a>
                <div class="header-controls">
                    <div class="timer-container">
                        <button class="timer-btn" id="timerPlayPause">
                            <i class="fas fa-play" id="timerIcon"></i>
                        </button>
                        <div class="timer" id="appTimer">00:00:00</div>
                        <button class="timer-btn" id="timerReset">
                            <i class="fas fa-redo-alt"></i>
                        </button>
                    </div>
                    
                    <div class="undo-redo-container">
                        <button class="btn btn-secondary" id="undoBtn" title="Undo" disabled>
                            <i class="fas fa-undo"></i>
                        </button>
                        <button class="btn btn-secondary" id="redoBtn" title="Redo" disabled>
                            <i class="fas fa-redo"></i>
                        </button>
                    </div>
                    
                    <button class="mode-toggle" id="modeToggle">
                        <i class="fas fa-sun" id="modeIcon"></i>
                    </button>
                    
                    <div class="profile-container">
                        <div class="status-indicator status-login" id="statusIndicator">Login</div>
                        <img src="https://i.imgur.com/EyXqkTX.png" alt="Profile" class="profile" id="profilePic">
                        <span class="notification-badge" id="notificationBadge">0</span>
                        <div class="dropdown-menu" id="profileDropdown">
                            <a href="#" class="dropdown-item" id="viewProfileBtn">
                                <i class="fas fa-user"></i> View Profile
                            </a>
                            <a href="#" class="dropdown-item" id="statusBtn">
                                <i class="fas fa-circle"></i> Change Status
                            </a>
                            <div class="dropdown-divider"></div>
                            <a href="#" class="dropdown-item" id="logoutBtn">
                                <i class="fas fa-sign-out-alt"></i> Logout
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </header>

        <!-- Main Content -->
        <div class="main-content">
            <!-- Dashboard Summary -->
            <h2 class="dashboard-title">Dashboard</h2>
            
            <div class="dashboard-summary">
                <div class="total-tasks-card">
                    <h3>Total Tasks</h3>
                    <p id="totalTasksCount">0</p>
                </div>
                
                <div class="task-summary-container">
                    <div class="summary-card completed">
                        <h3>Completed Tasks</h3>
                        <p id="completedTasksCount">0</p>
                    </div>
                    
                    <div class="summary-card pending">
                        <h3>Pending Tasks</h3>
                        <p id="pendingTasksCount">0</p>
                    </div>
                </div>
            </div>

            <!-- Tasks Section -->
            <div class="tasks-header">
                <h2 class="tasks-title">Tasks</h2>
                
                <div class="tasks-actions">
                    <button class="btn btn-success" id="addTaskBtn">
                        <i class="fas fa-plus"></i> Add Task
                    </button>
                    <button class="btn btn-primary" id="exportBtn">
                        <i class="fas fa-download"></i> Export
                    </button>
                    <button class="btn btn-primary" id="importBtn">
                        <i class="fas fa-upload"></i> Import
                    </button>
                    <button class="btn btn-primary" id="manageCategoriesBtn">
                        <i class="fas fa-tags"></i> Categories
                    </button>
                    <button class="btn btn-primary" id="usersBtn">
                        <i class="fas fa-users"></i> Users
                    </button>
                </div>
            </div>

            <div class="search-filter-container">
                <div class="search-box">
                    <i class="fas fa-search"></i>
                    <input type="text" class="search-input" id="searchInput" placeholder="Search tasks...">
                </div>
                
                <div class="filter-container">
                    <div class="filter-dropdown">
                        <button class="filter-btn" id="statusFilterBtn">
                            <i class="fas fa-filter"></i> Status
                            <i class="fas fa-chevron-down"></i>
                        </button>
                        <div class="filter-menu" id="statusFilterMenu">
                            <div class="filter-item active" data-value="all">All</div>
                            <div class="filter-item" data-value="active">Active</div>
                            <div class="filter-item" data-value="completed">Completed</div>
                        </div>
                    </div>
                    
                    <div class="filter-dropdown">
                        <button class="filter-btn" id="categoryFilterBtn">
                            <i class="fas fa-tag"></i> Category
                            <i class="fas fa-chevron-down"></i>
                        </button>
                        <div class="filter-menu" id="categoryFilterMenu">
                            <div class="filter-item active" data-value="all">All Categories</div>
                        </div>
                    </div>
                    
                    <div class="filter-dropdown">
                        <button class="filter-btn" id="priorityFilterBtn">
                            <i class="fas fa-flag"></i> Priority
                            <i class="fas fa-chevron-down"></i>
                        </button>
                        <div class="filter-menu" id="priorityFilterMenu">
                            <div class="filter-item active" data-value="all">All Priorities</div>
                            <div class="filter-item" data-value="high">High</div>
                            <div class="filter-item" data-value="medium">Medium</div>
                            <div class="filter-item" data-value="low">Low</div>
                        </div>
                    </div>
                    
                    <div class="filter-dropdown">
                        <button class="filter-btn" id="dateFilterBtn">
                            <i class="fas fa-calendar"></i> Due Date
                            <i class="fas fa-chevron-down"></i>
                        </button>
                        <div class="filter-menu" id="dateFilterMenu">
                            <div class="filter-item active" data-value="all">All Dates</div>
                            <div class="filter-item" data-value="today">Today</div>
                            <div class="filter-item" data-value="week">This Week</div>
                            <div class="filter-item" data-value="month">This Month</div>
                            <div class="filter-item" data-value="custom">Custom Range</div>
                        </div>
                    </div>
                    
                    <div class="filter-dropdown">
                        <button class="filter-btn" id="sortBtn">
                            <i class="fas fa-sort"></i> Sort
                            <i class="fas fa-chevron-down"></i>
                        </button>
                        <div class="filter-menu" id="sortMenu">
                            <div class="filter-item active" data-value="dueDate-asc">Due Date (Earliest)</div>
                            <div class="filter-item" data-value="dueDate-desc">Due Date (Latest)</div>
                            <div class="filter-item" data-value="title-asc">Title (A-Z)</div>
                            <div class="filter-item" data-value="title-desc">Title (Z-A)</div>
                            <div class="filter-item" data-value="priority-desc">Priority (High-Low)</div>
                            <div class="filter-item" data-value="priority-asc">Priority (Low-High)</div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="view-switcher">
                <button class="view-btn active" data-view="list" id="listViewBtn">List View</button>
                <button class="view-btn" data-view="graph" id="graphViewBtn">Graph View</button>
            </div>

            <!-- Task List View -->
            <div class="tasks-container" id="listView">
                <div class="task-list" id="taskList">
                    <!-- Tasks will be rendered here -->
                </div>
            </div>

            <!-- Graph View -->
            <div class="tasks-container hidden" id="graphView">
                <div class="graph-container">
                    <div class="graph-card">
                        <h3 class="graph-title">Tasks Progress</h3>
                        <div class="graph-canvas-container">
                            <canvas id="tasksProgressChart"></canvas>
                        </div>
                    </div>
                    
                    <div class="graph-card">
                        <h3 class="graph-title">Tasks Distribution</h3>
                        <div class="graph-canvas-container">
                            <canvas id="tasksDistributionChart"></canvas>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Insights Section -->
            <div class="insights-container">
                <h2 class="insights-title">Insights</h2>
                
                <div class="insights-grid">
                    <div class="insight-card">
                        <div class="insight-header">
                            <div class="insight-icon insight-icon-productivity">
                                <i class="fas fa-chart-line"></i>
                            </div>
                            <div class="insight-title">Productivity Rate</div>
                        </div>
                        <div class="insight-value" id="productivityRate">0%</div>
                        <div class="insight-description">Percentage of completed tasks</div>
                    </div>
                    
                    <div class="insight-card">
                        <div class="insight-header">
                            <div class="insight-icon insight-icon-performance">
                                <i class="fas fa-clock"></i>
                            </div>
                            <div class="insight-title">Avg. Completion Time</div>
                        </div>
                        <div class="insight-value" id="avgCompletionTime">0h</div>
                        <div class="insight-description">Average time spent on tasks</div>
                    </div>
                    
                    <div class="insight-card">
                        <div class="insight-header">
                            <div class="insight-icon insight-icon-overdue">
                                <i class="fas fa-exclamation-triangle"></i>
                            </div>
                            <div class="insight-title">Overdue Tasks</div>
                        </div>
                        <div class="insight-value" id="overdueTasksCount">0</div>
                        <div class="insight-description">Number of expired tasks</div>
                    </div>
                    
                    <div class="insight-card">
                        <div class="insight-header">
                            <div class="insight-icon insight-icon-categories">
                                <i class="fas fa-tags"></i>
                            </div>
                            <div class="insight-title">Categories</div>
                        </div>
                        <div class="insight-value" id="categoriesCount">0</div>
                        <div class="insight-description">Total number of categories</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Batch Actions Bar -->
        <div class="batch-actions" id="batchActions">
            <button class="btn btn-danger" id="batchDeleteBtn">
                <i class="fas fa-trash"></i> Delete Selected
            </button>
            <button class="btn btn-success" id="batchCompleteBtn">
                <i class="fas fa-check"></i> Mark as Completed
            </button>
            <button class="btn btn-secondary" id="batchCancelBtn">
                <i class="fas fa-times"></i> Cancel
            </button>
        </div>

        <!-- Toast Notifications -->
        <div class="toast-container" id="toastContainer">
            <!-- Toasts will be rendered here -->
        </div>
    </div>

    <!-- Modals -->
    <!-- Register Modal -->
    <div class="modal-overlay" id="registerModal">
        <div class="modal">
            <div class="modal-header">
                <h3 class="modal-title">Create Account</h3>
                <button class="modal-close" id="closeRegisterModal">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label for="registerLastName">Last Name</label>
                    <input type="text" class="form-control" id="registerLastName" placeholder="Enter your last name">
                </div>
                <div class="form-group">
                    <label for="registerFirstName">First Name</label>
                    <input type="text" class="form-control" id="registerFirstName" placeholder="Enter your first name">
                </div>
                <div class="form-group">
                    <label for="registerEmail">Email</label>
                    <input type="email" class="form-control" id="registerEmail" placeholder="Enter your email">
                </div>
                <div class="form-group">
                    <label for="registerEmailConfirm">Confirm Email</label>
                    <input type="email" class="form-control" id="registerEmailConfirm" placeholder="Confirm your email">
                </div>
                <div class="form-group">
                    <label for="registerPassword">Password</label>
                    <input type="password" class="form-control" id="registerPassword" placeholder="Enter your password">
                </div>
                <div class="form-group">
                    <label for="registerPasswordConfirm">Confirm Password</label>
                    <input type="password" class="form-control" id="registerPasswordConfirm" placeholder="Confirm your password">
                </div>
                <div class="form-group">
                    <label for="registerBirthdate">Birthdate</label>
                    <input type="text" class="form-control" id="registerBirthdate" placeholder="Select your birthdate">
                </div>
                <div class="form-group">
                    <label for="registerNationality">Nationality</label>
                    <select class="form-control" id="registerNationality">
                        <option value="">Select your nationality</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="registerRole">Role</label>
                    <select class="form-control" id="registerRole">
                        <option value="">Select your role</option>
                        <option value="Manager">Manager</option>
                        <option value="Staff">Staff</option>
                        <option value="Customer">Customer</option>
                        <option value="Admin">Admin</option>
                    </select>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" id="cancelRegisterBtn">Cancel</button>
                <button class="btn btn-success" id="createAccountBtn">Create</button>
            </div>
        </div>
    </div>
    
    <!-- Add Task Modal -->
    <div class="modal-overlay" id="addTaskModal">
        <div class="modal">
            <div class="modal-header">
                <h3 class="modal-title">Add New Task</h3>
                <button class="modal-close" id="closeAddTaskModal">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label for="taskTitle">Title</label>
                    <input type="text" class="form-control" id="taskTitle" placeholder="Enter task title">
                </div>
                <div class="form-group">
                    <label for="taskDescription">Description</label>
                    <textarea class="form-control" id="taskDescription" rows="3" placeholder="Enter task description"></textarea>
                </div>
                <div class="form-group">
                    <label>Sub-Tasks</label>
                    <div id="subTasksContainer">
                        <div class="subtask-input-container" style="display: flex; gap: 10px; margin-bottom: 10px;">
                            <input type="text" class="form-control subtask-input" placeholder="Enter sub-task">
                            <button class="btn btn-secondary remove-subtask-btn" style="display: none;">
                                <i class="fas fa-minus"></i>
                            </button>
                        </div>
                    </div>
                    <button class="btn btn-primary" id="addSubtaskBtn" style="margin-top: 10px;">
                        <i class="fas fa-plus"></i> Add Subtask
                    </button>
                </div>
                <div class="form-group">
                    <label for="taskDueDate">Due Date</label>
                    <input type="text" class="form-control" id="taskDueDate" placeholder="Select due date">
                </div>
                <div class="form-group">
                    <label for="taskPriority">Priority</label>
                    <select class="form-control" id="taskPriority">
                        <option value="">Select priority</option>
                        <option value="high">High</option>
                        <option value="medium">Medium</option>
                        <option value="low">Low</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="taskCategory">Category</label>
                    <select class="form-control" id="taskCategory">
                        <option value="">Select category</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="taskNotes">Notes</label>
                    <textarea class="form-control" id="taskNotes" rows="2" placeholder="Additional notes (optional)"></textarea>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" id="cancelAddTaskBtn">Cancel</button>
                <button class="btn btn-success" id="createTaskBtn">Create</button>
            </div>
        </div>
    </div>
    
    <!-- Edit Task Modal -->
    <div class="modal-overlay" id="editTaskModal">
        <div class="modal">
            <div class="modal-header">
                <h3 class="modal-title">Edit Task</h3>
                <button class="modal-close" id="closeEditTaskModal">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label for="editTaskTitle">Title</label>
                    <input type="text" class="form-control" id="editTaskTitle" placeholder="Enter task title">
                </div>
                <div class="form-group">
                    <label for="editTaskDescription">Description</label>
                    <textarea class="form-control" id="editTaskDescription" rows="3" placeholder="Enter task description"></textarea>
                </div>
                <div class="form-group">
                    <label>Sub-Tasks</label>
                    <div id="editSubTasksContainer">
                        <!-- Subtasks will be rendered here -->
                    </div>
                    <button class="btn btn-primary" id="editAddSubtaskBtn" style="margin-top: 10px;">
                        <i class="fas fa-plus"></i> Add Subtask
                    </button>
                </div>
                <div class="form-group">
                    <label for="editTaskDueDate">Due Date</label>
                    <input type="text" class="form-control" id="editTaskDueDate" placeholder="Select due date">
                </div>
                <div class="form-group">
                    <label for="editTaskPriority">Priority</label>
                    <select class="form-control" id="editTaskPriority">
                        <option value="">Select priority</option>
                        <option value="high">High</option>
                        <option value="medium">Medium</option>
                        <option value="low">Low</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="editTaskCategory">Category</label>
                    <select class="form-control" id="editTaskCategory">
                        <option value="">Select category</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="editTaskNotes">Notes</label>
                    <textarea class="form-control" id="editTaskNotes" rows="2" placeholder="Additional notes (optional)"></textarea>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" id="cancelEditTaskBtn">Cancel</button>
                <button class="btn btn-warning" id="updateTaskBtn">Update</button>
            </div>
        </div>
    </div>
    
    <!-- View Task Modal -->
    <div class="modal-overlay" id="viewTaskModal">
        <div class="modal">
            <div class="modal-header">
                <h3 class="modal-title">Task Details</h3>
                <button class="modal-close" id="closeViewTaskModal">&times;</button>
            </div>
            <div class="modal-body">
                <h4 id="viewTaskTitle" style="font-size: 1.2rem; margin-bottom: 10px;"></h4>
                <p id="viewTaskDescription" style="margin-bottom: 15px; color: var(--grey-color);"></p>
                
                <div class="task-meta-container" style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px; margin-bottom: 20px;">
                    <div class="task-meta-item">
                        <div style="font-weight: 600; margin-bottom: 5px; font-size: 0.9rem;">Due Date</div>
                        <div id="viewTaskDueDate" style="color: var(--grey-color); font-size: 0.9rem;"></div>
                    </div>
                    <div class="task-meta-item">
                        <div style="font-weight: 600; margin-bottom: 5px; font-size: 0.9rem;">Priority</div>
                        <div id="viewTaskPriority" style="font-size: 0.9rem;"></div>
                    </div>
                    <div class="task-meta-item">
                        <div style="font-weight: 600; margin-bottom: 5px; font-size: 0.9rem;">Category</div>
                        <div id="viewTaskCategory" style="font-size: 0.9rem;"></div>
                    </div>
                    <div class="task-meta-item">
                        <div style="font-weight: 600; margin-bottom: 5px; font-size: 0.9rem;">Status</div>
                        <div id="viewTaskStatus" style="font-size: 0.9rem;"></div>
                    </div>
                </div>
                
                <div style="margin-bottom: 20px;">
                    <div style="font-weight: 600; margin-bottom: 10px; font-size: 0.9rem;">Sub-Tasks</div>
                    <div id="viewSubTasksContainer" style="padding-left: 10px;">
                        <!-- Subtasks will be rendered here -->
                        <div style="color: var(--grey-color); font-style: italic; font-size: 0.9rem;" id="noSubtasksMessage">No sub-tasks</div>
                    </div>
                </div>
                
                <div>
                    <div style="font-weight: 600; margin-bottom: 10px; font-size: 0.9rem;">Notes</div>
                    <div id="viewTaskNotes" style="color: var(--grey-color); font-size: 0.9rem;">No notes</div>
                </div>
                
                <div style="margin-top: 20px;">
                    <div style="font-weight: 600; margin-bottom: 10px; font-size: 0.9rem;">Time Spent</div>
                    <div id="viewTaskTimeSpent" style="color: var(--primary-color); font-weight: 500;">00:00:00</div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" id="closeViewTaskBtn">Close</button>
                <button class="btn btn-warning" id="viewEditTaskBtn">Edit</button>
            </div>
        </div>
    </div>
    
    <!-- Export Modal -->
    <div class="modal-overlay" id="exportModal">
        <div class="modal">
            <div class="modal-header">
                <h3 class="modal-title">Export Tasks</h3>
                <button class="modal-close" id="closeExportModal">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label for="exportFormat">Select Format</label>
                    <select class="form-control" id="exportFormat">
                        <option value="pdf">PDF</option>
                        <option value="xlsx">Excel</option>
                        <option value="json">JSON</option>
                    </select>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" id="cancelExportBtn">Cancel</button>
                <button class="btn btn-primary" id="confirmExportBtn">Export</button>
            </div>
        </div>
    </div>
    
    <!-- Import Modal -->
    <div class="modal-overlay" id="importModal">
        <div class="modal">
            <div class="modal-header">
                <h3 class="modal-title">Import Tasks</h3>
                <button class="modal-close" id="closeImportModal">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label for="importType">Import From</label>
                    <select class="form-control" id="importType">
                        <option value="file">JSON File</option>
                        <option value="url">URL</option>
                    </select>
                </div>
                
                <div class="form-group" id="importFileGroup">
                    <label for="importFile">Select File</label>
                    <input type="file" class="form-control" id="importFile" accept=".json">
                </div>
                
                <div class="form-group hidden" id="importUrlGroup">
                    <label for="importUrl">URL</label>
                    <input type="url" class="form-control" id="importUrl" placeholder="Enter URL">
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" id="cancelImportBtn">Cancel</button>
                <button class="btn btn-primary" id="confirmImportBtn">Import</button>
            </div>
        </div>
    </div>
    
    <!-- Profile Modal -->
    <div class="modal-overlay" id="profileModal">
        <div class="modal">
            <div class="modal-header">
                <h3 class="modal-title">User Profile</h3>
                <button class="modal-close" id="closeProfileModal">&times;</button>
            </div>
            <div class="modal-body">
                <div style="display: flex; flex-direction: column; align-items: center; margin-bottom: 20px;">
                    <img src="https://i.imgur.com/EyXqkTX.png" alt="Profile" id="userProfilePic" style="width: 80px; height: 80px; border-radius: 50%; object-fit: cover; margin-bottom: 10px; border: 3px solid var(--primary-color);">
                    <input type="file" id="profilePicInput" accept="image/*" style="display: none;">
                    <button class="btn btn-primary" id="changeProfilePicBtn" style="font-size: 0.8rem; padding: 4px 8px;">Change Photo</button>
                </div>
                
                <div class="form-group">
                    <label for="profileName">Full Name</label>
                    <input type="text" class="form-control" id="profileName" placeholder="Enter your full name" readonly>
                </div>
                <div class="form-group">
                    <label for="profileEmail">Email</label>
                    <input type="email" class="form-control" id="profileEmail" placeholder="Enter your email" readonly>
                </div>
                <div class="form-group">
                    <label for="profilePhone">Phone</label>
                    <input type="tel" class="form-control" id="profilePhone" placeholder="Enter your phone number" readonly>
                </div>
                <div class="form-group">
                    <label for="profileCountry">Country</label>
                    <input type="text" class="form-control" id="profileCountry" placeholder="Enter your country" readonly>
                </div>
                <div class="form-group">
                    <label for="profileRole">Role</label>
                    <input type="text" class="form-control" id="profileRole" placeholder="Your role" readonly>
                </div>
                <div class="form-group">
                    <label for="profileJoiningDate">Joining Date</label>
                    <input type="text" class="form-control" id="profileJoiningDate" placeholder="Joining date" readonly>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" id="closeProfileBtn">Close</button>
                <button class="btn btn-warning" id="editProfileBtn">Edit Profile</button>
            </div>
        </div>
    </div>
    
    <!-- Edit Profile Modal -->
    <div class="modal-overlay" id="editProfileModal">
        <div class="modal">
            <div class="modal-header">
                <h3 class="modal-title">Edit Profile</h3>
                <button class="modal-close" id="closeEditProfileModal">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label for="editProfileName">Full Name</label>
                    <input type="text" class="form-control" id="editProfileName" placeholder="Enter your full name">
                </div>
                <div class="form-group">
                    <label for="editProfileEmail">Email</label>
                    <input type="email" class="form-control" id="editProfileEmail" placeholder="Enter your email">
                </div>
                <div class="form-group">
                    <label for="editProfilePhone">Phone</label>
                    <input type="tel" class="form-control" id="editProfilePhone" placeholder="Enter your phone number">
                </div>
                <div class="form-group">
                    <label for="editProfileCountry">Country</label>
                    <select class="form-control" id="editProfileCountry">
                        <option value="">Select your country</option>
                    </select>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" id="cancelEditProfileBtn">Cancel</button>
                <button class="btn btn-warning" id="updateProfileBtn">Update</button>
            </div>
        </div>
    </div>
    
    <!-- Manage Categories Modal -->
    <div class="modal-overlay" id="categoriesModal">
        <div class="modal">
            <div class="modal-header">
                <h3 class="modal-title">Manage Categories</h3>
                <button class="modal-close" id="closeCategoriesModal">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label for="newCategoryName">New Category</label>
                    <div style="display: flex; gap: 10px;">
                        <input type="text" class="form-control" id="newCategoryName" placeholder="Enter category name">
                        <button class="btn btn-success" id="addCategoryBtn">Add</button>
                    </div>
                </div>
                
                <div style="margin-top: 20px;">
                    <h4 style="font-size: 1rem; margin-bottom: 10px;">Existing Categories</h4>
                    <div id="categoriesList" style="max-height: 300px; overflow-y: auto;">
                        <!-- Categories will be rendered here -->
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" id="closeCategoriesBtn">Close</button>
            </div>
        </div>
    </div>
    
    <!-- Users Modal -->
    <div class="modal-overlay" id="usersModal">
        <div class="modal" style="max-width: 800px;">
            <div class="modal-header">
                <h3 class="modal-title">Users</h3>
                <button class="modal-close" id="closeUsersModal">&times;</button>
            </div>
            <div class="modal-body">
                <div class="users-grid" id="usersGrid">
                    <!-- Users will be rendered here -->
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" id="closeUsersBtn">Close</button>
            </div>
        </div>
    </div>
    
    <!-- Status Modal -->
    <div class="modal-overlay" id="statusModal">
        <div class="modal">
            <div class="modal-header">
                <h3 class="modal-title">Change Status</h3>
                <button class="modal-close" id="closeStatusModal">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label for="userStatus">Select Status</label>
                    <select class="form-control" id="userStatus">
                        <option value="login">Login</option>
                        <option value="logout">Logout</option>
                        <option value="break">Break</option>
                        <option value="shadow">Shadow</option>
                    </select>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" id="cancelStatusBtn">Cancel</button>
                <button class="btn btn-primary" id="updateStatusBtn">Update</button>
            </div>
        </div>
    </div>
    
    <!-- Notifications Modal -->
    <div class="modal-overlay" id="notificationsModal">
        <div class="modal">
            <div class="modal-header">
                <h3 class="modal-title">Notifications</h3>
                <button class="modal-close" id="closeNotificationsModal">&times;</button>
            </div>
            <div class="modal-body">
                <div class="notifications-container" id="notificationsList">
                    <!-- Notifications will be rendered here -->
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" id="closeNotificationsBtn">Close</button>
                <button class="btn btn-primary" id="markAllReadBtn">Mark All as Read</button>
            </div>
        </div>
    </div>
    
    <!-- Date Range Modal -->
    <div class="modal-overlay" id="dateRangeModal">
        <div class="modal">
            <div class="modal-header">
                <h3 class="modal-title">Select Date Range</h3>
                <button class="modal-close" id="closeDateRangeModal">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label for="dateRangeStart">Start Date</label>
                    <input type="text" class="form-control" id="dateRangeStart" placeholder="Start date">
                </div>
                <div class="form-group">
                    <label for="dateRangeEnd">End Date</label>
                    <input type="text" class="form-control" id="dateRangeEnd" placeholder="End date">
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" id="cancelDateRangeBtn">Cancel</button>
                <button class="btn btn-primary" id="applyDateRangeBtn">Apply</button>
            </div>
        </div>
    </div>

    <script>
        // Initialize the application
        document.addEventListener('DOMContentLoaded', function() {
            // Check for dark mode preference
            if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
                document.documentElement.classList.add('dark');
                document.getElementById('modeIcon').classList.remove('fa-sun');
                document.getElementById('modeIcon').classList.add('fa-moon');
            }

            // Listen for changes in color scheme preference
            window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', event => {
                if (event.matches) {
                    document.documentElement.classList.add('dark');
                    document.getElementById('modeIcon').classList.remove('fa-sun');
                    document.getElementById('modeIcon').classList.add('fa-moon');
                } else {
                    document.documentElement.classList.remove('dark');
                    document.getElementById('modeIcon').classList.remove('fa-moon');
                    document.getElementById('modeIcon').classList.add('fa-sun');
                }
            });

            // Initialize data
            initializeApp();
        });

        // Constants
        const DEFAULT_CATEGORIES = [
            'Work',
            'Personal',
            'Shopping',
            'Health',
            'Learning',
            'Finances'
        ];

        // Global variables
        let currentUser = null;
        let tasks = [];
        let categories = [];
        let users = [];
        let notifications = [];
        let filteredTasks = [];
        let selectedTasks = [];
        let currentFilters = {
            status: 'all',
            category: 'all',
            priority: 'all',
            date: 'all',
            sort: 'dueDate-asc',
            search: ''
        };
        let currentEditingTaskId = null;
        let appTimer = {
            hours: 0,
            minutes: 0,
            seconds: 0,
            running: false,
            intervalId: null
        };
        let taskTimers = {};
        let actionsHistory = {
            past: [],
            future: []
        };
        let currentView = 'list';
        let charts = {
            progress: null,
            distribution: null
        };
        
        // Random data generation utilities
        function getRandomDate(start, end) {
            return new Date(start.getTime() + Math.random() * (end.getTime() - start.getTime()));
        }
        
        function getRandomPriority() {
            const priorities = ['high', 'medium', 'low'];
            return priorities[Math.floor(Math.random() * priorities.length)];
        }
        
        function getRandomCategory() {
            return categories[Math.floor(Math.random() * categories.length)];
        }
        
        function getRandomBoolean() {
            return Math.random() > 0.5;
        }
        
        function getRandomSubtasks(count) {
            const subtasks = [];
            const subtaskExamples = [
                'Research information',
                'Create draft',
                'Review content',
                'Share with team',
                'Collect feedback',
                'Make revisions',
                'Final review',
                'Submit document',
                'Schedule meeting',
                'Send emails',
                'Update documentation',
                'Prepare presentation',
                'Create timeline',
                'Assign resources',
                'Test functionality'
            ];
            
            const shuffled = [...subtaskExamples].sort(() => 0.5 - Math.random());
            const selected = shuffled.slice(0, count);
            
            for (let i = 0; i < count; i++) {
                subtasks.push({
                    id: generateId(),
                    title: selected[i],
                    completed: getRandomBoolean()
                });
            }
            
            return subtasks;
        }
        
        // Generate random tasks
        function generateRandomTasks(count) {
            const now = new Date();
            const taskNames = [
                'Complete project proposal',
                'Review marketing materials',
                'Update website content',
                'Plan team meeting',
                'Research new technologies',
                'Prepare quarterly report',
                'Create social media strategy',
                'Call potential clients',
                'Fix application bugs',
                'Design new product features',
                'Schedule team building',
                'Update documentation',
                'Finish employee evaluations',
                'Organize files',
                'Create backup system'
            ];
            
            const taskDescriptions = [
                'This task involves creating a comprehensive plan and documentation for our upcoming project.',
                'Review and provide feedback on the latest marketing collaterals and promotional materials.',
                'Update website with new content, features, and ensure all pages are functioning properly.',
                'Organize the logistics for our monthly team meeting including agenda, location, and materials.',
                'Conduct research on new tools and technologies that could improve our workflow.',
                'Prepare a detailed quarterly report showing our progress, achievements, and areas for improvement.',
                'Develop a cohesive social media strategy for the next quarter to increase engagement.',
                'Reach out to potential clients and partners to discuss collaboration opportunities.',
                'Identify and fix existing bugs in the application to improve user experience.',
                'Design and document new features for our product based on user feedback.',
                'Plan and schedule a team building activity to improve collaboration and morale.',
                'Update all documentation to reflect recent changes in processes and products.',
                'Complete performance evaluations for all team members by the end of the week.',
                'Organize and categorize digital files and resources for better accessibility.',
                'Create a reliable backup system for all important data and documents.'
            ];
            
            // Get random unique tasks
            const shuffledIndices = Array.from({length: taskNames.length}, (_, i) => i)
                .sort(() => 0.5 - Math.random());
            const selectedIndices = shuffledIndices.slice(0, count);
            
            const randomTasks = selectedIndices.map(index => {
                const dueDate = getRandomDate(
                    new Date(now.getFullYear(), now.getMonth(), now.getDate() - 5),
                    new Date(now.getFullYear(), now.getMonth(), now.getDate() + 15)
                );
                
                const hasSubtasks = Math.random() > 0.4; // 60% chance to have subtasks
                const subtaskCount = hasSubtasks ? Math.floor(Math.random() * 3) + 1 : 0;
                
                return {
                    id: generateId(),
                    title: taskNames[index],
                    description: taskDescriptions[index],
                    dueDate: dueDate.toISOString(),
                    priority: getRandomPriority(),
                    category: getRandomCategory(),
                    completed: getRandomBoolean(),
                    subTasks: getRandomSubtasks(subtaskCount),
                    notes: 'Additional notes for this task.',
                    createdAt: new Date().toISOString(),
                    timeSpent: Math.floor(Math.random() * 7200) // Random seconds (up to 2 hours)
                };
            });
            
            return randomTasks;
        }
        
        // Generate random users
        function generateRandomUsers(count) {
            const firstNames = ['John', 'Jane', 'Michael', 'Sara', 'David', 'Emma', 'James', 'Olivia', 'Daniel', 'Sophia'];
            const lastNames = ['Smith', 'Johnson', 'Williams', 'Brown', 'Jones', 'Garcia', 'Miller', 'Davis', 'Rodriguez', 'Martinez'];
            const roles = ['Manager', 'Staff', 'Customer', 'Admin'];
            const domains = ['gmail.com', 'outlook.com', 'yahoo.com', 'company.com', 'example.com'];
            
            const randomUsers = [];
            
            for (let i = 0; i < count; i++) {
                const firstName = firstNames[Math.floor(Math.random() * firstNames.length)];
                const lastName = lastNames[Math.floor(Math.random() * lastNames.length)];
                const role = roles[Math.floor(Math.random() * roles.length)];
                const domain = domains[Math.floor(Math.random() * domains.length)];
                const email = `${firstName.toLowerCase()}.${lastName.toLowerCase()}@${domain}`;
                
                randomUsers.push({
                    id: generateId(),
                    firstName: firstName,
                    lastName: lastName,
                    email: email,
                    role: role,
                    avatar: `https://i.imgur.com/EyXqkTX.png`, // Default avatar, would normally be random
                    phone: '123-456-7890',
                    country: 'United States',
                    joiningDate: new Date().toISOString()
                });
            }
            
            return randomUsers;
        }
        
        // Initialize the application
        function initializeApp() {
            // Initialize datepickers
            initializeDatepickers();
            
            // Load data from localStorage
            loadDataFromStorage();
            
            // Generate initial data if not exists
            if (categories.length === 0) {
                categories = [...DEFAULT_CATEGORIES];
                saveCategoriesToStorage();
            }
            
            if (tasks.length === 0) {
                tasks = generateRandomTasks(10);
                saveTasksToStorage();
            }
            
            if (users.length === 0) {
                users = generateRandomUsers(6);
                saveUsersToStorage();
            }
            
            // Initialize views and UI
            renderCategoryOptions();
            updateTaskCounters();
            renderTasks();
            initializeCharts();
            updateInsights();
            
            // Set up event listeners
            setupEventListeners();
        }
        
        // Initialize Flatpickr for date inputs
        function initializeDatepickers() {
            // Initialize birthdate picker
            flatpickr("#registerBirthdate", {
                dateFormat: "Y-m-d",
                maxDate: new Date()
            });
            
            // Initialize task due date picker
            flatpickr("#taskDueDate", {
                dateFormat: "Y-m-d",
                minDate: "today"
            });
            
            // Initialize edit task due date picker
            flatpickr("#editTaskDueDate", {
                dateFormat: "Y-m-d",
                minDate: "today"
            });
            
            // Initialize date range pickers
            flatpickr("#dateRangeStart", {
                dateFormat: "Y-m-d"
            });
            
            flatpickr("#dateRangeEnd", {
                dateFormat: "Y-m-d"
            });
        }
        
        // Load nationality options
        function loadNationalities() {
            const nationalitySelect = document.getElementById('registerNationality');
            const editProfileCountry = document.getElementById('editProfileCountry');
            
            // Sample list of countries (would normally fetch from an API)
            const countries = [
                'United States', 'Canada', 'United Kingdom', 'Australia', 
                'Germany', 'France', 'Japan', 'China', 'India', 'Brazil', 
                'Russia', 'South Africa', 'Mexico', 'Italy', 'Spain'
            ];
            
            // Sort countries alphabetically
            countries.sort();
            
            // Add options to nationality select
            for (const country of countries) {
                const option = document.createElement('option');
                option.value = country;
                option.textContent = country;
                nationalitySelect.appendChild(option);
                
                // Also add to edit profile country select
                const optionClone = option.cloneNode(true);
                editProfileCountry.appendChild(optionClone);
            }
        }
        
        // Setup event listeners
        function setupEventListeners() {
            // Login page listeners
            document.getElementById('loginBtn').addEventListener('click', handleLogin);
            document.getElementById('registerLink').addEventListener('click', showRegisterModal);
            
            // Register modal listeners
            document.getElementById('closeRegisterModal').addEventListener('click', hideRegisterModal);
            document.getElementById('cancelRegisterBtn').addEventListener('click', hideRegisterModal);
            document.getElementById('createAccountBtn').addEventListener('click', handleRegister);
            
            // Load countries for nationality dropdown
            loadNationalities();
            
            // Header listeners
            document.getElementById('modeToggle').addEventListener('click', toggleDarkMode);
            document.getElementById('profilePic').addEventListener('click', toggleProfileDropdown);
            document.getElementById('timerPlayPause').addEventListener('click', toggleAppTimer);
            document.getElementById('timerReset').addEventListener('click', resetAppTimer);
            document.getElementById('undoBtn').addEventListener('click', undoAction);
            document.getElementById('redoBtn').addEventListener('click', redoAction);
            document.getElementById('notificationBadge').addEventListener('click', showNotificationsModal);
            
            // Profile dropdown listeners
            document.getElementById('viewProfileBtn').addEventListener('click', showProfileModal);
            document.getElementById('statusBtn').addEventListener('click', showStatusModal);
            document.getElementById('logoutBtn').addEventListener('click', handleLogout);
            
            // Task action listeners
            document.getElementById('addTaskBtn').addEventListener('click', showAddTaskModal);
            document.getElementById('closeAddTaskModal').addEventListener('click', hideAddTaskModal);
            document.getElementById('cancelAddTaskBtn').addEventListener('click', hideAddTaskModal);
            document.getElementById('createTaskBtn').addEventListener('click', handleCreateTask);
            document.getElementById('addSubtaskBtn').addEventListener('click', addSubtaskField);
            
            // Edit task listeners
            document.getElementById('closeEditTaskModal').addEventListener('click', hideEditTaskModal);
            document.getElementById('cancelEditTaskBtn').addEventListener('click', hideEditTaskModal);
            document.getElementById('updateTaskBtn').addEventListener('click', handleUpdateTask);
            document.getElementById('editAddSubtaskBtn').addEventListener('click', addEditSubtaskField);
            
            // View task listeners
            document.getElementById('closeViewTaskModal').addEventListener('click', hideViewTaskModal);
            document.getElementById('closeViewTaskBtn').addEventListener('click', hideViewTaskModal);
            document.getElementById('viewEditTaskBtn').addEventListener('click', handleViewEditTask);
            
            // Export/Import listeners
            document.getElementById('exportBtn').addEventListener('click', showExportModal);
            document.getElementById('closeExportModal').addEventListener('click', hideExportModal);
            document.getElementById('cancelExportBtn').addEventListener('click', hideExportModal);
            document.getElementById('confirmExportBtn').addEventListener('click', handleExportTasks);
            
            document.getElementById('importBtn').addEventListener('click', showImportModal);
            document.getElementById('closeImportModal').addEventListener('click', hideImportModal);
            document.getElementById('cancelImportBtn').addEventListener('click', hideImportModal);
            document.getElementById('confirmImportBtn').addEventListener('click', handleImportTasks);
            document.getElementById('importType').addEventListener('change', toggleImportFields);
            
            // Categories listeners
            document.getElementById('manageCategoriesBtn').addEventListener('click', showCategoriesModal);
            document.getElementById('closeCategoriesModal').addEventListener('click', hideCategoriesModal);
            document.getElementById('closeCategoriesBtn').addEventListener('click', hideCategoriesModal);
            document.getElementById('addCategoryBtn').addEventListener('click', handleAddCategory);
            
            // Users listeners
            document.getElementById('usersBtn').addEventListener('click', showUsersModal);
            document.getElementById('closeUsersModal').addEventListener('click', hideUsersModal);
            document.getElementById('closeUsersBtn').addEventListener('click', hideUsersModal);
            
            // Profile listeners
            document.getElementById('closeProfileModal').addEventListener('click', hideProfileModal);
            document.getElementById('closeProfileBtn').addEventListener('click', hideProfileModal);
            document.getElementById('editProfileBtn').addEventListener('click', showEditProfileModal);
            document.getElementById('changeProfilePicBtn').addEventListener('click', () => document.getElementById('profilePicInput').click());
            document.getElementById('profilePicInput').addEventListener('change', handleProfilePicChange);
            
            // Edit profile listeners
            document.getElementById('closeEditProfileModal').addEventListener('click', hideEditProfileModal);
            document.getElementById('cancelEditProfileBtn').addEventListener('click', hideEditProfileModal);
            document.getElementById('updateProfileBtn').addEventListener('click', handleUpdateProfile);
            
            // Status listeners
            document.getElementById('closeStatusModal').addEventListener('click', hideStatusModal);
            document.getElementById('cancelStatusBtn').addEventListener('click', hideStatusModal);
            document.getElementById('updateStatusBtn').addEventListener('click', handleUpdateStatus);
            
            // Notifications listeners
            document.getElementById('closeNotificationsModal').addEventListener('click', hideNotificationsModal);
            document.getElementById('closeNotificationsBtn').addEventListener('click', hideNotificationsModal);
            document.getElementById('markAllReadBtn').addEventListener('click', markAllNotificationsAsRead);
            
            // Date range listeners
            document.getElementById('closeDateRangeModal').addEventListener('click', hideDateRangeModal);
            document.getElementById('cancelDateRangeBtn').addEventListener('click', hideDateRangeModal);
            document.getElementById('applyDateRangeBtn').addEventListener('click', applyDateRange);
            
            // Batch actions listeners
            document.getElementById('batchDeleteBtn').addEventListener('click', handleBatchDelete);
            document.getElementById('batchCompleteBtn').addEventListener('click', handleBatchComplete);
            document.getElementById('batchCancelBtn').addEventListener('click', cancelBatchSelection);
            
            // Search and filter listeners
            document.getElementById('searchInput').addEventListener('input', handleSearch);
            
            document.getElementById('statusFilterBtn').addEventListener('click', toggleDropdown);
            document.getElementById('categoryFilterBtn').addEventListener('click', toggleDropdown);
            document.getElementById('priorityFilterBtn').addEventListener('click', toggleDropdown);
            document.getElementById('dateFilterBtn').addEventListener('click', toggleDropdown);
            document.getElementById('sortBtn').addEventListener('click', toggleDropdown);
            
            // Add event listeners to filter items
            setupFilterItemListeners('statusFilterMenu', 'status');
            setupFilterItemListeners('categoryFilterMenu', 'category');
            setupFilterItemListeners('priorityFilterMenu', 'priority');
            setupFilterItemListeners('dateFilterMenu', 'date');
            setupFilterItemListeners('sortMenu', 'sort');
            
            // View switcher listeners
            document.getElementById('listViewBtn').addEventListener('click', () => switchView('list'));
            document.getElementById('graphViewBtn').addEventListener('click', () => switchView('graph'));
            
            // Outside click handling for dropdowns
            document.addEventListener('click', function(event) {
                const isFilterBtn = event.target.closest('.filter-btn');
                const isFilterMenu = event.target.closest('.filter-menu');
                const isProfilePic = event.target.closest('.profile');
                const isProfileDropdown = event.target.closest('.dropdown-menu');
                
                if (!isFilterBtn && !isFilterMenu) {
                    document.querySelectorAll('.filter-menu').forEach(menu => {
                        menu.classList.remove('show');
                    });
                }
                
                if (!isProfilePic && !isProfileDropdown) {
                    document.getElementById('profileDropdown').classList.remove('show');
                }
            });
            
            // Set up drag and drop for tasks
            setupDragAndDrop();
        }
        
        // Setup filter item listeners
        function setupFilterItemListeners(menuId, filterType) {
            const menu = document.getElementById(menuId);
            if (!menu) return;
            
            const items = menu.querySelectorAll('.filter-item');
            items.forEach(item => {
                item.addEventListener('click', function() {
                    // Remove active class from all items
                    items.forEach(i => i.classList.remove('active'));
                    
                    // Add active class to clicked item
                    this.classList.add('active');
                    
                    // Get filter value
                    const value = this.getAttribute('data-value');
                    
                    // Handle date filter special case
                    if (filterType === 'date' && value === 'custom') {
                        showDateRangeModal();
                        return;
                    }
                    
                    // Update current filters
                    currentFilters[filterType] = value;
                    
                    // Apply filter
                    applyFilters();
                    
                    // Hide dropdown
                    menu.classList.remove('show');
                });
            });
        }
        
        // Toggle dropdown
        function toggleDropdown(event) {
            const btn = event.currentTarget;
            const menu = btn.nextElementSibling;
            
            // Close other dropdowns
            document.querySelectorAll('.filter-menu').forEach(m => {
                if (m !== menu) {
                    m.classList.remove('show');
                }
            });
            
            // Toggle this dropdown
            menu.classList.toggle('show');
        }
        
        // Toggle profile dropdown
        function toggleProfileDropdown() {
            document.getElementById('profileDropdown').classList.toggle('show');
        }
        
        // Toggle dark mode
        function toggleDarkMode() {
            document.documentElement.classList.toggle('dark');
            
            const icon = document.getElementById('modeIcon');
            if (document.documentElement.classList.contains('dark')) {
                icon.classList.remove('fa-sun');
                icon.classList.add('fa-moon');
            } else {
                icon.classList.remove('fa-moon');
                icon.classList.add('fa-sun');
            }
            
            // Update charts if they exist
            if (currentView === 'graph') {
                updateCharts();
            }
        }
        
        // Load data from localStorage
        function loadDataFromStorage() {
            // Load user data
            const userData = localStorage.getItem('todoAppUser');
            if (userData) {
                currentUser = JSON.parse(userData);
            }
            
            // Load tasks
            const tasksData = localStorage.getItem('todoAppTasks');
            if (tasksData) {
                tasks = JSON.parse(tasksData);
            }
            
            // Load categories
            const categoriesData = localStorage.getItem('todoAppCategories');
            if (categoriesData) {
                categories = JSON.parse(categoriesData);
            }
            
            // Load users
            const usersData = localStorage.getItem('todoAppUsers');
            if (usersData) {
                users = JSON.parse(usersData);
            }
            
            // Load notifications
            const notificationsData = localStorage.getItem('todoAppNotifications');
            if (notificationsData) {
                notifications = JSON.parse(notificationsData);
            }
        }
        
        // Save data to localStorage
        function saveTasksToStorage() {
            localStorage.setItem('todoAppTasks', JSON.stringify(tasks));
        }
        
        function saveCategoriesToStorage() {
            localStorage.setItem('todoAppCategories', JSON.stringify(categories));
        }
        
        function saveUsersToStorage() {
            localStorage.setItem('todoAppUsers', JSON.stringify(users));
        }
        
        function saveUserToStorage() {
            if (currentUser) {
                localStorage.setItem('todoAppUser', JSON.stringify(currentUser));
            }
        }
        
        function saveNotificationsToStorage() {
            localStorage.setItem('todoAppNotifications', JSON.stringify(notifications));
        }
        
        // Generate random ID
        function generateId() {
            return Math.random().toString(36).substring(2, 15) + Math.random().toString(36).substring(2, 15);
        }
        
        // Format date
        function formatDate(dateString) {
            const date = new Date(dateString);
            return date.toLocaleDateString('en-US', {
                year: 'numeric',
                month: 'short',
                day: 'numeric'
            });
        }
        
        // Format time
        function formatTime(seconds) {
            const hours = Math.floor(seconds / 3600);
            const minutes = Math.floor((seconds % 3600) / 60);
            const secs = seconds % 60;
            
            return `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;
        }
        
        // Login handler
        function handleLogin() {
            const email = document.getElementById('email').value;
            const password = document.getElementById('password').value;
            
            // Simple validation
            if (!email || !password) {
                showToast('Please enter both email and password', 'error');
                return;
            }
            
            // For demo purposes, accept any login
            if (!currentUser) {
                // Create a new user if none exists
                currentUser = {
                    id: generateId(),
                    firstName: 'Demo',
                    lastName: 'User',
                    email: email,
                    phone: '123-456-7890',
                    country: 'United States',
                    role: 'Admin',
                    joiningDate: new Date().toISOString(),
                    avatar: 'https://i.imgur.com/EyXqkTX.png'
                };
                
                saveUserToStorage();
            }
            
            // Show dashboard
            document.getElementById('loginPage').classList.add('hidden');
            document.getElementById('dashboard').classList.remove('hidden');
            
            // Start the application
            updateTaskCounters();
            renderTasks();
            initializeCharts();
            updateInsights();
            updateNotificationBadge();
            
            // Create welcome notification
            addNotification({
                type: 'task',
                title: 'Welcome back!',
                message: 'You have logged in successfully.',
                time: new Date().toISOString()
            });
            
            showToast('Logged in successfully', 'success');
        }
        
        // Register handler
        function handleRegister() {
            const firstName = document.getElementById('registerFirstName').value;
            const lastName = document.getElementById('registerLastName').value;
            const email = document.getElementById('registerEmail').value;
            const emailConfirm = document.getElementById('registerEmailConfirm').value;
            const password = document.getElementById('registerPassword').value;
            const passwordConfirm = document.getElementById('registerPasswordConfirm').value;
            const birthdate = document.getElementById('registerBirthdate').value;
            const nationality = document.getElementById('registerNationality').value;
            const role = document.getElementById('registerRole').value;
            
            // Validation
            if (!firstName || !lastName || !email || !emailConfirm || !password || !passwordConfirm || !birthdate || !nationality || !role) {
                showToast('Please fill in all fields', 'error');
                return;
            }
            
            if (email !== emailConfirm) {
                showToast('Emails do not match', 'error');
                return;
            }
            
            if (password !== passwordConfirm) {
                showToast('Passwords do not match', 'error');
                return;
            }
            
            // Create new user
            const newUser = {
                id: generateId(),
                firstName: firstName,
                lastName: lastName,
                email: email,
                password: password, // In a real app, this would be hashed
                birthdate: birthdate,
                country: nationality,
                role: role,
                joiningDate: new Date().toISOString(),
                avatar: 'https://i.imgur.com/EyXqkTX.png' // Default avatar
            };
            
            // Add user to array
            users.push(newUser);
            saveUsersToStorage();
            
            // Set as current user
            currentUser = newUser;
            saveUserToStorage();
            
            // Hide register modal
            hideRegisterModal();
            
            // Auto-login
            document.getElementById('loginPage').classList.add('hidden');
            document.getElementById('dashboard').classList.remove('hidden');
            
            // Start the application
            updateTaskCounters();
            renderTasks();
            initializeCharts();
            updateInsights();
            
            // Create welcome notification
            addNotification({
                type: 'task',
                title: 'Welcome!',
                message: 'Your account has been created successfully.',
                time: new Date().toISOString()
            });
            
            showToast('Account created successfully', 'success');
        }
        
        // Logout handler
        function handleLogout() {
            // Save any unsaved changes
            saveTasksToStorage();
            saveUserToStorage();
            saveNotificationsToStorage();
            
            // Reset timer
            resetAppTimer();
            
            // Hide dashboard and show login page
            document.getElementById('dashboard').classList.add('hidden');
            document.getElementById('loginPage').classList.remove('hidden');
            
            // Hide profile dropdown
            document.getElementById('profileDropdown').classList.remove('show');
            
            showToast('Logged out successfully', 'success');
        }
        
        // Show register modal
        function showRegisterModal(event) {
            event.preventDefault();
            document.getElementById('registerModal').classList.add('active');
        }
        
        // Hide register modal
        function hideRegisterModal() {
            document.getElementById('registerModal').classList.remove('active');
        }
        
        // Show add task modal
        function showAddTaskModal() {
            // Clear previous values
            document.getElementById('taskTitle').value = '';
            document.getElementById('taskDescription').value = '';
            document.getElementById('taskDueDate').value = '';
            document.getElementById('taskPriority').value = '';
            document.getElementById('taskCategory').value = '';
            document.getElementById('taskNotes').value = '';
            
            // Reset subtasks container
            const subTasksContainer = document.getElementById('subTasksContainer');
            subTasksContainer.innerHTML = `
                <div class="subtask-input-container" style="display: flex; gap: 10px; margin-bottom: 10px;">
                    <input type="text" class="form-control subtask-input" placeholder="Enter sub-task">
                    <button class="btn btn-secondary remove-subtask-btn" style="display: none;">
                        <i class="fas fa-minus"></i>
                    </button>
                </div>
            `;
            
            // Show modal
            document.getElementById('addTaskModal').classList.add('active');
        }
        
        // Hide add task modal
        function hideAddTaskModal() {
            document.getElementById('addTaskModal').classList.remove('active');
        }
        
        // Add subtask field
        function addSubtaskField() {
            const container = document.getElementById('subTasksContainer');
            const subtaskInputs = container.querySelectorAll('.subtask-input-container');
            
            // Show remove buttons for existing subtasks
            subtaskInputs.forEach(input => {
                input.querySelector('.remove-subtask-btn').style.display = 'block';
            });
            
            // Add new subtask input
            const newSubtaskContainer = document.createElement('div');
            newSubtaskContainer.className = 'subtask-input-container';
            newSubtaskContainer.style = 'display: flex; gap: 10px; margin-bottom: 10px;';
            newSubtaskContainer.innerHTML = `
                <input type="text" class="form-control subtask-input" placeholder="Enter sub-task">
                <button class="btn btn-secondary remove-subtask-btn">
                    <i class="fas fa-minus"></i>
                </button>
            `;
            
            // Add event listener to remove button
            newSubtaskContainer.querySelector('.remove-subtask-btn').addEventListener('click', function() {
                container.removeChild(newSubtaskContainer);
                
                // Hide remove button on the last remaining subtask
                const remainingSubtasks = container.querySelectorAll('.subtask-input-container');
                if (remainingSubtasks.length === 1) {
                    remainingSubtasks[0].querySelector('.remove-subtask-btn').style.display = 'none';
                }
            });
            
            container.appendChild(newSubtaskContainer);
        }
        
        // Add subtask field in edit modal
        function addEditSubtaskField() {
            const container = document.getElementById('editSubTasksContainer');
            
            // Add new subtask input
            const newSubtaskContainer = document.createElement('div');
            newSubtaskContainer.className = 'subtask-input-container';
            newSubtaskContainer.style = 'display: flex; gap: 10px; margin-bottom: 10px;';
            newSubtaskContainer.innerHTML = `
                <input type="text" class="form-control subtask-input" placeholder="Enter sub-task">
                <button class="btn btn-secondary remove-subtask-btn">
                    <i class="fas fa-minus"></i>
                </button>
            `;
            
            // Add event listener to remove button
            newSubtaskContainer.querySelector('.remove-subtask-btn').addEventListener('click', function() {
                container.removeChild(newSubtaskContainer);
            });
            
            container.appendChild(newSubtaskContainer);
        }
        
        // Create task handler
        function handleCreateTask() {
            const title = document.getElementById('taskTitle').value;
            const description = document.getElementById('taskDescription').value;
            const dueDate = document.getElementById('taskDueDate').value;
            const priority = document.getElementById('taskPriority').value;
            const category = document.getElementById('taskCategory').value;
            const notes = document.getElementById('taskNotes').value;
            
            // Validation
            if (!title) {
                showToast('Please enter task title', 'error');
                return;
            }
            
            if (!dueDate) {
                showToast('Please select due date', 'error');
                return;
            }
            
            if (!priority) {
                showToast('Please select priority', 'error');
                return;
            }
            
            if (!category) {
                showToast('Please select category', 'error');
                return;
            }
            
            // Get subtasks
            const subtasks = [];
            const subtaskInputs = document.querySelectorAll('#subTasksContainer .subtask-input');
            subtaskInputs.forEach(input => {
                if (input.value.trim()) {
                    subtasks.push({
                        id: generateId(),
                        title: input.value.trim(),
                        completed: false
                    });
                }
            });
            
            // Create new task
            const newTask = {
                id: generateId(),
                title: title,
                description: description,
                dueDate: new Date(dueDate).toISOString(),
                priority: priority,
                category: category,
                completed: false,
                subTasks: subtasks,
                notes: notes,
                createdAt: new Date().toISOString(),
                timeSpent: 0
            };
            
            // Add to history
            addToHistory({
                type: 'create',
                data: { task: newTask }
            });
            
            // Add task to array
            tasks.unshift(newTask);
            saveTasksToStorage();
            
            // Hide modal
            hideAddTaskModal();
            
            // Update UI
            updateTaskCounters();
            applyFilters();
            updateInsights();
            updateCharts();
            
            // Add notification
            addNotification({
                type: 'task',
                title: 'Task Created',
                message: `New task "${title}" has been created.`,
                time: new Date().toISOString()
            });
            
            showToast('Task created successfully', 'success');
        }
        
        // Edit task handler
        function handleEditTask(taskId) {
            const task = tasks.find(t => t.id === taskId);
            if (!task) return;
            
            // Set current editing task ID
            currentEditingTaskId = taskId;
            
            // Populate form
            document.getElementById('editTaskTitle').value = task.title;
            document.getElementById('editTaskDescription').value = task.description || '';
            document.getElementById('editTaskDueDate').value = new Date(task.dueDate).toISOString().split('T')[0];
            document.getElementById('editTaskPriority').value = task.priority;
            document.getElementById('editTaskCategory').value = task.category;
            document.getElementById('editTaskNotes').value = task.notes || '';
            
            // Populate subtasks
            const subTasksContainer = document.getElementById('editSubTasksContainer');
            subTasksContainer.innerHTML = '';
            
            if (task.subTasks && task.subTasks.length > 0) {
                task.subTasks.forEach(subtask => {
                    const subtaskContainer = document.createElement('div');
                    subtaskContainer.className = 'subtask-input-container';
                    subtaskContainer.style = 'display: flex; gap: 10px; margin-bottom: 10px;';
                    subtaskContainer.innerHTML = `
                        <input type="text" class="form-control subtask-input" placeholder="Enter sub-task" value="${subtask.title}" 
                            data-subtask-id="${subtask.id}" ${subtask.completed ? 'data-completed="true"' : ''}>
                        <button class="btn btn-secondary remove-subtask-btn">
                            <i class="fas fa-minus"></i>
                        </button>
                    `;
                    
                    // Add event listener to remove button
                    subtaskContainer.querySelector('.remove-subtask-btn').addEventListener('click', function() {
                        subTasksContainer.removeChild(subtaskContainer);
                    });
                    
                    subTasksContainer.appendChild(subtaskContainer);
                });
            } else {
                // Add empty subtask input
                const subtaskContainer = document.createElement('div');
                subtaskContainer.className = 'subtask-input-container';
                subtaskContainer.style = 'display: flex; gap: 10px; margin-bottom: 10px;';
                subtaskContainer.innerHTML = `
                    <input type="text" class="form-control subtask-input" placeholder="Enter sub-task">
                    <button class="btn btn-secondary remove-subtask-btn">
                        <i class="fas fa-minus"></i>
                    </button>
                `;
                
                // Add event listener to remove button
                subtaskContainer.querySelector('.remove-subtask-btn').addEventListener('click', function() {
                    subTasksContainer.removeChild(subtaskContainer);
                });
                
                subTasksContainer.appendChild(subtaskContainer);
            }
            
            // Show modal
            document.getElementById('editTaskModal').classList.add('active');
        }
        
        // Update task handler
        function handleUpdateTask() {
            if (!currentEditingTaskId) return;
            
            const task = tasks.find(t => t.id === currentEditingTaskId);
            if (!task) return;
            
            const title = document.getElementById('editTaskTitle').value;
            const description = document.getElementById('editTaskDescription').value;
            const dueDate = document.getElementById('editTaskDueDate').value;
            const priority = document.getElementById('editTaskPriority').value;
            const category = document.getElementById('editTaskCategory').value;
            const notes = document.getElementById('editTaskNotes').value;
            
            // Validation
            if (!title) {
                showToast('Please enter task title', 'error');
                return;
            }
            
            if (!dueDate) {
                showToast('Please select due date', 'error');
                return;
            }
            
            if (!priority) {
                showToast('Please select priority', 'error');
                return;
            }
            
            if (!category) {
                showToast('Please select category', 'error');
                return;
            }
            
            // Get subtasks
            const subtasks = [];
            const subtaskInputs = document.querySelectorAll('#editSubTasksContainer .subtask-input');
            subtaskInputs.forEach(input => {
                if (input.value.trim()) {
                    const subtaskId = input.dataset.subtaskId || generateId();
                    const completed = input.dataset.completed === 'true';
                    
                    subtasks.push({
                        id: subtaskId,
                        title: input.value.trim(),
                        completed: completed
                    });
                }
            });
            
            // Store old task for history
            const oldTask = { ...task };
            
            // Update task
            task.title = title;
            task.description = description;
            task.dueDate = new Date(dueDate).toISOString();
            task.priority = priority;
            task.category = category;
            task.notes = notes;
            task.subTasks = subtasks;
            
            // Add to history
            addToHistory({
                type: 'update',
                data: { oldTask: oldTask, newTask: { ...task } }
            });
            
            // Save changes
            saveTasksToStorage();
            
            // Hide modal
            hideEditTaskModal();
            
            // Update UI
            applyFilters();
            updateInsights();
            updateCharts();
            
            // Add notification
            addNotification({
                type: 'task',
                title: 'Task Updated',
                message: `Task "${title}" has been updated.`,
                time: new Date().toISOString()
            });
            
            showToast('Task updated successfully', 'success');
        }
        
        // Hide edit task modal
        function hideEditTaskModal() {
            document.getElementById('editTaskModal').classList.remove('active');
            currentEditingTaskId = null;
        }
        
        // View task handler
        function handleViewTask(taskId) {
            const task = tasks.find(t => t.id === taskId);
            if (!task) return;
            
            // Populate view
            document.getElementById('viewTaskTitle').textContent = task.title;
            document.getElementById('viewTaskDescription').textContent = task.description || 'No description';
            document.getElementById('viewTaskDueDate').textContent = formatDate(task.dueDate);
            
            // Format priority
            const priorityElement = document.getElementById('viewTaskPriority');
            priorityElement.textContent = task.priority.charAt(0).toUpperCase() + task.priority.slice(1);
            priorityElement.className = '';
            if (task.priority === 'high') {
                priorityElement.classList.add('priority-high');
            } else if (task.priority === 'medium') {
                priorityElement.classList.add('priority-medium');
            } else {
                priorityElement.classList.add('priority-low');
            }
            
            // Format category
            const categoryElement = document.getElementById('viewTaskCategory');
            categoryElement.textContent = task.category;
            categoryElement.className = 'task-category';
            
            // Format status
            const statusElement = document.getElementById('viewTaskStatus');
            statusElement.textContent = task.completed ? 'Completed' : 'Pending';
            statusElement.className = task.completed ? 'task-category' : 'priority-medium';
            
            // Format subtasks
            const subTasksContainer = document.getElementById('viewSubTasksContainer');
            const noSubtasksMessage = document.getElementById('noSubtasksMessage');
            
            if (task.subTasks && task.subTasks.length > 0) {
                subTasksContainer.innerHTML = '';
                noSubtasksMessage.style.display = 'none';
                
                task.subTasks.forEach(subtask => {
                    const subtaskElement = document.createElement('div');
                    subtaskElement.className = 'subtask-item';
                    subtaskElement.innerHTML = `
                        <i class="${subtask.completed ? 'fas fa-check-circle' : 'far fa-circle'}"></i>
                        <span style="${subtask.completed ? 'text-decoration: line-through; color: var(--grey-color);' : ''}">${subtask.title}</span>
                    `;
                    
                    subTasksContainer.appendChild(subtaskElement);
                });
            } else {
                subTasksContainer.innerHTML = '';
                noSubtasksMessage.style.display = 'block';
            }
            
            // Format notes
            document.getElementById('viewTaskNotes').textContent = task.notes || 'No notes';
            
            // Format time spent
            document.getElementById('viewTaskTimeSpent').textContent = formatTime(task.timeSpent || 0);
            
            // Set task ID for edit button
            document.getElementById('viewEditTaskBtn').setAttribute('data-task-id', taskId);
            
            // Show modal
            document.getElementById('viewTaskModal').classList.add('active');
        }
        
        // View -> edit task handler
        function handleViewEditTask() {
            const taskId = this.getAttribute('data-task-id');
            hideViewTaskModal();
            handleEditTask(taskId);
        }
        
        // Hide view task modal
        function hideViewTaskModal() {
            document.getElementById('viewTaskModal').classList.remove('active');
        }
        
        // Delete task handler
        function handleDeleteTask(taskId) {
            const task = tasks.find(t => t.id === taskId);
            if (!task) return;
            
            // Add to history
            addToHistory({
                type: 'delete',
                data: { task: { ...task } }
            });
            
            // Remove task
            tasks = tasks.filter(t => t.id !== taskId);
            saveTasksToStorage();
            
            // Update UI
            updateTaskCounters();
            applyFilters();
            updateInsights();
            updateCharts();
            
            // Add notification
            addNotification({
                type: 'alert',
                title: 'Task Deleted',
                message: `Task "${task.title}" has been deleted.`,
                time: new Date().toISOString()
            });
            
            showToast('Task deleted successfully', 'success');
        }
        
        // Toggle task completion handler
        function handleToggleTaskCompletion(taskId) {
            const task = tasks.find(t => t.id === taskId);
            if (!task) return;
            
            // Store old state for history
            const oldCompleted = task.completed;
            
            // Toggle completed state
            task.completed = !task.completed;
            
            // Add to history
            addToHistory({
                type: 'toggle',
                data: { 
                    taskId, 
                    oldCompleted, 
                    newCompleted: task.completed 
                }
            });
            
            // Save changes
            saveTasksToStorage();
            
            // Update UI
            updateTaskCounters();
            applyFilters();
            updateInsights();
            updateCharts();
            
            // Add notification
            addNotification({
                type: task.completed ? 'task' : 'warning',
                title: task.completed ? 'Task Completed' : 'Task Reopened',
                message: `Task "${task.title}" has been ${task.completed ? 'completed' : 'reopened'}.`,
                time: new Date().toISOString()
            });
            
            showToast(`Task ${task.completed ? 'completed' : 'reopened'}`, 'success');
        }
        
        // Toggle task timer handler
        function handleToggleTaskTimer(taskId) {
            const task = tasks.find(t => t.id === taskId);
            if (!task) return;
            
            const btn = document.querySelector(`[data-task-id="${taskId}"].task-btn-timer`);
            const icon = btn.querySelector('i');
            
            if (taskTimers[taskId]?.running) {
                // Stop timer
                clearInterval(taskTimers[taskId].intervalId);
                taskTimers[taskId].running = false;
                icon.classList.remove('fa-pause');
                icon.classList.add('fa-play');
                
                // Update notification
                showToast(`Timer stopped for "${task.title}" - Total: ${formatTime(task.timeSpent)}`, 'info');
            } else {
                // Start timer
                taskTimers[taskId] = {
                    running: true,
                    intervalId: setInterval(() => {
                        task.timeSpent = (task.timeSpent || 0) + 1;
                        saveTasksToStorage();
                        
                        // Update time display if visible
                        const timeDisplay = document.querySelector(`[data-task-id="${taskId}"] .task-timer-info span`);
                        if (timeDisplay) {
                            timeDisplay.textContent = formatTime(task.timeSpent);
                        }
                    }, 1000)
                };
                
                icon.classList.remove('fa-play');
                icon.classList.add('fa-pause');
                
                // Update notification
                showToast(`Timer started for "${task.title}"`, 'info');
            }
        }
        
        // Show export modal
        function showExportModal() {
            document.getElementById('exportModal').classList.add('active');
        }
        
        // Hide export modal
        function hideExportModal() {
            document.getElementById('exportModal').classList.remove('active');
        }
        
        // Handle export tasks
        function handleExportTasks() {
            const format = document.getElementById('exportFormat').value;
            
            try {
                if (format === 'pdf') {
                    exportTasksAsPDF();
                } else if (format === 'xlsx') {
                    exportTasksAsExcel();
                } else if (format === 'json') {
                    exportTasksAsJSON();
                }
                
                hideExportModal();
                showToast('Tasks exported successfully', 'success');
            } catch (error) {
                console.error('Export error:', error);
                showToast('Error exporting tasks', 'error');
            }
        }
        
        // Export tasks as PDF
        function exportTasksAsPDF() {
            // In a real implementation, this would use jsPDF to create a PDF file
            alert('PDF export functionality would be implemented here.\nIn a real implementation, this would generate a PDF file for download.');
        }
        
        // Export tasks as Excel
        function exportTasksAsExcel() {
            // In a real implementation, this would use xlsx.js to create an Excel file
            alert('Excel export functionality would be implemented here.\nIn a real implementation, this would generate an Excel file for download.');
        }
        
        // Export tasks as JSON
        function exportTasksAsJSON() {
            // In a real implementation, this would create a JSON file for download
            alert('JSON export functionality would be implemented here.\nIn a real implementation, this would generate a JSON file for download.');
        }
        
        // Show import modal
        function showImportModal() {
            document.getElementById('importModal').classList.add('active');
            document.getElementById('importType').value = 'file';
            document.getElementById('importFileGroup').classList.remove('hidden');
            document.getElementById('importUrlGroup').classList.add('hidden');
        }
        
        // Hide import modal
        function hideImportModal() {
            document.getElementById('importModal').classList.remove('active');
        }
        
        // Toggle import fields
        function toggleImportFields() {
            const importType = document.getElementById('importType').value;
            
            if (importType === 'file') {
                document.getElementById('importFileGroup').classList.remove('hidden');
                document.getElementById('importUrlGroup').classList.add('hidden');
            } else {
                document.getElementById('importFileGroup').classList.add('hidden');
                document.getElementById('importUrlGroup').classList.remove('hidden');
            }
        }
        
        // Handle import tasks
        function handleImportTasks() {
            const importType = document.getElementById('importType').value;
            
            try {
                if (importType === 'file') {
                    const fileInput = document.getElementById('importFile');
                    
                    if (!fileInput.files.length) {
                        showToast('Please select a file', 'error');
                        return;
                    }
                    
                    // In a real implementation, this would read and parse the JSON file
                    // For demo purposes, we'll just simulate a successful import
                    simulateTaskImport();
                } else {
                    const url = document.getElementById('importUrl').value;
                    
                    if (!url) {
                        showToast('Please enter a URL', 'error');
                        return;
                    }
                    
                    // In a real implementation, this would fetch and parse the JSON from URL
                    // For demo purposes, we'll just simulate a successful import
                    simulateTaskImport();
                }
            } catch (error) {
                console.error('Import error:', error);
                showToast('Error importing tasks', 'error');
            }
        }
        
        // Simulate task import
        function simulateTaskImport() {
            // Add random tasks
            const newTasks = generateRandomTasks(3);
            
            // Add to history
            addToHistory({
                type: 'import',
                data: { tasks: [...newTasks] }
            });
            
            // Add tasks to array
            tasks = [...newTasks, ...tasks];
            saveTasksToStorage();
            
            // Update UI
            updateTaskCounters();
            applyFilters();
            updateInsights();
            updateCharts();
            
            // Hide modal
            hideImportModal();
            
            // Add notification
            addNotification({
                type: 'task',
                title: 'Tasks Imported',
                message: `${newTasks.length} tasks have been imported.`,
                time: new Date().toISOString()
            });
            
            showToast('Tasks imported successfully', 'success');
        }
        
        // Show categories modal
        function showCategoriesModal() {
            renderCategories();
            document.getElementById('categoriesModal').classList.add('active');
        }
        
        // Hide categories modal
        function hideCategoriesModal() {
            document.getElementById('categoriesModal').classList.remove('active');
        }
        
        // Render categories
        function renderCategories() {
            const categoriesList = document.getElementById('categoriesList');
            categoriesList.innerHTML = '';
            
            categories.forEach(category => {
                const categoryElement = document.createElement('div');
                categoryElement.className = 'category-item';
                categoryElement.style = 'display: flex; justify-content: space-between; align-items: center; padding: 10px; border-bottom: 1px solid var(--border-color);';
                categoryElement.innerHTML = `
                    <span>${category}</span>
                    <div>
                        <button class="btn btn-secondary edit-category-btn" data-category="${category}">
                            <i class="fas fa-edit"></i>
                        </button>
                        <button class="btn btn-danger delete-category-btn" data-category="${category}">
                            <i class="fas fa-trash"></i>
                        </button>
                    </div>
                `;
                
                categoriesList.appendChild(categoryElement);
            });
            
            // Add event listeners
            document.querySelectorAll('.edit-category-btn').forEach(btn => {
                btn.addEventListener('click', handleEditCategory);
            });
            
            document.querySelectorAll('.delete-category-btn').forEach(btn => {
                btn.addEventListener('click', handleDeleteCategory);
            });
        }
        
        // Handle add category
        function handleAddCategory() {
            const categoryName = document.getElementById('newCategoryName').value.trim();
            
            if (!categoryName) {
                showToast('Please enter category name', 'error');
                return;
            }
            
            // Check for duplicate
            if (categories.includes(categoryName)) {
                showToast('Category already exists', 'error');
                return;
            }
            
            // Add category
            categories.push(categoryName);
            saveCategoriesToStorage();
            
            // Update UI
            renderCategories();
            renderCategoryOptions();
            updateInsights();
            
            // Clear input
            document.getElementById('newCategoryName').value = '';
            
            showToast('Category added successfully', 'success');
        }
        
        // Handle edit category
        function handleEditCategory() {
            const oldCategory = this.getAttribute('data-category');
            const newCategory = prompt('Enter new category name:', oldCategory);
            
            if (!newCategory || newCategory === oldCategory) {
                return;
            }
            
            // Check for duplicate
            if (categories.includes(newCategory)) {
                showToast('Category already exists', 'error');
                return;
            }
            
            // Update category in array
            const index = categories.indexOf(oldCategory);
            if (index !== -1) {
                categories[index] = newCategory;
                saveCategoriesToStorage();
            }
            
            // Update tasks with this category
            tasks.forEach(task => {
                if (task.category === oldCategory) {
                    task.category = newCategory;
                }
            });
            saveTasksToStorage();
            
            // Update UI
            renderCategories();
            renderCategoryOptions();
            applyFilters();
            
            showToast('Category updated successfully', 'success');
        }
        
        // Handle delete category
        function handleDeleteCategory() {
            const category = this.getAttribute('data-category');
            
            // Check if category is used in tasks
            const tasksWithCategory = tasks.filter(task => task.category === category);
            
            if (tasksWithCategory.length > 0) {
                if (!confirm(`This category is used in ${tasksWithCategory.length} tasks. Are you sure you want to delete it?`)) {
                    return;
                }
                
                // Update tasks with this category
                tasks.forEach(task => {
                    if (task.category === category) {
                        task.category = 'Uncategorized';
                    }
                });
                saveTasksToStorage();
                
                // Add Uncategorized category if it doesn't exist
                if (!categories.includes('Uncategorized')) {
                    categories.push('Uncategorized');
                }
            }
            
            // Delete category
            categories = categories.filter(c => c !== category);
            saveCategoriesToStorage();
            
            // Update UI
            renderCategories();
            renderCategoryOptions();
            applyFilters();
            updateInsights();
            
            showToast('Category deleted successfully', 'success');
        }
        
        // Render category options
        function renderCategoryOptions() {
            const taskCategorySelect = document.getElementById('taskCategory');
            const editTaskCategorySelect = document.getElementById('editTaskCategory');
            const categoryFilterMenu = document.getElementById('categoryFilterMenu');
            
            // Clear existing options
            taskCategorySelect.innerHTML = '<option value="">Select category</option>';
            editTaskCategorySelect.innerHTML = '<option value="">Select category</option>';
            categoryFilterMenu.innerHTML = '<div class="filter-item active" data-value="all">All Categories</div>';
            
            // Add options
            categories.forEach(category => {
                // Add to task category select
                const option = document.createElement('option');
                option.value = category;
                option.textContent = category;
                taskCategorySelect.appendChild(option);
                
                // Add to edit task category select
                const editOption = document.createElement('option');
                editOption.value = category;
                editOption.textContent = category;
                editTaskCategorySelect.appendChild(editOption);
                
                // Add to category filter menu
                const filterItem = document.createElement('div');
                filterItem.className = 'filter-item';
                filterItem.setAttribute('data-value', category);
                filterItem.textContent = category;
                categoryFilterMenu.appendChild(filterItem);
            });
            
            // Add event listeners to filter items
            setupFilterItemListeners('categoryFilterMenu', 'category');
        }
        
        // Show users modal
        function showUsersModal() {
            renderUsers();
            document.getElementById('usersModal').classList.add('active');
        }
        
        // Hide users modal
        function hideUsersModal() {
            document.getElementById('usersModal').classList.remove('active');
        }
        
        // Render users
        function renderUsers() {
            const usersGrid = document.getElementById('usersGrid');
            usersGrid.innerHTML = '';
            
            users.forEach(user => {
                const userElement = document.createElement('div');
                userElement.className = 'user-card';
                userElement.innerHTML = `
                    <img src="${user.avatar}" alt="${user.firstName} ${user.lastName}" class="user-avatar">
                    <h3 class="user-name">${user.firstName} ${user.lastName}</h3>
                    <p class="user-email">${user.email}</p>
                    <div class="user-role">${user.role}</div>
                `;
                
                usersGrid.appendChild(userElement);
            });
        }
        
        // Show profile modal
        function showProfileModal() {
            if (!currentUser) return;
            
            // Populate profile data
            document.getElementById('userProfilePic').src = currentUser.avatar;
            document.getElementById('profileName').value = `${currentUser.firstName} ${currentUser.lastName}`;
            document.getElementById('profileEmail').value = currentUser.email;
            document.getElementById('profilePhone').value = currentUser.phone || '';
            document.getElementById('profileCountry').value = currentUser.country || '';
            document.getElementById('profileRole').value = currentUser.role || '';
            document.getElementById('profileJoiningDate').value = formatDate(currentUser.joiningDate);
            
            // Hide profile dropdown
            document.getElementById('profileDropdown').classList.remove('show');
            
            // Show modal
            document.getElementById('profileModal').classList.add('active');
        }
        
        // Hide profile modal
        function hideProfileModal() {
            document.getElementById('profileModal').classList.remove('active');
        }
        
        // Show edit profile modal
        function showEditProfileModal() {
            if (!currentUser) return;
            
            // Populate form
            document.getElementById('editProfileName').value = `${currentUser.firstName} ${currentUser.lastName}`;
            document.getElementById('editProfileEmail').value = currentUser.email;
            document.getElementById('editProfilePhone').value = currentUser.phone || '';
            document.getElementById('editProfileCountry').value = currentUser.country || '';
            
            // Hide profile modal
            hideProfileModal();
            
            // Show edit modal
            document.getElementById('editProfileModal').classList.add('active');
        }
        
        // Hide edit profile modal
        function hideEditProfileModal() {
            document.getElementById('editProfileModal').classList.remove('active');
        }
        
        // Handle profile pic change
        function handleProfilePicChange(event) {
            const file = event.target.files[0];
            
            if (file) {
                // In a real implementation, this would upload the file
                // For demo purposes, we'll just use a data URL
                const reader = new FileReader();
                
                reader.onload = function(e) {
                    const img = document.getElementById('userProfilePic');
                    img.src = e.target.result;
                    
                    // Update user avatar
                    if (currentUser) {
                        currentUser.avatar = e.target.result;
                        saveUserToStorage();
                        
                        // Also update header profile pic
                        document.getElementById('profilePic').src = e.target.result;
                    }
                };
                
                reader.readAsDataURL(file);
            }
        }
        
        // Handle update profile
        function handleUpdateProfile() {
            if (!currentUser) return;
            
            const fullName = document.getElementById('editProfileName').value.trim();
            const email = document.getElementById('editProfileEmail').value.trim();
            const phone = document.getElementById('editProfilePhone').value.trim();
            const country = document.getElementById('editProfileCountry').value;
            
            // Validation
            if (!fullName || !email) {
                showToast('Please enter name and email', 'error');
                return;
            }
            
            // Split full name into first and last name
            const nameParts = fullName.split(' ');
            let firstName, lastName;
            
            if (nameParts.length === 1) {
                firstName = nameParts[0];
                lastName = '';
            } else {
                firstName = nameParts[0];
                lastName = nameParts.slice(1).join(' ');
            }
            
            // Update user data
            currentUser.firstName = firstName;
            currentUser.lastName = lastName;
            currentUser.email = email;
            currentUser.phone = phone;
            currentUser.country = country;
            
            // Save changes
            saveUserToStorage();
            
            // Hide edit profile modal
            hideEditProfileModal();
            
            // Show profile modal with updated data
            showProfileModal();
            
            showToast('Profile updated successfully', 'success');
        }
        
        // Show status modal
        function showStatusModal() {
            document.getElementById('userStatus').value = 'login';
            
            // Hide profile dropdown
            document.getElementById('profileDropdown').classList.remove('show');
            
            // Show modal
            document.getElementById('statusModal').classList.add('active');
        }
        
        // Hide status modal
        function hideStatusModal() {
            document.getElementById('statusModal').classList.remove('active');
        }
        
        // Handle update status
        function handleUpdateStatus() {
            const status = document.getElementById('userStatus').value;
            const statusIndicator = document.getElementById('statusIndicator');
            
            // Update status indicator
            statusIndicator.className = 'status-indicator';
            statusIndicator.textContent = status.charAt(0).toUpperCase() + status.slice(1);
            
            // Add appropriate class
            if (status === 'login') {
                statusIndicator.classList.add('status-login');
            } else if (status === 'logout') {
                statusIndicator.classList.add('status-logout');
            } else if (status === 'break') {
                statusIndicator.classList.add('status-break');
            } else if (status === 'shadow') {
                statusIndicator.classList.add('status-shadow');
            }
            
            // Hide modal
            hideStatusModal();
            
            showToast('Status updated successfully', 'success');
        }
        
        // Show notifications modal
        function showNotificationsModal() {
            renderNotifications();
            document.getElementById('notificationsModal').classList.add('active');
        }
        
        // Hide notifications modal
        function hideNotificationsModal() {
            document.getElementById('notificationsModal').classList.remove('active');
        }
        
        // Render notifications
        function renderNotifications() {
            const notificationsList = document.getElementById('notificationsList');
            notificationsList.innerHTML = '';
            
            if (notifications.length === 0) {
                notificationsList.innerHTML = '<div style="padding: 20px; text-align: center; color: var(--grey-color);">No notifications</div>';
                return;
            }
            
            // Sort notifications by time (newest first)
            const sortedNotifications = [...notifications].sort((a, b) => new Date(b.time) - new Date(a.time));
            
            sortedNotifications.forEach(notification => {
                const notificationElement = document.createElement('div');
                notificationElement.className = 'notification';
                
                if (!notification.read) {
                    notificationElement.classList.add('notification-unread');
                }
                
                let iconClass = 'fas fa-tasks';
                let iconType = 'notification-icon-task';
                
                if (notification.type === 'warning') {
                    iconClass = 'fas fa-exclamation-triangle';
                    iconType = 'notification-icon-warning';
                } else if (notification.type === 'alert') {
                    iconClass = 'fas fa-bell';
                    iconType = 'notification-icon-alert';
                }
                
                notificationElement.innerHTML = `
                    <div class="notification-icon ${iconType}">
                        <i class="${iconClass}"></i>
                    </div>
                    <div class="notification-content">
                        <div class="notification-title">${notification.title}</div>
                        <div class="notification-message">${notification.message}</div>
                    </div>
                    <div class="notification-time">${formatNotificationTime(notification.time)}</div>
                `;
                
                // Add click handler to mark as read
                notificationElement.addEventListener('click', () => {
                    markNotificationAsRead(notifications.indexOf(notification));
                    notificationElement.classList.remove('notification-unread');
                });
                
                notificationsList.appendChild(notificationElement);
            });
        }
        
        // Format notification time
        function formatNotificationTime(timeString) {
            const date = new Date(timeString);
            const now = new Date();
            const diff = now - date;
            
            // Less than a minute
            if (diff < 60000) {
                return 'Just now';
            }
            
            // Less than an hour
            if (diff < 3600000) {
                const minutes = Math.floor(diff / 60000);
                return `${minutes} ${minutes === 1 ? 'minute' : 'minutes'} ago`;
            }
            
            // Less than a day
            if (diff < 86400000) {
                const hours = Math.floor(diff / 3600000);
                return `${hours} ${hours === 1 ? 'hour' : 'hours'} ago`;
            }
            
            // Less than a week
            if (diff < 604800000) {
                const days = Math.floor(diff / 86400000);
                return `${days} ${days === 1 ? 'day' : 'days'} ago`;
            }
            
            // Otherwise, return the date
            return formatDate(timeString);
        }
        
        // Add notification
        function addNotification(notification) {
            notifications.unshift({
                ...notification,
                read: false
            });
            
            // Limit to 20 notifications
            if (notifications.length > 20) {
                notifications.pop();
            }
            
            saveNotificationsToStorage();
            updateNotificationBadge();
            
            // Show toast for urgent notifications
            if (notification.type === 'warning' || notification.type === 'alert') {
                showToast(notification.message, notification.type === 'warning' ? 'warning' : 'error');
            }
        }
        
        // Mark notification as read
        function markNotificationAsRead(index) {
            if (notifications[index]) {
                notifications[index].read = true;
                saveNotificationsToStorage();
                updateNotificationBadge();
            }
        }
        
        // Mark all notifications as read
        function markAllNotificationsAsRead() {
            notifications.forEach(notification => {
                notification.read = true;
            });
            
            saveNotificationsToStorage();
            updateNotificationBadge();
            renderNotifications();
            
            showToast('All notifications marked as read', 'success');
        }
        
        // Update notification badge
        function updateNotificationBadge() {
            const badge = document.getElementById('notificationBadge');
            const unreadCount = notifications.filter(n => !n.read).length;
            
            badge.textContent = unreadCount;
            badge.style.display = unreadCount > 0 ? 'flex' : 'none';
        }
        
        // Show date range modal
        function showDateRangeModal() {
            document.getElementById('dateRangeStart').value = '';
            document.getElementById('dateRangeEnd').value = '';
            document.getElementById('dateRangeModal').classList.add('active');
        }
        
        // Hide date range modal
        function hideDateRangeModal() {
            document.getElementById('dateRangeModal').classList.remove('active');
        }
        
        // Apply date range
        function applyDateRange() {
            const startDate = document.getElementById('dateRangeStart').value;
            const endDate = document.getElementById('dateRangeEnd').value;
            
            if (!startDate || !endDate) {
                showToast('Please select both start and end dates', 'error');
                return;
            }
            
            // Update current filters
            currentFilters.date = 'custom';
            currentFilters.dateRange = {
                start: startDate,
                end: endDate
            };
            
            // Apply filters
            applyFilters();
            
            // Hide modal
            hideDateRangeModal();
            
            // Update filter button text
            document.getElementById('dateFilterBtn').innerHTML = `
                <i class="fas fa-calendar"></i> ${formatDate(startDate)} - ${formatDate(endDate)}
                <i class="fas fa-chevron-down"></i>
            `;
            
            // Update active filter item
            const menuItems = document.querySelectorAll('#dateFilterMenu .filter-item');
            menuItems.forEach(item => {
                item.classList.remove('active');
                if (item.getAttribute('data-value') === 'custom') {
                    item.classList.add('active');
                }
            });
        }
        
        // Toggle app timer
        function toggleAppTimer() {
            const timerIcon = document.getElementById('timerIcon');
            
            if (appTimer.running) {
                // Stop timer
                clearInterval(appTimer.intervalId);
                appTimer.running = false;
                timerIcon.classList.remove('fa-pause');
                timerIcon.classList.add('fa-play');
            } else {
                // Start timer
                appTimer.intervalId = setInterval(updateAppTimer, 1000);
                appTimer.running = true;
                timerIcon.classList.remove('fa-play');
                timerIcon.classList.add('fa-pause');
            }
        }
        
        // Update app timer
        function updateAppTimer() {
            appTimer.seconds++;
            
            if (appTimer.seconds >= 60) {
                appTimer.seconds = 0;
                appTimer.minutes++;
                
                if (appTimer.minutes >= 60) {
                    appTimer.minutes = 0;
                    appTimer.hours++;
                }
            }
            
            // Update timer display
            document.getElementById('appTimer').textContent = formatTime(appTimer.hours * 3600 + appTimer.minutes * 60 + appTimer.seconds);
        }
        
        // Reset app timer
        function resetAppTimer() {
            // Stop timer if running
            if (appTimer.running) {
                clearInterval(appTimer.intervalId);
                appTimer.running = false;
                
                const timerIcon = document.getElementById('timerIcon');
                timerIcon.classList.remove('fa-pause');
                timerIcon.classList.add('fa-play');
            }
            
            // Reset timer values
            appTimer.hours = 0;
            appTimer.minutes = 0;
            appTimer.seconds = 0;
            
            // Update timer display
            document.getElementById('appTimer').textContent = '00:00:00';
        }
        
        // Batch delete handler
        function handleBatchDelete() {
            if (selectedTasks.length === 0) return;
            
            // Store tasks for history
            const tasksToDelete = tasks.filter(task => selectedTasks.includes(task.id)).map(task => ({ ...task }));
            
            // Add to history
            addToHistory({
                type: 'batchDelete',
                data: { tasks: tasksToDelete }
            });
            
            // Delete tasks
            tasks = tasks.filter(task => !selectedTasks.includes(task.id));
            saveTasksToStorage();
            
            // Update UI
            updateTaskCounters();
            applyFilters();
            updateInsights();
            updateCharts();
            
            // Add notification
            addNotification({
                type: 'alert',
                title: 'Tasks Deleted',
                message: `${selectedTasks.length} tasks have been deleted.`,
                time: new Date().toISOString()
            });
            
            // Reset selection
            selectedTasks = [];
            document.getElementById('batchActions').classList.remove('show');
            
            showToast(`${tasksToDelete.length} tasks deleted successfully`, 'success');
        }
        
        // Batch complete handler
        function handleBatchComplete() {
            if (selectedTasks.length === 0) return;
            
            // Store tasks for history
            const tasksBeforeUpdate = tasks.filter(task => selectedTasks.includes(task.id)).map(task => ({ ...task }));
            
            // Update tasks
            tasks.forEach(task => {
                if (selectedTasks.includes(task.id)) {
                    task.completed = true;
                }
            });
            
            // Add to history
            addToHistory({
                type: 'batchComplete',
                data: { 
                    tasksBefore: tasksBeforeUpdate,
                    tasksAfter: tasks.filter(task => selectedTasks.includes(task.id)).map(task => ({ ...task }))
                }
            });
            
            saveTasksToStorage();
            
            // Update UI
            updateTaskCounters();
            applyFilters();
            updateInsights();
            updateCharts();
            
            // Add notification
            addNotification({
                type: 'task',
                title: 'Tasks Completed',
                message: `${selectedTasks.length} tasks have been marked as completed.`,
                time: new Date().toISOString()
            });
            
            // Reset selection
            selectedTasks = [];
            document.getElementById('batchActions').classList.remove('show');
            
            showToast(`${tasksBeforeUpdate.length} tasks marked as completed`, 'success');
        }
        
        // Cancel batch selection
        function cancelBatchSelection() {
            selectedTasks = [];
            document.getElementById('batchActions').classList.remove('show');
            
            // Uncheck all checkboxes
            document.querySelectorAll('.task-checkbox input').forEach(checkbox => {
                checkbox.checked = false;
            });
        }
        
        // Handle search
        function handleSearch() {
            const searchValue = document.getElementById('searchInput').value.trim().toLowerCase();
            currentFilters.search = searchValue;
            applyFilters();
        }
        
        // Update task selection
        function updateTaskSelection() {
            const batchActions = document.getElementById('batchActions');
            
            if (selectedTasks.length > 0) {
                batchActions.classList.add('show');
            } else {
                batchActions.classList.remove('show');
            }
        }
        
        // Handle task checkbox click
        function handleTaskCheckboxClick(event, taskId) {
            // Prevent bubbling up to the task item
            event.stopPropagation();
            
            if (event.target.checked) {
                selectedTasks.push(taskId);
            } else {
                selectedTasks = selectedTasks.filter(id => id !== taskId);
            }
            
            updateTaskSelection();
        }
        
        // Undo action
        function undoAction() {
            if (actionsHistory.past.length === 0) return;
            
            // Get last action
            const action = actionsHistory.past.pop();
            
            // Add to future for redo
            actionsHistory.future.push(action);
            
            // Perform undo based on action type
            if (action.type === 'create') {
                // Remove created task
                tasks = tasks.filter(task => task.id !== action.data.task.id);
            } else if (action.type === 'update') {
                // Revert task to previous state
                const index = tasks.findIndex(task => task.id === action.data.oldTask.id);
                if (index !== -1) {
                    tasks[index] = { ...action.data.oldTask };
                }
            } else if (action.type === 'delete') {
                // Restore deleted task
                tasks.push({ ...action.data.task });
            } else if (action.type === 'toggle') {
                // Revert task completion state
                const task = tasks.find(t => t.id === action.data.taskId);
                if (task) {
                    task.completed = action.data.oldCompleted;
                }
            } else if (action.type === 'import') {
                // Remove imported tasks
                tasks = tasks.filter(task => !action.data.tasks.some(t => t.id === task.id));
            } else if (action.type === 'batchDelete') {
                // Restore deleted tasks
                tasks = [...tasks, ...action.data.tasks];
            } else if (action.type === 'batchComplete') {
                // Revert tasks to previous state
                action.data.tasksBefore.forEach(oldTask => {
                    const index = tasks.findIndex(task => task.id === oldTask.id);
                    if (index !== -1) {
                        tasks[index] = { ...oldTask };
                    }
                });
            }
            
            // Save changes
            saveTasksToStorage();
            
            // Update UI
            updateTaskCounters();
            applyFilters();
            updateInsights();
            updateCharts();
            updateHistoryButtons();
            
            showToast('Action undone', 'info');
        }
        
        // Redo action
        function redoAction() {
            if (actionsHistory.future.length === 0) return;
            
            // Get last undone action
            const action = actionsHistory.future.pop();
            
            // Add back to past
            actionsHistory.past.push(action);
            
            // Perform redo based on action type
            if (action.type === 'create') {
                // Re-add created task
                tasks.push({ ...action.data.task });
            } else if (action.type === 'update') {
                // Update task to new state
                const index = tasks.findIndex(task => task.id === action.data.newTask.id);
                if (index !== -1) {
                    tasks[index] = { ...action.data.newTask };
                }
            } else if (action.type === 'delete') {
                // Re-delete task
                tasks = tasks.filter(task => task.id !== action.data.task.id);
            } else if (action.type === 'toggle') {
                // Restore new completion state
                const task = tasks.find(t => t.id === action.data.taskId);
                if (task) {
                    task.completed = action.data.newCompleted;
                }
            } else if (action.type === 'import') {
                // Re-add imported tasks
                tasks = [...action.data.tasks, ...tasks];
            } else if (action.type === 'batchDelete') {
                // Re-delete tasks
                tasks = tasks.filter(task => !action.data.tasks.some(t => t.id === task.id));
            } else if (action.type === 'batchComplete') {
                // Restore tasks to completed state
                action.data.tasksAfter.forEach(newTask => {
                    const index = tasks.findIndex(task => task.id === newTask.id);
                    if (index !== -1) {
                        tasks[index] = { ...newTask };
                    }
                });
            }
            
            // Save changes
            saveTasksToStorage();
            
            // Update UI
            updateTaskCounters();
            applyFilters();
            updateInsights();
            updateCharts();
            updateHistoryButtons();
            
            showToast('Action redone', 'info');
        }
        
        // Add action to history
        function addToHistory(action) {
            actionsHistory.past.push(action);
            actionsHistory.future = []; // Clear redo stack
            updateHistoryButtons();
        }
        
        // Update undo/redo buttons
        function updateHistoryButtons() {
            const undoBtn = document.getElementById('undoBtn');
            const redoBtn = document.getElementById('redoBtn');
            
            undoBtn.disabled = actionsHistory.past.length === 0;
            redoBtn.disabled = actionsHistory.future.length === 0;
        }
        
        // Switch view
        function switchView(view) {
            const listViewBtn = document.getElementById('listViewBtn');
            const graphViewBtn = document.getElementById('graphViewBtn');
            const listView = document.getElementById('listView');
            const graphView = document.getElementById('graphView');
            
            if (view === 'list') {
                listViewBtn.classList.add('active');
                graphViewBtn.classList.remove('active');
                listView.classList.remove('hidden');
                graphView.classList.add('hidden');
                currentView = 'list';
            } else {
                listViewBtn.classList.remove('active');
                graphViewBtn.classList.add('active');
                listView.classList.add('hidden');
                graphView.classList.remove('hidden');
                currentView = 'graph';
                updateCharts();
            }
        }
        
        // Initialize charts
        function initializeCharts() {
            // Create charts
            const progressCtx = document.getElementById('tasksProgressChart').getContext('2d');
            const distributionCtx = document.getElementById('tasksDistributionChart').getContext('2d');
            
            // Set chart colors based on current theme
            const isDarkMode = document.documentElement.classList.contains('dark');
            const textColor = isDarkMode ? '#ffffff' : '#333333';
            const gridColor = isDarkMode ? 'rgba(255, 255, 255, 0.1)' : 'rgba(0, 0, 0, 0.1)';
            
            // Progress chart
            charts.progress = new Chart(progressCtx, {
                type: 'bar',
                data: {
                    labels: ['Completed', 'Pending'],
                    datasets: [{
                        label: 'Tasks',
                        data: [0, 0],
                        backgroundColor: [
                            'rgba(40, 167, 69, 0.7)',
                            'rgba(255, 193, 7, 0.7)'
                        ],
                        borderColor: [
                            'rgba(40, 167, 69, 1)',
                            'rgba(255, 193, 7, 1)'
                        ],
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                color: textColor
                            },
                            grid: {
                                color: gridColor
                            }
                        },
                        x: {
                            ticks: {
                                color: textColor
                            },
                            grid: {
                                color: gridColor
                            }
                        }
                    },
                    plugins: {
                        legend: {
                            display: false
                        }
                    }
                }
            });
            
            // Distribution chart
            charts.distribution = new Chart(distributionCtx, {
                type: 'pie',
                data: {
                    labels: ['Completed', 'Pending'],
                    datasets: [{
                        data: [0, 0],
                        backgroundColor: [
                            'rgba(40, 167, 69, 0.7)',
                            'rgba(255, 193, 7, 0.7)'
                        ],
                        borderColor: [
                            'rgba(40, 167, 69, 1)',
                            'rgba(255, 193, 7, 1)'
                        ],
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom',
                            labels: {
                                color: textColor
                            }
                        }
                    }
                }
            });
            
            // Update charts with data
            updateCharts();
        }
        
        // Update charts
        function updateCharts() {
            if (!charts.progress || !charts.distribution) return;
            
            // Set chart colors based on current theme
            const isDarkMode = document.documentElement.classList.contains('dark');
            const textColor = isDarkMode ? '#ffffff' : '#333333';
            const gridColor = isDarkMode ? 'rgba(255, 255, 255, 0.1)' : 'rgba(0, 0, 0, 0.1)';
            
            // Update chart theme
            charts.progress.options.scales.y.ticks.color = textColor;
            charts.progress.options.scales.y.grid.color = gridColor;
            charts.progress.options.scales.x.ticks.color = textColor;
            charts.progress.options.scales.x.grid.color = gridColor;
            
            charts.distribution.options.plugins.legend.labels.color = textColor;
            
            // Get task counts
            const completedTasks = tasks.filter(task => task.completed).length;
            const pendingTasks = tasks.filter(task => !task.completed).length;
            
            // Update progress chart
            charts.progress.data.datasets[0].data = [completedTasks, pendingTasks];
            charts.progress.update();
            
            // Update distribution chart
            charts.distribution.data.datasets[0].data = [completedTasks, pendingTasks];
            charts.distribution.update();
        }
        
        // Apply filters
        function applyFilters() {
            // Start with all tasks
            filteredTasks = [...tasks];
            
            // Apply search filter
            if (currentFilters.search) {
                filteredTasks = filteredTasks.filter(task => 
                    task.title.toLowerCase().includes(currentFilters.search) ||
                    (task.description && task.description.toLowerCase().includes(currentFilters.search))
                );
            }
            
            // Apply status filter
            if (currentFilters.status === 'active') {
                filteredTasks = filteredTasks.filter(task => !task.completed);
            } else if (currentFilters.status === 'completed') {
                filteredTasks = filteredTasks.filter(task => task.completed);
            }
            
            // Apply category filter
            if (currentFilters.category !== 'all') {
                filteredTasks = filteredTasks.filter(task => task.category === currentFilters.category);
            }
            
            // Apply priority filter
            if (currentFilters.priority !== 'all') {
                filteredTasks = filteredTasks.filter(task => task.priority === currentFilters.priority);
            }
            
            // Apply date filter
            if (currentFilters.date !== 'all') {
                const now = new Date();
                const today = new Date(now.getFullYear(), now.getMonth(), now.getDate());
                
                if (currentFilters.date === 'today') {
                    filteredTasks = filteredTasks.filter(task => {
                        const taskDate = new Date(task.dueDate);
                        return taskDate.getDate() === today.getDate() &&
                               taskDate.getMonth() === today.getMonth() &&
                               taskDate.getFullYear() === today.getFullYear();
                    });
                } else if (currentFilters.date === 'week') {
                    const weekEnd = new Date(today);
                    weekEnd.setDate(today.getDate() + 7);
                    
                    filteredTasks = filteredTasks.filter(task => {
                        const taskDate = new Date(task.dueDate);
                        return taskDate >= today && taskDate < weekEnd;
                    });
                } else if (currentFilters.date === 'month') {
                    const monthEnd = new Date(today);
                    monthEnd.setMonth(today.getMonth() + 1);
                    
                    filteredTasks = filteredTasks.filter(task => {
                        const taskDate = new Date(task.dueDate);
                        return taskDate >= today && taskDate < monthEnd;
                    });
                } else if (currentFilters.date === 'custom' && currentFilters.dateRange) {
                    const startDate = new Date(currentFilters.dateRange.start);
                    const endDate = new Date(currentFilters.dateRange.end);
                    endDate.setDate(endDate.getDate() + 1); // Include end date
                    
                    filteredTasks = filteredTasks.filter(task => {
                        const taskDate = new Date(task.dueDate);
                        return taskDate >= startDate && taskDate < endDate;
                    });
                }
            }
            
            // Apply sort
            const [sortField, sortDirection] = currentFilters.sort.split('-');
            
            filteredTasks.sort((a, b) => {
                if (sortField === 'title') {
                    return sortDirection === 'asc' 
                        ? a.title.localeCompare(b.title)
                        : b.title.localeCompare(a.title);
                } else if (sortField === 'dueDate') {
                    return sortDirection === 'asc'
                        ? new Date(a.dueDate) - new Date(b.dueDate)
                        : new Date(b.dueDate) - new Date(a.dueDate);
                } else if (sortField === 'priority') {
                    const priorityOrder = { high: 3, medium: 2, low: 1 };
                    return sortDirection === 'asc'
                        ? priorityOrder[a.priority] - priorityOrder[b.priority]
                        : priorityOrder[b.priority] - priorityOrder[a.priority];
                }
                
                return 0;
            });
            
            // Render filtered tasks
            renderTaskList();
        }
        
        // Update task counters
        function updateTaskCounters() {
            const totalTasks = tasks.length;
            const completedTasks = tasks.filter(task => task.completed).length;
            const pendingTasks = totalTasks - completedTasks;
            
            document.getElementById('totalTasksCount').textContent = totalTasks;
            document.getElementById('completedTasksCount').textContent = completedTasks;
            document.getElementById('pendingTasksCount').textContent = pendingTasks;
        }
        
        // Update insights
        function updateInsights() {
            // Productivity rate
            const totalTasks = tasks.length;
            const completedTasks = tasks.filter(task => task.completed).length;
            const productivityRate = totalTasks > 0 ? Math.round((completedTasks / totalTasks) * 100) : 0;
            document.getElementById('productivityRate').textContent = `${productivityRate}%`;
            
            // Average completion time
            const tasksWithTime = tasks.filter(task => task.completed && task.timeSpent);
            let avgTime = 0;
            
            if (tasksWithTime.length > 0) {
                const totalTime = tasksWithTime.reduce((sum, task) => sum + (task.timeSpent || 0), 0);
                avgTime = Math.round(totalTime / tasksWithTime.length / 3600 * 10) / 10; // Convert to hours with 1 decimal
            }
            
            document.getElementById('avgCompletionTime').textContent = `${avgTime}h`;
            
            // Overdue tasks
            const now = new Date();
            const overdueTasks = tasks.filter(task => !task.completed && new Date(task.dueDate) < now).length;
            document.getElementById('overdueTasksCount').textContent = overdueTasks;
            
            // Categories count
            document.getElementById('categoriesCount').textContent = categories.length;
        }
        
        // Render tasks
        function renderTasks() {
            // Apply current filters
            applyFilters();
        }
        
        // Render task list
        function renderTaskList() {
            const taskList = document.getElementById('taskList');
            taskList.innerHTML = '';
            
            if (filteredTasks.length === 0) {
                taskList.innerHTML = '<div style="text-align: center; padding: 30px; color: var(--grey-color);">No tasks found</div>';
                return;
            }
            
            filteredTasks.forEach(task => {
                const now = new Date();
                const dueDate = new Date(task.dueDate);
                const timeDiff = dueDate - now;
                const daysRemaining = Math.ceil(timeDiff / (1000 * 60 * 60 * 24));
                
                let borderClass = '';
                if (daysRemaining < 0) {
                    borderClass = 'task-border-expired';
                } else if (daysRemaining <= 2) {
                    borderClass = 'task-border-soon';
                } else {
                    borderClass = 'task-border-future';
                }
                
                const taskElement = document.createElement('div');
                taskElement.className = `task-item ${borderClass} ${task.completed ? 'task-completed' : ''}`;
                taskElement.setAttribute('data-task-id', task.id);
                taskElement.setAttribute('draggable', 'true');
                
                let subTasksHTML = '';
                if (task.subTasks && task.subTasks.length > 0) {
                    const completedSubtasks = task.subTasks.filter(subtask => subtask.completed).length;
                    subTasksHTML = `
                        <div class="subtasks-container">
                            <div class="subtask-item">
                                <i class="fas fa-tasks"></i> 
                                Subtasks: ${completedSubtasks}/${task.subTasks.length} completed
                            </div>
                        </div>
                    `;
                }
                
                let dueDateClass = '';
                if (daysRemaining < 0) {
                    dueDateClass = 'priority-high';
                } else if (daysRemaining <= 2) {
                    dueDateClass = 'priority-medium';
                }
                
                let timerInfo = '';
                if (task.timeSpent) {
                    timerInfo = `
                        <div class="task-timer-info">
                            <i class="fas fa-clock"></i>
                            <span>${formatTime(task.timeSpent)}</span>
                        </div>
                    `;
                }
                
                taskElement.innerHTML = `
                    <div class="task-checkbox">
                        <input type="checkbox" id="task-check-${task.id}" ${task.completed ? 'checked' : ''}>
                        <span class="checkmark"></span>
                    </div>
                    
                    <div class="task-content">
                        <div class="task-title">${task.title}</div>
                        <div class="task-description">${task.description || ''}</div>
                        ${subTasksHTML}
                        <div class="task-meta">
                            <div class="task-due ${dueDateClass}">
                                <i class="fas fa-calendar-alt"></i> ${formatDate(task.dueDate)}
                            </div>
                            <div class="task-priority priority-${task.priority}">
                                ${task.priority.charAt(0).toUpperCase() + task.priority.slice(1)}
                            </div>
                            <div class="task-category">
                                ${task.category}
                            </div>
                            ${timerInfo}
                        </div>
                    </div>
                    
                    <div class="task-actions">
                        <button class="task-btn task-btn-view" data-task-id="${task.id}">
                            <i class="fas fa-eye"></i>
                        </button>
                        <button class="task-btn task-btn-edit" data-task-id="${task.id}">
                            <i class="fas fa-edit"></i>
                        </button>
                        <button class="task-btn task-btn-delete" data-task-id="${task.id}">
                            <i class="fas fa-trash"></i>
                        </button>
                        <button class="task-btn task-btn-timer" data-task-id="${task.id}">
                            <i class="fas fa-${taskTimers[task.id]?.running ? 'pause' : 'play'}"></i>
                        </button>
                        <label class="task-toggle">
                            <input type="checkbox" ${task.completed ? 'checked' : ''} data-task-id="${task.id}">
                            <span class="toggle-slider"></span>
                        </label>
                    </div>
                `;
                
                taskList.appendChild(taskElement);
                
                // Add event listeners
                const checkbox = taskElement.querySelector('.task-checkbox input');
                checkbox.addEventListener('click', (e) => handleTaskCheckboxClick(e, task.id));
                
                const viewBtn = taskElement.querySelector('.task-btn-view');
                viewBtn.addEventListener('click', () => handleViewTask(task.id));
                
                const editBtn = taskElement.querySelector('.task-btn-edit');
                editBtn.addEventListener('click', () => handleEditTask(task.id));
                
                const deleteBtn = taskElement.querySelector('.task-btn-delete');
                deleteBtn.addEventListener('click', () => handleDeleteTask(task.id));
                
                const timerBtn = taskElement.querySelector('.task-btn-timer');
                timerBtn.addEventListener('click', () => handleToggleTaskTimer(task.id));
                
                const toggle = taskElement.querySelector('.task-toggle input');
                toggle.addEventListener('change', () => handleToggleTaskCompletion(task.id));
            });
        }
        
        // Setup drag and drop
        function setupDragAndDrop() {
            let draggedTask = null;
            
            // Event delegation for drag events
            document.addEventListener('dragstart', function(event) {
                if (event.target.classList.contains('task-item')) {
                    draggedTask = event.target;
                    event.target.classList.add('dragging');
                    
                    // Required for Firefox
                    event.dataTransfer.setData('text/plain', event.target.getAttribute('data-task-id'));
                    event.dataTransfer.effectAllowed = 'move';
                }
            });
            
            document.addEventListener('dragend', function(event) {
                if (event.target.classList.contains('task-item')) {
                    event.target.classList.remove('dragging');
                    draggedTask = null;
                }
            });
            
            document.addEventListener('dragover', function(event) {
                // Prevent default to allow drop
                event.preventDefault();
                
                if (!draggedTask) return;
                
                const taskList = document.getElementById('taskList');
                const taskItems = taskList.querySelectorAll('.task-item:not(.dragging)');
                
                // Find the closest task item to insert draggedTask before
                let nextTask = null;
                
                for (const taskItem of taskItems) {
                    const rect = taskItem.getBoundingClientRect();
                    const taskMiddle = rect.top + rect.height / 2;
                    
                    if (event.clientY < taskMiddle) {
                        nextTask = taskItem;
                        break;
                    }
                }
                
                // Insert the dragged task at the appropriate position
                if (nextTask) {
                    taskList.insertBefore(draggedTask, nextTask);
                } else {
                    taskList.appendChild(draggedTask);
                }
            });
            
            document.addEventListener('drop', function(event) {
                // Prevent default action
                event.preventDefault();
                
                if (!draggedTask) return;
                
                // Update the task array to match the new visual order
                const taskItems = document.querySelectorAll('.task-item');
                const newOrder = Array.from(taskItems).map(item => item.getAttribute('data-task-id'));
                
                // Create a new tasks array with the updated order (keeping only filtered tasks in the right order)
                const reorderedTasks = [];
                
                // First add tasks in the new order (only those that were displayed/filtered)
                newOrder.forEach(taskId => {
                    const task = tasks.find(t => t.id === taskId);
                    if (task) {
                        reorderedTasks.push(task);
                    }
                });
                
                // Then add any tasks that weren't in the filtered view (preserving their original order)
                tasks.forEach(task => {
                    if (!newOrder.includes(task.id)) {
                        reorderedTasks.push(task);
                    }
                });
                
                // Update the tasks array and save
                tasks = reorderedTasks;
                saveTasksToStorage();
                
                // Add to history (future implementation could track the specific move)
                addToHistory({
                    type: 'reorder',
                    data: { newOrder }
                });
            });
        }
        
        // Show toast notification
        function showToast(message, type = 'info') {
            const toastContainer = document.getElementById('toastContainer');
            
            const toast = document.createElement('div');
            toast.className = `toast toast-${type}`;
            
            let iconClass = 'fas fa-info-circle';
            if (type === 'success') {
                iconClass = 'fas fa-check-circle';
            } else if (type === 'warning') {
                iconClass = 'fas fa-exclamation-triangle';
            } else if (type === 'error') {
                iconClass = 'fas fa-times-circle';
            }
            
            toast.innerHTML = `
                <div class="toast-icon">
                    <i class="${iconClass}"></i>
                </div>
                <div class="toast-message">${message}</div>
                <button class="toast-close">
                    <i class="fas fa-times"></i>
                </button>
            `;
            
            // Add event listener to close button
            toast.querySelector('.toast-close').addEventListener('click', () => {
                toast.classList.remove('show');
                setTimeout(() => {
                    toastContainer.removeChild(toast);
                }, 300);
            });
            
            // Add toast to container
            toastContainer.appendChild(toast);
            
            // Show toast
            setTimeout(() => {
                toast.classList.add('show');
            }, 10);
            
            // Auto-close after 5 seconds
            setTimeout(() => {
                if (toastContainer.contains(toast)) {
                    toast.classList.remove('show');
                    setTimeout(() => {
                        if (toastContainer.contains(toast)) {
                            toastContainer.removeChild(toast);
                        }
                    }, 300);
                }
            }, 5000);
        }
    </script>
</body>
</html>
