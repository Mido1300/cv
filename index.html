<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>To-Do APP</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        primary: '#5D5CDE',
                        success: '#22c55e',
                        warning: '#facc15',
                        danger: '#ef4444',
                        info: '#3b82f6',
                        gray: {
                            dark: '#1f2937',
                            light: '#f3f4f6'
                        }
                    }
                }
            }
        }
    </script>
    <style>
        .task-item {
            transition: all 0.3s ease;
        }
        .task-item.completed {
            background-color: rgba(34, 197, 94, 0.1);
        }
        .task-item:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
        }
        .dragging {
            opacity: 0.5;
        }

        /* Custom scrollbar */
        ::-webkit-scrollbar {
            width: 6px;
            height: 6px;
        }
        ::-webkit-scrollbar-track {
            background: #f1f1f1;
        }
        .dark ::-webkit-scrollbar-track {
            background: #374151;
        }
        ::-webkit-scrollbar-thumb {
            background: #888;
            border-radius: 10px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #555;
        }

        /* Animation effects */
        .fade-in {
            animation: fadeIn 0.5s ease-in-out;
        }
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        .slide-up {
            animation: slideUp 0.3s ease-in-out;
        }
        @keyframes slideUp {
            from { transform: translateY(20px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        /* Status indicators */
        .status-indicator {
            border: 2px solid;
            transition: all 0.3s ease;
        }
        .status-online {
            border-color: #22c55e;
        }
        .status-break {
            border-color: #facc15;
        }
        .status-shadow {
            border-color: #9ca3af;
        }
        .status-offline {
            border-color: #ef4444;
        }

        /* Modal animations */
        .modal {
            transition: all 0.3s ease;
        }
        .modal.open {
            visibility: visible;
            opacity: 1;
        }
        .modal:not(.open) {
            visibility: hidden;
            opacity: 0;
        }
        
        .dark .task-item.completed {
            background-color: rgba(34, 197, 94, 0.05);
        }
    </style>
</head>
<body class="font-sans antialiased bg-gray-50 text-gray-800 dark:bg-gray-900 dark:text-gray-200 min-h-screen transition-colors duration-300">
    <!-- App Container -->
    <div id="app" class="relative">
        <!-- Login/Register Section -->
        <div id="auth-section" class="min-h-screen flex items-center justify-center p-4">
            <div class="w-full max-w-md">
                <!-- Login Form -->
                <div id="login-form" class="bg-white dark:bg-gray-800 shadow-md rounded-lg p-6 mb-4 fade-in">
                    <div class="flex justify-center mb-6">
                        <div class="bg-primary text-white rounded-full p-3">
                            <i class="fas fa-tasks text-xl"></i>
                        </div>
                    </div>
                    <h2 class="text-2xl font-bold text-center mb-6 text-primary">To-Do APP</h2>
                    <div class="mb-4">
                        <label class="block text-gray-700 dark:text-gray-300 text-sm font-bold mb-2" for="email">
                            Email
                        </label>
                        <input class="shadow appearance-none border rounded w-full py-2 px-3 text-base text-gray-700 dark:text-gray-300 dark:bg-gray-700 leading-tight focus:outline-none focus:ring-2 focus:ring-primary" id="email" type="email" placeholder="Email">
                    </div>
                    <div class="mb-6">
                        <label class="block text-gray-700 dark:text-gray-300 text-sm font-bold mb-2" for="password">
                            Password
                        </label>
                        <input class="shadow appearance-none border rounded w-full py-2 px-3 text-base text-gray-700 dark:text-gray-300 dark:bg-gray-700 leading-tight focus:outline-none focus:ring-2 focus:ring-primary" id="password" type="password" placeholder="******************">
                    </div>
                    <div class="flex items-center justify-between mb-6">
                        <button id="login-btn" class="bg-primary hover:bg-opacity-90 text-white font-bold py-2 px-4 rounded focus:outline-none focus:shadow-outline transition-all duration-300" type="button">
                            Sign In
                        </button>
                        <a class="inline-block align-baseline font-bold text-sm text-primary hover:text-opacity-80" href="#" id="show-register">
                            Don't have an account?
                        </a>
                    </div>
                    <div id="login-error" class="text-red-500 text-center mb-4 hidden"></div>
                </div>

                <!-- Register Form -->
                <div id="register-form" class="bg-white dark:bg-gray-800 shadow-md rounded-lg p-6 mb-4 hidden fade-in">
                    <div class="flex justify-center mb-6">
                        <div class="bg-primary text-white rounded-full p-3">
                            <i class="fas fa-user-plus text-xl"></i>
                        </div>
                    </div>
                    <h2 class="text-2xl font-bold text-center mb-6 text-primary">Create Account</h2>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div class="mb-4">
                            <label class="block text-gray-700 dark:text-gray-300 text-sm font-bold mb-2" for="reg-name">
                                Full Name
                            </label>
                            <input class="shadow appearance-none border rounded w-full py-2 px-3 text-base text-gray-700 dark:text-gray-300 dark:bg-gray-700 leading-tight focus:outline-none focus:ring-2 focus:ring-primary" id="reg-name" type="text" placeholder="Full Name">
                        </div>
                        
                        <div class="mb-4">
                            <label class="block text-gray-700 dark:text-gray-300 text-sm font-bold mb-2" for="reg-email">
                                Email
                            </label>
                            <input class="shadow appearance-none border rounded w-full py-2 px-3 text-base text-gray-700 dark:text-gray-300 dark:bg-gray-700 leading-tight focus:outline-none focus:ring-2 focus:ring-primary" id="reg-email" type="email" placeholder="Email">
                        </div>
                        
                        <div class="mb-4">
                            <label class="block text-gray-700 dark:text-gray-300 text-sm font-bold mb-2" for="reg-email-confirm">
                                Confirm Email
                            </label>
                            <input class="shadow appearance-none border rounded w-full py-2 px-3 text-base text-gray-700 dark:text-gray-300 dark:bg-gray-700 leading-tight focus:outline-none focus:ring-2 focus:ring-primary" id="reg-email-confirm" type="email" placeholder="Confirm Email">
                        </div>
                        
                        <div class="mb-4">
                            <label class="block text-gray-700 dark:text-gray-300 text-sm font-bold mb-2" for="reg-password">
                                Password
                            </label>
                            <input class="shadow appearance-none border rounded w-full py-2 px-3 text-base text-gray-700 dark:text-gray-300 dark:bg-gray-700 leading-tight focus:outline-none focus:ring-2 focus:ring-primary" id="reg-password" type="password" placeholder="Password">
                        </div>
                        
                        <div class="mb-4">
                            <label class="block text-gray-700 dark:text-gray-300 text-sm font-bold mb-2" for="reg-password-confirm">
                                Confirm Password
                            </label>
                            <input class="shadow appearance-none border rounded w-full py-2 px-3 text-base text-gray-700 dark:text-gray-300 dark:bg-gray-700 leading-tight focus:outline-none focus:ring-2 focus:ring-primary" id="reg-password-confirm" type="password" placeholder="Confirm Password">
                        </div>
                        
                        <div class="mb-4">
                            <label class="block text-gray-700 dark:text-gray-300 text-sm font-bold mb-2" for="reg-phone">
                                Phone Number
                            </label>
                            <input class="shadow appearance-none border rounded w-full py-2 px-3 text-base text-gray-700 dark:text-gray-300 dark:bg-gray-700 leading-tight focus:outline-none focus:ring-2 focus:ring-primary" id="reg-phone" type="tel" placeholder="Phone Number">
                        </div>
                        
                        <div class="mb-4">
                            <label class="block text-gray-700 dark:text-gray-300 text-sm font-bold mb-2" for="reg-country">
                                Country
                            </label>
                            <select class="shadow appearance-none border rounded w-full py-2 px-3 text-base text-gray-700 dark:text-gray-300 dark:bg-gray-700 leading-tight focus:outline-none focus:ring-2 focus:ring-primary" id="reg-country">
                                <option value="">Select Country</option>
                                <option value="US">United States</option>
                                <option value="CA">Canada</option>
                                <option value="UK">United Kingdom</option>
                                <option value="AU">Australia</option>
                                <option value="DE">Germany</option>
                                <option value="FR">France</option>
                                <option value="JP">Japan</option>
                                <option value="CN">China</option>
                                <option value="IN">India</option>
                                <option value="BR">Brazil</option>
                                <option value="AE">United Arab Emirates</option>
                                <option value="EG">Egypt</option>
                                <option value="SA">Saudi Arabia</option>
                            </select>
                        </div>
                        
                        <div class="mb-4">
                            <label class="block text-gray-700 dark:text-gray-300 text-sm font-bold mb-2" for="reg-role">
                                Role
                            </label>
                            <select class="shadow appearance-none border rounded w-full py-2 px-3 text-base text-gray-700 dark:text-gray-300 dark:bg-gray-700 leading-tight focus:outline-none focus:ring-2 focus:ring-primary" id="reg-role">
                                <option value="">Select Role</option>
                                <option value="Manager">Manager</option>
                                <option value="Admin">Admin</option>
                                <option value="Staff">Staff</option>
                                <option value="Customer">Customer</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="flex items-center justify-between mt-6">
                        <button id="register-btn" class="bg-primary hover:bg-opacity-90 text-white font-bold py-2 px-4 rounded focus:outline-none focus:shadow-outline transition-all duration-300" type="button">
                            Register
                        </button>
                        <a class="inline-block align-baseline font-bold text-sm text-primary hover:text-opacity-80" href="#" id="show-login">
                            Already have an account?
                        </a>
                    </div>
                    <div id="register-error" class="text-red-500 text-center mt-4 hidden"></div>
                </div>
            </div>
        </div>

        <!-- Dashboard Section -->
        <div id="dashboard-section" class="hidden">
            <!-- Header -->
            <header class="bg-white dark:bg-gray-800 shadow-md p-4">
                <div class="container mx-auto flex flex-wrap items-center justify-between">
                    <!-- Logo -->
                    <div class="flex items-center">
                        <div class="bg-primary text-white rounded-full p-2 mr-2">
                            <i class="fas fa-tasks"></i>
                        </div>
                        <h1 class="text-xl font-bold text-primary">To-Do APP</h1>
                    </div>
                    
                    <!-- Right Side Controls -->
                    <div class="flex items-center space-x-4">
                        <!-- Time Counter -->
                        <div id="time-counter" class="hidden md:flex items-center px-3 py-1 rounded-full border-2 border-green-500 text-sm">
                            <i class="fas fa-clock mr-2"></i>
                            <span id="time-display">00:00:00</span>
                        </div>
                        
                        <!-- Dark Mode Toggle -->
                        <button id="dark-mode-toggle" class="p-2 rounded-full hover:bg-gray-200 dark:hover:bg-gray-700 transition-colors">
                            <i class="fas fa-moon dark:hidden"></i>
                            <i class="fas fa-sun hidden dark:block"></i>
                        </button>
                        
                        <!-- Notifications -->
                        <div class="relative">
                            <button id="notification-btn" class="p-2 rounded-full hover:bg-gray-200 dark:hover:bg-gray-700 transition-colors">
                                <i class="fas fa-bell"></i>
                                <span id="notification-count" class="absolute -top-1 -right-1 bg-red-500 text-white text-xs rounded-full h-5 w-5 flex items-center justify-center">3</span>
                            </button>
                            
                            <!-- Notification Dropdown -->
                            <div id="notification-dropdown" class="hidden absolute right-0 mt-2 w-80 bg-white dark:bg-gray-800 rounded-md shadow-lg z-50">
                                <div class="p-3 border-b dark:border-gray-700">
                                    <h3 class="font-semibold">Notifications</h3>
                                </div>
                                <div class="max-h-60 overflow-y-auto">
                                    <div class="notification-item p-3 border-b dark:border-gray-700 hover:bg-gray-100 dark:hover:bg-gray-700 cursor-pointer">
                                        <div class="font-semibold">Task Deadline Approaching</div>
                                        <div class="text-sm text-gray-600 dark:text-gray-400">Task "Website Redesign" is due in 2 days</div>
                                    </div>
                                    <div class="notification-item p-3 border-b dark:border-gray-700 hover:bg-gray-100 dark:hover:bg-gray-700 cursor-pointer">
                                        <div class="font-semibold">New Task Assigned</div>
                                        <div class="text-sm text-gray-600 dark:text-gray-400">You have been assigned to "Database Migration"</div>
                                    </div>
                                    <div class="notification-item p-3 hover:bg-gray-100 dark:hover:bg-gray-700 cursor-pointer">
                                        <div class="font-semibold">Task Completed</div>
                                        <div class="text-sm text-gray-600 dark:text-gray-400">"Prototype Testing" was marked as complete</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Profile -->
                        <div class="relative">
                            <button id="profile-btn" class="flex items-center focus:outline-none">
                                <img id="profile-image" class="h-10 w-10 rounded-full object-cover status-indicator status-online" src="https://i.imgur.com/8Km9tLL.jpg" alt="User Profile">
                            </button>
                            
                            <!-- Profile Dropdown -->
                            <div id="profile-dropdown" class="hidden absolute right-0 mt-2 w-48 bg-white dark:bg-gray-800 rounded-md shadow-lg z-50">
                                <div class="p-3 border-b dark:border-gray-700">
                                    <div class="font-semibold user-name">John Doe</div>
                                    <div class="text-sm text-gray-600 dark:text-gray-400 user-role">Manager</div>
                                </div>
                                
                                <!-- Status Options -->
                                <div class="border-b dark:border-gray-700">
                                    <button id="status-btn" class="w-full text-left p-3 hover:bg-gray-100 dark:hover:bg-gray-700 flex items-center">
                                        <span class="h-2 w-2 rounded-full bg-green-500 mr-2"></span>
                                        <span id="current-status">Online</span>
                                        <i class="fas fa-chevron-down ml-auto"></i>
                                    </button>
                                    
                                    <div id="status-options" class="hidden px-2 py-1">
                                        <button data-status="online" class="w-full text-left px-3 py-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded flex items-center">
                                            <span class="h-2 w-2 rounded-full bg-green-500 mr-2"></span>
                                            Online
                                        </button>
                                        <button data-status="break" class="w-full text-left px-3 py-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded flex items-center">
                                            <span class="h-2 w-2 rounded-full bg-yellow-500 mr-2"></span>
                                            On Break
                                        </button>
                                        <button data-status="shadow" class="w-full text-left px-3 py-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded flex items-center">
                                            <span class="h-2 w-2 rounded-full bg-gray-500 mr-2"></span>
                                            Shadow
                                        </button>
                                        <button data-status="offline" class="w-full text-left px-3 py-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded flex items-center">
                                            <span class="h-2 w-2 rounded-full bg-red-500 mr-2"></span>
                                            Offline
                                        </button>
                                    </div>
                                </div>
                                
                                <div class="py-1">
                                    <button id="view-profile-btn" class="w-full text-left block px-4 py-2 hover:bg-gray-100 dark:hover:bg-gray-700">
                                        View Profile
                                    </button>
                                    <button id="logout-btn" class="w-full text-left block px-4 py-2 hover:bg-gray-100 dark:hover:bg-gray-700 text-red-500">
                                        Logout
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </header>

            <!-- Main Content -->
            <main class="container mx-auto p-4">
<!-- Task Stats -->
<div class="grid grid-cols-1 md:grid-cols-5 gap-6 mb-8">
    <div class="col-span-1 md:col-span-5 bg-white dark:bg-gray-800 rounded-lg shadow p-6 fade-in">
        <h2 class="text-xl font-bold mb-4 text-primary">Total Tasks</h2>
        <div class="flex items-center">
            <div class="bg-blue-100 dark:bg-blue-900 p-3 rounded-full mr-4">
                <i class="fas fa-tasks text-blue-500 dark:text-blue-300"></i>
            </div>
            <div>
                <div id="total-tasks-count" class="text-3xl font-bold text-blue-500 dark:text-blue-300">12</div>
            </div>
        </div>
    </div>

    <div class="col-span-1 md:col-span-2/5 bg-white dark:bg-gray-800 rounded-lg shadow p-6 fade-in">
        <h2 class="text-lg font-semibold mb-4 text-green-600 dark:text-green-400">Completed Tasks</h2>
        <div class="flex items-center">
            <div class="bg-green-100 dark:bg-green-900 p-3 rounded-full mr-4">
                <i class="fas fa-check text-green-500 dark:text-green-300"></i>
            </div>
            <div>
                <div id="completed-tasks-count" class="text-2xl font-bold text-green-500 dark:text-green-300">5</div>
            </div>
        </div>
    </div>

    <div class="col-span-1 md:col-span-2/5 bg-white dark:bg-gray-800 rounded-lg shadow p-6 fade-in">
        <h2 class="text-lg font-semibold mb-4 text-yellow-600 dark:text-yellow-400">Pending Tasks</h2>
        <div class="flex items-center">
            <div class="bg-yellow-100 dark:bg-yellow-900 p-3 rounded-full mr-4">
                <i class="fas fa-clock text-yellow-500 dark:text-yellow-300"></i>
            </div>
            <div>
                <div id="pending-tasks-count" class="text-2xl font-bold text-yellow-500 dark:text-yellow-300">7</div>
            </div>
        </div>
    </div>
</div>             
                <!-- Task Controls -->
                <div class="flex flex-wrap items-center justify-between gap-4 mb-6">
                    <div class="flex flex-wrap items-center gap-2">
                        <button id="import-btn" class="bg-white dark:bg-gray-800 py-2 px-4 rounded-lg shadow hover:shadow-md flex items-center transition-all duration-300">
                            <i class="fas fa-file-import mr-2 text-primary"></i>
                            <span>Import</span>
                        </button>
                        <button id="export-btn" class="bg-white dark:bg-gray-800 py-2 px-4 rounded-lg shadow hover:shadow-md flex items-center transition-all duration-300">
                            <i class="fas fa-file-export mr-2 text-primary"></i>
                            <span>Export</span>
                        </button>
                        <button id="users-btn" class="bg-white dark:bg-gray-800 py-2 px-4 rounded-lg shadow hover:shadow-md flex items-center transition-all duration-300">
                            <i class="fas fa-users mr-2 text-primary"></i>
                            <span>Users</span>
                        </button>
                        <button id="Categories-btn" class="bg-white dark:bg-gray-800 py-2 px-4 rounded-lg shadow hover:shadow-md flex items-center transition-all duration-300">
                            <i class="fas fa-file-export mr-2 text-primary"></i>
                            <span>Categories</span>
                        <button id="add-task-btn" class="bg-primary text-white py-2 px-4 rounded-lg shadow hover:shadow-md flex items-center transition-all duration-300">
                            <i class="fas fa-plus mr-2"></i>
                            <span>Add Task</span>
                        </button>
                    </div>
                    <div class="flex items-center">
                        <button id="list-view-btn" class="bg-primary text-white py-2 px-3 rounded-l-lg shadow">
                            <i class="fas fa-list"></i>
                        </button>
                        <button id="graph-view-btn" class="bg-white dark:bg-gray-800 text-gray-700 dark:text-gray-300 py-2 px-3 rounded-r-lg shadow border-l">
                            <i class="fas fa-chart-bar"></i>
                        </button>
                    </div>
                </div>

                <!-- Task Filters -->
                <div class="bg-white dark:bg-gray-800 rounded-lg shadow p-4 mb-6 fade-in">
                    <div class="flex flex-wrap items-center justify-between gap-4">
                        <div class="flex-1">
                            <div class="relative">
                                <span class="absolute inset-y-0 left-0 flex items-center pl-3">
                                    <i class="fas fa-search text-gray-400"></i>
                                </span>
                                <input id="search-input" type="text" class="block w-full pl-10 pr-3 py-2 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 focus:outline-none focus:ring-2 focus:ring-primary text-base" placeholder="Search tasks...">
                            </div>
                        </div>
                        
                        <div class="flex flex-wrap items-center gap-2">
                            <select id="category-filter" class="border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-primary text-base">
                                <option value="">All Categories</option>
                                <option value="Development">Development</option>
                                <option value="Design">Design</option>
                                <option value="Marketing">Marketing</option>
                                <option value="Research">Research</option>
                            </select>

                            <select id="priority-filter" class="border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-primary text-base">
                                <option value="">All Priorities</option>
                                <option value="High">High</option>
                                <option value="Medium">Medium</option>
                                <option value="Low">Low</option>
                            </select>

                            <select id="status-filter" class="border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-primary text-base">
                                <option value="">All Status</option>
                                <option value="Active">Active</option>
                                <option value="Completed">Completed</option>
                            </select>

                            <select id="date-filter" class="border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-primary text-base">
                                <option value="">All Dates</option>
                                <option value="today">Today</option>
                                <option value="week">This Week</option>
                                <option value="month">This Month</option>
                                <option value="custom">Custom Range</option>
                            </select>
                        </div>

                        <div class="flex items-center gap-2">
                            <button id="undo-btn" class="p-2 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700" title="Undo">
                                <i class="fas fa-undo"></i>
                            </button>
                            <button id="redo-btn" class="p-2 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700" title="Redo">
                                <i class="fas fa-redo"></i>
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Sort Options -->
                <div class="flex items-center justify-end mb-4">
                    <label class="mr-2 text-sm font-medium">Sort By:</label>
                    <select id="sort-select" class="border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-primary text-base">
                        <option value="dueDate">Due Date</option>
                        <option value="priority">Priority</option>
                        <option value="title">Title</option>
                        <option value="created">Created Date</option>
                    </select>
                    <button id="sort-direction" class="ml-2 p-2 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700">
                        <i class="fas fa-sort-amount-down"></i>
                    </button>
                </div>

                <!-- Task Selection Actions -->
                <div id="task-selection-actions" class="hidden bg-white dark:bg-gray-800 rounded-lg shadow p-4 mb-6 slide-up">
                    <div class="flex items-center justify-between">
                        <div>
                            <span id="selected-count" class="font-semibold">0</span> tasks selected
                        </div>
                        <div class="flex items-center gap-2">
                            <button id="mark-complete-selected" class="bg-green-500 hover:bg-green-600 text-white px-3 py-1 rounded-lg transition-colors">
                                <i class="fas fa-check mr-1"></i> Mark Complete
                            </button>
                            <button id="delete-selected" class="bg-red-500 hover:bg-red-600 text-white px-3 py-1 rounded-lg transition-colors">
                                <i class="fas fa-trash-alt mr-1"></i> Delete
                            </button>
                            <button id="cancel-selection" class="bg-gray-300 dark:bg-gray-700 hover:bg-gray-400 dark:hover:bg-gray-600 px-3 py-1 rounded-lg transition-colors">
                                Cancel
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Tasks List View -->
                <div id="list-view" class="mb-8">
                    <div class="bg-white dark:bg-gray-800 rounded-lg shadow overflow-hidden">
                        <div class="flex items-center justify-between px-6 py-4 border-b dark:border-gray-700">
                            <h2 class="text-xl font-bold text-primary">Tasks</h2>
                            <div class="text-sm text-gray-500 dark:text-gray-400">
                                Drag and drop to reorder
                            </div>
                        </div>
                        <div id="tasks-container" class="divide-y dark:divide-gray-700">
                            <!-- Task items will be inserted here dynamically -->
                        </div>
                    </div>
                </div>

                <!-- Graph View -->
                <div id="graph-view" class="mb-8 hidden">
                    <div class="bg-white dark:bg-gray-800 rounded-lg shadow p-6">
                        <h2 class="text-xl font-bold mb-6 text-primary">Task Analytics</h2>
                        
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <div class="bg-white dark:bg-gray-800 rounded-lg shadow p-4 border dark:border-gray-700">
                                <h3 class="text-lg font-semibold mb-4">Task Status</h3>
                                <div class="h-64">
                                    <canvas id="status-chart"></canvas>
                                </div>
                            </div>
                            
                            <div class="bg-white dark:bg-gray-800 rounded-lg shadow p-4 border dark:border-gray-700">
                                <h3 class="text-lg font-semibold mb-4">Priority Distribution</h3>
                                <div class="h-64">
                                    <canvas id="priority-chart"></canvas>
                                </div>
                            </div>
                            
                            <div class="bg-white dark:bg-gray-800 rounded-lg shadow p-4 border dark:border-gray-700">
                                <h3 class="text-lg font-semibold mb-4">Task Completion Timeline</h3>
                                <div class="h-64">
                                    <canvas id="timeline-chart"></canvas>
                                </div>
                            </div>
                            
                            <div class="bg-white dark:bg-gray-800 rounded-lg shadow p-4 border dark:border-gray-700">
                                <h3 class="text-lg font-semibold mb-4">Category Distribution</h3>
                                <div class="h-64">
                                    <canvas id="category-chart"></canvas>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Insights Section -->
                <div class="bg-white dark:bg-gray-800 rounded-lg shadow p-6 mb-8 fade-in">
                    <h2 class="text-xl font-bold mb-6 text-primary">Insights</h2>
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                        <div class="bg-blue-50 dark:bg-blue-900/20 p-4 rounded-lg border border-blue-100 dark:border-blue-800">
                            <h3 class="text-lg font-semibold mb-2 text-blue-700 dark:text-blue-300">Productivity Score</h3>
                            <div class="flex items-center">
                                <div class="text-2xl font-bold text-blue-600 dark:text-blue-300 mr-2" id="productivity-score">78%</div>
                                <div class="text-green-500">
                                    <i class="fas fa-arrow-up mr-1"></i>
                                    <span>5%</span>
                                </div>
                            </div>
                            <p class="text-sm text-gray-600 dark:text-gray-400 mt-2">Based on your task completion rate</p>
                        </div>
                        
                        <div class="bg-purple-50 dark:bg-purple-900/20 p-4 rounded-lg border border-purple-100 dark:border-purple-800">
                            <h3 class="text-lg font-semibold mb-2 text-purple-700 dark:text-purple-300">Time Management</h3>
                            <div class="flex items-center">
                                <div class="text-2xl font-bold text-purple-600 dark:text-purple-300 mr-2">6.5</div>
                                <div class="text-gray-500">/10</div>
                            </div>
                            <p class="text-sm text-gray-600 dark:text-gray-400 mt-2">Average hours per task</p>
                        </div>
                        
                        <div class="bg-amber-50 dark:bg-amber-900/20 p-4 rounded-lg border border-amber-100 dark:border-amber-800">
                            <h3 class="text-lg font-semibold mb-2 text-amber-700 dark:text-amber-300">Upcoming Deadlines</h3>
                            <div class="text-2xl font-bold text-amber-600 dark:text-amber-300">3</div>
                            <p class="text-sm text-gray-600 dark:text-gray-400 mt-2">Tasks due in the next 48 hours</p>
                        </div>
                    </div>
                </div>
            </main>
        </div>
    </div>

    <!-- MODALS -->
    
    <!-- Profile Modal -->
    <div id="profile-modal" class="modal fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4">
        <div class="bg-white dark:bg-gray-800 rounded-lg shadow-lg max-w-md w-full max-h-[90vh] overflow-y-auto">
            <div class="flex justify-between items-center border-b dark:border-gray-700 p-4">
                <h2 class="text-xl font-bold text-primary">User Profile</h2>
                <button class="close-modal text-gray-500 hover:text-gray-700 dark:hover:text-gray-300">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="p-6">
                <div class="flex flex-col items-center mb-6">
                    <div class="relative mb-4">
                        <img id="profile-pic" class="h-24 w-24 rounded-full object-cover border-2 border-primary" src="https://i.imgur.com/8Km9tLL.jpg" alt="Profile Picture">
                        <button id="change-profile-pic" class="absolute bottom-0 right-0 bg-primary text-white rounded-full p-2 shadow">
                            <i class="fas fa-camera"></i>
                        </button>
                    </div>
                    <h3 id="profile-name" class="text-lg font-semibold">John Doe</h3>
                    <p id="profile-role" class="text-sm text-gray-600 dark:text-gray-400">Manager</p>
                </div>
                
                <div class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Name</label>
                        <input id="profile-edit-name" type="text" class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-primary focus:border-primary dark:bg-gray-700 text-base" value="John Doe">
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Email</label>
                        <input id="profile-edit-email" type="email" class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-primary focus:border-primary dark:bg-gray-700 text-base" value="john.doe@example.com">
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Phone</label>
                        <input id="profile-edit-phone" type="tel" class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-primary focus:border-primary dark:bg-gray-700 text-base" value="+1 (555) 123-4567">
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Password</label>
                        <input id="profile-edit-password" type="password" class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-primary focus:border-primary dark:bg-gray-700 text-base" value="********">
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Country</label>
                        <select id="profile-edit-country" class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-primary focus:border-primary dark:bg-gray-700 text-base">
                            <option value="US">United States</option>
                            <option value="CA">Canada</option>
                            <option value="UK">United Kingdom</option>
                            <option value="AU">Australia</option>
                            <option value="DE">Germany</option>
                            <option value="FR">France</option>
                            <option value="JP">Japan</option>
                            <option value="CN">China</option>
                            <option value="IN">India</option>
                            <option value="BR">Brazil</option>
                            <option value="AE">United Arab Emirates</option>
                            <option value="EG">Egypt</option>
                            <option value="SA">Saudi Arabia</option>
                        </select>
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Role</label>
                        <select id="profile-edit-role" class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-primary focus:border-primary dark:bg-gray-700 text-base">
                            <option value="Manager">Manager</option>
                            <option value="Admin">Admin</option>
                            <option value="Staff">Staff</option>
                            <option value="Customer">Customer</option>
                        </select>
                    </div>
                </div>
                
                <div class="flex justify-end gap-3 mt-6">
                    <button class="close-modal px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm text-sm font-medium text-gray-700 dark:text-gray-300 bg-white dark:bg-gray-700 hover:bg-gray-50 dark:hover:bg-gray-600 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary">
                        Cancel
                    </button>
                    <button id="save-profile" class="px-4 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-primary hover:bg-opacity-90 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary">
                        Save Changes
                    </button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Add Task Modal -->
    <div id="add-task-modal" class="modal fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4">
        <div class="bg-white dark:bg-gray-800 rounded-lg shadow-lg max-w-2xl w-full max-h-[90vh] overflow-y-auto">
            <div class="flex justify-between items-center border-b dark:border-gray-700 p-4">
                <h2 class="text-xl font-bold text-primary">Add New Task</h2>
                <button class="close-modal text-gray-500 hover:text-gray-700 dark:hover:text-gray-300">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="p-6">
                <div class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Title</label>
                        <input id="task-title" type="text" class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-primary focus:border-primary dark:bg-gray-700 text-base" placeholder="Task title">
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Description</label>
                        <textarea id="task-description" rows="3" class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-primary focus:border-primary dark:bg-gray-700 text-base" placeholder="Task description"></textarea>
                    </div>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Category</label>
                            <select id="task-category" class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-primary focus:border-primary dark:bg-gray-700 text-base">
                                <option value="">Select Category</option>
                                <option value="Development">Development</option>
                                <option value="Design">Design</option>
                                <option value="Marketing">Marketing</option>
                                <option value="Research">Research</option>
                            </select>
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Priority</label>
                            <select id="task-priority" class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-primary focus:border-primary dark:bg-gray-700 text-base">
                                <option value="">Select Priority</option>
                                <option value="High">High</option>
                                <option value="Medium">Medium</option>
                                <option value="Low">Low</option>
                            </select>
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Due Date</label>
                            <input id="task-due-date" type="date" class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-primary focus:border-primary dark:bg-gray-700 text-base">
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Assign To</label>
                            <select id="task-assign" class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-primary focus:border-primary dark:bg-gray-700 text-base">
                                <option value="">Select User</option>
                                <option value="1">John Doe (You)</option>
                                <option value="2">Alice Smith</option>
                                <option value="3">Bob Johnson</option>
                                <option value="4">Carol Williams</option>
                            </select>
                        </div>
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Sub Tasks</label>
                        <div id="subtasks-container" class="space-y-2 mb-2">
                            <!-- Subtasks will be added here -->
                        </div>
                        <button id="add-subtask" class="text-primary hover:text-primary-dark text-sm flex items-center mt-1">
                            <i class="fas fa-plus mr-1"></i> Add Subtask
                        </button>
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Additional Notes</label>
                        <textarea id="task-notes" rows="2" class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-primary focus:border-primary dark:bg-gray-700 text-base" placeholder="Additional notes or details"></textarea>
                    </div>
                </div>
                
                <div class="flex justify-end gap-3 mt-6">
                    <button class="close-modal px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm text-sm font-medium text-gray-700 dark:text-gray-300 bg-white dark:bg-gray-700 hover:bg-gray-50 dark:hover:bg-gray-600 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary">
                        Cancel
                    </button>
                    <button id="save-task" class="px-4 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-primary hover:bg-opacity-90 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary">
                        Add Task
                    </button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Users Modal -->
    <div id="users-modal" class="modal fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4">
        <div class="bg-white dark:bg-gray-800 rounded-lg shadow-lg max-w-4xl w-full max-h-[90vh] overflow-y-auto">
            <div class="flex justify-between items-center border-b dark:border-gray-700 p-4">
                <h2 class="text-xl font-bold text-primary">Team Members</h2>
                <button class="close-modal text-gray-500 hover:text-gray-700 dark:hover:text-gray-300">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="p-6">
                <div class="mb-4 relative">
                    <input type="text" id="user-search" class="w-full px-3 py-2 pl-10 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-primary focus:border-primary dark:bg-gray-700 text-base" placeholder="Search users...">
                    <i class="fas fa-search absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400"></i>
                </div>
                
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4" id="users-container">
                    <!-- User cards will be added here -->
                </div>
            </div>
        </div>
    </div>
    
    <!-- Import Modal -->
    <div id="import-modal" class="modal fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4">
        <div class="bg-white dark:bg-gray-800 rounded-lg shadow-lg max-w-md w-full">
            <div class="flex justify-between items-center border-b dark:border-gray-700 p-4">
                <h2 class="text-xl font-bold text-primary">Import Tasks</h2>
                <button class="close-modal text-gray-500 hover:text-gray-700 dark:hover:text-gray-300">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="p-6">
                <div class="flex items-center justify-center w-full mb-6">
                    <label class="flex flex-col items-center justify-center w-full h-32 border-2 border-gray-300 dark:border-gray-600 border-dashed rounded-lg cursor-pointer bg-gray-50 dark:bg-gray-700 hover:bg-gray-100 dark:hover:bg-gray-600">
                        <div class="flex flex-col items-center justify-center pt-5 pb-6">
                            <i class="fas fa-file-upload text-2xl text-gray-500 dark:text-gray-400 mb-2"></i>
                            <p class="mb-2 text-sm text-gray-500 dark:text-gray-400">
                                <span class="font-semibold">Click to upload</span> or drag and drop
                            </p>
                            <p class="text-xs text-gray-500 dark:text-gray-400">
                                JSON, CSV or Excel files
                            </p>
                        </div>
                        <input id="import-file" type="file" class="hidden" accept=".json,.csv,.xlsx,.xls">
                    </label>
                </div>
                
                <div id="import-file-info" class="hidden mb-4 p-3 bg-gray-100 dark:bg-gray-700 rounded-lg">
                    <div class="flex items-center">
                        <i class="fas fa-file-alt text-primary mr-2"></i>
                        <span id="import-file-name">filename.json</span>
                        <button id="remove-import-file" class="ml-auto text-gray-500 hover:text-red-500">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                </div>
                
                <div class="text-sm text-gray-600 dark:text-gray-400 mb-4">
                    <div class="font-semibold mb-1">Supported formats:</div>
                    <ul class="list-disc pl-5 space-y-1">
                        <li>JSON: Task objects with title, description, etc.</li>
                        <li>CSV/Excel: Columns for task properties</li>
                    </ul>
                </div>
                
                <div class="flex justify-end gap-3">
                    <button class="close-modal px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm text-sm font-medium text-gray-700 dark:text-gray-300 bg-white dark:bg-gray-700 hover:bg-gray-50 dark:hover:bg-gray-600 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary">
                        Cancel
                    </button>
                    <button id="import-submit" class="px-4 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-primary hover:bg-opacity-90 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary disabled:opacity-50 disabled:cursor-not-allowed" disabled>
                        Import
                    </button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Export Modal -->
    <div id="export-modal" class="modal fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4">
        <div class="bg-white dark:bg-gray-800 rounded-lg shadow-lg max-w-md w-full">
            <div class="flex justify-between items-center border-b dark:border-gray-700 p-4">
                <h2 class="text-xl font-bold text-primary">Export Tasks</h2>
                <button class="close-modal text-gray-500 hover:text-gray-700 dark:hover:text-gray-300">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="p-6">
                <div class="mb-6">
                    <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Export Format</label>
                    <div class="grid grid-cols-1 sm:grid-cols-3 gap-3">
                        <div class="relative">
                            <input type="radio" id="export-json" name="export-format" value="json" class="absolute h-0 w-0 opacity-0" checked>
                            <label for="export-json" class="block border-2 rounded-lg p-4 text-center cursor-pointer transition-all duration-200 hover:bg-gray-50 dark:hover:bg-gray-700">
                                <i class="fas fa-file-code text-4xl text-primary"></i>
                                <p class="mt-2 font-medium">JSON</p>
                            </label>
                        </div>
                        <div class="relative">
                            <input type="radio" id="export-pdf" name="export-format" value="pdf" class="absolute h-0 w-0 opacity-0">
                            <label for="export-pdf" class="block border-2 rounded-lg p-4 text-center cursor-pointer transition-all duration-200 hover:bg-gray-50 dark:hover:bg-gray-700">
                                <i class="fas fa-file-pdf text-4xl text-red-500"></i>
                                <p class="mt-2 font-medium">PDF</p>
                            </label>
                        </div>
                        <div class="relative">
                            <input type="radio" id="export-docx" name="export-format" value="docx" class="absolute h-0 w-0 opacity-0">
                            <label for="export-docx" class="block border-2 rounded-lg p-4 text-center cursor-pointer transition-all duration-200 hover:bg-gray-50 dark:hover:bg-gray-700">
                                <i class="fas fa-file-word text-4xl text-blue-500"></i>
                                <p class="mt-2 font-medium">DOCX</p>
                            </label>
                        </div>
                    </div>
                </div>
                
                <div class="mb-6">
                    <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Select Tasks</label>
                    <div class="relative">
                        <select id="export-tasks" class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-primary focus:border-primary dark:bg-gray-700 text-base">
                            <option value="all">All Tasks</option>
                            <option value="completed">Completed Tasks Only</option>
                            <option value="pending">Pending Tasks Only</option>
                        </select>
                    </div>
                </div>
                
                <div class="flex justify-end gap-3">
                    <button class="close-modal px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm text-sm font-medium text-gray-700 dark:text-gray-300 bg-white dark:bg-gray-700 hover:bg-gray-50 dark:hover:bg-gray-600 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary">
                        Cancel
                    </button>
                    <button id="export-submit" class="px-4 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-primary hover:bg-opacity-90 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary">
                        Export
                    </button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Date Range Modal -->
    <div id="date-range-modal" class="modal fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4">
        <div class="bg-white dark:bg-gray-800 rounded-lg shadow-lg max-w-md w-full">
            <div class="flex justify-between items-center border-b dark:border-gray-700 p-4">
                <h2 class="text-xl font-bold text-primary">Custom Date Range</h2>
                <button class="close-modal text-gray-500 hover:text-gray-700 dark:hover:text-gray-300">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="p-6">
                <div class="mb-4">
                    <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Start Date</label>
                    <input id="date-range-start" type="date" class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-primary focus:border-primary dark:bg-gray-700 text-base">
                </div>
                
                <div class="mb-6">
                    <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">End Date</label>
                    <input id="date-range-end" type="date" class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-primary focus:border-primary dark:bg-gray-700 text-base">
                </div>
                
                <div class="flex justify-end gap-3">
                    <button class="close-modal px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm text-sm font-medium text-gray-700 dark:text-gray-300 bg-white dark:bg-gray-700 hover:bg-gray-50 dark:hover:bg-gray-600 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary">
                        Cancel
                    </button>
                    <button id="date-range-apply" class="px-4 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-primary hover:bg-opacity-90 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary">
                        Apply
                    </button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Share Task Modal -->
    <div id="share-task-modal" class="modal fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4">
        <div class="bg-white dark:bg-gray-800 rounded-lg shadow-lg max-w-md w-full">
            <div class="flex justify-between items-center border-b dark:border-gray-700 p-4">
                <h2 class="text-xl font-bold text-primary">Share Task</h2>
                <button class="close-modal text-gray-500 hover:text-gray-700 dark:hover:text-gray-300">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="p-6">
                <p class="text-gray-600 dark:text-gray-400 mb-4">Share this task with team members or external collaborators</p>
                
                <div class="mb-4">
                    <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Team Members</label>
                    <select id="share-users" class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-primary focus:border-primary dark:bg-gray-700 text-base" multiple>
                        <option value="user1">Alice Smith</option>
                        <option value="user2">Bob Johnson</option>
                        <option value="user3">Carol Williams</option>
                        <option value="user4">David Brown</option>
                        <option value="user5">Eve Taylor</option>
                    </select>
                    <p class="text-xs text-gray-500 mt-1">Hold Ctrl/Cmd to select multiple users</p>
                </div>
                
                <div class="mb-4">
                    <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Email</label>
                    <div class="flex">
                        <input id="share-email" type="email" class="flex-grow px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-l-md shadow-sm focus:outline-none focus:ring-primary focus:border-primary dark:bg-gray-700 text-base" placeholder="Enter email address">
                        <button id="add-share-email" class="px-3 py-2 bg-primary text-white rounded-r-md hover:bg-opacity-90 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary">
                            <i class="fas fa-plus"></i>
                        </button>
                    </div>
                </div>
                
                <div id="share-emails-container" class="mb-4 flex flex-wrap gap-2">
                    <!-- Shared email tags will be added here -->
                </div>
                
                <div class="mb-6">
                    <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Permission</label>
                    <div class="flex space-x-4">
                        <div class="flex items-center">
                            <input id="share-view" type="radio" name="share-permission" value="view" class="h-4 w-4 text-primary focus:ring-primary" checked>
                            <label for="share-view" class="ml-2 block text-sm text-gray-700 dark:text-gray-300">
                                View Only
                            </label>
                        </div>
                        <div class="flex items-center">
                            <input id="share-edit" type="radio" name="share-permission" value="edit" class="h-4 w-4 text-primary focus:ring-primary">
                            <label for="share-edit" class="ml-2 block text-sm text-gray-700 dark:text-gray-300">
                                Edit
                            </label>
                        </div>
                    </div>
                </div>
                
                <div class="flex justify-end gap-3">
                    <button class="close-modal px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm text-sm font-medium text-gray-700 dark:text-gray-300 bg-white dark:bg-gray-700 hover:bg-gray-50 dark:hover:bg-gray-600 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary">
                        Cancel
                    </button>
                    <button id="share-submit" class="px-4 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-primary hover:bg-opacity-90 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary">
                        Share
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Task details template (hidden, will be cloned) -->
    <template id="task-item-template">
        <div class="task-item p-4 hover:bg-gray-50 dark:hover:bg-gray-700 transition-all duration-300" draggable="true">
            <div class="flex items-start gap-3">
                <div class="flex-shrink-0">
                    <input type="checkbox" class="task-checkbox h-5 w-5 rounded border-gray-300 text-primary focus:ring-primary dark:border-gray-600 dark:bg-gray-700 mt-1">
                </div>
                <div class="flex-grow">
                    <div class="flex items-start justify-between">
                        <div>
                            <h3 class="task-title text-lg font-semibold mb-1">Task Title</h3>
                            <p class="task-description text-gray-600 dark:text-gray-400 mb-2">Task description goes here...</p>
                            
                            <div class="flex flex-wrap items-center gap-2 mb-2">
                                <span class="task-category bg-gray-100 dark:bg-gray-700 text-xs px-2 py-1 rounded">Category</span>
                                <span class="task-priority text-xs px-2 py-1 rounded"></span>
                                <span class="task-due-date text-xs flex items-center">
                                    <i class="fas fa-calendar-alt mr-1"></i>
                                    <span>Due Date</span>
                                </span>
                            </div>
                            
                            <div class="text-xs text-gray-500 dark:text-gray-400 mb-1 flex items-center">
                                <i class="fas fa-user-circle mr-1"></i>
                                <span class="task-assignee">Assigned to</span>
                            </div>
                            
                            <div class="task-subtasks mt-2 pl-2 border-l-2 border-gray-200 dark:border-gray-700 hidden">
                                <!-- Subtasks will be added here -->
                            </div>
                        </div>
                        <div class="flex flex-col items-end">
                            <div class="task-alerts flex flex-col items-end space-y-1 mb-2">
                                <!-- Alert badges will appear here -->
                            </div>
                        </div>
                    </div>
                    
                    <div class="flex flex-wrap items-center justify-between mt-3 pt-2 border-t dark:border-gray-700">
                        <div class="flex items-center space-x-2">
                            <button class="task-timer-btn p-1 rounded-full hover:bg-gray-100 dark:hover:bg-gray-700 text-gray-700 dark:text-gray-300" title="Start Timer">
                                <i class="fas fa-stopwatch"></i>
                            </button>
                            <span class="task-timer text-xs text-gray-600 dark:text-gray-400">00:00:00</span>
                        </div>
                        
                        <div class="flex items-center space-x-2">
                            <button class="share-task-btn p-1 rounded-full hover:bg-gray-100 dark:hover:bg-gray-700 text-gray-700 dark:text-gray-300" title="Share Task">
                                <i class="fas fa-share-alt"></i>
                            </button>
                            <button class="edit-task-btn p-1 rounded-full hover:bg-gray-100 dark:hover:bg-gray-700 text-gray-700 dark:text-gray-300" title="Edit Task">
                                <i class="fas fa-pencil-alt"></i>
                            </button>
                            <button class="delete-task-btn p-1 rounded-full hover:bg-gray-100 dark:hover:bg-gray-700 text-red-400 hover:text-red-500" title="Delete Task">
                                <i class="fas fa-trash-alt"></i>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </template>

    <!-- User Card Template -->
    <template id="user-card-template">
        <div class="user-card bg-white dark:bg-gray-800 rounded-lg shadow p-4 border dark:border-gray-700">
            <div class="flex items-center">
                <img class="user-avatar h-12 w-12 rounded-full object-cover mr-3" src="" alt="User Avatar">
                <div class="flex-grow">
                    <h3 class="user-name font-semibold">User Name</h3>
                    <p class="user-role text-sm text-gray-500 dark:text-gray-400">Role</p>
                </div>
            </div>
            <div class="mt-3 pt-3 border-t dark:border-gray-700">
                <p class="user-email text-sm flex items-center">
                    <i class="fas fa-envelope text-gray-500 mr-2"></i>
                    <span>email@example.com</span>
                </p>
                <p class="user-tasks text-sm flex items-center mt-1">
                    <i class="fas fa-tasks text-gray-500 mr-2"></i>
                    <span>5 assigned tasks</span>
                </p>
            </div>
        </div>
    </template>

    <!-- Task timer element (hidden) -->
    <div id="task-timer-container" class="fixed bottom-4 right-4 bg-white dark:bg-gray-800 rounded-lg shadow-lg p-4 z-40 hidden slide-up">
        <div class="flex items-center justify-between mb-2">
            <h3 class="font-semibold" id="timer-task-title">Task Timer</h3>
            <button id="close-timer" class="text-gray-500 hover:text-gray-700 dark:hover:text-gray-300">
                <i class="fas fa-times"></i>
            </button>
        </div>
        <div class="flex items-center justify-between">
            <div class="text-2xl font-bold" id="active-task-timer">00:00:00</div>
            <div class="flex space-x-2">
                <button id="pause-timer" class="p-2 rounded-full bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300">
                    <i class="fas fa-pause"></i>
                </button>
                <button id="stop-timer" class="p-2 rounded-full bg-red-100 dark:bg-red-900/20 text-red-500">
                    <i class="fas fa-stop"></i>
                </button>
            </div>
        </div>
    </div>

    <!-- Confirmation modal -->
    <div id="confirmation-modal" class="modal fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4">
        <div class="bg-white dark:bg-gray-800 rounded-lg shadow-lg max-w-md w-full">
            <div class="p-6">
                <h3 class="text-lg font-semibold mb-4" id="confirmation-message">Are you sure?</h3>
                <div class="flex justify-end gap-3">
                    <button id="confirm-cancel" class="px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm text-sm font-medium text-gray-700 dark:text-gray-300 bg-white dark:bg-gray-700 hover:bg-gray-50 dark:hover:bg-gray-600 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary">
                        Cancel
                    </button>
                    <button id="confirm-yes" class="px-4 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-red-500 hover:bg-red-600 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500">
                        Confirm
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- JavaScript -->
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // ====== App State ======
            const appState = {
                currentUser: null,
                users: [
                    { id: 1, name: 'John Doe', email: 'john.doe@example.com', password: 'password123', phone: '+1 (555) 123-4567', country: 'US', role: 'Manager', avatar: 'https://i.imgur.com/8Km9tLL.jpg' },
                    { id: 2, name: 'Alice Smith', email: 'alice@example.com', password: 'password123', phone: '+1 (555) 234-5678', country: 'CA', role: 'Admin', avatar: 'https://i.imgur.com/3tVgsra.jpg' },
                    { id: 3, name: 'Bob Johnson', email: 'bob@example.com', password: 'password123', phone: '+1 (555) 345-6789', country: 'UK', role: 'Staff', avatar: 'https://i.imgur.com/iNKlGdX.jpg' },
                    { id: 4, name: 'Carol Williams', email: 'carol@example.com', password: 'password123', phone: '+1 (555) 456-7890', country: 'AU', role: 'Staff', avatar: 'https://i.imgur.com/Q9HLmAo.jpg' },
                    { id: 5, name: 'David Brown', email: 'david@example.com', password: 'password123', phone: '+1 (555) 567-8901', country: 'DE', role: 'Customer', avatar: 'https://i.imgur.com/LFQPmcB.jpg' },
                    { id: 6, name: 'Eve Taylor', email: 'eve@example.com', password: 'password123', phone: '+1 (555) 678-9012', country: 'FR', role: 'Customer', avatar: 'https://i.imgur.com/BxQJPYU.jpg' },
                ],
                tasks: [
                    { id: 1, title: 'Website Redesign', description: 'Update the company website with new branding and improved UI/UX', category: 'Design', priority: 'High', dueDate: '2023-07-15', completed: false, assignedTo: 1, subtasks: ['Create wireframes', 'Design new logo', 'Implement responsive layout'], notes: 'Focus on mobile-first approach', created: '2023-06-30', timer: 0 },
                    { id: 2, title: 'Database Migration', description: 'Migrate the current database to the new cloud-based solution', category: 'Development', priority: 'High', dueDate: '2023-07-10', completed: false, assignedTo: 2, subtasks: ['Create backup', 'Test migration script', 'Verify data integrity'], notes: 'Schedule downtime with operations team', created: '2023-06-28', timer: 0 },
                    { id: 3, title: 'Content Creation', description: 'Create new content for the blog section of the website', category: 'Marketing', priority: 'Medium', dueDate: '2023-07-22', completed: false, assignedTo: 4, subtasks: ['Research topics', 'Draft 3 articles', 'Create images'], notes: 'Focus on SEO optimization', created: '2023-07-01', timer: 0 },
                    { id: 4, title: 'User Testing', description: 'Conduct user testing sessions for the new application features', category: 'Research', priority: 'Medium', dueDate: '2023-07-28', completed: false, assignedTo: 3, subtasks: ['Recruit participants', 'Prepare test scenarios', 'Compile results'], notes: 'Target 10-15 participants', created: '2023-07-02', timer: 0 },
                    { id: 5, title: 'Security Audit', description: 'Perform a comprehensive security audit of all systems', category: 'Development', priority: 'High', dueDate: '2023-07-08', completed: false, assignedTo: 1, subtasks: ['Review access controls', 'Test for vulnerabilities', 'Document findings'], notes: 'Focus on API endpoints', created: '2023-06-25', timer: 0 },
                    { id: 6, title: 'Marketing Campaign', description: 'Plan and execute Q3 marketing campaign', category: 'Marketing', priority: 'Medium', dueDate: '2023-07-30', completed: true, assignedTo: 4, subtasks: ['Define target audience', 'Create social media plan', 'Prepare email templates'], notes: 'Budget: $5,000', created: '2023-06-20', timer: 3600 },
                    { id: 7, title: 'Bug Fixes', description: 'Address critical bugs reported in the latest release', category: 'Development', priority: 'High', dueDate: '2023-07-05', completed: true, assignedTo: 3, subtasks: ['Reproduce issues', 'Implement fixes', 'Write tests'], notes: 'Focus on high-priority issues first', created: '2023-07-01', timer: 7200 },
                    { id: 8, title: 'Client Presentation', description: 'Prepare and deliver presentation for potential client', category: 'Marketing', priority: 'Medium', dueDate: '2023-07-18', completed: false, assignedTo: 2, subtasks: ['Create slides', 'Prepare demo', 'Practice presentation'], notes: 'Focus on new features and benefits', created: '2023-07-01', timer: 0 },
                    { id: 9, title: 'Optimize Performance', description: 'Identify and fix performance bottlenecks in the application', category: 'Development', priority: 'Low', dueDate: '2023-08-05', completed: false, assignedTo: 1, subtasks: ['Profile application', 'Optimize database queries', 'Reduce load times'], notes: 'Target 30% improvement', created: '2023-07-02', timer: 0 },
                    { id: 10, title: 'Annual Report', description: 'Compile data and create annual report for stakeholders', category: 'Research', priority: 'Medium', dueDate: '2023-08-15', completed: false, assignedTo: 4, subtasks: ['Gather financial data', 'Write executive summary', 'Design charts and graphics'], notes: 'Include growth projections', created: '2023-06-28', timer: 0 },
                    { id: 11, title: 'Code Review', description: 'Perform code review for the new feature branches', category: 'Development', priority: 'Low', dueDate: '2023-07-25', completed: true, assignedTo: 3, subtasks: ['Review PRs', 'Provide feedback', 'Approve changes'], notes: 'Focus on code quality and standards', created: '2023-07-01', timer: 1800 },
                    { id: 12, title: 'Vendor Selection', description: 'Evaluate and select new vendors for office supplies', category: 'Research', priority: 'Low', dueDate: '2023-08-10', completed: true, assignedTo: 2, subtasks: ['Research options', 'Request quotes', 'Compare offers'], notes: 'Budget: $2,000/month', created: '2023-06-15', timer: 5400 }
                ],
                notifications: [
                    { id: 1, title: 'Task Deadline Approaching', message: 'Task "Website Redesign" is due in 2 days', read: false },
                    { id: 2, title: 'New Task Assigned', message: 'You have been assigned to "Database Migration"', read: false },
                    { id: 3, title: 'Task Completed', message: '"Prototype Testing" was marked as complete', read: false }
                ],
                status: 'online', // online, break, shadow, offline
                filters: {
                    search: '',
                    category: '',
                    priority: '',
                    status: '',
                    dateRange: { start: null, end: null }
                },
                sort: {
                    by: 'dueDate',
                    direction: 'asc'
                },
                view: 'list', // list or graph
                selectedTasks: [],
                activeTimer: {
                    taskId: null,
                    startTime: null,
                    elapsed: 0,
                    interval: null
                },
                workTimer: {
                    startTime: null,
                    elapsed: 0,
                    interval: null
                },
                darkMode: false,
                history: {
                    actions: [],
                    position: -1
                }
            };
            
            // ====== DOM Elements ======
            const elements = {
                // Auth section
                authSection: document.getElementById('auth-section'),
                loginForm: document.getElementById('login-form'),
                registerForm: document.getElementById('register-form'),
                loginBtn: document.getElementById('login-btn'),
                registerBtn: document.getElementById('register-btn'),
                showLoginBtn: document.getElementById('show-login'),
                showRegisterBtn: document.getElementById('show-register'),
                loginError: document.getElementById('login-error'),
                registerError: document.getElementById('register-error'),
                
                // Dashboard section
                dashboardSection: document.getElementById('dashboard-section'),
                profileImage: document.getElementById('profile-image'),
                profileBtn: document.getElementById('profile-btn'),
                profileDropdown: document.getElementById('profile-dropdown'),
                logoutBtn: document.getElementById('logout-btn'),
                darkModeToggle: document.getElementById('dark-mode-toggle'),
                
                // Status elements
                statusBtn: document.getElementById('status-btn'),
                statusOptions: document.getElementById('status-options'),
                currentStatus: document.getElementById('current-status'),
                timeCounter: document.getElementById('time-counter'),
                timeDisplay: document.getElementById('time-display'),
                
                // Task stats
                totalTasksCount: document.getElementById('total-tasks-count'),
                completedTasksCount: document.getElementById('completed-tasks-count'),
                pendingTasksCount: document.getElementById('pending-tasks-count'),
                
                // Task filters and controls
                addTaskBtn: document.getElementById('add-task-btn'),
                importBtn: document.getElementById('import-btn'),
                exportBtn: document.getElementById('export-btn'),
                usersBtn: document.getElementById('users-btn'),
                
                searchInput: document.getElementById('search-input'),
                categoryFilter: document.getElementById('category-filter'),
                priorityFilter: document.getElementById('priority-filter'),
                statusFilter: document.getElementById('status-filter'),
                dateFilter: document.getElementById('date-filter'),
                
                undoBtn: document.getElementById('undo-btn'),
                redoBtn: document.getElementById('redo-btn'),
                
                // Sort controls
                sortSelect: document.getElementById('sort-select'),
                sortDirection: document.getElementById('sort-direction'),
                
                // Task views
                listViewBtn: document.getElementById('list-view-btn'),
                graphViewBtn: document.getElementById('graph-view-btn'),
                listView: document.getElementById('list-view'),
                graphView: document.getElementById('graph-view'),
                
                // Task container
                tasksContainer: document.getElementById('tasks-container'),
                
                // Selection actions
                taskSelectionActions: document.getElementById('task-selection-actions'),
                selectedCount: document.getElementById('selected-count'),
                markCompleteSelected: document.getElementById('mark-complete-selected'),
                deleteSelected: document.getElementById('delete-selected'),
                cancelSelection: document.getElementById('cancel-selection'),
                
                // Notification elements
                notificationBtn: document.getElementById('notification-btn'),
                notificationCount: document.getElementById('notification-count'),
                notificationDropdown: document.getElementById('notification-dropdown'),
                
                // Timer elements
                taskTimerContainer: document.getElementById('task-timer-container'),
                timerTaskTitle: document.getElementById('timer-task-title'),
                activeTaskTimer: document.getElementById('active-task-timer'),
                pauseTimer: document.getElementById('pause-timer'),
                stopTimer: document.getElementById('stop-timer'),
                closeTimer: document.getElementById('close-timer'),
                
                // User elements
                usersContainer: document.getElementById('users-container'),
                userSearch: document.getElementById('user-search'),
                
                // Charts
                statusChart: document.getElementById('status-chart'),
                priorityChart: document.getElementById('priority-chart'),
                timelineChart: document.getElementById('timeline-chart'),
                categoryChart: document.getElementById('category-chart'),
                
                // Insight elements
                productivityScore: document.getElementById('productivity-score'),
                
                // Modals
                profileModal: document.getElementById('profile-modal'),
                addTaskModal: document.getElementById('add-task-modal'),
                usersModal: document.getElementById('users-modal'),
                importModal: document.getElementById('import-modal'),
                exportModal: document.getElementById('export-modal'),
                dateRangeModal: document.getElementById('date-range-modal'),
                shareTaskModal: document.getElementById('share-task-modal'),
                confirmationModal: document.getElementById('confirmation-modal'),
                
                // Templates
                taskItemTemplate: document.getElementById('task-item-template'),
                userCardTemplate: document.getElementById('user-card-template')
            };
            
            // ====== Authentication ======
            
            // Show login form
            elements.showLoginBtn.addEventListener('click', function(e) {
                e.preventDefault();
                elements.registerForm.classList.add('hidden');
                elements.loginForm.classList.remove('hidden');
            });
            
            // Show register form
            elements.showRegisterBtn.addEventListener('click', function(e) {
                e.preventDefault();
                elements.loginForm.classList.add('hidden');
                elements.registerForm.classList.remove('hidden');
            });
            
            // Login handler
            elements.loginBtn.addEventListener('click', function() {
                const email = document.getElementById('email').value;
                const password = document.getElementById('password').value;
                
                if (!email || !password) {
                    elements.loginError.textContent = 'Please enter email and password';
                    elements.loginError.classList.remove('hidden');
                    return;
                }
                
                const user = appState.users.find(u => u.email === email && u.password === password);
                if (user) {
                    // Login successful
                    appState.currentUser = user;
                    
                    // Save session to sessionStorage
                    try {
                        // In iframe environment, this might not work
                        sessionStorage.setItem('currentUser', JSON.stringify(user));
                    } catch (e) {
                        console.log('Session storage not available');
                    }
                    
                    // Navigate to dashboard
                    showDashboard();
                } else {
                    elements.loginError.textContent = 'Invalid email or password';
                    elements.loginError.classList.remove('hidden');
                }
            });
            
            // Register handler
            elements.registerBtn.addEventListener('click', function() {
                const name = document.getElementById('reg-name').value;
                const email = document.getElementById('reg-email').value;
                const emailConfirm = document.getElementById('reg-email-confirm').value;
                const password = document.getElementById('reg-password').value;
                const passwordConfirm = document.getElementById('reg-password-confirm').value;
                const phone = document.getElementById('reg-phone').value;
                const country = document.getElementById('reg-country').value;
                const role = document.getElementById('reg-role').value;
                
                // Validate inputs
                if (!name || !email || !emailConfirm || !password || !passwordConfirm || !phone || !country || !role) {
                    elements.registerError.textContent = 'Please fill in all fields';
                    elements.registerError.classList.remove('hidden');
                    return;
                }
                
                if (email !== emailConfirm) {
                    elements.registerError.textContent = 'Emails do not match';
                    elements.registerError.classList.remove('hidden');
                    return;
                }
                
                if (password !== passwordConfirm) {
                    elements.registerError.textContent = 'Passwords do not match';
                    elements.registerError.classList.remove('hidden');
                    return;
                }
                
                // Check if email already exists
                if (appState.users.some(u => u.email === email)) {
                    elements.registerError.textContent = 'Email already registered';
                    elements.registerError.classList.remove('hidden');
                    return;
                }
                
                // Create new user
                const newUser = {
                    id: appState.users.length + 1,
                    name,
                    email,
                    password,
                    phone,
                    country,
                    role,
                    avatar: 'https://i.imgur.com/ShelJwI.jpg' // Default avatar
                };
                
                // Add to users array
                appState.users.push(newUser);
                
                // Set as current user
                appState.currentUser = newUser;
                
                // Try to save to sessionStorage
                try {
                    sessionStorage.setItem('currentUser', JSON.stringify(newUser));
                } catch (e) {
                    console.log('Session storage not available');
                }
                
                // Navigate to dashboard
                showDashboard();
            });
            
            // Logout handler
            elements.logoutBtn.addEventListener('click', function() {
                // Clear user data
                appState.currentUser = null;
                
                // Try to clear sessionStorage
                try {
                    sessionStorage.removeItem('currentUser');
                } catch (e) {
                    console.log('Session storage not available');
                }
                
                // Reset work timer
                if (appState.workTimer.interval) {
                    clearInterval(appState.workTimer.interval);
                    appState.workTimer.interval = null;
                    appState.workTimer.elapsed = 0;
                }
                
                // Update status
                updateUserStatus('offline');
                
                // Navigate to login
                showLogin();
            });
            
            // ====== Dashboard Functions ======
            
            // Show dashboard
            function showDashboard() {
                elements.authSection.classList.add('hidden');
                elements.dashboardSection.classList.remove('hidden');
                
                // Update UI with user data
                updateUserUI();
                
                // Start work timer
                startWorkTimer();
                
                // Load tasks
                renderTasks();
                
                // Initialize charts
                initCharts();
                
                // Update task stats
                updateTaskStats();
                
                // Check for stored tasks
                try {
                    const storedTasks = sessionStorage.getItem('tasks');
                    if (storedTasks) {
                        appState.tasks = JSON.parse(storedTasks);
                        renderTasks();
                    }
                } catch (e) {
                    console.log('Session storage not available');
                }
            }
            
            // Show login
            function showLogin() {
                elements.dashboardSection.classList.add('hidden');
                elements.authSection.classList.remove('hidden');
                elements.registerForm.classList.add('hidden');
                elements.loginForm.classList.remove('hidden');
            }
            
            // Update UI with user data
            function updateUserUI() {
                const user = appState.currentUser;
                if (!user) return;
                
                // Update profile image and dropdown details
                elements.profileImage.src = user.avatar;
                document.querySelector('.user-name').textContent = user.name;
                document.querySelector('.user-role').textContent = user.role;
                
                // Update profile modal
                document.getElementById('profile-name').textContent = user.name;
                document.getElementById('profile-role').textContent = user.role;
                document.getElementById('profile-pic').src = user.avatar;
                document.getElementById('profile-edit-name').value = user.name;
                document.getElementById('profile-edit-email').value = user.email;
                document.getElementById('profile-edit-phone').value = user.phone;
                document.getElementById('profile-edit-country').value = user.country;
                document.getElementById('profile-edit-role').value = user.role;
            }
            
            // ====== Status Management ======
            
            // Status button click handler
            elements.statusBtn.addEventListener('click', function() {
                elements.statusOptions.classList.toggle('hidden');
            });
            
            // Status options
            document.querySelectorAll('#status-options button').forEach(button => {
                button.addEventListener('click', function() {
                    const status = this.getAttribute('data-status');
                    updateUserStatus(status);
                    elements.statusOptions.classList.add('hidden');
                });
            });
            
            // Update user status
            function updateUserStatus(status) {
                appState.status = status;
                
                // Update status indicator
                elements.currentStatus.textContent = status.charAt(0).toUpperCase() + status.slice(1);
                elements.profileImage.className = 'h-10 w-10 rounded-full object-cover status-indicator';
                elements.profileImage.classList.add(`status-${status}`);
                
                // Update time counter
                elements.timeCounter.className = 'hidden md:flex items-center px-3 py-1 rounded-full border-2 text-sm';
                elements.timeCounter.classList.add(`border-${getStatusColor(status)}-500`);
                
                // Handle work timer based on status
                if (status === 'online') {
                    startWorkTimer();
                    elements.timeCounter.classList.remove('hidden');
                } else if (status === 'break') {
                    pauseWorkTimer();
                    elements.timeCounter.classList.remove('hidden');
                } else if (status === 'shadow') {
                    pauseWorkTimer();
                    elements.timeCounter.classList.remove('hidden');
                } else {
                    stopWorkTimer();
                    elements.timeCounter.classList.add('hidden');
                }
            }
            
            function getStatusColor(status) {
                switch(status) {
                    case 'online': return 'green';
                    case 'break': return 'yellow';
                    case 'shadow': return 'gray';
                    case 'offline': return 'red';
                    default: return 'gray';
                }
            }
            
            // ====== Work Timer Functions ======
            
            // Start work timer
            function startWorkTimer() {
                // Clear any existing interval
                if (appState.workTimer.interval) {
                    clearInterval(appState.workTimer.interval);
                }
                
                // If we don't have a start time, set it now
                if (!appState.workTimer.startTime) {
                    appState.workTimer.startTime = new Date();
                }
                
                // Start the timer
                appState.workTimer.interval = setInterval(updateWorkTimer, 1000);
            }
            
            // Pause work timer
            function pauseWorkTimer() {
                if (appState.workTimer.interval) {
                    clearInterval(appState.workTimer.interval);
                    appState.workTimer.interval = null;
                }
            }
            
            // Stop work timer
            function stopWorkTimer() {
                if (appState.workTimer.interval) {
                    clearInterval(appState.workTimer.interval);
                    appState.workTimer.interval = null;
                    appState.workTimer.elapsed = 0;
                    appState.workTimer.startTime = null;
                }
                updateWorkTimerDisplay();
            }
            
            // Reset work timer at midnight
            function checkMidnightReset() {
                const now = new Date();
                if (now.getHours() === 0 && now.getMinutes() === 0 && now.getSeconds() === 0) {
                    appState.workTimer.elapsed = 0;
                    appState.workTimer.startTime = new Date();
                }
            }
            
            // Update work timer
            function updateWorkTimer() {
                checkMidnightReset();
                const now = new Date();
                const elapsed = now - appState.workTimer.startTime + appState.workTimer.elapsed;
                appState.workTimer.elapsed = elapsed;
                updateWorkTimerDisplay();
            }
            
            // Update work timer display
            function updateWorkTimerDisplay() {
                const hours = Math.floor(appState.workTimer.elapsed / 3600000);
                const minutes = Math.floor((appState.workTimer.elapsed % 3600000) / 60000);
                const seconds = Math.floor((appState.workTimer.elapsed % 60000) / 1000);
                
                elements.timeDisplay.textContent = `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
            }
            
            // ====== Task Management ======
            
            // Render tasks
            function renderTasks() {
                // Clear container
                elements.tasksContainer.innerHTML = '';
                
                // Filter tasks
                const filteredTasks = filterTasks();
                
                // Sort tasks
                const sortedTasks = sortTasks(filteredTasks);
                
                // Render each task
                sortedTasks.forEach(task => {
                    const taskElement = createTaskElement(task);
                    elements.tasksContainer.appendChild(taskElement);
                });
                
                // Update task stats
                updateTaskStats();
            }
            
            // Create task element
            function createTaskElement(task) {
                const taskElement = elements.taskItemTemplate.content.cloneNode(true).children[0];
                
                // Set task ID
                taskElement.setAttribute('data-task-id', task.id);
                
                // Set checkbox state
                const checkbox = taskElement.querySelector('.task-checkbox');
                checkbox.checked = task.completed;
                
                // Set title and description
                taskElement.querySelector('.task-title').textContent = task.title;
                taskElement.querySelector('.task-description').textContent = task.description;
                
                // Set category
                taskElement.querySelector('.task-category').textContent = task.category;
                
                // Set priority with color
                const priorityElement = taskElement.querySelector('.task-priority');
                priorityElement.textContent = task.priority;
                if (task.priority === 'High') {
                    priorityElement.classList.add('bg-red-100', 'text-red-800', 'dark:bg-red-900/20', 'dark:text-red-400');
                } else if (task.priority === 'Medium') {
                    priorityElement.classList.add('bg-yellow-100', 'text-yellow-800', 'dark:bg-yellow-900/20', 'dark:text-yellow-400');
                } else {
                    priorityElement.classList.add('bg-gray-100', 'text-gray-800', 'dark:bg-gray-700', 'dark:text-gray-400');
                }
                
                // Set due date
                const dueDate = new Date(task.dueDate);
                const dueDateElement = taskElement.querySelector('.task-due-date span');
                dueDateElement.textContent = dueDate.toLocaleDateString();
                
                // Add due date alert
                const alertsContainer = taskElement.querySelector('.task-alerts');
                const now = new Date();
                const timeDiff = dueDate - now;
                const daysDiff = timeDiff / (1000 * 3600 * 24);
                
                let alertColor;
                if (daysDiff < 0) {
                    // Overdue
                    alertColor = 'red';
                } else if (daysDiff < 2) {
                    // Due soon
                    alertColor = 'yellow';
                } else {
                    // Due later
                    alertColor = 'green';
                }
                
                const alertElement = document.createElement('div');
                alertElement.className = `bg-${alertColor}-100 dark:bg-${alertColor}-900/20 text-${alertColor}-800 dark:text-${alertColor}-400 text-xs px-2 py-1 rounded`;
                if (daysDiff < 0) {
                    alertElement.textContent = `Overdue by ${Math.abs(Math.floor(daysDiff))} days`;
                } else if (daysDiff < 1) {
                    alertElement.textContent = 'Due today';
                } else {
                    alertElement.textContent = `Due in ${Math.floor(daysDiff)} days`;
                }
                alertsContainer.appendChild(alertElement);
                
                // Set assignee
                const assignee = appState.users.find(u => u.id === task.assignedTo);
                if (assignee) {
                    taskElement.querySelector('.task-assignee').textContent = assignee.name;
                }
                
                // Setup subtasks if any
                if (task.subtasks && task.subtasks.length > 0) {
                    const subtasksContainer = taskElement.querySelector('.task-subtasks');
                    subtasksContainer.classList.remove('hidden');
                    
                    task.subtasks.forEach(subtask => {
                        const subtaskElement = document.createElement('div');
                        subtaskElement.className = 'flex items-center text-sm text-gray-600 dark:text-gray-400 mb-1';
                        subtaskElement.innerHTML = `
                            <i class="fas fa-circle text-xs mr-2"></i>
                            <span>${subtask}</span>
                        `;
                        subtasksContainer.appendChild(subtaskElement);
                    });
                }
                
                // Set timer display
                const timerDisplay = taskElement.querySelector('.task-timer');
                timerDisplay.textContent = formatTime(task.timer);
                
                // If task is completed, add completed class
                if (task.completed) {
                    taskElement.classList.add('completed');
                }
                
                // Add event listeners
                
                // Checkbox change
                checkbox.addEventListener('change', function(e) {
                    e.stopPropagation();
                    const taskId = parseInt(taskElement.getAttribute('data-task-id'));
                    toggleTaskCompletion(taskId);
                });
                
                // Timer button
                taskElement.querySelector('.task-timer-btn').addEventListener('click', function(e) {
                    e.stopPropagation();
                    const taskId = parseInt(taskElement.getAttribute('data-task-id'));
                    toggleTaskTimer(taskId);
                });
                
                // Share button
                taskElement.querySelector('.share-task-btn').addEventListener('click', function(e) {
                    e.stopPropagation();
                    const taskId = parseInt(taskElement.getAttribute('data-task-id'));
                    showShareTaskModal(taskId);
                });
                
                // Edit button
                taskElement.querySelector('.edit-task-btn').addEventListener('click', function(e) {
                    e.stopPropagation();
                    const taskId = parseInt(taskElement.getAttribute('data-task-id'));
                    showEditTaskModal(taskId);
                });
                
                // Delete button
                taskElement.querySelector('.delete-task-btn').addEventListener('click', function(e) {
                    e.stopPropagation();
                    const taskId = parseInt(taskElement.getAttribute('data-task-id'));
                    showDeleteConfirmation(taskId);
                });
                
                // Task selection (for multi-select)
                taskElement.addEventListener('click', function(e) {
                    if (e.target.matches('input, button, i') || e.target.closest('button')) {
                        return;
                    }
                    
                    const taskId = parseInt(this.getAttribute('data-task-id'));
                    toggleTaskSelection(taskId);
                });
                
                // Drag and drop
                taskElement.addEventListener('dragstart', handleDragStart);
                taskElement.addEventListener('dragend', handleDragEnd);
                taskElement.addEventListener('dragover', handleDragOver);
                taskElement.addEventListener('dragleave', handleDragLeave);
                taskElement.addEventListener('drop', handleDrop);
                
                return taskElement;
            }
            
            // Filter tasks based on current filters
            function filterTasks() {
                return appState.tasks.filter(task => {
                    // Search filter
                    if (appState.filters.search && !task.title.toLowerCase().includes(appState.filters.search.toLowerCase()) && 
                        !task.description.toLowerCase().includes(appState.filters.search.toLowerCase())) {
                        return false;
                    }
                    
                    // Category filter
                    if (appState.filters.category && task.category !== appState.filters.category) {
                        return false;
                    }
                    
                    // Priority filter
                    if (appState.filters.priority && task.priority !== appState.filters.priority) {
                        return false;
                    }
                    
                    // Status filter
                    if (appState.filters.status) {
                        if (appState.filters.status === 'Completed' && !task.completed) return false;
                        if (appState.filters.status === 'Active' && task.completed) return false;
                    }
                    
                    // Date filter
                    if (appState.filters.dateRange.start && appState.filters.dateRange.end) {
                        const taskDate = new Date(task.dueDate);
                        const startDate = new Date(appState.filters.dateRange.start);
                        const endDate = new Date(appState.filters.dateRange.end);
                        
                        startDate.setHours(0, 0, 0, 0);
                        endDate.setHours(23, 59, 59, 999);
                        
                        if (taskDate < startDate || taskDate > endDate) {
                            return false;
                        }
                    } else if (appState.filters.dateFilter) {
                        const now = new Date();
                        const taskDate = new Date(task.dueDate);
                        
                        if (appState.filters.dateFilter === 'today') {
                            if (taskDate.toDateString() !== now.toDateString()) {
                                return false;
                            }
                        } else if (appState.filters.dateFilter === 'week') {
                            const weekAhead = new Date(now);
                            weekAhead.setDate(now.getDate() + 7);
                            if (taskDate < now || taskDate > weekAhead) {
                                return false;
                            }
                        } else if (appState.filters.dateFilter === 'month') {
                            const monthAhead = new Date(now);
                            monthAhead.setMonth(now.getMonth() + 1);
                            if (taskDate < now || taskDate > monthAhead) {
                                return false;
                            }
                        }
                    }
                    
                    return true;
                });
            }
            
            // Sort tasks
            function sortTasks(tasks) {
                return [...tasks].sort((a, b) => {
                    let result;
                    
                    switch (appState.sort.by) {
                        case 'dueDate':
                            result = new Date(a.dueDate) - new Date(b.dueDate);
                            break;
                        case 'priority':
                            const priorityOrder = { 'High': 0, 'Medium': 1, 'Low': 2 };
                            result = priorityOrder[a.priority] - priorityOrder[b.priority];
                            break;
                        case 'title':
                            result = a.title.localeCompare(b.title);
                            break;
                        case 'created':
                            result = new Date(a.created) - new Date(b.created);
                            break;
                        default:
                            result = 0;
                    }
                    
                    return appState.sort.direction === 'asc' ? result : -result;
                });
            }
            
            // Toggle task completion
            function toggleTaskCompletion(taskId) {
                const task = appState.tasks.find(t => t.id === taskId);
                if (task) {
                    // Add to history for undo/redo
                    addToHistory({
                        type: 'toggleCompletion',
                        taskId,
                        previousState: task.completed
                    });
                    
                    task.completed = !task.completed;
                    saveTasksState();
                    renderTasks();
                    updateTaskStats();
                    updateCharts();
                    
                    // Show notification
                    if (task.completed) {
                        showNotification('Task Completed', `"${task.title}" marked as complete`);
                    }
                }
            }
            
            // Toggle task timer
            function toggleTaskTimer(taskId) {
                const task = appState.tasks.find(t => t.id === taskId);
                if (!task) return;
                
                // If there's already an active timer for another task, stop it
                if (appState.activeTimer.taskId && appState.activeTimer.taskId !== taskId) {
                    stopTaskTimer();
                }
                
                // If this task already has an active timer, stop it
                if (appState.activeTimer.taskId === taskId) {
                    stopTaskTimer();
                    return;
                }
                
                // Start timer for this task
                appState.activeTimer.taskId = taskId;
                appState.activeTimer.startTime = new Date();
                appState.activeTimer.elapsed = task.timer;
                
                // Start the interval
                appState.activeTimer.interval = setInterval(() => {
                    updateTaskTimer();
                }, 1000);
                
                // Show timer container
                elements.timerTaskTitle.textContent = task.title;
                elements.taskTimerContainer.classList.remove('hidden');
                updateTaskTimer();
            }
            
            // Update task timer
            function updateTaskTimer() {
                if (!appState.activeTimer.taskId) return;
                
                const elapsed = appState.activeTimer.elapsed + (new Date() - appState.activeTimer.startTime);
                
                // Update the display in the timer container
                elements.activeTaskTimer.textContent = formatTime(elapsed);
                
                // Update the display in the task item
                const taskElement = document.querySelector(`[data-task-id="${appState.activeTimer.taskId}"]`);
                if (taskElement) {
                    taskElement.querySelector('.task-timer').textContent = formatTime(elapsed);
                }
            }
            
            // Pause task timer
            function pauseTaskTimer() {
                if (!appState.activeTimer.taskId) return;
                
                const task = appState.tasks.find(t => t.id === appState.activeTimer.taskId);
                if (!task) return;
                
                // Calculate elapsed time
                const elapsed = appState.activeTimer.elapsed + (new Date() - appState.activeTimer.startTime);
                
                // Update task timer value
                task.timer = elapsed;
                
                // Clear interval
                clearInterval(appState.activeTimer.interval);
                
                // Update state
                appState.activeTimer.interval = null;
                appState.activeTimer.elapsed = elapsed;
                
                // Update UI
                elements.pauseTimer.innerHTML = '<i class="fas fa-play"></i>';
                elements.pauseTimer.setAttribute('data-action', 'resume');
                
                saveTasksState();
            }
            
            // Resume task timer
            function resumeTaskTimer() {
                if (!appState.activeTimer.taskId) return;
                
                // Reset start time
                appState.activeTimer.startTime = new Date();
                
                // Start interval
                appState.activeTimer.interval = setInterval(() => {
                    updateTaskTimer();
                }, 1000);
                
                // Update UI
                elements.pauseTimer.innerHTML = '<i class="fas fa-pause"></i>';
                elements.pauseTimer.setAttribute('data-action', 'pause');
            }
            
            // Stop task timer
            function stopTaskTimer() {
                if (!appState.activeTimer.taskId) return;
                
                const task = appState.tasks.find(t => t.id === appState.activeTimer.taskId);
                if (!task) return;
                
                // Only update the task timer if the interval is running
                if (appState.activeTimer.interval) {
                    // Calculate elapsed time
                    const elapsed = appState.activeTimer.elapsed + (new Date() - appState.activeTimer.startTime);
                    
                    // Update task timer value
                    task.timer = elapsed;
                    
                    // Clear interval
                    clearInterval(appState.activeTimer.interval);
                }
                
                // Reset state
                appState.activeTimer.taskId = null;
                appState.activeTimer.startTime = null;
                appState.activeTimer.elapsed = 0;
                appState.activeTimer.interval = null;
                
                // Hide timer container
                elements.taskTimerContainer.classList.add('hidden');
                
                // Reset UI
                elements.pauseTimer.innerHTML = '<i class="fas fa-pause"></i>';
                elements.pauseTimer.setAttribute('data-action', 'pause');
                
                saveTasksState();
                renderTasks();
            }
            
            // Timer container events
            elements.pauseTimer.addEventListener('click', function() {
                const action = this.getAttribute('data-action') || 'pause';
                if (action === 'pause') {
                    pauseTaskTimer();
                } else {
                    resumeTaskTimer();
                }
            });
            
            elements.stopTimer.addEventListener('click', stopTaskTimer);
            elements.closeTimer.addEventListener('click', stopTaskTimer);
            
            // Format time for display (milliseconds to HH:MM:SS)
            function formatTime(ms) {
                const seconds = Math.floor((ms / 1000) % 60);
                const minutes = Math.floor((ms / (1000 * 60)) % 60);
                const hours = Math.floor(ms / (1000 * 60 * 60));
                
                return `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
            }
            
            // Toggle task selection
            function toggleTaskSelection(taskId) {
                const index = appState.selectedTasks.indexOf(taskId);
                if (index > -1) {
                    // Deselect
                    appState.selectedTasks.splice(index, 1);
                } else {
                    // Select
                    appState.selectedTasks.push(taskId);
                }
                
                // Update UI
                updateSelectionUI();
            }
            
            // Update selection UI
            function updateSelectionUI() {
                // Update selected count
                elements.selectedCount.textContent = appState.selectedTasks.length;
                
                // Show/hide selection actions
                if (appState.selectedTasks.length > 0) {
                    elements.taskSelectionActions.classList.remove('hidden');
                } else {
                    elements.taskSelectionActions.classList.add('hidden');
                }
                
                // Highlight selected tasks
                document.querySelectorAll('.task-item').forEach(item => {
                    const taskId = parseInt(item.getAttribute('data-task-id'));
                    if (appState.selectedTasks.includes(taskId)) {
                        item.classList.add('bg-blue-50', 'dark:bg-blue-900/10', 'border', 'border-blue-200', 'dark:border-blue-800');
                    } else {
                        item.classList.remove('bg-blue-50', 'dark:bg-blue-900/10', 'border', 'border-blue-200', 'dark:border-blue-800');
                    }
                });
            }
            
            // Mark selected tasks as complete
            elements.markCompleteSelected.addEventListener('click', function() {
                if (appState.selectedTasks.length === 0) return;
                
                // Add to history
                const previousState = {};
                appState.selectedTasks.forEach(taskId => {
                    const task = appState.tasks.find(t => t.id === taskId);
                    if (task) {
                        previousState[taskId] = task.completed;
                    }
                });
                
                addToHistory({
                    type: 'bulkToggleCompletion',
                    taskIds: [...appState.selectedTasks],
                    previousState
                });
                
                // Mark all selected tasks as complete
                appState.selectedTasks.forEach(taskId => {
                    const task = appState.tasks.find(t => t.id === taskId);
                    if (task) {
                        task.completed = true;
                    }
                });
                
                // Clear selection
                appState.selectedTasks = [];
                
                // Update UI
                saveTasksState();
                renderTasks();
                updateTaskStats();
                updateCharts();
                elements.taskSelectionActions.classList.add('hidden');
            });
            
            // Delete selected tasks
            elements.deleteSelected.addEventListener('click', function() {
                if (appState.selectedTasks.length === 0) return;
                
                // Show confirmation dialog
                showDeleteMultipleConfirmation();
            });
            
            // Cancel selection
            elements.cancelSelection.addEventListener('click', function() {
                appState.selectedTasks = [];
                updateSelectionUI();
            });
            
            // Show delete confirmation
            function showDeleteConfirmation(taskId) {
                const task = appState.tasks.find(t => t.id === taskId);
                if (!task) return;
                
                // Set confirmation message
                document.getElementById('confirmation-message').textContent = `Are you sure you want to delete "${task.title}"?`;
                
                // Show modal
                openModal(elements.confirmationModal);
                
                // Set confirm action
                document.getElementById('confirm-yes').onclick = function() {
                    // Add to history
                    addToHistory({
                        type: 'deleteTask',
                        task: {...task}
                    });
                    
                    // Remove task
                    appState.tasks = appState.tasks.filter(t => t.id !== taskId);
                    
                    // Update UI
                    saveTasksState();
                    renderTasks();
                    updateTaskStats();
                    updateCharts();
                    
                    // Close modal
                    closeModal(elements.confirmationModal);
                };
                
                // Set cancel action
                document.getElementById('confirm-cancel').onclick = function() {
                    closeModal(elements.confirmationModal);
                };
            }
            
            // Show delete multiple confirmation
            function showDeleteMultipleConfirmation() {
                // Set confirmation message
                document.getElementById('confirmation-message').textContent = `Are you sure you want to delete ${appState.selectedTasks.length} selected tasks?`;
                
                // Show modal
                openModal(elements.confirmationModal);
                
                // Set confirm action
                document.getElementById('confirm-yes').onclick = function() {
                    // Add to history
                    const deletedTasks = appState.tasks.filter(t => appState.selectedTasks.includes(t.id));
                    
                    addToHistory({
                        type: 'deleteMultipleTasks',
                        tasks: deletedTasks.map(t => ({...t}))
                    });
                    
                    // Remove tasks
                    appState.tasks = appState.tasks.filter(t => !appState.selectedTasks.includes(t.id));
                    
                    // Clear selection
                    appState.selectedTasks = [];
                    
                    // Update UI
                    saveTasksState();
                    renderTasks();
                    updateTaskStats();
                    updateCharts();
                    elements.taskSelectionActions.classList.add('hidden');
                    
                    // Close modal
                    closeModal(elements.confirmationModal);
                };
                
                // Set cancel action
                document.getElementById('confirm-cancel').onclick = function() {
                    closeModal(elements.confirmationModal);
                };
            }
            
            // Show edit task modal
            function showEditTaskModal(taskId) {
                const task = appState.tasks.find(t => t.id === taskId);
                if (!task) return;
                
                // Update modal title
                document.querySelector('#add-task-modal h2').textContent = 'Edit Task';
                document.getElementById('save-task').textContent = 'Save Changes';
                
                // Fill form
                document.getElementById('task-title').value = task.title;
                document.getElementById('task-description').value = task.description;
                document.getElementById('task-category').value = task.category;
                document.getElementById('task-priority').value = task.priority;
                document.getElementById('task-due-date').value = task.dueDate;
                document.getElementById('task-assign').value = task.assignedTo;
                document.getElementById('task-notes').value = task.notes || '';
                
                // Clear subtasks container
                const subtasksContainer = document.getElementById('subtasks-container');
                subtasksContainer.innerHTML = '';
                
                // Add subtasks
                if (task.subtasks && task.subtasks.length > 0) {
                    task.subtasks.forEach(subtask => {
                        addSubtaskInput(subtask);
                    });
                }
                
                // Set save action
                document.getElementById('save-task').onclick = function() {
                    saveEditedTask(taskId);
                };
                
                // Show modal
                openModal(elements.addTaskModal);
            }
            
            // Save edited task
            function saveEditedTask(taskId) {
                const task = appState.tasks.find(t => t.id === taskId);
                if (!task) return;
                
                // Validate inputs
                const title = document.getElementById('task-title').value.trim();
                if (!title) {
                    alert('Please enter a task title');
                    return;
                }
                
                // Get form values
                const description = document.getElementById('task-description').value.trim();
                const category = document.getElementById('task-category').value;
                const priority = document.getElementById('task-priority').value;
                const dueDate = document.getElementById('task-due-date').value;
                const assignedTo = document.getElementById('task-assign').value;
                const notes = document.getElementById('task-notes').value.trim();
                
                // Get subtasks
                const subtaskInputs = document.querySelectorAll('.subtask-input');
                const subtasks = Array.from(subtaskInputs).map(input => input.value.trim()).filter(s => s !== '');
                
                // Add to history
                addToHistory({
                    type: 'editTask',
                    taskId,
                    previousState: {...task}
                });
                
                // Update task
                task.title = title;
                task.description = description;
                task.category = category;
                task.priority = priority;
                task.dueDate = dueDate;
                task.assignedTo = parseInt(assignedTo) || task.assignedTo;
                task.notes = notes;
                task.subtasks = subtasks;
                
                // Update UI
                saveTasksState();
                renderTasks();
                updateCharts();
                
                // Close modal
                closeModal(elements.addTaskModal);
            }
            
            // Add subtask input
            function addSubtaskInput(value = '') {
                const subtasksContainer = document.getElementById('subtasks-container');
                const subtaskWrapper = document.createElement('div');
                subtaskWrapper.className = 'flex items-center gap-2';
                
                subtaskWrapper.innerHTML = `
                    <input type="text" class="subtask-input flex-grow px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-primary focus:border-primary dark:bg-gray-700 text-base" value="${value}" placeholder="Enter subtask">
                    <button class="delete-subtask p-2 text-red-500 hover:text-red-600">
                        <i class="fas fa-trash-alt"></i>
                    </button>
                `;
                
                // Add delete event listener
                subtaskWrapper.querySelector('.delete-subtask').addEventListener('click', function() {
                    subtaskWrapper.remove();
                });
                
                subtasksContainer.appendChild(subtaskWrapper);
            }
            
            // Add subtask button event
            document.getElementById('add-subtask').addEventListener('click', function() {
                addSubtaskInput();
            });
            
            // Show share task modal
            function showShareTaskModal(taskId) {
                const task = appState.tasks.find(t => t.id === taskId);
                if (!task) return;
                
                // Clear any previously added email tags
                document.getElementById('share-emails-container').innerHTML = '';
                
                // Reset form
                document.getElementById('share-users').value = '';
                document.getElementById('share-email').value = '';
                document.getElementById('share-view').checked = true;
                
                // Set task title in modal
                elements.shareTaskModal.querySelector('h2').textContent = `Share Task: ${task.title}`;
                
                // Set data attribute for task id
                elements.shareTaskModal.setAttribute('data-task-id', taskId);
                
                // Open modal
                openModal(elements.shareTaskModal);
            }
            
            // Add email tag
            document.getElementById('add-share-email').addEventListener('click', function() {
                const email = document.getElementById('share-email').value.trim();
                if (!email) return;
                
                // Validate email
                const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
                if (!emailRegex.test(email)) {
                    alert('Please enter a valid email address');
                    return;
                }
                
                // Add email tag
                const emailsContainer = document.getElementById('share-emails-container');
                const emailTag = document.createElement('div');
                emailTag.className = 'bg-primary bg-opacity-10 text-primary px-2 py-1 rounded flex items-center';
                emailTag.innerHTML = `
                    <span class="mr-2">${email}</span>
                    <button class="text-primary hover:text-primary-dark remove-email">
                        <i class="fas fa-times"></i>
                    </button>
                `;
                
                // Add remove event
                emailTag.querySelector('.remove-email').addEventListener('click', function() {
                    emailTag.remove();
                });
                
                emailsContainer.appendChild(emailTag);
                
                // Clear input
                document.getElementById('share-email').value = '';
            });
            
            // Share task
            document.getElementById('share-submit').addEventListener('click', function() {
                const taskId = parseInt(elements.shareTaskModal.getAttribute('data-task-id'));
                const task = appState.tasks.find(t => t.id === taskId);
                if (!task) return;
                
                // Get selected users
                const userSelect = document.getElementById('share-users');
                const selectedUsers = Array.from(userSelect.selectedOptions).map(option => option.value);
                
                // Get email tags
                const emailTags = document.querySelectorAll('#share-emails-container > div');
                const emails = Array.from(emailTags).map(tag => tag.querySelector('span').textContent);
                
                // Get permission
                const permission = document.querySelector('input[name="share-permission"]:checked').value;
                
                // In a real app, we would send this data to a server
                // For this demo, we'll just show a success message
                alert(`Task "${task.title}" shared with ${selectedUsers.length + emails.length} recipients`);
                
                // Close modal
                closeModal(elements.shareTaskModal);
                
                // Add a notification for sharing
                showNotification('Task Shared', `"${task.title}" shared with ${selectedUsers.length + emails.length} recipients`);
            });
            
            // Update task stats
            function updateTaskStats() {
                const total = appState.tasks.length;
                const completed = appState.tasks.filter(t => t.completed).length;
                const pending = total - completed;
                
                elements.totalTasksCount.textContent = total;
                elements.completedTasksCount.textContent = completed;
                elements.pendingTasksCount.textContent = pending;
                
                // Update productivity score
                if (total > 0) {
                    const score = Math.round((completed / total) * 100);
                    elements.productivityScore.textContent = `${score}%`;
                } else {
                    elements.productivityScore.textContent = '0%';
                }
            }
            
            // Save tasks state
            function saveTasksState() {
                try {
                    sessionStorage.setItem('tasks', JSON.stringify(appState.tasks));
                } catch (e) {
                    console.log('Session storage not available');
                }
            }
            
            // ====== Notification Management ======
            
            // Toggle notification dropdown
            elements.notificationBtn.addEventListener('click', function() {
                elements.notificationDropdown.classList.toggle('hidden');
                
                // Mark all as read if dropdown is visible
                if (!elements.notificationDropdown.classList.contains('hidden')) {
                    markAllNotificationsAsRead();
                }
            });
            
            // Mark all notifications as read
            function markAllNotificationsAsRead() {
                appState.notifications.forEach(notification => {
                    notification.read = true;
                });
                updateNotificationBadge();
            }
            
            // Update notification badge
            function updateNotificationBadge() {
                const unreadCount = appState.notifications.filter(n => !n.read).length;
                elements.notificationCount.textContent = unreadCount;
                
                if (unreadCount === 0) {
                    elements.notificationCount.classList.add('hidden');
                } else {
                    elements.notificationCount.classList.remove('hidden');
                }
            }
            
            // Show notification
            function showNotification(title, message) {
                const notification = {
                    id: appState.notifications.length + 1,
                    title,
                    message,
                    read: false
                };
                
                appState.notifications.unshift(notification);
                
                // Update notification dropdown
                const notificationElement = document.createElement('div');
                notificationElement.className = 'notification-item p-3 border-b dark:border-gray-700 hover:bg-gray-100 dark:hover:bg-gray-700 cursor-pointer';
                notificationElement.innerHTML = `
                    <div class="font-semibold">${title}</div>
                    <div class="text-sm text-gray-600 dark:text-gray-400">${message}</div>
                `;
                
                // Add click event to mark as read
                notificationElement.addEventListener('click', function() {
                    notification.read = true;
                    this.classList.add('bg-gray-50', 'dark:bg-gray-800');
                    updateNotificationBadge();
                });
                
                // Insert at top
                elements.notificationDropdown.querySelector('.max-h-60').prepend(notificationElement);
                
                // Update badge
                updateNotificationBadge();
            }
            
            // ====== Drag and Drop ======
            
            let draggedItem = null;
            
            function handleDragStart(e) {
                draggedItem = this;
                setTimeout(() => this.classList.add('dragging'), 0);
                
                e.dataTransfer.setData('text/plain', this.getAttribute('data-task-id'));
                e.dataTransfer.effectAllowed = 'move';
            }
            
            function handleDragEnd() {
                this.classList.remove('dragging');
                draggedItem = null;
            }
            
            function handleDragOver(e) {
                e.preventDefault();
                e.dataTransfer.dropEffect = 'move';
                
                const container = elements.tasksContainer;
                const afterElement = getDragAfterElement(container, e.clientY);
                
                if (afterElement) {
                    container.insertBefore(draggedItem, afterElement);
                } else {
                    container.appendChild(draggedItem);
                }
            }
            
            function handleDragLeave() {
                // Not needed for this implementation
            }
            
            function handleDrop(e) {
                e.preventDefault();
                const taskId = parseInt(e.dataTransfer.getData('text/plain'));
                const targetId = parseInt(this.getAttribute('data-task-id'));
                
                if (taskId === targetId) return;
                
                // Reorder tasks
                reorderTasks(taskId, targetId);
            }
            
            function getDragAfterElement(container, y) {
                const draggableElements = [...container.querySelectorAll('.task-item:not(.dragging)')];
                
                return draggableElements.reduce((closest, child) => {
                    const box = child.getBoundingClientRect();
                    const offset = y - box.top - box.height / 2;
                    
                    if (offset < 0 && offset > closest.offset) {
                        return { offset: offset, element: child };
                    } else {
                        return closest;
                    }
                }, { offset: Number.NEGATIVE_INFINITY }).element;
            }
            
            function reorderTasks(sourceId, targetId) {
                // Find source and target indices
                const sourceIndex = appState.tasks.findIndex(t => t.id === sourceId);
                const targetIndex = appState.tasks.findIndex(t => t.id === targetId);
                
                if (sourceIndex === -1 || targetIndex === -1) return;
                
                // Create a copy of the tasks array for history
                const previousTasks = [...appState.tasks];
                
                // Move the task
                const [movedTask] = appState.tasks.splice(sourceIndex, 1);
                appState.tasks.splice(targetIndex, 0, movedTask);
                
                // Add to history
                addToHistory({
                    type: 'reorderTasks',
                    previousTasks
                });
                
                // Save and rerender
                saveTasksState();
                renderTasks();
            }
            
            // ====== Chart Management ======
            
            let charts = {
                status: null,
                priority: null,
                timeline: null,
                category: null
            };
            
            function initCharts() {
                // Status chart
                const statusCtx = elements.statusChart.getContext('2d');
                charts.status = new Chart(statusCtx, {
                    type: 'doughnut',
                    data: {
                        labels: ['Completed', 'Pending'],
                        datasets: [{
                            data: [0, 0],
                            backgroundColor: [
                                'rgba(34, 197, 94, 0.8)',
                                'rgba(250, 204, 21, 0.8)'
                            ],
                            borderColor: [
                                'rgba(34, 197, 94, 1)',
                                'rgba(250, 204, 21, 1)'
                            ],
                            borderWidth: 1
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                position: 'bottom',
                                labels: {
                                    color: document.documentElement.classList.contains('dark') ? '#e5e7eb' : '#4b5563'
                                }
                            }
                        }
                    }
                });
                
                // Priority chart
                const priorityCtx = elements.priorityChart.getContext('2d');
                charts.priority = new Chart(priorityCtx, {
                    type: 'bar',
                    data: {
                        labels: ['High', 'Medium', 'Low'],
                        datasets: [{
                            label: 'Tasks',
                            data: [0, 0, 0],
                            backgroundColor: [
                                'rgba(239, 68, 68, 0.8)',
                                'rgba(250, 204, 21, 0.8)',
                                'rgba(156, 163, 175, 0.8)'
                            ],
                            borderColor: [
                                'rgba(239, 68, 68, 1)',
                                'rgba(250, 204, 21, 1)',
                                'rgba(156, 163, 175, 1)'
                            ],
                            borderWidth: 1
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                display: false
                            }
                        },
                        scales: {
                            y: {
                                beginAtZero: true,
                                ticks: {
                                    precision: 0,
                                    color: document.documentElement.classList.contains('dark') ? '#e5e7eb' : '#4b5563'
                                },
                                grid: {
                                    color: document.documentElement.classList.contains('dark') ? 'rgba(255, 255, 255, 0.1)' : 'rgba(0, 0, 0, 0.1)'
                                }
                            },
                            x: {
                                ticks: {
                                    color: document.documentElement.classList.contains('dark') ? '#e5e7eb' : '#4b5563'
                                },
                                grid: {
                                    color: document.documentElement.classList.contains('dark') ? 'rgba(255, 255, 255, 0.1)' : 'rgba(0, 0, 0, 0.1)'
                                }
                            }
                        }
                    }
                });
                
                // Timeline chart
                const timelineCtx = elements.timelineChart.getContext('2d');
                
                // Get date labels for the last 7 days
                const dateLabels = [];
                for (let i = 6; i >= 0; i--) {
                    const date = new Date();
                    date.setDate(date.getDate() - i);
                    dateLabels.push(date.toLocaleDateString('en-US', { month: 'short', day: 'numeric' }));
                }
                
                charts.timeline = new Chart(timelineCtx, {
                    type: 'line',
                    data: {
                        labels: dateLabels,
                        datasets: [{
                            label: 'Completed Tasks',
                            data: [0, 0, 0, 0, 0, 0, 0],
                            borderColor: 'rgba(34, 197, 94, 1)',
                            backgroundColor: 'rgba(34, 197, 94, 0.1)',
                            borderWidth: 2,
                            tension: 0.3,
                            fill: true
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                display: false
                            }
                        },
                        scales: {
                            y: {
                                beginAtZero: true,
                                ticks: {
                                    precision: 0,
                                    color: document.documentElement.classList.contains('dark') ? '#e5e7eb' : '#4b5563'
                                },
                                grid: {
                                    color: document.documentElement.classList.contains('dark') ? 'rgba(255, 255, 255, 0.1)' : 'rgba(0, 0, 0, 0.1)'
                                }
                            },
                            x: {
                                ticks: {
                                    color: document.documentElement.classList.contains('dark') ? '#e5e7eb' : '#4b5563'
                                },
                                grid: {
                                    color: document.documentElement.classList.contains('dark') ? 'rgba(255, 255, 255, 0.1)' : 'rgba(0, 0, 0, 0.1)'
                                }
                            }
                        }
                    }
                });
                
                // Category chart
                const categoryCtx = elements.categoryChart.getContext('2d');
                charts.category = new Chart(categoryCtx, {
                    type: 'polarArea',
                    data: {
                        labels: ['Development', 'Design', 'Marketing', 'Research'],
                        datasets: [{
                            data: [0, 0, 0, 0],
                            backgroundColor: [
                                'rgba(59, 130, 246, 0.8)',
                                'rgba(139, 92, 246, 0.8)',
                                'rgba(249, 115, 22, 0.8)',
                                'rgba(20, 184, 166, 0.8)'
                            ],
                            borderWidth: 1
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                position: 'bottom',
                                labels: {
                                    color: document.documentElement.classList.contains('dark') ? '#e5e7eb' : '#4b5563'
                                }
                            }
                        }
                    }
                });
                
                // Update charts with data
                updateCharts();
            }
            
            // Update charts with current data
            function updateCharts() {
                // Skip if charts aren't initialized yet
                if (!charts.status) return;
                
                // Status chart data
                const completed = appState.tasks.filter(t => t.completed).length;
                const pending = appState.tasks.length - completed;
                
                charts.status.data.datasets[0].data = [completed, pending];
                charts.status.update();
                
                // Priority chart data
                const highPriority = appState.tasks.filter(t => t.priority === 'High').length;
                const mediumPriority = appState.tasks.filter(t => t.priority === 'Medium').length;
                const lowPriority = appState.tasks.filter(t => t.priority === 'Low').length;
                
                charts.priority.data.datasets[0].data = [highPriority, mediumPriority, lowPriority];
                charts.priority.update();
                
                // Timeline chart data
                // Simulate completed tasks over time
                const timelineData = [1, 2, 3, 4, 3, 5, 4];
                charts.timeline.data.datasets[0].data = timelineData;
                charts.timeline.update();
                
                // Category chart data
                const development = appState.tasks.filter(t => t.category === 'Development').length;
                const design = appState.tasks.filter(t => t.category === 'Design').length;
                const marketing = appState.tasks.filter(t => t.category === 'Marketing').length;
                const research = appState.tasks.filter(t => t.category === 'Research').length;
                
                charts.category.data.datasets[0].data = [development, design, marketing, research];
                charts.category.update();
            }
            
            // ====== Filter and Sort Controls ======
            
            // Search input
            elements.searchInput.addEventListener('input', function() {
                appState.filters.search = this.value.trim();
                renderTasks();
            });
            
            // Category filter
            elements.categoryFilter.addEventListener('change', function() {
                appState.filters.category = this.value;
                renderTasks();
            });
            
            // Priority filter
            elements.priorityFilter.addEventListener('change', function() {
                appState.filters.priority = this.value;
                renderTasks();
            });
            
            // Status filter
            elements.statusFilter.addEventListener('change', function() {
                appState.filters.status = this.value;
                renderTasks();
            });
            
            // Date filter
            elements.dateFilter.addEventListener('change', function() {
                if (this.value === 'custom') {
                    openModal(elements.dateRangeModal);
                } else {
                    appState.filters.dateFilter = this.value;
                    appState.filters.dateRange = { start: null, end: null };
                    renderTasks();
                }
            });
            
            // Apply date range
            document.getElementById('date-range-apply').addEventListener('click', function() {
                const startDate = document.getElementById('date-range-start').value;
                const endDate = document.getElementById('date-range-end').value;
                
                if (!startDate || !endDate) {
                    alert('Please select both start and end dates');
                    return;
                }
                
                appState.filters.dateRange = {
                    start: startDate,
                    end: endDate
                };
                
                // Reset date filter
                appState.filters.dateFilter = '';
                
                // Update UI
                elements.dateFilter.value = 'custom';
                
                // Close modal
                closeModal(elements.dateRangeModal);
                
                // Render tasks
                renderTasks();
            });
            
            // Sort controls
            elements.sortSelect.addEventListener('change', function() {
                appState.sort.by = this.value;
                renderTasks();
            });
            
            elements.sortDirection.addEventListener('click', function() {
                appState.sort.direction = appState.sort.direction === 'asc' ? 'desc' : 'asc';
                
                // Update icon
                this.innerHTML = appState.sort.direction === 'asc' ? 
                    '<i class="fas fa-sort-amount-up"></i>' : 
                    '<i class="fas fa-sort-amount-down"></i>';
                
                renderTasks();
            });
            
            // ====== View Controls ======
            
            // List view button
            elements.listViewBtn.addEventListener('click', function() {
                if (appState.view === 'list') return;
                
                appState.view = 'list';
                elements.listView.classList.remove('hidden');
                elements.graphView.classList.add('hidden');
                
                // Update button styles
                elements.listViewBtn.classList.remove('bg-white', 'dark:bg-gray-800', 'text-gray-700', 'dark:text-gray-300');
                elements.listViewBtn.classList.add('bg-primary', 'text-white');
                
                elements.graphViewBtn.classList.remove('bg-primary', 'text-white');
                elements.graphViewBtn.classList.add('bg-white', 'dark:bg-gray-800', 'text-gray-700', 'dark:text-gray-300');
            });
            
            // Graph view button
            elements.graphViewBtn.addEventListener('click', function() {
                if (appState.view === 'graph') return;
                
                appState.view = 'graph';
                elements.graphView.classList.remove('hidden');
                elements.listView.classList.add('hidden');
                
                // Update button styles
                elements.graphViewBtn.classList.remove('bg-white', 'dark:bg-gray-800', 'text-gray-700', 'dark:text-gray-300');
                elements.graphViewBtn.classList.add('bg-primary', 'text-white');
                
                elements.listViewBtn.classList.remove('bg-primary', 'text-white');
                elements.listViewBtn.classList.add('bg-white', 'dark:bg-gray-800', 'text-gray-700', 'dark:text-gray-300');
                
                // Update charts
                updateCharts();
            });
            
            // ====== Add Task ======
            
            // Add task button
            elements.addTaskBtn.addEventListener('click', function() {
                // Reset form
                document.getElementById('task-title').value = '';
                document.getElementById('task-description').value = '';
                document.getElementById('task-category').value = '';
                document.getElementById('task-priority').value = '';
                document.getElementById('task-due-date').value = '';
                document.getElementById('task-assign').value = '';
                document.getElementById('task-notes').value = '';
                document.getElementById('subtasks-container').innerHTML = '';
                
                // Update modal title
                document.querySelector('#add-task-modal h2').textContent = 'Add New Task';
                document.getElementById('save-task').textContent = 'Add Task';
                
                // Set save action
                document.getElementById('save-task').onclick = addNewTask;
                
                // Show modal
                openModal(elements.addTaskModal);
            });
            
            // Add new task
            function addNewTask() {
                // Validate inputs
                const title = document.getElementById('task-title').value.trim();
                if (!title) {
                    alert('Please enter a task title');
                    return;
                }
                
                // Get form values
                const description = document.getElementById('task-description').value.trim();
                const category = document.getElementById('task-category').value;
                const priority = document.getElementById('task-priority').value;
                const dueDate = document.getElementById('task-due-date').value;
                const assignedTo = parseInt(document.getElementById('task-assign').value) || 1;
                const notes = document.getElementById('task-notes').value.trim();
                
                // Get subtasks
                const subtaskInputs = document.querySelectorAll('.subtask-input');
                const subtasks = Array.from(subtaskInputs).map(input => input.value.trim()).filter(s => s !== '');
                
                // Create new task
                const newTask = {
                    id: appState.tasks.length > 0 ? Math.max(...appState.tasks.map(t => t.id)) + 1 : 1,
                    title,
                    description,
                    category,
                    priority,
                    dueDate,
                    completed: false,
                    assignedTo,
                    subtasks,
                    notes,
                    created: new Date().toISOString().split('T')[0],
                    timer: 0
                };
                
                // Add to history
                addToHistory({
                    type: 'addTask',
                    task: newTask
                });
                
                // Add to tasks
                appState.tasks.push(newTask);
                
                // Update UI
                saveTasksState();
                renderTasks();
                updateCharts();
                
                // Close modal
                closeModal(elements.addTaskModal);
                
                // Show notification
                showNotification('Task Added', `"${title}" has been added`);
            }
            
            // ====== Import/Export ======
            
            // Import button
            elements.importBtn.addEventListener('click', function() {
                openModal(elements.importModal);
            });
            
            // Export button
            elements.exportBtn.addEventListener('click', function() {
                openModal(elements.exportModal);
            });
            
            // Import file selection
            document.getElementById('import-file').addEventListener('change', function(e) {
                if (e.target.files.length === 0) return;
                
                const file = e.target.files[0];
                
                // Update file info
                document.getElementById('import-file-info').classList.remove('hidden');
                document.getElementById('import-file-name').textContent = file.name;
                
                // Enable import button
                document.getElementById('import-submit').disabled = false;
            });
            
            // Remove import file
            document.getElementById('remove-import-file').addEventListener('click', function() {
                document.getElementById('import-file').value = '';
                document.getElementById('import-file-info').classList.add('hidden');
                document.getElementById('import-submit').disabled = true;
            });
            
            // Import submit
            document.getElementById('import-submit').addEventListener('click', function() {
                const fileInput = document.getElementById('import-file');
                if (fileInput.files.length === 0) return;
                
                const file = fileInput.files[0];
                
                // In a real app, we would read the file and parse it
                // For this demo, we'll just simulate importing
                
                // Show success message
                alert(`File "${file.name}" imported successfully`);
                
                // Close modal
                closeModal(elements.importModal);
            });
            
            // Export submit
            document.getElementById('export-submit').addEventListener('click', function() {
                // Get export format
                const format = document.querySelector('input[name="export-format"]:checked').value;
                
                // Get export tasks
                const exportType = document.getElementById('export-tasks').value;
                
                // In a real app, we would generate and download the file
                // For this demo, we'll just show a success message
                
                // Show success message
                alert(`Tasks exported as ${format.toUpperCase()}`);
                
                // Close modal
                closeModal(elements.exportModal);
            });
            
            // ====== Users ======
            
            // Users button
            elements.usersBtn.addEventListener('click', function() {
                // Clear users container
                elements.usersContainer.innerHTML = '';
                
                // Render users
                appState.users.forEach(user => {
                    const userCard = elements.userCardTemplate.content.cloneNode(true);
                    
                    userCard.querySelector('.user-name').textContent = user.name;
                    userCard.querySelector('.user-role').textContent = user.role;
                    userCard.querySelector('.user-email span').textContent = user.email;
                    userCard.querySelector('.user-avatar').src = user.avatar;
                    
                    // Count assigned tasks
                    const assignedTasks = appState.tasks.filter(t => t.assignedTo === user.id).length;
                    userCard.querySelector('.user-tasks span').textContent = `${assignedTasks} assigned tasks`;
                    
                    elements.usersContainer.appendChild(userCard);
                });
                
                // Show modal
                openModal(elements.usersModal);
            });
            
            // User search
            elements.userSearch.addEventListener('input', function() {
                const query = this.value.toLowerCase();
                
                document.querySelectorAll('#users-container .user-card').forEach(card => {
                    const name = card.querySelector('.user-name').textContent.toLowerCase();
                    const role = card.querySelector('.user-role').textContent.toLowerCase();
                    
                    if (name.includes(query) || role.includes(query)) {
                        card.classList.remove('hidden');
                    } else {
                        card.classList.add('hidden');
                    }
                });
            });
            
            // ====== Profile ======
            
            // Profile button
            elements.profileBtn.addEventListener('click', function() {
                elements.profileDropdown.classList.toggle('hidden');
            });
            
            // View profile button
            document.getElementById('view-profile-btn').addEventListener('click', function() {
                elements.profileDropdown.classList.add('hidden');
                openModal(elements.profileModal);
            });
            
            // Save profile changes
            document.getElementById('save-profile').addEventListener('click', function() {
                // Get form values
                const name = document.getElementById('profile-edit-name').value.trim();
                const email = document.getElementById('profile-edit-email').value.trim();
                const phone = document.getElementById('profile-edit-phone').value.trim();
                const country = document.getElementById('profile-edit-country').value;
                const role = document.getElementById('profile-edit-role').value;
                
                // Validate inputs
                if (!name || !email || !phone) {
                    alert('Please fill in all required fields');
                    return;
                }
                
                // Update user data
                appState.currentUser.name = name;
                appState.currentUser.email = email;
                appState.currentUser.phone = phone;
                appState.currentUser.country = country;
                appState.currentUser.role = role;
                
                // Update UI
                updateUserUI();
                
                // Close modal
                closeModal(elements.profileModal);
                
                // Show notification
                showNotification('Profile Updated', 'Your profile has been updated successfully');
            });
            
            // Change profile picture
            document.getElementById('change-profile-pic').addEventListener('click', function() {
                // In a real app, we would show a file picker
                // For this demo, we'll just show a message
                alert('This would open a file picker to select a new profile picture');
            });
            
            // ====== Dark Mode ======
            
            // Check for dark mode preference
            if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
                document.documentElement.classList.add('dark');
                appState.darkMode = true;
            }
            
            // Listen for changes in color scheme preference
            window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', event => {
                if (event.matches) {
                    document.documentElement.classList.add('dark');
                    appState.darkMode = true;
                } else {
                    document.documentElement.classList.remove('dark');
                    appState.darkMode = false;
                }
                
                // Update charts for dark/light mode
                if (charts.status) {
                    updateChartsTheme();
                }
            });
            
            // Dark mode toggle
            elements.darkModeToggle.addEventListener('click', function() {
                document.documentElement.classList.toggle('dark');
                appState.darkMode = document.documentElement.classList.contains('dark');
                
                // Update charts for dark/light mode
                if (charts.status) {
                    updateChartsTheme();
                }
            });
            
            // Update charts theme
            function updateChartsTheme() {
                const textColor = document.documentElement.classList.contains('dark') ? '#e5e7eb' : '#4b5563';
                const gridColor = document.documentElement.classList.contains('dark') ? 'rgba(255, 255, 255, 0.1)' : 'rgba(0, 0, 0, 0.1)';
                
                // Update each chart
                for (const chartName in charts) {
                    const chart = charts[chartName];
                    
                    if (chart.options.plugins.legend && chart.options.plugins.legend.labels) {
                        chart.options.plugins.legend.labels.color = textColor;
                    }
                    
                    if (chart.options.scales) {
                        if (chart.options.scales.y) {
                            chart.options.scales.y.ticks.color = textColor;
                            chart.options.scales.y.grid.color = gridColor;
                        }
                        
                        if (chart.options.scales.x) {
                            chart.options.scales.x.ticks.color = textColor;
                            chart.options.scales.x.grid.color = gridColor;
                        }
                    }
                    
                    chart.update();
                }
            }
            
            // ====== Modal Management ======
            
            // Open modal
            function openModal(modal) {
                modal.classList.add('open');
            }
            
            // Close modal
            function closeModal(modal) {
                modal.classList.remove('open');
            }
            
            // Close modal buttons
            document.querySelectorAll('.close-modal').forEach(button => {
                button.addEventListener('click', function() {
                    const modal = this.closest('.modal');
                    closeModal(modal);
                });
            });
            
            // Close modals when clicking outside
            document.querySelectorAll('.modal').forEach(modal => {
                modal.addEventListener('click', function(e) {
                    if (e.target === this) {
                        closeModal(this);
                    }
                });
            });
            
            // ====== History (Undo/Redo) ======
            
            // Add action to history
            function addToHistory(action) {
                // If we're not at the end of the history, remove future actions
                if (appState.history.position < appState.history.actions.length - 1) {
                    appState.history.actions = appState.history.actions.slice(0, appState.history.position + 1);
                }
                
                // Add new action
                appState.history.actions.push(action);
                appState.history.position = appState.history.actions.length - 1;
                
                // Update UI
                updateHistoryButtons();
            }
            
            // Update history buttons
            function updateHistoryButtons() {
                // Update undo button
                elements.undoBtn.disabled = appState.history.position < 0;
                elements.undoBtn.classList.toggle('opacity-50', appState.history.position < 0);
                
                // Update redo button
                elements.redoBtn.disabled = appState.history.position >= appState.history.actions.length - 1;
                elements.redoBtn.classList.toggle('opacity-50', appState.history.position >= appState.history.actions.length - 1);
            }
            
            // Undo button
            elements.undoBtn.addEventListener('click', function() {
                if (appState.history.position < 0) return;
                
                const action = appState.history.actions[appState.history.position];
                
                // Perform undo based on action type
                switch (action.type) {
                    case 'addTask':
                        // Remove the task
                        appState.tasks = appState.tasks.filter(t => t.id !== action.task.id);
                        break;
                        
                    case 'deleteTask':
                        // Restore the task
                        appState.tasks.push(action.task);
                        break;
                        
                    case 'deleteMultipleTasks':
                        // Restore all tasks
                        appState.tasks.push(...action.tasks);
                        break;
                        
                    case 'editTask':
                        // Restore previous state
                        const taskToRestore = appState.tasks.find(t => t.id === action.taskId);
                        if (taskToRestore) {
                            Object.assign(taskToRestore, action.previousState);
                        }
                        break;
                        
                    case 'toggleCompletion':
                        // Toggle back to previous state
                        const taskToToggle = appState.tasks.find(t => t.id === action.taskId);
                        if (taskToToggle) {
                            taskToToggle.completed = action.previousState;
                        }
                        break;
                        
                    case 'bulkToggleCompletion':
                        // Restore all tasks to previous state
                        action.taskIds.forEach(id => {
                            const task = appState.tasks.find(t => t.id === id);
                            if (task) {
                                task.completed = action.previousState[id];
                            }
                        });
                        break;
                        
                    case 'reorderTasks':
                        // Restore previous order
                        appState.tasks = [...action.previousTasks];
                        break;
                }
                
                // Decrement position
                appState.history.position--;
                
                // Update UI
                saveTasksState();
                renderTasks();
                updateCharts();
                updateHistoryButtons();
            });
            
            // Redo button
            elements.redoBtn.addEventListener('click', function() {
                if (appState.history.position >= appState.history.actions.length - 1) return;
                
                // Increment position
                appState.history.position++;
                
                const action = appState.history.actions[appState.history.position];
                
                // Perform redo based on action type
                switch (action.type) {
                    case 'addTask':
                        // Add the task back
                        appState.tasks.push(action.task);
                        break;
                        
                    case 'deleteTask':
                        // Remove the task again
                        appState.tasks = appState.tasks.filter(t => t.id !== action.task.id);
                        break;
                        
                    case 'deleteMultipleTasks':
                        // Remove all tasks again
                        const taskIds = action.tasks.map(t => t.id);
                        appState.tasks = appState.tasks.filter(t => !taskIds.includes(t.id));
                        break;
                        
                    case 'editTask':
                        // Apply the edit again
                        const taskToEdit = appState.tasks.find(t => t.id === action.taskId);
                        
                        // Since we stored the previous state, we need to figure out what changed
                        // For simplicity, we'll remove and re-add the task
                        if (taskToEdit) {
                            appState.tasks = appState.tasks.filter(t => t.id !== action.taskId);
                            
                            // Create a deep copy of the task without the previous state
                            const { previousState, ...newTask } = action;
                            
                            appState.tasks.push(taskToEdit);
                        }
                        break;
                        
                    case 'toggleCompletion':
                        // Toggle completion again
                        const taskToToggle = appState.tasks.find(t => t.id === action.taskId);
                        if (taskToToggle) {
                            taskToToggle.completed = !action.previousState;
                        }
                        break;
                        
                    case 'bulkToggleCompletion':
                        // Toggle all tasks again
                        action.taskIds.forEach(id => {
                            const task = appState.tasks.find(t => t.id === id);
                            if (task) {
                                task.completed = true; // Since bulk toggle is always setting to true
                            }
                        });
                        break;
                        
                    case 'reorderTasks':
                        // We can't easily redo a reorder, so we'll skip this
                        break;
                }
                
                // Update UI
                saveTasksState();
                renderTasks();
                updateCharts();
                updateHistoryButtons();
            });
            
            // ====== Click Outside Handlers ======
            
            // Close dropdowns when clicking outside
            document.addEventListener('click', function(e) {
                // Profile dropdown
                if (elements.profileBtn && !elements.profileBtn.contains(e.target) && 
                    elements.profileDropdown && !elements.profileDropdown.contains(e.target)) {
                    elements.profileDropdown.classList.add('hidden');
                }
                
                // Status options
                if (elements.statusBtn && !elements.statusBtn.contains(e.target) &&
                    elements.statusOptions && !elements.statusOptions.contains(e.target)) {
                    elements.statusOptions.classList.add('hidden');
                }
                
                // Notification dropdown
                if (elements.notificationBtn && !elements.notificationBtn.contains(e.target) &&
                    elements.notificationDropdown && !elements.notificationDropdown.contains(e.target)) {
                    elements.notificationDropdown.classList.add('hidden');
                }
            });
            
            // ====== Initialization ======
            
            // Check for dark mode
            if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
                document.documentElement.classList.add('dark');
            }
            
            // Disable import button initially
            document.getElementById('import-submit').disabled = true;
            
            // Initialize history buttons
            updateHistoryButtons();
            
            // Check for stored session
            try {
                const storedUser = sessionStorage.getItem('currentUser');
                if (storedUser) {
                    appState.currentUser = JSON.parse(storedUser);
                    showDashboard();
                }
            } catch (e) {
                console.log('Session storage not available');
            }
        });
    </script>
</body>
</html>
