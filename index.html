<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>To-Do APP</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js@3.9.1/dist/chart.min.js"></script>
    <style>
        /* Custom Styles */
        .task-card {
            transition: all 0.3s ease;
        }
        .task-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 20px rgba(0,0,0,0.1);
        }
        .completed-task {
            background-color: rgba(16, 185, 129, 0.1);
            border-left: 4px solid #10B981;
        }
        .profile-picture {
            border: 3px solid;
            transition: all 0.3s ease;
        }
        .status-green { border-color: #10B981; }
        .status-red { border-color: #EF4444; }
        .status-yellow { border-color: #F59E0B; }
        .status-gray { border-color: #6B7280; }
        .priority-high { border-left: 4px solid #EF4444; }
        .priority-medium { border-left: 4px solid #F59E0B; }
        .priority-low { border-left: 4px solid #6B7280; }
        .due-expired { color: #EF4444; }
        .due-soon { color: #F59E0B; }
        .due-safe { color: #10B981; }
        .modal {
            transition: opacity 0.3s ease;
        }
        .graph-container {
            height: 300px;
            position: relative;
        }
        .task-dragging {
            opacity: 0.5;
            background-color: #f3f4f6;
        }
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        .fade-in {
            animation: fadeIn 0.5s ease-in-out;
        }
        
        /* Dark mode styles */
        .dark body {
            background-color: #1F2937;
            color: #F9FAFB;
        }
        .dark .bg-white {
            background-color: #1F2937;
        }
        .dark .bg-gray-50 {
            background-color: #111827;
        }
        .dark .bg-gray-100 {
            background-color: #374151;
        }
        .dark .text-gray-700 {
            color: #E5E7EB;
        }
        .dark .text-gray-600 {
            color: #D1D5DB;
        }
        .dark .text-gray-800 {
            color: #F3F4F6;
        }
        .dark .text-gray-900 {
            color: #F9FAFB;
        }
        .dark .border-gray-200 {
            border-color: #374151;
        }
        .dark .border-gray-300 {
            border-color: #4B5563;
        }
        .dark .shadow {
            box-shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.4), 0 1px 2px 0 rgba(0, 0, 0, 0.24);
        }
        .dark .completed-task {
            background-color: rgba(16, 185, 129, 0.15);
        }
        .dark input, 
        .dark select, 
        .dark textarea {
            background-color: #374151;
            border-color: #4B5563;
            color: #F9FAFB;
        }
        .dark input::placeholder {
            color: #9CA3AF;
        }
        /* Transition Effect for Theme Switching */
        body, .bg-white, .bg-gray-50, .bg-gray-100, input, select, textarea, .shadow, 
        .text-gray-700, .text-gray-600, .text-gray-800, .text-gray-900, 
        .border-gray-200, .border-gray-300 {
            transition: all 0.3s ease;
        }
    </style>
</head>
<body class="bg-gray-50 min-h-screen">
    <!-- Login/Register Page -->
    <div id="auth-page" class="min-h-screen flex items-center justify-center py-12 px-4 sm:px-6 lg:px-8">
        <div class="max-w-md w-full space-y-8 bg-white p-8 rounded-lg shadow-lg">
            <div class="text-center">
                <h2 id="auth-title" class="mt-6 text-3xl font-extrabold text-gray-900">Sign in to your account</h2>
                <p class="mt-2 text-sm text-gray-600">
                    <span id="auth-toggle-text">Or</span>
                    <a href="#" id="auth-toggle-link" class="font-medium text-indigo-600 hover:text-indigo-500">
                        create a new account
                    </a>
                </p>
            </div>
            
            <!-- Login Form -->
            <form id="login-form" class="mt-8 space-y-6">
                <input type="hidden" name="remember" value="true">
                <div class="rounded-md shadow-sm -space-y-px">
                    <div>
                        <label for="login-email" class="sr-only">Email address</label>
                        <input id="login-email" name="email" type="email" autocomplete="email" required 
                            class="appearance-none rounded-none relative block w-full px-3 py-2 border border-gray-300 
                            placeholder-gray-500 text-gray-900 rounded-t-md focus:outline-none focus:ring-indigo-500 
                            focus:border-indigo-500 focus:z-10 text-base" placeholder="Email address">
                    </div>
                    <div>
                        <label for="login-password" class="sr-only">Password</label>
                        <input id="login-password" name="password" type="password" autocomplete="current-password" required 
                            class="appearance-none rounded-none relative block w-full px-3 py-2 border border-gray-300 
                            placeholder-gray-500 text-gray-900 rounded-b-md focus:outline-none focus:ring-indigo-500 
                            focus:border-indigo-500 focus:z-10 text-base" placeholder="Password">
                    </div>
                </div>
                <div>
                    <button type="submit" 
                        class="group relative w-full flex justify-center py-2 px-4 border border-transparent 
                        text-base font-medium rounded-md text-white bg-indigo-600 hover:bg-indigo-700 
                        focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500">
                        Sign in
                    </button>
                </div>
                <div id="login-error" class="text-red-500 text-sm text-center hidden"></div>
            </form>
            
            <!-- Register Form -->
            <form id="register-form" class="mt-8 space-y-6 hidden">
                <div class="rounded-md shadow-sm space-y-2">
                    <div>
                        <label for="register-name" class="sr-only">Full Name</label>
                        <input id="register-name" name="name" type="text" required 
                            class="appearance-none rounded-md relative block w-full px-3 py-2 border border-gray-300 
                            placeholder-gray-500 text-gray-900 focus:outline-none focus:ring-indigo-500 
                            focus:border-indigo-500 focus:z-10 text-base" placeholder="Full Name">
                    </div>
                    <div>
                        <label for="register-email" class="sr-only">Email address</label>
                        <input id="register-email" name="email" type="email" required 
                            class="appearance-none rounded-md relative block w-full px-3 py-2 border border-gray-300 
                            placeholder-gray-500 text-gray-900 focus:outline-none focus:ring-indigo-500 
                            focus:border-indigo-500 focus:z-10 text-base" placeholder="Email address">
                    </div>
                    <div>
                        <label for="register-email-confirm" class="sr-only">Confirm Email</label>
                        <input id="register-email-confirm" name="email-confirm" type="email" required 
                            class="appearance-none rounded-md relative block w-full px-3 py-2 border border-gray-300 
                            placeholder-gray-500 text-gray-900 focus:outline-none focus:ring-indigo-500 
                            focus:border-indigo-500 focus:z-10 text-base" placeholder="Confirm Email">
                    </div>
                    <div>
                        <label for="register-password" class="sr-only">Password</label>
                        <input id="register-password" name="password" type="password" required 
                            class="appearance-none rounded-md relative block w-full px-3 py-2 border border-gray-300 
                            placeholder-gray-500 text-gray-900 focus:outline-none focus:ring-indigo-500 
                            focus:border-indigo-500 focus:z-10 text-base" placeholder="Password">
                    </div>
                    <div>
                        <label for="register-password-confirm" class="sr-only">Confirm Password</label>
                        <input id="register-password-confirm" name="password-confirm" type="password" required 
                            class="appearance-none rounded-md relative block w-full px-3 py-2 border border-gray-300 
                            placeholder-gray-500 text-gray-900 focus:outline-none focus:ring-indigo-500 
                            focus:border-indigo-500 focus:z-10 text-base" placeholder="Confirm Password">
                    </div>
                    <div>
                        <label for="register-phone" class="sr-only">Phone Number</label>
                        <input id="register-phone" name="phone" type="tel" required 
                            class="appearance-none rounded-md relative block w-full px-3 py-2 border border-gray-300 
                            placeholder-gray-500 text-gray-900 focus:outline-none focus:ring-indigo-500 
                            focus:border-indigo-500 focus:z-10 text-base" placeholder="Phone Number">
                    </div>
                    <div>
                        <label for="register-country" class="sr-only">Country</label>
                        <select id="register-country" name="country" required 
                            class="appearance-none rounded-md relative block w-full px-3 py-2 border border-gray-300 
                            text-gray-900 focus:outline-none focus:ring-indigo-500 
                            focus:border-indigo-500 focus:z-10 text-base">
                            <option value="" disabled selected>Select Country</option>
                            <option value="US">United States</option>
                            <option value="CA">Canada</option>
                            <option value="UK">United Kingdom</option>
                            <option value="AU">Australia</option>
                            <option value="FR">France</option>
                            <option value="DE">Germany</option>
                            <option value="JP">Japan</option>
                            <option value="IN">India</option>
                            <option value="BR">Brazil</option>
                            <option value="CN">China</option>
                            <option value="RU">Russia</option>
                            <option value="ZA">South Africa</option>
                            <option value="MX">Mexico</option>
                            <option value="IT">Italy</option>
                            <option value="ES">Spain</option>
                            <option value="KR">South Korea</option>
                            <option value="NL">Netherlands</option>
                            <option value="SE">Sweden</option>
                            <option value="SG">Singapore</option>
                        </select>
                    </div>
                    <div>
                        <label for="register-role" class="sr-only">Role</label>
                        <select id="register-role" name="role" required 
                            class="appearance-none rounded-md relative block w-full px-3 py-2 border border-gray-300 
                            text-gray-900 focus:outline-none focus:ring-indigo-500 
                            focus:border-indigo-500 focus:z-10 text-base">
                            <option value="" disabled selected>Select Role</option>
                            <option value="Manager">Manager</option>
                            <option value="Admin">Admin</option>
                            <option value="Staff">Staff</option>
                            <option value="Customer">Customer</option>
                        </select>
                    </div>
                </div>
                <div>
                    <button type="submit" 
                        class="group relative w-full flex justify-center py-2 px-4 border border-transparent 
                        text-base font-medium rounded-md text-white bg-indigo-600 hover:bg-indigo-700 
                        focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500">
                        Register
                    </button>
                </div>
                <div id="register-error" class="text-red-500 text-sm text-center hidden"></div>
            </form>
        </div>
    </div>

    <!-- Main App -->
    <div id="app-container" class="hidden">
        <!-- Header -->
        <header class="bg-white shadow dark:bg-gray-800">
            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                <div class="flex justify-between h-16">
                    <!-- Logo and App Name -->
                    <div class="flex-shrink-0 flex items-center">
                        <div class="w-10 h-10 bg-indigo-600 rounded-lg flex items-center justify-center text-white font-bold text-lg">TD</div>
                        <span class="ml-2 text-xl font-bold text-gray-900 dark:text-white">To-Do APP</span>
                    </div>
                    
                    <!-- Right Side Menu -->
                    <div class="flex items-center space-x-4">
                        <!-- Work Timer -->
                        <div id="work-timer" class="hidden md:flex items-center px-3 py-1 rounded-md border-2 status-green">
                            <i class="fas fa-clock mr-2"></i>
                            <span id="timer-display">00:00:00</span>
                        </div>
                        
                        <!-- Dark Mode Toggle -->
                        <button id="theme-toggle" class="p-2 rounded-full text-gray-600 hover:text-gray-900 focus:outline-none dark:text-gray-400 dark:hover:text-white">
                            <i id="theme-icon" class="fas fa-moon"></i>
                        </button>
                        
                        <!-- Notifications -->
                        <div class="relative">
                            <button id="notification-btn" class="p-2 rounded-full text-gray-600 hover:text-gray-900 focus:outline-none dark:text-gray-400 dark:hover:text-white">
                                <i class="fas fa-bell"></i>
                                <span id="notification-count" class="absolute top-0 right-0 inline-flex items-center justify-center px-2 py-1 text-xs font-bold leading-none text-white transform translate-x-1/2 -translate-y-1/2 bg-red-500 rounded-full">3</span>
                            </button>
                            <!-- Notification Dropdown -->
                            <div id="notification-dropdown" class="hidden absolute right-0 mt-2 w-80 bg-white rounded-md shadow-lg z-50 dark:bg-gray-700">
                                <div class="px-4 py-2 border-b border-gray-200 dark:border-gray-600">
                                    <h3 class="text-sm font-medium text-gray-900 dark:text-white">Notifications</h3>
                                </div>
                                <div class="max-h-72 overflow-y-auto">
                                    <div class="notification-item p-4 border-b border-gray-200 dark:border-gray-600">
                                        <p class="text-sm text-gray-700 dark:text-gray-300">Task "Website Redesign" is due in 24 hours</p>
                                        <p class="text-xs text-gray-500 dark:text-gray-400 mt-1">2 hours ago</p>
                                    </div>
                                    <div class="notification-item p-4 border-b border-gray-200 dark:border-gray-600">
                                        <p class="text-sm text-gray-700 dark:text-gray-300">John Smith completed "Database Migration"</p>
                                        <p class="text-xs text-gray-500 dark:text-gray-400 mt-1">5 hours ago</p>
                                    </div>
                                    <div class="notification-item p-4">
                                        <p class="text-sm text-gray-700 dark:text-gray-300">New task assigned to you: "Client Meeting Preparation"</p>
                                        <p class="text-xs text-gray-500 dark:text-gray-400 mt-1">Yesterday</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Profile -->
                        <div class="relative">
                            <button id="profile-btn" class="flex text-sm rounded-full focus:outline-none">
                                <img id="profile-img" class="h-10 w-10 rounded-full object-cover profile-picture status-green" src="https://i.imgur.com/8Km9tLL.jpg" alt="User profile">
                            </button>
                            <!-- Profile Dropdown -->
                            <div id="profile-dropdown" class="hidden absolute right-0 mt-2 w-48 bg-white rounded-md shadow-lg z-50 dark:bg-gray-700">
                                <div class="px-4 py-3 border-b border-gray-200 dark:border-gray-600">
                                    <p id="profile-name" class="text-sm font-medium text-gray-900 dark:text-white">John Doe</p>
                                    <p id="profile-email" class="text-xs text-gray-500 dark:text-gray-400">john@example.com</p>
                                </div>
                                <div class="py-1">
                                    <a href="#" id="view-profile-btn" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 dark:text-gray-300 dark:hover:bg-gray-600">View Profile</a>
                                    <div class="px-4 py-2">
                                        <p class="text-xs text-gray-500 dark:text-gray-400 mb-1">Status</p>
                                        <div class="flex flex-col space-y-1">
                                            <button class="status-btn px-2 py-1 text-sm text-left rounded hover:bg-gray-100 dark:hover:bg-gray-600" data-status="login">
                                                <i class="fas fa-circle text-green-500 mr-2"></i>Login to Work
                                            </button>
                                            <button class="status-btn px-2 py-1 text-sm text-left rounded hover:bg-gray-100 dark:hover:bg-gray-600" data-status="shadow">
                                                <i class="fas fa-circle text-gray-500 mr-2"></i>Shadow
                                            </button>
                                            <button class="status-btn px-2 py-1 text-sm text-left rounded hover:bg-gray-100 dark:hover:bg-gray-600" data-status="break">
                                                <i class="fas fa-circle text-yellow-500 mr-2"></i>Break
                                            </button>
                                            <button class="status-btn px-2 py-1 text-sm text-left rounded hover:bg-gray-100 dark:hover:bg-gray-600" data-status="logout">
                                                <i class="fas fa-circle text-red-500 mr-2"></i>Logout from Work
                                            </button>
                                        </div>
                                    </div>
                                    <a href="#" id="logout-btn" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 dark:text-gray-300 dark:hover:bg-gray-600">Sign out</a>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </header>

        <!-- Main Content -->
        <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
            <!-- Task Summary Section -->
            <div class="bg-white shadow rounded-lg p-6 mb-6 dark:bg-gray-800">
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                    <div class="bg-blue-50 rounded-lg p-4 flex items-center dark:bg-blue-900">
                        <div class="rounded-full bg-blue-500 w-12 h-12 flex items-center justify-center">
                            <i class="fas fa-tasks text-white"></i>
                        </div>
                        <div class="ml-4">
                            <h3 class="text-lg font-semibold text-blue-700 dark:text-blue-300">Total Tasks</h3>
                            <p id="total-tasks" class="text-2xl font-bold text-blue-900 dark:text-blue-100">12</p>
                        </div>
                    </div>
                    <div class="bg-green-50 rounded-lg p-4 flex items-center dark:bg-green-900">
                        <div class="rounded-full bg-green-500 w-12 h-12 flex items-center justify-center">
                            <i class="fas fa-check-circle text-white"></i>
                        </div>
                        <div class="ml-4">
                            <h3 class="text-lg font-semibold text-green-700 dark:text-green-300">Completed Tasks</h3>
                            <p id="completed-tasks" class="text-2xl font-bold text-green-900 dark:text-green-100">5</p>
                        </div>
                    </div>
                    <div class="bg-yellow-50 rounded-lg p-4 flex items-center dark:bg-yellow-900">
                        <div class="rounded-full bg-yellow-500 w-12 h-12 flex items-center justify-center">
                            <i class="fas fa-clock text-white"></i>
                        </div>
                        <div class="ml-4">
                            <h3 class="text-lg font-semibold text-yellow-700 dark:text-yellow-300">Pending Tasks</h3>
                            <p id="pending-tasks" class="text-2xl font-bold text-yellow-900 dark:text-yellow-100">7</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Task Management Section -->
            <div class="bg-white shadow rounded-lg mb-6 dark:bg-gray-800">
                <div class="p-6 border-b border-gray-200 dark:border-gray-700 flex flex-wrap justify-between items-center">
                    <h2 class="text-xl font-semibold text-gray-800 dark:text-white">Tasks</h2>
                    
                    <div class="flex flex-wrap gap-2 mt-2 sm:mt-0">
                        <button id="import-btn" class="inline-flex items-center px-3 py-2 border border-gray-300 shadow-sm text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none dark:bg-gray-700 dark:text-gray-300 dark:border-gray-600 dark:hover:bg-gray-600">
                            <i class="fas fa-file-import mr-2"></i>
                            Import
                        </button>
                        <button id="export-btn" class="inline-flex items-center px-3 py-2 border border-gray-300 shadow-sm text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none dark:bg-gray-700 dark:text-gray-300 dark:border-gray-600 dark:hover:bg-gray-600">
                            <i class="fas fa-file-export mr-2"></i>
                            Export
                        </button>
                        <button id="users-btn" class="inline-flex items-center px-3 py-2 border border-gray-300 shadow-sm text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none dark:bg-gray-700 dark:text-gray-300 dark:border-gray-600 dark:hover:bg-gray-600">
                            <i class="fas fa-users mr-2"></i>
                            Users
                        </button>
                        <button id="add-task-btn" class="inline-flex items-center px-3 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none">
                            <i class="fas fa-plus mr-2"></i>
                            Add Task
                        </button>
                    </div>
                </div>
                
                <!-- Task Filters -->
                <div class="p-4 border-b border-gray-200 dark:border-gray-700 bg-gray-50 dark:bg-gray-900">
                    <div class="flex flex-wrap items-center gap-3">
                        <div class="relative flex-grow max-w-xs">
                            <input type="text" id="task-search" placeholder="Search tasks..." class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 text-base dark:bg-gray-700 dark:border-gray-600">
                            <div class="absolute inset-y-0 right-0 flex items-center pr-3 pointer-events-none">
                                <i class="fas fa-search text-gray-400"></i>
                            </div>
                        </div>
                        
                        <div class="flex flex-wrap items-center gap-2">
                            <select id="filter-category" class="border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 text-sm dark:bg-gray-700 dark:border-gray-600">
                                <option value="">All Categories</option>
                                <option value="work">Work</option>
                                <option value="personal">Personal</option>
                                <option value="learning">Learning</option>
                                <option value="health">Health</option>
                                <option value="home">Home</option>
                            </select>
                            
                            <select id="filter-priority" class="border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 text-sm dark:bg-gray-700 dark:border-gray-600">
                                <option value="">All Priorities</option>
                                <option value="high">High</option>
                                <option value="medium">Medium</option>
                                <option value="low">Low</option>
                            </select>
                            
                            <select id="filter-status" class="border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 text-sm dark:bg-gray-700 dark:border-gray-600">
                                <option value="">All Status</option>
                                <option value="active">Active</option>
                                <option value="completed">Completed</option>
                            </select>
                            
                            <div class="relative">
                                <select id="filter-date" class="border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 text-sm dark:bg-gray-700 dark:border-gray-600">
                                    <option value="">All Dates</option>
                                    <option value="today">Today</option>
                                    <option value="week">This Week</option>
                                    <option value="month">This Month</option>
                                    <option value="custom">Custom Range</option>
                                </select>
                            </div>
                            
                            <div id="date-range-picker" class="hidden flex gap-2 items-center">
                                <input type="date" id="date-from" class="border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 text-sm dark:bg-gray-700 dark:border-gray-600">
                                <span class="text-gray-500">to</span>
                                <input type="date" id="date-to" class="border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 text-sm dark:bg-gray-700 dark:border-gray-600">
                                <button id="apply-date-range" class="bg-indigo-600 text-white px-3 py-2 rounded-md text-sm hover:bg-indigo-700 focus:outline-none">Apply</button>
                            </div>
                        </div>
                        
                        <div class="ml-auto flex items-center">
                            <button id="undo-btn" class="text-gray-500 hover:text-gray-700 p-1 dark:text-gray-400 dark:hover:text-gray-300" title="Undo">
                                <i class="fas fa-undo"></i>
                            </button>
                            <button id="redo-btn" class="text-gray-500 hover:text-gray-700 p-1 ml-2 dark:text-gray-400 dark:hover:text-gray-300" title="Redo">
                                <i class="fas fa-redo"></i>
                            </button>
                            
                            <div class="border-l border-gray-300 mx-3 h-6 dark:border-gray-600"></div>
                            
                            <div class="flex items-center">
                                <span class="text-sm text-gray-600 mr-2 dark:text-gray-400">Sort by:</span>
                                <select id="sort-tasks" class="border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 text-sm dark:bg-gray-700 dark:border-gray-600">
                                    <option value="dueDate">Due Date</option>
                                    <option value="priority">Priority</option>
                                    <option value="title">Title</option>
                                    <option value="status">Status</option>
                                    <option value="createdAt">Created Date</option>
                                </select>
                            </div>
                            
                            <div class="border-l border-gray-300 mx-3 h-6 dark:border-gray-600"></div>
                            
                            <div class="flex">
                                <button id="list-view-btn" class="text-indigo-600 p-1 dark:text-indigo-400" title="List View">
                                    <i class="fas fa-list"></i>
                                </button>
                                <button id="graph-view-btn" class="text-gray-500 hover:text-gray-700 p-1 ml-2 dark:text-gray-400 dark:hover:text-gray-300" title="Graph View">
                                    <i class="fas fa-chart-bar"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Tasks List View -->
                <div id="tasks-list-view" class="p-6">
                    <div id="tasks-header" class="flex items-center mb-4">
                        <div class="flex-shrink-0 w-6">
                            <input type="checkbox" id="select-all-tasks" class="w-4 h-4 rounded border-gray-300 focus:ring-indigo-500 dark:border-gray-600">
                        </div>
                        <div class="ml-4 flex-grow grid grid-cols-5 gap-4">
                            <div class="text-sm font-medium text-gray-500 dark:text-gray-400">Task</div>
                            <div class="text-sm font-medium text-gray-500 dark:text-gray-400">Priority</div>
                            <div class="text-sm font-medium text-gray-500 dark:text-gray-400">Due Date</div>
                            <div class="text-sm font-medium text-gray-500 dark:text-gray-400">Assigned To</div>
                            <div class="text-sm font-medium text-gray-500 dark:text-gray-400">Status</div>
                        </div>
                        <div class="flex-shrink-0 w-20 text-right">
                            <span class="text-sm font-medium text-gray-500 dark:text-gray-400">Actions</span>
                        </div>
                    </div>
                    
                    <div id="selected-actions" class="hidden mb-4 p-2 bg-gray-100 dark:bg-gray-700 rounded-md flex items-center">
                        <span class="text-sm text-gray-600 dark:text-gray-300 mr-2"><span id="selected-count">0</span> selected</span>
                        <button id="multi-complete-btn" class="text-xs bg-green-500 text-white px-2 py-1 rounded-md hover:bg-green-600 ml-2">
                            <i class="fas fa-check mr-1"></i> Complete
                        </button>
                        <button id="multi-delete-btn" class="text-xs bg-red-500 text-white px-2 py-1 rounded-md hover:bg-red-600 ml-2">
                            <i class="fas fa-trash mr-1"></i> Delete
                        </button>
                    </div>
                    
                    <div id="tasks-container">
                        <!-- Tasks will be generated here -->
                    </div>
                </div>
                
                <!-- Tasks Graph View -->
                <div id="tasks-graph-view" class="p-6 hidden">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div class="bg-white p-4 rounded-lg shadow dark:bg-gray-700">
                            <h3 class="text-lg font-medium text-gray-900 mb-4 dark:text-white">Task Status Distribution</h3>
                            <div class="graph-container">
                                <canvas id="status-chart"></canvas>
                            </div>
                        </div>
                        <div class="bg-white p-4 rounded-lg shadow dark:bg-gray-700">
                            <h3 class="text-lg font-medium text-gray-900 mb-4 dark:text-white">Task Priority Distribution</h3>
                            <div class="graph-container">
                                <canvas id="priority-chart"></canvas>
                            </div>
                        </div>
                        <div class="bg-white p-4 rounded-lg shadow dark:bg-gray-700">
                            <h3 class="text-lg font-medium text-gray-900 mb-4 dark:text-white">Tasks by Category</h3>
                            <div class="graph-container">
                                <canvas id="category-chart"></canvas>
                            </div>
                        </div>
                        <div class="bg-white p-4 rounded-lg shadow dark:bg-gray-700">
                            <h3 class="text-lg font-medium text-gray-900 mb-4 dark:text-white">Task Completion Trend</h3>
                            <div class="graph-container">
                                <canvas id="completion-chart"></canvas>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Insights Section -->
            <div class="bg-white shadow rounded-lg p-6 dark:bg-gray-800">
                <h2 class="text-xl font-semibold text-gray-800 mb-6 dark:text-white">Insights</h2>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                    <div class="bg-white p-4 rounded-lg shadow dark:bg-gray-700">
                        <h3 class="text-lg font-medium text-gray-900 mb-2 dark:text-white">Productivity Score</h3>
                        <div class="flex items-center">
                            <div class="w-16 h-16 rounded-full flex items-center justify-center bg-green-100 text-green-800 text-2xl font-bold dark:bg-green-900 dark:text-green-200">
                                85%
                            </div>
                            <div class="ml-4">
                                <p class="text-sm text-gray-600 dark:text-gray-300">Your productivity has increased by 12% compared to last week</p>
                            </div>
                        </div>
                    </div>
                    <div class="bg-white p-4 rounded-lg shadow dark:bg-gray-700">
                        <h3 class="text-lg font-medium text-gray-900 mb-2 dark:text-white">Task Completion Rate</h3>
                        <div class="flex items-center">
                            <div class="w-16 h-16 rounded-full flex items-center justify-center bg-blue-100 text-blue-800 text-2xl font-bold dark:bg-blue-900 dark:text-blue-200">
                                73%
                            </div>
                            <div class="ml-4">
                                <p class="text-sm text-gray-600 dark:text-gray-300">You've completed 8 out of 11 tasks this week</p>
                            </div>
                        </div>
                    </div>
                    <div class="bg-white p-4 rounded-lg shadow dark:bg-gray-700">
                        <h3 class="text-lg font-medium text-gray-900 mb-2 dark:text-white">Work Time</h3>
                        <div class="flex items-center">
                            <div class="w-16 h-16 rounded-full flex items-center justify-center bg-purple-100 text-purple-800 text-2xl font-bold dark:bg-purple-900 dark:text-purple-200">
                                32h
                            </div>
                            <div class="ml-4">
                                <p class="text-sm text-gray-600 dark:text-gray-300">Total work time this week</p>
                                <p class="text-xs text-gray-500 dark:text-gray-400 mt-1">4h break time, 2h shadow time</p>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="mt-6">
                    <h3 class="text-lg font-medium text-gray-900 mb-4 dark:text-white">Work Patterns</h3>
                    <div class="bg-white p-4 rounded-lg shadow dark:bg-gray-700">
                        <canvas id="work-pattern-chart" height="100"></canvas>
                    </div>
                </div>
            </div>
        </main>

        <!-- Modals -->
        <!-- Add Task Modal -->
        <div id="add-task-modal" class="fixed inset-0 bg-gray-600 bg-opacity-50 flex items-center justify-center z-50 hidden">
            <div class="bg-white rounded-lg shadow-lg w-full max-w-md mx-4 dark:bg-gray-800">
                <div class="p-6">
                    <div class="flex justify-between items-center mb-4">
                        <h2 class="text-xl font-semibold text-gray-800 dark:text-white">Add New Task</h2>
                        <button class="close-modal text-gray-400 hover:text-gray-500 focus:outline-none">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                    <form id="add-task-form">
                        <div class="space-y-4">
                            <div>
                                <label for="task-title" class="block text-sm font-medium text-gray-700 dark:text-gray-300">Title</label>
                                <input type="text" id="task-title" name="title" class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm px-3 py-2 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 text-base dark:bg-gray-700 dark:border-gray-600" required>
                            </div>
                            <div>
                                <label for="task-description" class="block text-sm font-medium text-gray-700 dark:text-gray-300">Description</label>
                                <textarea id="task-description" name="description" rows="3" class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm px-3 py-2 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 text-base dark:bg-gray-700 dark:border-gray-600"></textarea>
                            </div>
                            <div class="grid grid-cols-2 gap-4">
                                <div>
                                    <label for="task-category" class="block text-sm font-medium text-gray-700 dark:text-gray-300">Category</label>
                                    <select id="task-category" name="category" class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm px-3 py-2 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 text-base dark:bg-gray-700 dark:border-gray-600">
                                        <option value="work">Work</option>
                                        <option value="personal">Personal</option>
                                        <option value="learning">Learning</option>
                                        <option value="health">Health</option>
                                        <option value="home">Home</option>
                                    </select>
                                </div>
                                <div>
                                    <label for="task-priority" class="block text-sm font-medium text-gray-700 dark:text-gray-300">Priority</label>
                                    <select id="task-priority" name="priority" class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm px-3 py-2 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 text-base dark:bg-gray-700 dark:border-gray-600">
                                        <option value="high">High</option>
                                        <option value="medium">Medium</option>
                                        <option value="low">Low</option>
                                    </select>
                                </div>
                            </div>
                            <div>
                                <label for="task-due-date" class="block text-sm font-medium text-gray-700 dark:text-gray-300">Due Date</label>
                                <input type="date" id="task-due-date" name="dueDate" class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm px-3 py-2 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 text-base dark:bg-gray-700 dark:border-gray-600" required>
                            </div>
                            <div>
                                <label for="task-assign" class="block text-sm font-medium text-gray-700 dark:text-gray-300">Assign To</label>
                                <select id="task-assign" name="assignTo" class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm px-3 py-2 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 text-base dark:bg-gray-700 dark:border-gray-600">
                                    <option value="self">Myself</option>
                                    <option value="user1">Sarah Johnson</option>
                                    <option value="user2">Michael Smith</option>
                                    <option value="user3">Emily Davis</option>
                                    <option value="user4">David Wilson</option>
                                </select>
                            </div>
                            <div id="subtasks-container">
                                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300">Subtasks</label>
                                <div class="space-y-2" id="subtask-items">
                                    <!-- Subtasks will be added here -->
                                </div>
                                <button type="button" id="add-subtask-btn" class="mt-2 inline-flex items-center px-3 py-1 border border-transparent text-sm font-medium rounded-md text-indigo-700 bg-indigo-100 hover:bg-indigo-200 focus:outline-none dark:bg-indigo-900 dark:text-indigo-200 dark:hover:bg-indigo-800">
                                    <i class="fas fa-plus mr-2"></i> Add Subtask
                                </button>
                            </div>
                            <div>
                                <label for="task-notes" class="block text-sm font-medium text-gray-700 dark:text-gray-300">Additional Notes</label>
                                <textarea id="task-notes" name="notes" rows="2" class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm px-3 py-2 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 text-base dark:bg-gray-700 dark:border-gray-600"></textarea>
                            </div>
                        </div>
                        <div class="mt-6 flex justify-end space-x-3">
                            <button type="button" class="close-modal px-4 py-2 border border-gray-300 shadow-sm text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none dark:bg-gray-700 dark:text-gray-300 dark:border-gray-600 dark:hover:bg-gray-600">
                                Cancel
                            </button>
                            <button type="submit" class="px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none">
                                Save Task
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>

        <!-- Profile Modal -->
        <div id="profile-modal" class="fixed inset-0 bg-gray-600 bg-opacity-50 flex items-center justify-center z-50 hidden">
            <div class="bg-white rounded-lg shadow-lg w-full max-w-md mx-4 dark:bg-gray-800">
                <div class="p-6">
                    <div class="flex justify-between items-center mb-4">
                        <h2 class="text-xl font-semibold text-gray-800 dark:text-white">User Profile</h2>
                        <button class="close-modal text-gray-400 hover:text-gray-500 focus:outline-none">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                    <div class="flex flex-col items-center mb-6">
                        <div class="relative">
                            <img id="profile-modal-img" class="h-24 w-24 rounded-full object-cover" src="https://i.imgur.com/8Km9tLL.jpg" alt="User profile">
                            <button id="change-profile-pic" class="absolute bottom-0 right-0 bg-indigo-600 rounded-full p-2 text-white hover:bg-indigo-700 focus:outline-none">
                                <i class="fas fa-camera"></i>
                            </button>
                            <input type="file" id="profile-pic-input" class="hidden" accept="image/*">
                        </div>
                        <p id="profile-modal-name" class="mt-4 text-lg font-medium text-gray-900 dark:text-white">John Doe</p>
                        <p id="profile-modal-role" class="text-sm text-gray-500 dark:text-gray-400">Manager</p>
                    </div>
                    <form id="edit-profile-form">
                        <div class="space-y-4">
                            <div>
                                <label for="profile-name" class="block text-sm font-medium text-gray-700 dark:text-gray-300">Full Name</label>
                                <input type="text" id="profile-name" name="name" class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm px-3 py-2 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 text-base dark:bg-gray-700 dark:border-gray-600">
                            </div>
                            <div>
                                <label for="profile-email" class="block text-sm font-medium text-gray-700 dark:text-gray-300">Email</label>
                                <input type="email" id="profile-email-input" name="email" class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm px-3 py-2 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 text-base dark:bg-gray-700 dark:border-gray-600">
                            </div>
                            <div>
                                <label for="profile-phone" class="block text-sm font-medium text-gray-700 dark:text-gray-300">Phone Number</label>
                                <input type="tel" id="profile-phone" name="phone" class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm px-3 py-2 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 text-base dark:bg-gray-700 dark:border-gray-600">
                            </div>
                            <div>
                                <label for="profile-country" class="block text-sm font-medium text-gray-700 dark:text-gray-300">Country</label>
                                <select id="profile-country" name="country" class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm px-3 py-2 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 text-base dark:bg-gray-700 dark:border-gray-600">
                                    <option value="US">United States</option>
                                    <option value="CA">Canada</option>
                                    <option value="UK">United Kingdom</option>
                                    <option value="AU">Australia</option>
                                    <option value="FR">France</option>
                                    <option value="DE">Germany</option>
                                    <option value="JP">Japan</option>
                                    <option value="IN">India</option>
                                    <option value="BR">Brazil</option>
                                    <option value="CN">China</option>
                                    <option value="RU">Russia</option>
                                    <option value="ZA">South Africa</option>
                                    <option value="MX">Mexico</option>
                                    <option value="IT">Italy</option>
                                    <option value="ES">Spain</option>
                                    <option value="KR">South Korea</option>
                                    <option value="NL">Netherlands</option>
                                    <option value="SE">Sweden</option>
                                    <option value="SG">Singapore</option>
                                </select>
                            </div>
                            <div>
                                <label for="profile-role" class="block text-sm font-medium text-gray-700 dark:text-gray-300">Role</label>
                                <select id="profile-role-input" name="role" class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm px-3 py-2 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 text-base dark:bg-gray-700 dark:border-gray-600" disabled>
                                    <option value="Manager">Manager</option>
                                    <option value="Admin">Admin</option>
                                    <option value="Staff">Staff</option>
                                    <option value="Customer">Customer</option>
                                </select>
                            </div>
                            <div>
                                <div class="flex items-center justify-between">
                                    <label for="profile-password" class="block text-sm font-medium text-gray-700 dark:text-gray-300">Password</label>
                                    <button type="button" id="change-password-btn" class="text-xs text-indigo-600 hover:text-indigo-500 dark:text-indigo-400">
                                        Change Password
                                    </button>
                                </div>
                                <input type="password" id="profile-password" name="password" class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm px-3 py-2 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 text-base dark:bg-gray-700 dark:border-gray-600" value="********" disabled>
                            </div>
                            <div id="change-password-section" class="hidden space-y-3">
                                <div>
                                    <label for="current-password" class="block text-sm font-medium text-gray-700 dark:text-gray-300">Current Password</label>
                                    <input type="password" id="current-password" name="currentPassword" class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm px-3 py-2 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 text-base dark:bg-gray-700 dark:border-gray-600">
                                </div>
                                <div>
                                    <label for="new-password" class="block text-sm font-medium text-gray-700 dark:text-gray-300">New Password</label>
                                    <input type="password" id="new-password" name="newPassword" class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm px-3 py-2 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 text-base dark:bg-gray-700 dark:border-gray-600">
                                </div>
                                <div>
                                    <label for="confirm-new-password" class="block text-sm font-medium text-gray-700 dark:text-gray-300">Confirm New Password</label>
                                    <input type="password" id="confirm-new-password" name="confirmNewPassword" class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm px-3 py-2 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 text-base dark:bg-gray-700 dark:border-gray-600">
                                </div>
                            </div>
                        </div>
                        <div class="mt-6 flex justify-end space-x-3">
                            <button type="button" class="close-modal px-4 py-2 border border-gray-300 shadow-sm text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none dark:bg-gray-700 dark:text-gray-300 dark:border-gray-600 dark:hover:bg-gray-600">
                                Cancel
                            </button>
                            <button type="submit" class="px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none">
                                Save Changes
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>

        <!-- Users Modal -->
        <div id="users-modal" class="fixed inset-0 bg-gray-600 bg-opacity-50 flex items-center justify-center z-50 hidden">
            <div class="bg-white rounded-lg shadow-lg w-full max-w-4xl mx-4 dark:bg-gray-800">
                <div class="p-6">
                    <div class="flex justify-between items-center mb-4">
                        <h2 class="text-xl font-semibold text-gray-800 dark:text-white">Team Members</h2>
                        <button class="close-modal text-gray-400 hover:text-gray-500 focus:outline-none">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                    <div class="mb-4">
                        <input type="text" id="search-users" placeholder="Search users..." class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 text-base dark:bg-gray-700 dark:border-gray-600">
                    </div>
                    <div id="users-list" class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <!-- Users will be generated here -->
                    </div>
                    <div class="mt-6 flex justify-end">
                        <button class="close-modal px-4 py-2 border border-gray-300 shadow-sm text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none dark:bg-gray-700 dark:text-gray-300 dark:border-gray-600 dark:hover:bg-gray-600">
                            Close
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Import Modal -->
        <div id="import-modal" class="fixed inset-0 bg-gray-600 bg-opacity-50 flex items-center justify-center z-50 hidden">
            <div class="bg-white rounded-lg shadow-lg w-full max-w-md mx-4 dark:bg-gray-800">
                <div class="p-6">
                    <div class="flex justify-between items-center mb-4">
                        <h2 class="text-xl font-semibold text-gray-800 dark:text-white">Import Tasks</h2>
                        <button class="close-modal text-gray-400 hover:text-gray-500 focus:outline-none">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                    <div class="space-y-4">
                        <div class="border-2 border-dashed border-gray-300 rounded-lg p-6 text-center dark:border-gray-600">
                            <div class="space-y-1">
                                <i class="fas fa-file-upload text-4xl text-gray-400 dark:text-gray-500"></i>
                                <p class="text-sm text-gray-500 dark:text-gray-400">Drag and drop your file here, or</p>
                                <label for="import-file" class="cursor-pointer text-indigo-600 hover:text-indigo-500 dark:text-indigo-400">
                                    browse files
                                </label>
                                <input id="import-file" type="file" class="hidden" accept=".json,.csv,.xlsx,.xls">
                                <p id="selected-file-name" class="text-sm text-gray-500 hidden dark:text-gray-400"></p>
                            </div>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1 dark:text-gray-300">File Format</label>
                            <div class="flex space-x-2">
                                <label class="inline-flex items-center">
                                    <input type="radio" name="import-format" value="json" class="form-radio" checked>
                                    <span class="ml-2 text-sm text-gray-700 dark:text-gray-300">JSON</span>
                                </label>
                                <label class="inline-flex items-center">
                                    <input type="radio" name="import-format" value="csv" class="form-radio">
                                    <span class="ml-2 text-sm text-gray-700 dark:text-gray-300">CSV</span>
                                </label>
                                <label class="inline-flex items-center">
                                    <input type="radio" name="import-format" value="excel" class="form-radio">
                                    <span class="ml-2 text-sm text-gray-700 dark:text-gray-300">Excel</span>
                                </label>
                            </div>
                        </div>
                        <div class="mt-6 flex justify-end space-x-3">
                            <button type="button" class="close-modal px-4 py-2 border border-gray-300 shadow-sm text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none dark:bg-gray-700 dark:text-gray-300 dark:border-gray-600 dark:hover:bg-gray-600">
                                Cancel
                            </button>
                            <button id="import-btn-submit" class="px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none">
                                Import
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Export Modal -->
        <div id="export-modal" class="fixed inset-0 bg-gray-600 bg-opacity-50 flex items-center justify-center z-50 hidden">
            <div class="bg-white rounded-lg shadow-lg w-full max-w-md mx-4 dark:bg-gray-800">
                <div class="p-6">
                    <div class="flex justify-between items-center mb-4">
                        <h2 class="text-xl font-semibold text-gray-800 dark:text-white">Export Tasks</h2>
                        <button class="close-modal text-gray-400 hover:text-gray-500 focus:outline-none">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                    <div class="space-y-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2 dark:text-gray-300">Export Format</label>
                            <div class="grid grid-cols-3 gap-2">
                                <button class="export-format-btn bg-white border border-gray-300 rounded-md p-4 flex flex-col items-center hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-indigo-500 dark:bg-gray-700 dark:border-gray-600 dark:hover:bg-gray-600" data-format="json">
                                    <i class="fas fa-file-code text-2xl text-indigo-500 mb-2"></i>
                                    <span class="text-sm text-gray-700 dark:text-gray-300">JSON</span>
                                </button>
                                <button class="export-format-btn bg-white border border-gray-300 rounded-md p-4 flex flex-col items-center hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-indigo-500 dark:bg-gray-700 dark:border-gray-600 dark:hover:bg-gray-600" data-format="pdf">
                                    <i class="fas fa-file-pdf text-2xl text-red-500 mb-2"></i>
                                    <span class="text-sm text-gray-700 dark:text-gray-300">PDF</span>
                                </button>
                                <button class="export-format-btn bg-white border border-gray-300 rounded-md p-4 flex flex-col items-center hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-indigo-500 dark:bg-gray-700 dark:border-gray-600 dark:hover:bg-gray-600" data-format="docx">
                                    <i class="fas fa-file-word text-2xl text-blue-500 mb-2"></i>
                                    <span class="text-sm text-gray-700 dark:text-gray-300">DOCX</span>
                                </button>
                            </div>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2 dark:text-gray-300">Data to Export</label>
                            <div class="space-y-2">
                                <label class="inline-flex items-center">
                                    <input type="radio" name="export-data" value="all" class="form-radio" checked>
                                    <span class="ml-2 text-sm text-gray-700 dark:text-gray-300">All Tasks</span>
                                </label>
                                <div class="block">
                                    <label class="inline-flex items-center">
                                        <input type="radio" name="export-data" value="filtered" class="form-radio">
                                        <span class="ml-2 text-sm text-gray-700 dark:text-gray-300">Current Filtered View</span>
                                    </label>
                                </div>
                                <div class="block">
                                    <label class="inline-flex items-center">
                                        <input type="radio" name="export-data" value="selected" class="form-radio">
                                        <span class="ml-2 text-sm text-gray-700 dark:text-gray-300">Selected Tasks Only</span>
                                    </label>
                                </div>
                            </div>
                        </div>
                        <div class="mt-6 flex justify-end space-x-3">
                            <button type="button" class="close-modal px-4 py-2 border border-gray-300 shadow-sm text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none dark:bg-gray-700 dark:text-gray-300 dark:border-gray-600 dark:hover:bg-gray-600">
                                Cancel
                            </button>
                            <button id="export-btn-submit" class="px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none">
                                Export
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Helper functions
        function generateUUID() {
            return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function(c) {
                var r = Math.random() * 16 | 0, v = c == 'x' ? r : (r & 0x3 | 0x8);
                return v.toString(16);
            });
        }

        function formatDate(dateString) {
            const date = new Date(dateString);
            return date.toLocaleDateString('en-US', { year: 'numeric', month: 'short', day: 'numeric' });
        }

        function getTimeRemaining(dueDate) {
            const now = new Date();
            const due = new Date(dueDate);
            const diff = due - now;
            const hours = Math.floor(diff / (1000 * 60 * 60));
            
            if (diff < 0) return { status: 'expired', text: 'Expired' };
            if (hours < 48) return { status: 'soon', text: 'Due soon' };
            return { status: 'safe', text: 'On track' };
        }

        function randomImageUrl() {
            const images = [
                'https://i.imgur.com/8Km9tLL.jpg',
                'https://i.imgur.com/7D7I6dI.jpg',
                'https://i.imgur.com/0PmCB5v.jpg',
                'https://i.imgur.com/v4crorW.jpg',
                'https://i.imgur.com/HvdkPgJ.jpg',
                'https://i.imgur.com/bLizzaA.jpg',
                'https://i.imgur.com/mIZtuxm.jpg',
                'https://i.imgur.com/Z68hMpX.jpg'
            ];
            return images[Math.floor(Math.random() * images.length)];
        }

        function formatTimeFromSeconds(seconds) {
            const hours = Math.floor(seconds / 3600);
            const minutes = Math.floor((seconds % 3600) / 60);
            const remainingSeconds = seconds % 60;
            
            const formattedHours = String(hours).padStart(2, '0');
            const formattedMinutes = String(minutes).padStart(2, '0');
            const formattedSeconds = String(remainingSeconds).padStart(2, '0');
            
            return `${formattedHours}:${formattedMinutes}:${formattedSeconds}`;
        }

        // Dark Mode Toggle
        function initializeDarkMode() {
            const themeToggleBtn = document.getElementById('theme-toggle');
            const themeIcon = document.getElementById('theme-icon');
            
            // Check for user preference
            if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
                document.documentElement.classList.add('dark');
                themeIcon.classList.remove('fa-moon');
                themeIcon.classList.add('fa-sun');
            }
            
            // Toggle theme
            themeToggleBtn.addEventListener('click', () => {
                document.documentElement.classList.toggle('dark');
                
                if (document.documentElement.classList.contains('dark')) {
                    themeIcon.classList.remove('fa-moon');
                    themeIcon.classList.add('fa-sun');
                } else {
                    themeIcon.classList.remove('fa-sun');
                    themeIcon.classList.add('fa-moon');
                }
                
                // Save preference
                localStorage.setItem('darkMode', document.documentElement.classList.contains('dark'));
            });
            
            // Listen for system preference change
            window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', event => {
                if (event.matches) {
                    document.documentElement.classList.add('dark');
                    themeIcon.classList.remove('fa-moon');
                    themeIcon.classList.add('fa-sun');
                } else {
                    document.documentElement.classList.remove('dark');
                    themeIcon.classList.remove('fa-sun');
                    themeIcon.classList.add('fa-moon');
                }
            });
        }

        // User Authentication
        let currentUser = null;
        const users = JSON.parse(localStorage.getItem('todoAppUsers')) || [];
        
        function initializeAuth() {
            const loginForm = document.getElementById('login-form');
            const registerForm = document.getElementById('register-form');
            const authToggleLink = document.getElementById('auth-toggle-link');
            const authTitle = document.getElementById('auth-title');
            const authToggleText = document.getElementById('auth-toggle-text');
            
            // Check if user is already logged in
            const savedUser = localStorage.getItem('todoAppCurrentUser');
            if (savedUser) {
                currentUser = JSON.parse(savedUser);
                showApp();
                updateUserInfo();
            }
            
            // Toggle between login and register forms
            authToggleLink.addEventListener('click', (e) => {
                e.preventDefault();
                
                if (loginForm.classList.contains('hidden')) {
                    // Switch to login
                    loginForm.classList.remove('hidden');
                    registerForm.classList.add('hidden');
                    authTitle.textContent = 'Sign in to your account';
                    authToggleLink.textContent = 'create a new account';
                    authToggleText.textContent = 'Or';
                } else {
                    // Switch to register
                    loginForm.classList.add('hidden');
                    registerForm.classList.remove('hidden');
                    authTitle.textContent = 'Create a new account';
                    authToggleLink.textContent = 'sign in to your account';
                    authToggleText.textContent = 'Or';
                }
            });
            
            // Login form submission
            loginForm.addEventListener('submit', (e) => {
                e.preventDefault();
                
                const email = document.getElementById('login-email').value;
                const password = document.getElementById('login-password').value;
                const errorElement = document.getElementById('login-error');
                
                const user = users.find(u => u.email === email && u.password === password);
                
                if (user) {
                    currentUser = user;
                    localStorage.setItem('todoAppCurrentUser', JSON.stringify(user));
                    showApp();
                    updateUserInfo();
                    // Reset form
                    loginForm.reset();
                    errorElement.classList.add('hidden');
                } else {
                    errorElement.textContent = 'Invalid email or password';
                    errorElement.classList.remove('hidden');
                }
            });
            
            // Register form submission
            registerForm.addEventListener('submit', (e) => {
                e.preventDefault();
                
                const name = document.getElementById('register-name').value;
                const email = document.getElementById('register-email').value;
                const emailConfirm = document.getElementById('register-email-confirm').value;
                const password = document.getElementById('register-password').value;
                const passwordConfirm = document.getElementById('register-password-confirm').value;
                const phone = document.getElementById('register-phone').value;
                const country = document.getElementById('register-country').value;
                const role = document.getElementById('register-role').value;
                const errorElement = document.getElementById('register-error');
                
                // Validation
                if (email !== emailConfirm) {
                    errorElement.textContent = 'Emails do not match';
                    errorElement.classList.remove('hidden');
                    return;
                }
                
                if (password !== passwordConfirm) {
                    errorElement.textContent = 'Passwords do not match';
                    errorElement.classList.remove('hidden');
                    return;
                }
                
                if (users.some(u => u.email === email)) {
                    errorElement.textContent = 'Email already in use';
                    errorElement.classList.remove('hidden');
                    return;
                }
                
                // Create new user
                const newUser = {
                    id: generateUUID(),
                    name,
                    email,
                    password,
                    phone,
                    country,
                    role,
                    profileImage: randomImageUrl(),
                    status: 'login', // Default status
                    workTime: { login: 0, shadow: 0, break: 0 },
                    createdAt: new Date().toISOString()
                };
                
                users.push(newUser);
                localStorage.setItem('todoAppUsers', JSON.stringify(users));
                
                // Login the user
                currentUser = newUser;
                localStorage.setItem('todoAppCurrentUser', JSON.stringify(newUser));
                
                showApp();
                updateUserInfo();
                
                // Reset form
                registerForm.reset();
                errorElement.classList.add('hidden');
            });
            
            // Logout
            document.getElementById('logout-btn').addEventListener('click', (e) => {
                e.preventDefault();
                
                localStorage.removeItem('todoAppCurrentUser');
                currentUser = null;
                
                hideApp();
                resetTimer();
            });
        }

        function showApp() {
            document.getElementById('auth-page').classList.add('hidden');
            document.getElementById('app-container').classList.remove('hidden');
            initializeTimer();
        }

        function hideApp() {
            document.getElementById('app-container').classList.add('hidden');
            document.getElementById('auth-page').classList.remove('hidden');
        }

        function updateUserInfo() {
            if (!currentUser) return;
            
            // Update header profile info
            document.getElementById('profile-name').textContent = currentUser.name;
            document.getElementById('profile-email').textContent = currentUser.email;
            document.getElementById('profile-img').src = currentUser.profileImage;
            
            // Update profile modal
            document.getElementById('profile-modal-name').textContent = currentUser.name;
            document.getElementById('profile-modal-role').textContent = currentUser.role;
            document.getElementById('profile-modal-img').src = currentUser.profileImage;
            
            // Update form fields
            document.getElementById('profile-name').value = currentUser.name;
            document.getElementById('profile-email-input').value = currentUser.email;
            document.getElementById('profile-phone').value = currentUser.phone;
            document.getElementById('profile-country').value = currentUser.country;
            document.getElementById('profile-role-input').value = currentUser.role;
            
            // Update profile picture status
            updateProfileStatus(currentUser.status);
        }

        function updateProfileStatus(status) {
            const profileImg = document.getElementById('profile-img');
            const workTimer = document.getElementById('work-timer');
            
            // Remove all status classes
            profileImg.classList.remove('status-green', 'status-red', 'status-yellow', 'status-gray');
            workTimer.classList.remove('status-green', 'status-red', 'status-yellow', 'status-gray');
            
            // Add appropriate status class
            switch (status) {
                case 'login':
                    profileImg.classList.add('status-green');
                    workTimer.classList.add('status-green');
                    workTimer.classList.remove('hidden');
                    break;
                case 'logout':
                    profileImg.classList.add('status-red');
                    workTimer.classList.add('status-red');
                    workTimer.classList.remove('hidden');
                    break;
                case 'shadow':
                    profileImg.classList.add('status-gray');
                    workTimer.classList.add('status-gray');
                    workTimer.classList.remove('hidden');
                    break;
                case 'break':
                    profileImg.classList.add('status-yellow');
                    workTimer.classList.add('status-yellow');
                    workTimer.classList.remove('hidden');
                    break;
            }
            
            // Update current user status
            if (currentUser) {
                currentUser.status = status;
                localStorage.setItem('todoAppCurrentUser', JSON.stringify(currentUser));
                
                // Update in users array
                const userIndex = users.findIndex(u => u.id === currentUser.id);
                if (userIndex !== -1) {
                    users[userIndex].status = status;
                    localStorage.setItem('todoAppUsers', JSON.stringify(users));
                }
            }
        }

        // Timer functionality
        let timerInterval = null;
        let seconds = 0;

        function initializeTimer() {
            if (!currentUser) return;
            
            // Load saved timer value for current status
            seconds = currentUser.workTime[currentUser.status] || 0;
            updateTimerDisplay();
            
            // Start timer for active status
            startTimer();
            
            // Add status button event listeners
            document.querySelectorAll('.status-btn').forEach(btn => {
                btn.addEventListener('click', () => {
                    const newStatus = btn.dataset.status;
                    
                    // Save current timer for current status
                    saveTimerForStatus(currentUser.status);
                    
                    // Update status
                    updateProfileStatus(newStatus);
                    
                    // Reset and start timer for new status
                    resetTimer();
                    seconds = currentUser.workTime[newStatus] || 0;
                    updateTimerDisplay();
                    startTimer();
                    
                    // Close dropdown
                    document.getElementById('profile-dropdown').classList.add('hidden');
                });
            });
        }

        function startTimer() {
            clearInterval(timerInterval);
            
            timerInterval = setInterval(() => {
                seconds++;
                updateTimerDisplay();
                
                // Save every minute
                if (seconds % 60 === 0) {
                    saveTimerForStatus(currentUser.status);
                }
            }, 1000);
        }

        function resetTimer() {
            clearInterval(timerInterval);
            seconds = 0;
            updateTimerDisplay();
        }

        function updateTimerDisplay() {
            document.getElementById('timer-display').textContent = formatTimeFromSeconds(seconds);
        }

        function saveTimerForStatus(status) {
            if (!currentUser) return;
            
            currentUser.workTime[status] = seconds;
            localStorage.setItem('todoAppCurrentUser', JSON.stringify(currentUser));
            
            // Update in users array
            const userIndex = users.findIndex(u => u.id === currentUser.id);
            if (userIndex !== -1) {
                users[userIndex].workTime[status] = seconds;
                localStorage.setItem('todoAppUsers', JSON.stringify(users));
            }
        }

        // Task Management
        let tasks = JSON.parse(localStorage.getItem('todoAppTasks')) || generateSampleTasks();
        let selectedTasks = new Set();
        let filteredTasks = [...tasks];
        let currentFilters = {
            search: '',
            category: '',
            priority: '',
            status: '',
            dateRange: { type: '', from: null, to: null }
        };
        
        function generateSampleTasks() {
            const sampleTasks = [
                {
                    id: generateUUID(),
                    title: 'Complete Project Proposal',
                    description: 'Finalize the project proposal document with all requirements and deliverables.',
                    priority: 'high',
                    dueDate: new Date(Date.now() + 24 * 60 * 60 * 1000).toISOString().split('T')[0], // Tomorrow
                    category: 'work',
                    assignedTo: 'self',
                    assigneeName: 'John Doe',
                    assigneeImage: 'https://i.imgur.com/8Km9tLL.jpg',
                    status: 'active',
                    completed: false,
                    subtasks: [
                        { id: generateUUID(), text: 'Gather requirements', completed: true },
                        { id: generateUUID(), text: 'Create outline', completed: true },
                        { id: generateUUID(), text: 'Write executive summary', completed: false }
                    ],
                    notes: 'Need to include budget estimates and timeline',
                    createdAt: new Date().toISOString(),
                    updatedAt: new Date().toISOString(),
                    workTime: 0
                },
                {
                    id: generateUUID(),
                    title: 'Client Meeting Preparation',
                    description: 'Prepare presentation and materials for the client meeting.',
                    priority: 'high',
                    dueDate: new Date(Date.now() + 2 * 24 * 60 * 60 * 1000).toISOString().split('T')[0], // Day after tomorrow
                    category: 'work',
                    assignedTo: 'self',
                    assigneeName: 'John Doe',
                    assigneeImage: 'https://i.imgur.com/8Km9tLL.jpg',
                    status: 'active',
                    completed: false,
                    subtasks: [
                        { id: generateUUID(), text: 'Create presentation slides', completed: false },
                        { id: generateUUID(), text: 'Prepare demo', completed: false }
                    ],
                    notes: 'Focus on new features and benefits',
                    createdAt: new Date().toISOString(),
                    updatedAt: new Date().toISOString(),
                    workTime: 0
                },
                {
                    id: generateUUID(),
                    title: 'Weekly Team Review',
                    description: 'Review progress with the team and address any blockers.',
                    priority: 'medium',
                    dueDate: new Date(Date.now() + 5 * 24 * 60 * 60 * 1000).toISOString().split('T')[0], // 5 days from now
                    category: 'work',
                    assignedTo: 'user1',
                    assigneeName: 'Sarah Johnson',
                    assigneeImage: 'https://i.imgur.com/7D7I6dI.jpg',
                    status: 'active',
                    completed: false,
                    subtasks: [
                        { id: generateUUID(), text: 'Collect status updates', completed: true },
                        { id: generateUUID(), text: 'Prepare agenda', completed: false }
                    ],
                    notes: 'Include time for Q&A',
                    createdAt: new Date().toISOString(),
                    updatedAt: new Date().toISOString(),
                    workTime: 0
                },
                {
                    id: generateUUID(),
                    title: 'Database Migration',
                    description: 'Migrate data from old database to new system.',
                    priority: 'high',
                    dueDate: new Date(Date.now() - 1 * 24 * 60 * 60 * 1000).toISOString().split('T')[0], // Yesterday (expired)
                    category: 'work',
                    assignedTo: 'user2',
                    assigneeName: 'Michael Smith',
                    assigneeImage: 'https://i.imgur.com/0PmCB5v.jpg',
                    status: 'completed',
                    completed: true,
                    subtasks: [
                        { id: generateUUID(), text: 'Create backup', completed: true },
                        { id: generateUUID(), text: 'Run migration script', completed: true },
                        { id: generateUUID(), text: 'Verify data integrity', completed: true }
                    ],
                    notes: 'Critical task - ensure all validations pass',
                    createdAt: new Date().toISOString(),
                    updatedAt: new Date().toISOString(),
                    workTime: 7200 // 2 hours
                },
                {
                    id: generateUUID(),
                    title: 'Update Documentation',
                    description: 'Update user documentation with new features.',
                    priority: 'medium',
                    dueDate: new Date(Date.now() + 7 * 24 * 60 * 60 * 1000).toISOString().split('T')[0], // 7 days from now
                    category: 'work',
                    assignedTo: 'user3',
                    assigneeName: 'Emily Davis',
                    assigneeImage: 'https://i.imgur.com/v4crorW.jpg',
                    status: 'active',
                    completed: false,
                    subtasks: [
                        { id: generateUUID(), text: 'Update user guide', completed: false },
                        { id: generateUUID(), text: 'Create video tutorials', completed: false }
                    ],
                    notes: 'Focus on simplicity and clarity',
                    createdAt: new Date().toISOString(),
                    updatedAt: new Date().toISOString(),
                    workTime: 0
                },
                {
                    id: generateUUID(),
                    title: 'Website Redesign',
                    description: 'Redesign company website with new branding.',
                    priority: 'medium',
                    dueDate: new Date(Date.now() + 1 * 24 * 60 * 60 * 1000).toISOString().split('T')[0], // Tomorrow
                    category: 'work',
                    assignedTo: 'user4',
                    assigneeName: 'David Wilson',
                    assigneeImage: 'https://i.imgur.com/HvdkPgJ.jpg',
                    status: 'active',
                    completed: false,
                    subtasks: [
                        { id: generateUUID(), text: 'Create wireframes', completed: true },
                        { id: generateUUID(), text: 'Design mockups', completed: false },
                        { id: generateUUID(), text: 'Implement new design', completed: false }
                    ],
                    notes: 'Follow brand guidelines strictly',
                    createdAt: new Date().toISOString(),
                    updatedAt: new Date().toISOString(),
                    workTime: 3600 // 1 hour
                },
                {
                    id: generateUUID(),
                    title: 'Gym Workout',
                    description: 'Complete weekly workout routine.',
                    priority: 'low',
                    dueDate: new Date(Date.now() + 1 * 24 * 60 * 60 * 1000).toISOString().split('T')[0], // Tomorrow
                    category: 'health',
                    assignedTo: 'self',
                    assigneeName: 'John Doe',
                    assigneeImage: 'https://i.imgur.com/8Km9tLL.jpg',
                    status: 'active',
                    completed: false,
                    subtasks: [
                        { id: generateUUID(), text: 'Cardio - 30 minutes', completed: false },
                        { id: generateUUID(), text: 'Weight training', completed: false }
                    ],
                    notes: 'Focus on proper form',
                    createdAt: new Date().toISOString(),
                    updatedAt: new Date().toISOString(),
                    workTime: 0
                },
                {
                    id: generateUUID(),
                    title: 'Read Book',
                    description: 'Finish reading "The Productivity Project".',
                    priority: 'low',
                    dueDate: new Date(Date.now() + 14 * 24 * 60 * 60 * 1000).toISOString().split('T')[0], // 14 days from now
                    category: 'personal',
                    assignedTo: 'self',
                    assigneeName: 'John Doe',
                    assigneeImage: 'https://i.imgur.com/8Km9tLL.jpg',
                    status: 'active',
                    completed: false,
                    subtasks: [
                        { id: generateUUID(), text: 'Read chapters 1-5', completed: true },
                        { id: generateUUID(), text: 'Read chapters 6-10', completed: false },
                        { id: generateUUID(), text: 'Take notes on key concepts', completed: false }
                    ],
                    notes: 'Apply learnings to daily routine',
                    createdAt: new Date().toISOString(),
                    updatedAt: new Date().toISOString(),
                    workTime: 1800 // 30 minutes
                },
                {
                    id: generateUUID(),
                    title: 'Learn React Hooks',
                    description: 'Complete tutorial on React Hooks and functional components.',
                    priority: 'medium',
                    dueDate: new Date(Date.now() + 10 * 24 * 60 * 60 * 1000).toISOString().split('T')[0], // 10 days from now
                    category: 'learning',
                    assignedTo: 'self',
                    assigneeName: 'John Doe',
                    assigneeImage: 'https://i.imgur.com/8Km9tLL.jpg',
                    status: 'active',
                    completed: false,
                    subtasks: [
                        { id: generateUUID(), text: 'Learn useState and useEffect', completed: true },
                        { id: generateUUID(), text: 'Learn useContext and useReducer', completed: false },
                        { id: generateUUID(), text: 'Build practice project', completed: false }
                    ],
                    notes: 'Focus on practical applications',
                    createdAt: new Date().toISOString(),
                    updatedAt: new Date().toISOString(),
                    workTime: 0
                },
                {
                    id: generateUUID(),
                    title: 'Home Cleaning',
                    description: 'Clean and organize the house.',
                    priority: 'low',
                    dueDate: new Date(Date.now() + 3 * 24 * 60 * 60 * 1000).toISOString().split('T')[0], // 3 days from now
                    category: 'home',
                    assignedTo: 'self',
                    assigneeName: 'John Doe',
                    assigneeImage: 'https://i.imgur.com/8Km9tLL.jpg',
                    status: 'completed',
                    completed: true,
                    subtasks: [
                        { id: generateUUID(), text: 'Clean kitchen', completed: true },
                        { id: generateUUID(), text: 'Vacuum living room', completed: true },
                        { id: generateUUID(), text: 'Organize closet', completed: true }
                    ],
                    notes: 'Donate unused items',
                    createdAt: new Date().toISOString(),
                    updatedAt: new Date().toISOString(),
                    workTime: 7200 // 2 hours
                },
                {
                    id: generateUUID(),
                    title: 'Budget Planning',
                    description: 'Review and plan monthly budget.',
                    priority: 'high',
                    dueDate: new Date(Date.now() + 2 * 24 * 60 * 60 * 1000).toISOString().split('T')[0], // 2 days from now
                    category: 'personal',
                    assignedTo: 'self',
                    assigneeName: 'John Doe',
                    assigneeImage: 'https://i.imgur.com/8Km9tLL.jpg',
                    status: 'active',
                    completed: false,
                    subtasks: [
                        { id: generateUUID(), text: 'Review last month expenses', completed: true },
                        { id: generateUUID(), text: 'Set budget for next month', completed: false },
                        { id: generateUUID(), text: 'Identify savings opportunities', completed: false }
                    ],
                    notes: 'Focus on reducing unnecessary expenses',
                    createdAt: new Date().toISOString(),
                    updatedAt: new Date().toISOString(),
                    workTime: 0
                },
                {
                    id: generateUUID(),
                    title: 'Code Review',
                    description: 'Review pull requests from team members.',
                    priority: 'high',
                    dueDate: new Date(Date.now() + 1 * 24 * 60 * 60 * 1000).toISOString().split('T')[0], // Tomorrow
                    category: 'work',
                    assignedTo: 'self',
                    assigneeName: 'John Doe',
                    assigneeImage: 'https://i.imgur.com/8Km9tLL.jpg',
                    status: 'completed',
                    completed: true,
                    subtasks: [
                        { id: generateUUID(), text: 'Review PR #45', completed: true },
                        { id: generateUUID(), text: 'Review PR #46', completed: true },
                        { id: generateUUID(), text: 'Provide feedback', completed: true }
                    ],
                    notes: 'Focus on code quality and performance',
                    createdAt: new Date().toISOString(),
                    updatedAt: new Date().toISOString(),
                    workTime: 3600 // 1 hour
                }
            ];
            
            localStorage.setItem('todoAppTasks', JSON.stringify(sampleTasks));
            return sampleTasks;
        }

        function initializeTaskManagement() {
            renderTasks();
            updateTaskCounters();
            setupTaskEventListeners();
            
            // Initialize graphs for graph view
            initializeGraphs();
            
            // Initialize work pattern chart in insights
            initializeWorkPatternChart();
        }

        function renderTasks() {
            const tasksContainer = document.getElementById('tasks-container');
            tasksContainer.innerHTML = '';
            
            filteredTasks.forEach(task => {
                const taskElement = createTaskElement(task);
                tasksContainer.appendChild(taskElement);
            });
            
            // Enable drag and drop
            enableDragAndDrop();
            
            // Update multi-select actions visibility
            updateSelectedActionsVisibility();
        }

        function createTaskElement(task) {
            const timeRemaining = getTimeRemaining(task.dueDate);
            
            const taskElement = document.createElement('div');
            taskElement.className = `task-card rounded-lg border border-gray-200 p-4 mb-4 ${task.completed ? 'completed-task' : ''} ${task.priority === 'high' ? 'priority-high' : task.priority === 'medium' ? 'priority-medium' : 'priority-low'}`;
            taskElement.dataset.id = task.id;
            taskElement.draggable = true;
            
            taskElement.innerHTML = `
                <div class="flex items-center">
                    <div class="flex-shrink-0 w-6">
                        <input type="checkbox" class="task-checkbox w-4 h-4 rounded border-gray-300 focus:ring-indigo-500 dark:border-gray-600" 
                            data-id="${task.id}" ${task.completed ? 'checked' : ''}>
                    </div>
                    <div class="ml-4 flex-grow grid grid-cols-5 gap-4">
                        <div>
                            <p class="text-sm font-medium text-gray-900 dark:text-white">${task.title}</p>
                            <p class="text-xs text-gray-500 dark:text-gray-400">${task.category.charAt(0).toUpperCase() + task.category.slice(1)}</p>
                        </div>
                        <div>
                            <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${
                                task.priority === 'high' ? 'bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-200' : 
                                task.priority === 'medium' ? 'bg-yellow-100 text-yellow-800 dark:bg-yellow-900 dark:text-yellow-200' : 
                                'bg-gray-100 text-gray-800 dark:bg-gray-700 dark:text-gray-300'
                            }">
                                ${task.priority.charAt(0).toUpperCase() + task.priority.slice(1)}
                            </span>
                        </div>
                        <div>
                            <p class="text-sm text-gray-900 dark:text-white">${formatDate(task.dueDate)}</p>
                            <p class="text-xs ${
                                timeRemaining.status === 'expired' ? 'due-expired' : 
                                timeRemaining.status === 'soon' ? 'due-soon' : 
                                'due-safe'
                            }">${timeRemaining.text}</p>
                        </div>
                        <div class="flex items-center">
                            <img src="${task.assigneeImage}" alt="${task.assigneeName}" class="w-6 h-6 rounded-full mr-2">
                            <span class="text-sm text-gray-900 dark:text-white">${task.assigneeName}</span>
                        </div>
                        <div>
                            <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${
                                task.completed ? 'bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200' : 
                                'bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-200'
                            }">
                                ${task.completed ? 'Completed' : 'Active'}
                            </span>
                        </div>
                    </div>
                    <div class="flex-shrink-0 flex space-x-2">
                        <button class="task-timer-btn text-indigo-600 hover:text-indigo-900 dark:text-indigo-400 dark:hover:text-indigo-300" title="Track Time" data-id="${task.id}">
                            <i class="fas fa-clock"></i>
                        </button>
                        <button class="task-share-btn text-indigo-600 hover:text-indigo-900 dark:text-indigo-400 dark:hover:text-indigo-300" title="Share" data-id="${task.id}">
                            <i class="fas fa-share-alt"></i>
                        </button>
                        <button class="task-edit-btn text-indigo-600 hover:text-indigo-900 dark:text-indigo-400 dark:hover:text-indigo-300" title="Edit" data-id="${task.id}">
                            <i class="fas fa-edit"></i>
                        </button>
                        <button class="task-delete-btn text-red-600 hover:text-red-900 dark:text-red-400 dark:hover:text-red-300" title="Delete" data-id="${task.id}">
                            <i class="fas fa-trash"></i>
                        </button>
                    </div>
                </div>
            `;
            
            return taskElement;
        }

        function updateTaskCounters() {
            const totalTasks = tasks.length;
            const completedTasks = tasks.filter(task => task.completed).length;
            const pendingTasks = totalTasks - completedTasks;
            
            document.getElementById('total-tasks').textContent = totalTasks;
            document.getElementById('completed-tasks').textContent = completedTasks;
            document.getElementById('pending-tasks').textContent = pendingTasks;
        }

        function setupTaskEventListeners() {
            // Add Task button
            document.getElementById('add-task-btn').addEventListener('click', () => {
                openAddTaskModal();
            });
            
            // Task checkbox (mark complete/incomplete)
            document.getElementById('tasks-container').addEventListener('click', (e) => {
                if (e.target.classList.contains('task-checkbox')) {
                    const taskId = e.target.dataset.id;
                    const isChecked = e.target.checked;
                    
                    updateTaskStatus(taskId, isChecked);
                }
            });
            
            // Task buttons (timer, share, edit, delete)
            document.getElementById('tasks-container').addEventListener('click', (e) => {
                const button = e.target.closest('button');
                if (!button) return;
                
                const taskId = button.dataset.id;
                
                if (button.classList.contains('task-timer-btn')) {
                    toggleTaskTimer(taskId);
                } else if (button.classList.contains('task-share-btn')) {
                    shareTask(taskId);
                } else if (button.classList.contains('task-edit-btn')) {
                    editTask(taskId);
                } else if (button.classList.contains('task-delete-btn')) {
                    deleteTask(taskId);
                }
            });
            
            // Select all tasks
            document.getElementById('select-all-tasks').addEventListener('change', (e) => {
                const isChecked = e.target.checked;
                
                const checkboxes = document.querySelectorAll('.task-checkbox');
                checkboxes.forEach(checkbox => {
                    checkbox.checked = isChecked;
                    const taskId = checkbox.dataset.id;
                    
                    if (isChecked) {
                        selectedTasks.add(taskId);
                    } else {
                        selectedTasks.delete(taskId);
                    }
                });
                
                updateSelectedActionsVisibility();
            });
            
            // Multi-complete button
            document.getElementById('multi-complete-btn').addEventListener('click', () => {
                selectedTasks.forEach(taskId => {
                    updateTaskStatus(taskId, true);
                });
                
                selectedTasks.clear();
                updateSelectedActionsVisibility();
                document.getElementById('select-all-tasks').checked = false;
            });
            
            // Multi-delete button
            document.getElementById('multi-delete-btn').addEventListener('click', () => {
                selectedTasks.forEach(taskId => {
                    deleteTask(taskId, true); // true = skip confirmation for bulk operation
                });
                
                selectedTasks.clear();
                updateSelectedActionsVisibility();
                document.getElementById('select-all-tasks').checked = false;
            });
            
            // Filter inputs
            document.getElementById('task-search').addEventListener('input', applyFilters);
            document.getElementById('filter-category').addEventListener('change', applyFilters);
            document.getElementById('filter-priority').addEventListener('change', applyFilters);
            document.getElementById('filter-status').addEventListener('change', applyFilters);
            document.getElementById('filter-date').addEventListener('change', (e) => {
                const value = e.target.value;
                if (value === 'custom') {
                    document.getElementById('date-range-picker').classList.remove('hidden');
                } else {
                    document.getElementById('date-range-picker').classList.add('hidden');
                    applyFilters();
                }
            });
            
            // Apply custom date range
            document.getElementById('apply-date-range').addEventListener('click', applyFilters);
            
            // Sorting
            document.getElementById('sort-tasks').addEventListener('change', (e) => {
                const sortBy = e.target.value;
                sortTasks(sortBy);
            });
            
            // View toggle
            document.getElementById('list-view-btn').addEventListener('click', () => {
                document.getElementById('list-view-btn').classList.add('text-indigo-600');
                document.getElementById('list-view-btn').classList.remove('text-gray-500');
                document.getElementById('graph-view-btn').classList.add('text-gray-500');
                document.getElementById('graph-view-btn').classList.remove('text-indigo-600');
                
                document.getElementById('tasks-list-view').classList.remove('hidden');
                document.getElementById('tasks-graph-view').classList.add('hidden');
            });
            
            document.getElementById('graph-view-btn').addEventListener('click', () => {
                document.getElementById('graph-view-btn').classList.add('text-indigo-600');
                document.getElementById('graph-view-btn').classList.remove('text-gray-500');
                document.getElementById('list-view-btn').classList.add('text-gray-500');
                document.getElementById('list-view-btn').classList.remove('text-indigo-600');
                
                document.getElementById('tasks-list-view').classList.add('hidden');
                document.getElementById('tasks-graph-view').classList.remove('hidden');
                updateGraphs();
            });
            
            // Import/Export
            document.getElementById('import-btn').addEventListener('click', () => {
                document.getElementById('import-modal').classList.remove('hidden');
            });
            
            document.getElementById('export-btn').addEventListener('click', () => {
                document.getElementById('export-modal').classList.remove('hidden');
            });
            
            // Users button
            document.getElementById('users-btn').addEventListener('click', () => {
                document.getElementById('users-modal').classList.remove('hidden');
                populateUsersModal();
            });
            
            // File input change
            document.getElementById('import-file').addEventListener('change', (e) => {
                const fileName = e.target.files[0]?.name || '';
                if (fileName) {
                    document.getElementById('selected-file-name').textContent = fileName;
                    document.getElementById('selected-file-name').classList.remove('hidden');
                }
            });
            
            // Import submit
            document.getElementById('import-btn-submit').addEventListener('click', () => {
                // Simulate successful import
                const fileInput = document.getElementById('import-file');
                if (fileInput.files.length > 0) {
                    const fileName = fileInput.files[0].name;
                    
                    // In a real app, we would parse the file here
                    // For demo purposes, we'll just add a sample task
                    const newTask = {
                        id: generateUUID(),
                        title: `Imported Task: ${fileName}`,
                        description: 'This task was imported from a file.',
                        priority: 'medium',
                        dueDate: new Date(Date.now() + 7 * 24 * 60 * 60 * 1000).toISOString().split('T')[0],
                        category: 'work',
                        assignedTo: 'self',
                        assigneeName: currentUser.name,
                        assigneeImage: currentUser.profileImage,
                        status: 'active',
                        completed: false,
                        subtasks: [],
                        notes: `Imported from ${fileName} on ${new Date().toLocaleString()}`,
                        createdAt: new Date().toISOString(),
                        updatedAt: new Date().toISOString(),
                        workTime: 0
                    };
                    
                    tasks.unshift(newTask);
                    localStorage.setItem('todoAppTasks', JSON.stringify(tasks));
                    
                    // Close modal and refresh tasks
                    document.getElementById('import-modal').classList.add('hidden');
                    
                    // Reset file input
                    fileInput.value = '';
                    document.getElementById('selected-file-name').classList.add('hidden');
                    
                    // Apply current filters and render
                    applyFilters();
                    updateTaskCounters();
                    
                    // Show notification
                    showNotification(`Task imported: ${fileName}`);
                }
            });
            
            // Export submit
            document.getElementById('export-btn-submit').addEventListener('click', () => {
                // Determine which format was selected
                const selectedFormat = document.querySelector('.export-format-btn[data-format].ring-2')?.dataset.format || 'json';
                
                // Determine which data to export
                const exportData = document.querySelector('input[name="export-data"]:checked').value;
                
                let tasksToExport;
                if (exportData === 'all') {
                    tasksToExport = tasks;
                } else if (exportData === 'filtered') {
                    tasksToExport = filteredTasks;
                } else if (exportData === 'selected') {
                    tasksToExport = tasks.filter(task => selectedTasks.has(task.id));
                }
                
                // In a real app, we would format the data and trigger a download
                // For demo purposes, we'll just show a notification
                
                showNotification(`${tasksToExport.length} tasks exported as ${selectedFormat.toUpperCase()}`);
                
                // Close modal
                document.getElementById('export-modal').classList.add('hidden');
            });
            
            // Export format selection
            document.querySelectorAll('.export-format-btn').forEach(btn => {
                btn.addEventListener('click', () => {
                    // Remove selection from all buttons
                    document.querySelectorAll('.export-format-btn').forEach(b => {
                        b.classList.remove('ring-2', 'ring-indigo-500');
                    });
                    
                    // Add selection to clicked button
                    btn.classList.add('ring-2', 'ring-indigo-500');
                });
            });
            
            // Close all modals
            document.querySelectorAll('.close-modal').forEach(btn => {
                btn.addEventListener('click', () => {
                    document.querySelectorAll('.fixed.inset-0').forEach(modal => {
                        modal.classList.add('hidden');
                    });
                });
            });
            
            // Add subtask button
            document.getElementById('add-subtask-btn').addEventListener('click', () => {
                addSubtaskInput();
            });
            
            // Add task form submission
            document.getElementById('add-task-form').addEventListener('submit', (e) => {
                e.preventDefault();
                
                const title = document.getElementById('task-title').value;
                const description = document.getElementById('task-description').value;
                const category = document.getElementById('task-category').value;
                const priority = document.getElementById('task-priority').value;
                const dueDate = document.getElementById('task-due-date').value;
                const assignTo = document.getElementById('task-assign').value;
                const notes = document.getElementById('task-notes').value;
                
                // Get subtasks
                const subtasks = [];
                document.querySelectorAll('.subtask-input').forEach(input => {
                    if (input.value.trim()) {
                        subtasks.push({
                            id: generateUUID(),
                            text: input.value.trim(),
                            completed: false
                        });
                    }
                });
                
                // Get assignee details
                let assigneeName, assigneeImage;
                if (assignTo === 'self') {
                    assigneeName = currentUser.name;
                    assigneeImage = currentUser.profileImage;
                } else {
                    // In a real app, we would get this from a user database
                    // For demo purposes, we'll use the sample users
                    const assigneeOptions = {
                        user1: { name: 'Sarah Johnson', image: 'https://i.imgur.com/7D7I6dI.jpg' },
                        user2: { name: 'Michael Smith', image: 'https://i.imgur.com/0PmCB5v.jpg' },
                        user3: { name: 'Emily Davis', image: 'https://i.imgur.com/v4crorW.jpg' },
                        user4: { name: 'David Wilson', image: 'https://i.imgur.com/HvdkPgJ.jpg' }
                    };
                    
                    assigneeName = assigneeOptions[assignTo].name;
                    assigneeImage = assigneeOptions[assignTo].image;
                }
                
                // Create new task
                const newTask = {
                    id: generateUUID(),
                    title,
                    description,
                    priority,
                    dueDate,
                    category,
                    assignedTo: assignTo,
                    assigneeName,
                    assigneeImage,
                    status: 'active',
                    completed: false,
                    subtasks,
                    notes,
                    createdAt: new Date().toISOString(),
                    updatedAt: new Date().toISOString(),
                    workTime: 0
                };
                
                // Add task to list
                tasks.unshift(newTask);
                localStorage.setItem('todoAppTasks', JSON.stringify(tasks));
                
                // Close modal and refresh tasks
                document.getElementById('add-task-modal').classList.add('hidden');
                
                // Reset form
                document.getElementById('add-task-form').reset();
                document.getElementById('subtask-items').innerHTML = '';
                
                // Apply current filters and render
                applyFilters();
                updateTaskCounters();
                
                // Show notification
                showNotification(`Task added: ${title}`);
            });
            
            // Profile dropdown
            document.getElementById('profile-btn').addEventListener('click', () => {
                document.getElementById('profile-dropdown').classList.toggle('hidden');
            });
            
            // Notification dropdown
            document.getElementById('notification-btn').addEventListener('click', () => {
                document.getElementById('notification-dropdown').classList.toggle('hidden');
            });
            
            // View profile
            document.getElementById('view-profile-btn').addEventListener('click', () => {
                document.getElementById('profile-modal').classList.remove('hidden');
                document.getElementById('profile-dropdown').classList.add('hidden');
            });
            
            // Edit profile form
            document.getElementById('edit-profile-form').addEventListener('submit', (e) => {
                e.preventDefault();
                
                // Update user info
                currentUser.name = document.getElementById('profile-name').value;
                currentUser.email = document.getElementById('profile-email-input').value;
                currentUser.phone = document.getElementById('profile-phone').value;
                currentUser.country = document.getElementById('profile-country').value;
                
                // Check if password was changed
                const newPassword = document.getElementById('new-password').value;
                if (newPassword) {
                    currentUser.password = newPassword;
                }
                
                // Update in localStorage
                localStorage.setItem('todoAppCurrentUser', JSON.stringify(currentUser));
                
                // Update in users array
                const userIndex = users.findIndex(u => u.id === currentUser.id);
                if (userIndex !== -1) {
                    users[userIndex] = { ...currentUser };
                    localStorage.setItem('todoAppUsers', JSON.stringify(users));
                }
                
                // Update UI
                updateUserInfo();
                
                // Close modal
                document.getElementById('profile-modal').classList.add('hidden');
                
                // Show notification
                showNotification('Profile updated successfully');
            });
            
            // Change password toggle
            document.getElementById('change-password-btn').addEventListener('click', () => {
                document.getElementById('change-password-section').classList.toggle('hidden');
            });
            
            // Change profile picture
            document.getElementById('change-profile-pic').addEventListener('click', () => {
                document.getElementById('profile-pic-input').click();
            });
            
            // Profile picture input change
            document.getElementById('profile-pic-input').addEventListener('change', (e) => {
                const file = e.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = function(event) {
                        const imgSrc = event.target.result;
                        document.getElementById('profile-modal-img').src = imgSrc;
                        document.getElementById('profile-img').src = imgSrc;
                        
                        // Update currentUser
                        currentUser.profileImage = imgSrc;
                        localStorage.setItem('todoAppCurrentUser', JSON.stringify(currentUser));
                        
                        // Update in users array
                        const userIndex = users.findIndex(u => u.id === currentUser.id);
                        if (userIndex !== -1) {
                            users[userIndex].profileImage = imgSrc;
                            localStorage.setItem('todoAppUsers', JSON.stringify(users));
                        }
                    };
                    reader.readAsDataURL(file);
                }
            });
            
            // Close dropdowns when clicking outside
            document.addEventListener('click', (e) => {
                // Profile dropdown
                if (!e.target.closest('#profile-btn') && !e.target.closest('#profile-dropdown')) {
                    document.getElementById('profile-dropdown').classList.add('hidden');
                }
                
                // Notification dropdown
                if (!e.target.closest('#notification-btn') && !e.target.closest('#notification-dropdown')) {
                    document.getElementById('notification-dropdown').classList.add('hidden');
                }
            });
        }

        function updateSelectedActionsVisibility() {
            const selectedCount = selectedTasks.size;
            const selectedActions = document.getElementById('selected-actions');
            const selectedCountEl = document.getElementById('selected-count');
            
            if (selectedCount > 0) {
                selectedActions.classList.remove('hidden');
                selectedCountEl.textContent = selectedCount;
            } else {
                selectedActions.classList.add('hidden');
            }
        }

        function openAddTaskModal() {
            document.getElementById('add-task-modal').classList.remove('hidden');
            document.getElementById('task-title').focus();
            
            // Set default due date to tomorrow
            const tomorrow = new Date();
            tomorrow.setDate(tomorrow.getDate() + 1);
            document.getElementById('task-due-date').value = tomorrow.toISOString().split('T')[0];
            
            // Clear any existing subtasks
            document.getElementById('subtask-items').innerHTML = '';
            
            // Add one empty subtask input by default
            addSubtaskInput();
        }

        function addSubtaskInput() {
            const subtaskItems = document.getElementById('subtask-items');
            const subtaskId = `subtask-${Date.now()}`;
            
            const subtaskItem = document.createElement('div');
            subtaskItem.className = 'flex items-center';
            subtaskItem.innerHTML = `
                <input type="text" id="${subtaskId}" class="subtask-input flex-grow border border-gray-300 rounded-md shadow-sm px-3 py-2 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 text-base dark:bg-gray-700 dark:border-gray-600" placeholder="Enter subtask">
                <button type="button" class="remove-subtask-btn ml-2 text-red-600 hover:text-red-800 dark:text-red-400 dark:hover:text-red-300">
                    <i class="fas fa-times"></i>
                </button>
            `;
            
            subtaskItems.appendChild(subtaskItem);
            
            // Focus on new input
            document.getElementById(subtaskId).focus();
            
            // Add remove button handler
            subtaskItem.querySelector('.remove-subtask-btn').addEventListener('click', () => {
                subtaskItem.remove();
            });
        }

        function updateTaskStatus(taskId, completed) {
            // Find the task
            const taskIndex = tasks.findIndex(t => t.id === taskId);
            if (taskIndex === -1) return;
            
            // Update task status
            tasks[taskIndex].completed = completed;
            tasks[taskIndex].status = completed ? 'completed' : 'active';
            tasks[taskIndex].updatedAt = new Date().toISOString();
            
            // Save to localStorage
            localStorage.setItem('todoAppTasks', JSON.stringify(tasks));
            
            // Find the task element
            const taskElement = document.querySelector(`.task-card[data-id="${taskId}"]`);
            if (taskElement) {
                if (completed) {
                    taskElement.classList.add('completed-task');
                } else {
                    taskElement.classList.remove('completed-task');
                }
                
                // Update the status display
                const statusEl = taskElement.querySelector('.task-card span:last-of-type');
                if (statusEl) {
                    statusEl.textContent = completed ? 'Completed' : 'Active';
                    statusEl.className = `inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${
                        completed ? 'bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200' : 
                        'bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-200'
                    }`;
                }
            }
            
            // Update task counters
            updateTaskCounters();
            
            // Update graphs if they're showing
            if (!document.getElementById('tasks-graph-view').classList.contains('hidden')) {
                updateGraphs();
            }
            
            // Show notification
            showNotification(`Task ${completed ? 'completed' : 'marked as active'}: ${tasks[taskIndex].title}`);
        }

        function toggleTaskTimer(taskId) {
            // Find the task
            const taskIndex = tasks.findIndex(t => t.id === taskId);
            if (taskIndex === -1) return;
            
            // In a real app, we would start/stop a timer here
            // For demo purposes, we'll just increment the work time by a random amount
            const incrementMinutes = Math.floor(Math.random() * 30) + 15; // 15-45 minutes
            tasks[taskIndex].workTime += incrementMinutes * 60;
            
            // Save to localStorage
            localStorage.setItem('todoAppTasks', JSON.stringify(tasks));
            
            // Show notification
            showNotification(`Added ${incrementMinutes} minutes to task: ${tasks[taskIndex].title}`);
        }

        function shareTask(taskId) {
            // Find the task
            const taskIndex = tasks.findIndex(t => t.id === taskId);
            if (taskIndex === -1) return;
            
            // In a real app, we would open a share dialog here
            // For demo purposes, we'll just show a notification
            showNotification(`Shared task: ${tasks[taskIndex].title}`);
        }

        function editTask(taskId) {
            // In a real app, we would populate the form with task data
            // For demo purposes, we'll open the add task modal
            openAddTaskModal();
            
            // Find the task
            const taskIndex = tasks.findIndex(t => t.id === taskId);
            if (taskIndex === -1) return;
            
            const task = tasks[taskIndex];
            
            // Populate form fields
            document.getElementById('task-title').value = task.title;
            document.getElementById('task-description').value = task.description;
            document.getElementById('task-category').value = task.category;
            document.getElementById('task-priority').value = task.priority;
            document.getElementById('task-due-date').value = task.dueDate;
            document.getElementById('task-assign').value = task.assignedTo;
            document.getElementById('task-notes').value = task.notes;
            
            // Populate subtasks
            document.getElementById('subtask-items').innerHTML = '';
            task.subtasks.forEach(subtask => {
                const subtaskItems = document.getElementById('subtask-items');
                const subtaskId = `subtask-${Date.now()}-${Math.random().toString(36).substr(2, 5)}`;
                
                const subtaskItem = document.createElement('div');
                subtaskItem.className = 'flex items-center';
                subtaskItem.innerHTML = `
                    <input type="text" id="${subtaskId}" class="subtask-input flex-grow border border-gray-300 rounded-md shadow-sm px-3 py-2 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 text-base dark:bg-gray-700 dark:border-gray-600" value="${subtask.text}" placeholder="Enter subtask">
                    <button type="button" class="remove-subtask-btn ml-2 text-red-600 hover:text-red-800 dark:text-red-400 dark:hover:text-red-300">
                        <i class="fas fa-times"></i>
                    </button>
                `;
                
                subtaskItems.appendChild(subtaskItem);
                
                // Add remove button handler
                subtaskItem.querySelector('.remove-subtask-btn').addEventListener('click', () => {
                    subtaskItem.remove();
                });
            });
            
            // When the form is submitted, we'll need to update the task instead of creating a new one
            const addTaskForm = document.getElementById('add-task-form');
            const originalSubmit = addTaskForm.onsubmit;
            
            addTaskForm.onsubmit = (e) => {
                e.preventDefault();
                
                // Get form values
                const title = document.getElementById('task-title').value;
                const description = document.getElementById('task-description').value;
                const category = document.getElementById('task-category').value;
                const priority = document.getElementById('task-priority').value;
                const dueDate = document.getElementById('task-due-date').value;
                const assignTo = document.getElementById('task-assign').value;
                const notes = document.getElementById('task-notes').value;
                
                // Get subtasks
                const subtasks = [];
                document.querySelectorAll('.subtask-input').forEach(input => {
                    if (input.value.trim()) {
                        subtasks.push({
                            id: generateUUID(),
                            text: input.value.trim(),
                            completed: false
                        });
                    }
                });
                
                // Get assignee details
                let assigneeName, assigneeImage;
                if (assignTo === 'self') {
                    assigneeName = currentUser.name;
                    assigneeImage = currentUser.profileImage;
                } else {
                    // In a real app, we would get this from a user database
                    // For demo purposes, we'll use the sample users
                    const assigneeOptions = {
                        user1: { name: 'Sarah Johnson', image: 'https://i.imgur.com/7D7I6dI.jpg' },
                        user2: { name: 'Michael Smith', image: 'https://i.imgur.com/0PmCB5v.jpg' },
                        user3: { name: 'Emily Davis', image: 'https://i.imgur.com/v4crorW.jpg' },
                        user4: { name: 'David Wilson', image: 'https://i.imgur.com/HvdkPgJ.jpg' }
                    };
                    
                    assigneeName = assigneeOptions[assignTo].name;
                    assigneeImage = assigneeOptions[assignTo].image;
                }
                
                // Update task
                tasks[taskIndex] = {
                    ...tasks[taskIndex],
                    title,
                    description,
                    priority,
                    dueDate,
                    category,
                    assignedTo: assignTo,
                    assigneeName,
                    assigneeImage,
                    subtasks,
                    notes,
                    updatedAt: new Date().toISOString()
                };
                
                // Save to localStorage
                localStorage.setItem('todoAppTasks', JSON.stringify(tasks));
                
                // Close modal and refresh tasks
                document.getElementById('add-task-modal').classList.add('hidden');
                
                // Reset form
                document.getElementById('add-task-form').reset();
                document.getElementById('subtask-items').innerHTML = '';
                
                // Restore original submit handler
                addTaskForm.onsubmit = originalSubmit;
                
                // Apply current filters and render
                applyFilters();
                updateTaskCounters();
                
                // Show notification
                showNotification(`Task updated: ${title}`);
            };
        }

        function deleteTask(taskId, skipConfirmation = false) {
            // Find the task
            const taskIndex = tasks.findIndex(t => t.id === taskId);
            if (taskIndex === -1) return;
            
            const taskTitle = tasks[taskIndex].title;
            
            // In a real app, we would show a confirmation dialog
            // For demo purposes, we'll skip that for bulk operations
            if (!skipConfirmation) {
                if (!confirm(`Are you sure you want to delete task: ${taskTitle}?`)) {
                    return;
                }
            }
            
            // Remove task
            tasks.splice(taskIndex, 1);
            
            // Save to localStorage
            localStorage.setItem('todoAppTasks', JSON.stringify(tasks));
            
            // Apply current filters and render
            applyFilters();
            updateTaskCounters();
            
            // Update selected tasks set
            selectedTasks.delete(taskId);
            updateSelectedActionsVisibility();
            
            // Show notification
            showNotification(`Task deleted: ${taskTitle}`);
        }

        function applyFilters() {
            const searchText = document.getElementById('task-search').value.toLowerCase();
            const category = document.getElementById('filter-category').value;
            const priority = document.getElementById('filter-priority').value;
            const status = document.getElementById('filter-status').value;
            const dateFilter = document.getElementById('filter-date').value;
            
            // Save current filters
            currentFilters = {
                search: searchText,
                category,
                priority,
                status,
                dateRange: { type: dateFilter }
            };
            
            // Apply search and category/priority/status filters
            filteredTasks = tasks.filter(task => {
                // Search text
                const matchesSearch = task.title.toLowerCase().includes(searchText) || 
                                     task.description.toLowerCase().includes(searchText);
                
                // Category
                const matchesCategory = !category || task.category === category;
                
                // Priority
                const matchesPriority = !priority || task.priority === priority;
                
                // Status
                const matchesStatus = !status || 
                                     (status === 'completed' && task.completed) || 
                                     (status === 'active' && !task.completed);
                
                // Date filter
                let matchesDate = true;
                const taskDate = new Date(task.dueDate);
                
                if (dateFilter === 'today') {
                    const today = new Date();
                    matchesDate = taskDate.setHours(0, 0, 0, 0) === today.setHours(0, 0, 0, 0);
                } else if (dateFilter === 'week') {
                    const today = new Date();
                    const nextWeek = new Date(today);
                    nextWeek.setDate(today.getDate() + 7);
                    
                    matchesDate = taskDate >= today.setHours(0, 0, 0, 0) && taskDate <= nextWeek.setHours(23, 59, 59, 999);
                } else if (dateFilter === 'month') {
                    const today = new Date();
                    const nextMonth = new Date(today);
                    nextMonth.setMonth(today.getMonth() + 1);
                    
                    matchesDate = taskDate >= today.setHours(0, 0, 0, 0) && taskDate <= nextMonth.setHours(23, 59, 59, 999);
                } else if (dateFilter === 'custom') {
                    const fromDate = document.getElementById('date-from').value;
                    const toDate = document.getElementById('date-to').value;
                    
                    if (fromDate && toDate) {
                        // Save custom date range
                        currentFilters.dateRange.from = fromDate;
                        currentFilters.dateRange.to = toDate;
                        
                        const from = new Date(fromDate);
                        const to = new Date(toDate);
                        to.setHours(23, 59, 59, 999);
                        
                        matchesDate = taskDate >= from && taskDate <= to;
                    }
                }
                
                return matchesSearch && matchesCategory && matchesPriority && matchesStatus && matchesDate;
            });
            
            // Apply current sort
            const sortBy = document.getElementById('sort-tasks').value;
            sortTasks(sortBy, false); // false = don't render (we'll do it after sorting)
            
            // Render filtered tasks
            renderTasks();
        }

        function sortTasks(sortBy, shouldRender = true) {
            switch (sortBy) {
                case 'dueDate':
                    filteredTasks.sort((a, b) => new Date(a.dueDate) - new Date(b.dueDate));
                    break;
                case 'priority':
                    const priorityOrder = { high: 1, medium: 2, low: 3 };
                    filteredTasks.sort((a, b) => priorityOrder[a.priority] - priorityOrder[b.priority]);
                    break;
                case 'title':
                    filteredTasks.sort((a, b) => a.title.localeCompare(b.title));
                    break;
                case 'status':
                    filteredTasks.sort((a, b) => (a.completed === b.completed) ? 0 : a.completed ? 1 : -1);
                    break;
                case 'createdAt':
                    filteredTasks.sort((a, b) => new Date(b.createdAt) - new Date(a.createdAt));
                    break;
            }
            
            if (shouldRender) {
                renderTasks();
            }
        }

        function enableDragAndDrop() {
            const taskElements = document.querySelectorAll('.task-card');
            const tasksContainer = document.getElementById('tasks-container');
            
            taskElements.forEach(task => {
                task.addEventListener('dragstart', (e) => {
                    e.dataTransfer.setData('text/plain', task.dataset.id);
                    task.classList.add('task-dragging');
                    
                    // Prevent dragging when certain elements are clicked
                    const target = e.target;
                    if (target.closest('input[type="checkbox"]') || 
                        target.closest('button')) {
                        e.preventDefault();
                    }
                });
                
                task.addEventListener('dragend', () => {
                    task.classList.remove('task-dragging');
                });
            });
            
            tasksContainer.addEventListener('dragover', (e) => {
                e.preventDefault();
                const afterElement = getDragAfterElement(tasksContainer, e.clientY);
                const dragging = document.querySelector('.task-dragging');
                
                if (afterElement) {
                    tasksContainer.insertBefore(dragging, afterElement);
                } else {
                    tasksContainer.appendChild(dragging);
                }
            });
            
            tasksContainer.addEventListener('drop', (e) => {
                e.preventDefault();
                const taskId = e.dataTransfer.getData('text/plain');
                const draggedTaskElement = document.querySelector(`.task-card[data-id="${taskId}"]`);
                
                if (draggedTaskElement) {
                    draggedTaskElement.classList.remove('task-dragging');
                    
                    // Get all task elements in their new order
                    const taskElements = tasksContainer.querySelectorAll('.task-card');
                    const newOrder = Array.from(taskElements).map(el => el.dataset.id);
                    
                    // Create a new filtered tasks array based on the new order
                    const newFilteredTasks = newOrder.map(id => filteredTasks.find(task => task.id === id));
                    filteredTasks = newFilteredTasks;
                    
                    // Find the tasks in the full tasks array and update their order
                    const newTasks = [];
                    
                    // First add all tasks that are in the filtered view in their new order
                    newOrder.forEach(id => {
                        const task = tasks.find(t => t.id === id);
                        if (task) {
                            newTasks.push(task);
                        }
                    });
                    
                    // Then add all tasks that are not in the filtered view
                    tasks.forEach(task => {
                        if (!newOrder.includes(task.id)) {
                            newTasks.push(task);
                        }
                    });
                    
                    tasks = newTasks;
                    localStorage.setItem('todoAppTasks', JSON.stringify(tasks));
                    
                    // Show notification
                    showNotification('Task order updated');
                }
            });
        }

        function getDragAfterElement(container, y) {
            const draggableElements = [...container.querySelectorAll('.task-card:not(.task-dragging)')];
            
            return draggableElements.reduce((closest, child) => {
                const box = child.getBoundingClientRect();
                const offset = y - box.top - box.height / 2;
                
                if (offset < 0 && offset > closest.offset) {
                    return { offset, element: child };
                } else {
                    return closest;
                }
            }, { offset: Number.NEGATIVE_INFINITY }).element;
        }

        function showNotification(message) {
            // In a real app, we would use a proper notification system
            // For demo purposes, we'll add a new notification to the dropdown
            
            const now = new Date();
            const timeText = 'Just now';
            
            const notificationItem = document.createElement('div');
            notificationItem.className = 'notification-item p-4 border-b border-gray-200 dark:border-gray-600';
            notificationItem.innerHTML = `
                <p class="text-sm text-gray-700 dark:text-gray-300">${message}</p>
                <p class="text-xs text-gray-500 dark:text-gray-400 mt-1">${timeText}</p>
            `;
            
            const notificationContainer = document.getElementById('notification-dropdown').querySelector('.max-h-72');
            notificationContainer.insertBefore(notificationItem, notificationContainer.firstChild);
            
            // Update notification count
            const countElement = document.getElementById('notification-count');
            const currentCount = parseInt(countElement.textContent);
            countElement.textContent = currentCount + 1;
            
            // Add click handler to mark as read
            notificationItem.addEventListener('click', () => {
                const currentCount = parseInt(countElement.textContent);
                if (currentCount > 0) {
                    countElement.textContent = currentCount - 1;
                }
                notificationItem.remove();
            });
        }

        function populateUsersModal() {
            const usersList = document.getElementById('users-list');
            usersList.innerHTML = '';
            
            // Get some random users
            const randomUsers = generateRandomUsers();
            
            randomUsers.forEach(user => {
                const userCard = document.createElement('div');
                userCard.className = 'bg-white p-4 rounded-lg border border-gray-200 flex items-center dark:bg-gray-700 dark:border-gray-600';
                userCard.innerHTML = `
                    <img src="${user.image}" alt="${user.name}" class="w-12 h-12 rounded-full object-cover">
                    <div class="ml-4">
                        <h3 class="text-lg font-medium text-gray-900 dark:text-white">${user.name}</h3>
                        <p class="text-sm text-gray-500 dark:text-gray-400">${user.role}</p>
                        <p class="text-sm text-gray-500 dark:text-gray-400">${user.email}</p>
                    </div>
                `;
                
                usersList.appendChild(userCard);
            });
        }

        function generateRandomUsers() {
            const randomUsers = [
                {
                    name: 'Sarah Johnson',
                    email: 'sarah@example.com',
                    role: 'Designer',
                    image: 'https://i.imgur.com/7D7I6dI.jpg'
                },
                {
                    name: 'Michael Smith',
                    email: 'michael@example.com',
                    role: 'Developer',
                    image: 'https://i.imgur.com/0PmCB5v.jpg'
                },
                {
                    name: 'Emily Davis',
                    email: 'emily@example.com',
                    role: 'Project Manager',
                    image: 'https://i.imgur.com/v4crorW.jpg'
                },
                {
                    name: 'David Wilson',
                    email: 'david@example.com',
                    role: 'Marketing',
                    image: 'https://i.imgur.com/HvdkPgJ.jpg'
                },
                {
                    name: 'Jessica Brown',
                    email: 'jessica@example.com',
                    role: 'Designer',
                    image: 'https://i.imgur.com/bLizzaA.jpg'
                },
                {
                    name: 'Daniel Lee',
                    email: 'daniel@example.com',
                    role: 'Developer',
                    image: 'https://i.imgur.com/mIZtuxm.jpg'
                },
                {
                    name: 'Sophia Martinez',
                    email: 'sophia@example.com',
                    role: 'Customer Support',
                    image: 'https://i.imgur.com/Z68hMpX.jpg'
                },
                {
                    name: 'James Taylor',
                    email: 'james@example.com',
                    role: 'Sales',
                    image: 'https://i.imgur.com/8Km9tLL.jpg'
                }
            ];
            
            return randomUsers;
        }

        // Charts and Graphs
        let statusChart, priorityChart, categoryChart, completionChart, workPatternChart;

        function initializeGraphs() {
            // Status Chart
            const statusCtx = document.getElementById('status-chart').getContext('2d');
            statusChart = new Chart(statusCtx, {
                type: 'doughnut',
                data: {
                    labels: ['Completed', 'Active'],
                    datasets: [{
                        data: [0, 0],
                        backgroundColor: ['#10B981', '#3B82F6'],
                        borderColor: ['#059669', '#2563EB'],
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom',
                            labels: {
                                color: document.documentElement.classList.contains('dark') ? '#F9FAFB' : '#1F2937'
                            }
                        }
                    }
                }
            });
            
            // Priority Chart
            const priorityCtx = document.getElementById('priority-chart').getContext('2d');
            priorityChart = new Chart(priorityCtx, {
                type: 'bar',
                data: {
                    labels: ['High', 'Medium', 'Low'],
                    datasets: [{
                        label: 'Tasks by Priority',
                        data: [0, 0, 0],
                        backgroundColor: ['#EF4444', '#F59E0B', '#6B7280'],
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                color: document.documentElement.classList.contains('dark') ? '#D1D5DB' : '#4B5563'
                            },
                            grid: {
                                color: document.documentElement.classList.contains('dark') ? '#374151' : '#E5E7EB'
                            }
                        },
                        x: {
                            ticks: {
                                color: document.documentElement.classList.contains('dark') ? '#D1D5DB' : '#4B5563'
                            },
                            grid: {
                                color: document.documentElement.classList.contains('dark') ? '#374151' : '#E5E7EB'
                            }
                        }
                    },
                    plugins: {
                        legend: {
                            display: false
                        }
                    }
                }
            });
            
            // Category Chart
            const categoryCtx = document.getElementById('category-chart').getContext('2d');
            categoryChart = new Chart(categoryCtx, {
                type: 'pie',
                data: {
                    labels: ['Work', 'Personal', 'Learning', 'Health', 'Home'],
                    datasets: [{
                        data: [0, 0, 0, 0, 0],
                        backgroundColor: ['#3B82F6', '#EC4899', '#8B5CF6', '#10B981', '#F59E0B'],
                        borderColor: ['#2563EB', '#DB2777', '#7C3AED', '#059669', '#D97706'],
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom',
                            labels: {
                                color: document.documentElement.classList.contains('dark') ? '#F9FAFB' : '#1F2937'
                            }
                        }
                    }
                }
            });
            
            // Completion Trend Chart
            const completionCtx = document.getElementById('completion-chart').getContext('2d');
            completionChart = new Chart(completionCtx, {
                type: 'line',
                data: {
                    labels: getLast7Days(),
                    datasets: [{
                        label: 'Completed Tasks',
                        data: [0, 0, 0, 0, 0, 0, 0],
                        backgroundColor: 'rgba(16, 185, 129, 0.2)',
                        borderColor: '#10B981',
                        borderWidth: 2,
                        fill: true,
                        tension: 0.4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                color: document.documentElement.classList.contains('dark') ? '#D1D5DB' : '#4B5563'
                            },
                            grid: {
                                color: document.documentElement.classList.contains('dark') ? '#374151' : '#E5E7EB'
                            }
                        },
                        x: {
                            ticks: {
                                color: document.documentElement.classList.contains('dark') ? '#D1D5DB' : '#4B5563'
                            },
                            grid: {
                                color: document.documentElement.classList.contains('dark') ? '#374151' : '#E5E7EB'
                            }
                        }
                    },
                    plugins: {
                        legend: {
                            labels: {
                                color: document.documentElement.classList.contains('dark') ? '#F9FAFB' : '#1F2937'
                            }
                        }
                    }
                }
            });
            
            // Update graphs with current data
            updateGraphs();
        }

        function updateGraphs() {
            // Status Chart (Completed vs Active)
            const completed = tasks.filter(task => task.completed).length;
            const active = tasks.length - completed;
            statusChart.data.datasets[0].data = [completed, active];
            statusChart.update();
            
            // Priority Chart
            const highPriority = tasks.filter(task => task.priority === 'high').length;
            const mediumPriority = tasks.filter(task => task.priority === 'medium').length;
            const lowPriority = tasks.filter(task => task.priority === 'low').length;
            priorityChart.data.datasets[0].data = [highPriority, mediumPriority, lowPriority];
            priorityChart.update();
            
            // Category Chart
            const workCategory = tasks.filter(task => task.category === 'work').length;
            const personalCategory = tasks.filter(task => task.category === 'personal').length;
            const learningCategory = tasks.filter(task => task.category === 'learning').length;
            const healthCategory = tasks.filter(task => task.category === 'health').length;
            const homeCategory = tasks.filter(task => task.category === 'home').length;
            categoryChart.data.datasets[0].data = [workCategory, personalCategory, learningCategory, healthCategory, homeCategory];
            categoryChart.update();
            
            // Completion Trend Chart
            const last7Days = getLast7Days(true);
            const completionData = last7Days.map(date => {
                return tasks.filter(task => {
                    const taskDate = new Date(task.updatedAt);
                    return task.completed && 
                           taskDate.getDate() === date.getDate() && 
                           taskDate.getMonth() === date.getMonth() && 
                           taskDate.getFullYear() === date.getFullYear();
                }).length;
            });
            
            completionChart.data.datasets[0].data = completionData;
            completionChart.update();
        }

        function initializeWorkPatternChart() {
            const workPatternCtx = document.getElementById('work-pattern-chart').getContext('2d');
            
            workPatternChart = new Chart(workPatternCtx, {
                type: 'bar',
                data: {
                    labels: ['Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday', 'Sunday'],
                    datasets: [{
                        label: 'Work Time (hours)',
                        data: [6.5, 7.2, 5.8, 8.1, 6.7, 2.5, 1.1],
                        backgroundColor: '#3B82F6'
                    }, {
                        label: 'Break Time (hours)',
                        data: [1.2, 1.0, 1.3, 1.1, 1.0, 0.5, 0.2],
                        backgroundColor: '#F59E0B'
                    }, {
                        label: 'Shadow Time (hours)',
                        data: [0.8, 0.5, 1.1, 0.7, 0.9, 0.3, 0.1],
                        backgroundColor: '#6B7280'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        x: {
                            stacked: true,
                            ticks: {
                                color: document.documentElement.classList.contains('dark') ? '#D1D5DB' : '#4B5563'
                            },
                            grid: {
                                color: document.documentElement.classList.contains('dark') ? '#374151' : '#E5E7EB'
                            }
                        },
                        y: {
                            stacked: true,
                            ticks: {
                                color: document.documentElement.classList.contains('dark') ? '#D1D5DB' : '#4B5563'
                            },
                            grid: {
                                color: document.documentElement.classList.contains('dark') ? '#374151' : '#E5E7EB'
                            }
                        }
                    },
                    plugins: {
                        legend: {
                            labels: {
                                color: document.documentElement.classList.contains('dark') ? '#F9FAFB' : '#1F2937'
                            }
                        }
                    }
                }
            });
        }

        function getLast7Days(asDateObjects = false) {
            const result = [];
            for (let i = 6; i >= 0; i--) {
                const date = new Date();
                date.setDate(date.getDate() - i);
                
                if (asDateObjects) {
                    result.push(date);
                } else {
                    result.push(date.toLocaleDateString('en-US', { month: 'short', day: 'numeric' }));
                }
            }
            return result;
        }

        // Initialize everything
        document.addEventListener('DOMContentLoaded', () => {
            initializeDarkMode();
            initializeAuth();
            initializeTaskManagement();
        });
    </script>
</body>
</html>
