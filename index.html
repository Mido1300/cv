<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>To-Do App</title>
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <!-- Font Awesome -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <!-- Flatpickr -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <!-- Flatpickr -->
    <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
    <!-- jsPDF -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <!-- XLSX -->
    <script src="https://cdn.jsdelivr.net/npm/xlsx/dist/xlsx.full.min.js"></script>
    <style>
        :root {
            --primary: #5D5CDE;
            --secondary: #6c757d;
            --success: #28a745;
            --danger: #dc3545;
            --warning: #ffc107;
            --info: #17a2b8;
            --light: #f8f9fa;
            --dark: #343a40;
            --text-dark: #212529;
            --text-light: #f8f9fa;
            --background-light: #ffffff;
            --background-dark: #181818;
            --card-light: #f8f9fa;
            --card-dark: #2a2a2a;
            --border-light: #dee2e6;
            --border-dark: #444;
            --shadow-light: 0 0.5rem 1rem rgba(0, 0, 0, 0.15);
            --shadow-dark: 0 0.5rem 1rem rgba(0, 0, 0, 0.5);
            --shadow-sm-light: 0 0.125rem 0.25rem rgba(0, 0, 0, 0.075);
            --shadow-sm-dark: 0 0.125rem 0.25rem rgba(0, 0, 0, 0.2);
            --header-height: 60px;
            --sidebar-width: 250px;
            --transition-speed: 0.3s;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Poppins', sans-serif;
            transition: background-color var(--transition-speed), color var(--transition-speed);
        }

        body {
            background-color: var(--background-light);
            color: var(--text-dark);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }

        body.dark {
            background-color: var(--background-dark);
            color: var(--text-light);
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
            width: 100%;
        }

        header {
            background-color: var(--background-light);
            box-shadow: var(--shadow-sm-light);
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            z-index: 100;
            padding: 10px 0;
            height: var(--header-height);
        }

        .dark header {
            background-color: var(--background-dark);
            box-shadow: var(--shadow-sm-dark);
        }

        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo {
            display: flex;
            align-items: center;
            font-size: 24px;
            font-weight: 700;
            color: var(--primary);
            cursor: pointer;
            transition: transform 0.3s;
        }

        .logo:hover {
            transform: scale(1.05);
        }

        .logo i {
            margin-right: 10px;
        }

        .user-controls {
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .mode-switcher {
            background-color: var(--primary);
            color: white;
            border: none;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 2px 10px rgba(93, 92, 222, 0.3);
        }

        .mode-switcher:hover {
            transform: scale(1.1);
            box-shadow: 0 2px 15px rgba(93, 92, 222, 0.5);
        }

        .task-timer {
            background-color: var(--card-light);
            padding: 5px 15px;
            border-radius: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            font-weight: 600;
            font-size: 14px;
        }

        .dark .task-timer {
            background-color: var(--card-dark);
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.3);
        }

        .timer-controls button {
            background: none;
            border: none;
            color: var(--primary);
            cursor: pointer;
            font-size: 14px;
        }

        .timer-controls button:hover {
            color: var(--secondary);
        }

        .notification-icon {
            position: relative;
            cursor: pointer;
        }

        .notification-badge {
            position: absolute;
            top: -5px;
            right: -5px;
            background-color: var(--danger);
            color: white;
            border-radius: 50%;
            width: 18px;
            height: 18px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            font-weight: 600;
        }

        .profile {
            position: relative;
        }

        .profile-img {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            cursor: pointer;
            transition: transform 0.3s;
            object-fit: cover;
            border: 2px solid var(--primary);
        }

        .profile-img:hover {
            transform: scale(1.1);
        }

        .profile-status {
            position: absolute;
            bottom: 0;
            right: 0;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background-color: var(--success);
            border: 2px solid var(--background-light);
        }

        .dark .profile-status {
            border-color: var(--background-dark);
        }

        .profile-dropdown {
            position: absolute;
            top: 50px;
            right: 0;
            background-color: var(--card-light);
            border-radius: 8px;
            box-shadow: var(--shadow-light);
            width: 200px;
            z-index: 10;
            overflow: hidden;
            opacity: 0;
            visibility: hidden;
            transform: translateY(-10px);
            transition: opacity 0.3s, visibility 0.3s, transform 0.3s;
        }

        .dark .profile-dropdown {
            background-color: var(--card-dark);
            box-shadow: var(--shadow-dark);
        }

        .profile-dropdown.show {
            opacity: 1;
            visibility: visible;
            transform: translateY(0);
        }

        .profile-dropdown-item {
            padding: 12px 15px;
            display: flex;
            align-items: center;
            gap: 10px;
            cursor: pointer;
            color: var(--text-dark);
            transition: background-color 0.3s;
        }

        .dark .profile-dropdown-item {
            color: var(--text-light);
        }

        .profile-dropdown-item:hover {
            background-color: rgba(93, 92, 222, 0.1);
        }

        .dark .profile-dropdown-item:hover {
            background-color: rgba(93, 92, 222, 0.2);
        }

        .notification-dropdown {
            position: absolute;
            top: 50px;
            right: 0;
            background-color: var(--card-light);
            border-radius: 8px;
            box-shadow: var(--shadow-light);
            width: 300px;
            max-height: 400px;
            overflow-y: auto;
            z-index: 10;
            opacity: 0;
            visibility: hidden;
            transform: translateY(-10px);
            transition: opacity 0.3s, visibility 0.3s, transform 0.3s;
        }

        .dark .notification-dropdown {
            background-color: var(--card-dark);
            box-shadow: var(--shadow-dark);
        }

        .notification-dropdown.show {
            opacity: 1;
            visibility: visible;
            transform: translateY(0);
        }

        .notification-header {
            padding: 15px;
            border-bottom: 1px solid var(--border-light);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .dark .notification-header {
            border-color: var(--border-dark);
        }

        .notification-header h3 {
            font-size: 16px;
            font-weight: 600;
        }

        .notification-header button {
            background: none;
            border: none;
            color: var(--primary);
            cursor: pointer;
            font-size: 14px;
        }

        .notification-list {
            padding: 0;
        }

        .notification-item {
            padding: 12px 15px;
            border-bottom: 1px solid var(--border-light);
            cursor: pointer;
            transition: background-color 0.3s;
        }

        .dark .notification-item {
            border-color: var(--border-dark);
        }

        .notification-item:hover {
            background-color: rgba(93, 92, 222, 0.1);
        }

        .dark .notification-item:hover {
            background-color: rgba(93, 92, 222, 0.2);
        }

        .notification-item.unread {
            border-left: 3px solid var(--primary);
        }

        .notification-item h4 {
            font-size: 14px;
            margin-bottom: 5px;
        }

        .notification-item p {
            font-size: 12px;
            color: var(--secondary);
            margin-bottom: 5px;
        }

        .notification-time {
            font-size: 12px;
            color: var(--secondary);
        }

        main {
            flex: 1;
            margin-top: var(--header-height);
            padding: 20px 0;
        }

        .auth-container {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin-top: 0;
        }

        .auth-form {
            background-color: var(--card-light);
            padding: 30px;
            border-radius: 10px;
            box-shadow: var(--shadow-light);
            width: 100%;
            max-width: 400px;
            animation: fadeIn 0.5s ease-in-out;
        }

        .dark .auth-form {
            background-color: var(--card-dark);
            box-shadow: var(--shadow-dark);
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(-20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .auth-form h2 {
            text-align: center;
            margin-bottom: 20px;
            color: var(--primary);
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
        }

        .form-control {
            width: 100%;
            padding: 10px 15px;
            border: 1px solid var(--border-light);
            border-radius: 5px;
            font-size: 16px;
            transition: border-color 0.3s, box-shadow 0.3s;
            background-color: var(--background-light);
            color: var(--text-dark);
        }

        .dark .form-control {
            border-color: var(--border-dark);
            background-color: var(--background-dark);
            color: var(--text-light);
        }

        .form-control:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(93, 92, 222, 0.2);
        }

        .btn {
            display: inline-block;
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            font-size: 16px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s;
            text-align: center;
        }

        .btn-primary {
            background-color: var(--primary);
            color: white;
            box-shadow: 0 2px 10px rgba(93, 92, 222, 0.3);
        }

        .btn-primary:hover {
            background-color: #4a49d1;
            box-shadow: 0 2px 15px rgba(93, 92, 222, 0.5);
            transform: translateY(-2px);
        }

        .btn-secondary {
            background-color: var(--secondary);
            color: white;
            box-shadow: 0 2px 10px rgba(108, 117, 125, 0.3);
        }

        .btn-secondary:hover {
            background-color: #5a6268;
            box-shadow: 0 2px 15px rgba(108, 117, 125, 0.5);
            transform: translateY(-2px);
        }

        .btn-success {
            background-color: var(--success);
            color: white;
            box-shadow: 0 2px 10px rgba(40, 167, 69, 0.3);
        }

        .btn-success:hover {
            background-color: #218838;
            box-shadow: 0 2px 15px rgba(40, 167, 69, 0.5);
            transform: translateY(-2px);
        }

        .btn-danger {
            background-color: var(--danger);
            color: white;
            box-shadow: 0 2px 10px rgba(220, 53, 69, 0.3);
        }

        .btn-danger:hover {
            background-color: #c82333;
            box-shadow: 0 2px 15px rgba(220, 53, 69, 0.5);
            transform: translateY(-2px);
        }

        .btn-block {
            display: block;
            width: 100%;
        }

        .auth-links {
            margin-top: 20px;
            text-align: center;
            font-size: 14px;
        }

        .auth-links a {
            color: var(--primary);
            text-decoration: none;
            transition: all 0.3s;
        }

        .auth-links a:hover {
            text-decoration: underline;
        }

        .login-btn-wrapper {
            position: relative;
            overflow: hidden;
            border-radius: 5px;
            margin: 0 auto;
            width: 80%;
        }

        .login-btn-light {
            position: absolute;
            top: -20px;
            left: -20px;
            width: 60px;
            height: 60px;
            background: linear-gradient(to right, #5D5CDE, #4a49d1);
            border-radius: 50%;
            opacity: 0;
            animation: moveLight 3s linear infinite;
            filter: blur(20px);
        }

        @keyframes moveLight {
            0% {
                opacity: 0;
                transform: translateX(0) translateY(0);
            }
            25% {
                opacity: 0.5;
                transform: translateX(170px) translateY(0);
            }
            50% {
                opacity: 0.8;
                transform: translateX(170px) translateY(50px);
            }
            75% {
                opacity: 0.5;
                transform: translateX(0) translateY(50px);
            }
            100% {
                opacity: 0;
                transform: translateX(0) translateY(0);
            }
        }

        /* Dashboard */
        .dashboard {
            display: none;
        }

        .section {
            background-color: var(--card-light);
            border-radius: 10px;
            box-shadow: var(--shadow-light);
            padding: 20px;
            margin-bottom: 20px;
        }

        .dark .section {
            background-color: var(--card-dark);
            box-shadow: var(--shadow-dark);
        }

        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .section-title {
            font-size: 20px;
            font-weight: 600;
        }

        .section-actions {
            display: flex;
            gap: 10px;
        }

        .task-summary {
            display: grid;
            grid-template-columns: 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }

        .total-tasks {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 20px;
            background-color: var(--background-light);
            border-radius: 10px;
            border: 1px solid var(--border-light);
            box-shadow: var(--shadow-sm-light);
            text-align: center;
            transition: transform 0.3s;
        }

        .dark .total-tasks {
            background-color: var(--background-dark);
            border-color: var(--border-dark);
            box-shadow: var(--shadow-sm-dark);
        }

        .total-tasks h3 {
            font-size: 16px;
            margin-bottom: 10px;
        }

        .total-tasks .count {
            font-size: 28px;
            font-weight: 700;
            color: var(--primary);
        }

        .task-stats {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 20px;
        }

        .task-stat-card {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 20px;
            border-radius: 10px;
            box-shadow: var(--shadow-sm-light);
            text-align: center;
            transition: transform 0.3s;
        }

        .dark .task-stat-card {
            box-shadow: var(--shadow-sm-dark);
        }

        .task-stat-card:hover {
            transform: translateY(-5px);
        }

        .task-stat-card h3 {
            font-size: 16px;
            margin-bottom: 10px;
        }

        .task-stat-card .count {
            font-size: 28px;
            font-weight: 700;
        }

        .completed-tasks {
            background-color: rgba(40, 167, 69, 0.1);
            border: 1px solid rgba(40, 167, 69, 0.2);
        }

        .dark .completed-tasks {
            background-color: rgba(40, 167, 69, 0.2);
            border: 1px solid rgba(40, 167, 69, 0.3);
        }

        .completed-tasks .count {
            color: var(--success);
        }

        .pending-tasks {
            background-color: rgba(255, 193, 7, 0.1);
            border: 1px solid rgba(255, 193, 7, 0.2);
        }

        .dark .pending-tasks {
            background-color: rgba(255, 193, 7, 0.2);
            border: 1px solid rgba(255, 193, 7, 0.3);
        }

        .pending-tasks .count {
            color: var(--warning);
        }

        .task-filters {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }

        .task-filter {
            position: relative;
        }

        .task-filter select,
        .task-filter input {
            width: 100%;
            padding: 8px 12px;
            border: 1px solid var(--border-light);
            border-radius: 5px;
            background-color: var(--background-light);
            color: var(--text-dark);
            font-size: 14px;
            transition: border-color 0.3s;
            appearance: none;
            cursor: pointer;
        }

        .dark .task-filter select,
        .dark .task-filter input {
            border-color: var(--border-dark);
            background-color: var(--background-dark);
            color: var(--text-light);
        }

        .task-filter select:focus,
        .task-filter input:focus {
            outline: none;
            border-color: var(--primary);
        }

        .task-filter i {
            position: absolute;
            right: 10px;
            top: 50%;
            transform: translateY(-50%);
            pointer-events: none;
            color: var(--secondary);
        }

        .search-bar {
            margin-bottom: 20px;
            position: relative;
        }

        .search-bar input {
            width: 100%;
            padding: 10px 15px 10px 40px;
            border: 1px solid var(--border-light);
            border-radius: 5px;
            background-color: var(--background-light);
            color: var(--text-dark);
            font-size: 16px;
            transition: border-color 0.3s;
        }

        .dark .search-bar input {
            border-color: var(--border-dark);
            background-color: var(--background-dark);
            color: var(--text-light);
        }

        .search-bar input:focus {
            outline: none;
            border-color: var(--primary);
        }

        .search-bar i {
            position: absolute;
            left: 15px;
            top: 50%;
            transform: translateY(-50%);
            color: var(--secondary);
        }

        .task-list-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .task-list-actions {
            display: flex;
            gap: 10px;
        }

        .view-switcher {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .view-btn {
            background-color: var(--background-light);
            color: var(--text-dark);
            border: 1px solid var(--border-light);
            border-radius: 5px;
            padding: 8px 12px;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 14px;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .dark .view-btn {
            background-color: var(--background-dark);
            color: var(--text-light);
            border-color: var(--border-dark);
        }

        .view-btn.active {
            background-color: var(--primary);
            color: white;
            border-color: var(--primary);
        }

        .undo-redo {
            display: flex;
            gap: 5px;
        }

        .undo-redo button {
            background-color: var(--background-light);
            color: var(--text-dark);
            border: 1px solid var(--border-light);
            border-radius: 5px;
            width: 36px;
            height: 36px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s;
        }

        .dark .undo-redo button {
            background-color: var(--background-dark);
            color: var(--text-light);
            border-color: var(--border-dark);
        }

        .undo-redo button:hover {
            background-color: var(--primary);
            color: white;
            border-color: var(--primary);
        }

        .undo-redo button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .task-list {
            margin-bottom: 20px;
        }

        .task-list-view {
            display: block;
        }

        .graph-view {
            display: none;
        }

        .task-item {
            background-color: var(--background-light);
            border: 1px solid var(--border-light);
            border-radius: 8px;
            margin-bottom: 15px;
            padding: 15px;
            box-shadow: var(--shadow-sm-light);
            transition: transform 0.3s, box-shadow 0.3s;
            position: relative;
        }

        .dark .task-item {
            background-color: var(--background-dark);
            border-color: var(--border-dark);
            box-shadow: var(--shadow-sm-dark);
        }

        .task-item:hover {
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }

        .dark .task-item:hover {
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
        }

        .task-item.high-priority {
            border-left: 5px solid var(--danger);
        }

        .task-item.medium-priority {
            border-left: 5px solid var(--warning);
        }

        .task-item.low-priority {
            border-left: 5px solid var(--secondary);
        }

        .task-item.expired {
            border: 2px solid var(--danger);
        }

        .task-item.due-soon {
            border: 2px solid var(--warning);
        }

        .task-item.ok {
            border: 2px solid var(--success);
        }

        .task-item.completed {
            opacity: 0.7;
            background-color: rgba(40, 167, 69, 0.1);
        }

        .dark .task-item.completed {
            background-color: rgba(40, 167, 69, 0.2);
        }

        .task-checkbox {
            display: inline-block;
            margin-right: 10px;
            cursor: pointer;
        }

        .task-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
        }

        .task-header-left {
            display: flex;
            align-items: center;
        }

        .task-select {
            margin-right: 10px;
        }

        .task-title {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 5px;
        }

        .task-description {
            font-size: 14px;
            color: var(--secondary);
            margin-bottom: 10px;
        }

        .task-meta {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-bottom: 10px;
            font-size: 13px;
        }

        .task-meta-item {
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .task-category,
        .task-priority {
            padding: 3px 8px;
            border-radius: 15px;
            font-size: 12px;
            font-weight: 500;
        }

        .task-category {
            background-color: rgba(93, 92, 222, 0.1);
            color: var(--primary);
        }

        .dark .task-category {
            background-color: rgba(93, 92, 222, 0.2);
        }

        .priority-high {
            background-color: rgba(220, 53, 69, 0.1);
            color: var(--danger);
        }

        .dark .priority-high {
            background-color: rgba(220, 53, 69, 0.2);
        }

        .priority-medium {
            background-color: rgba(255, 193, 7, 0.1);
            color: var(--warning);
        }

        .dark .priority-medium {
            background-color: rgba(255, 193, 7, 0.2);
        }

        .priority-low {
            background-color: rgba(108, 117, 125, 0.1);
            color: var(--secondary);
        }

        .dark .priority-low {
            background-color: rgba(108, 117, 125, 0.2);
        }

        .task-actions {
            display: flex;
            gap: 5px;
        }

        .task-action-btn {
            background-color: var(--background-light);
            color: var(--text-dark);
            border: 1px solid var(--border-light);
            border-radius: 5px;
            width: 32px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 14px;
        }

        .dark .task-action-btn {
            background-color: var(--background-dark);
            color: var(--text-light);
            border-color: var(--border-dark);
        }

        .task-action-btn:hover {
            background-color: var(--primary);
            color: white;
            border-color: var(--primary);
        }

        .task-action-btn.play {
            color: var(--success);
        }

        .task-action-btn.play:hover {
            background-color: var(--success);
            color: white;
            border-color: var(--success);
        }

        .task-action-btn.pause {
            color: var(--warning);
        }

        .task-action-btn.pause:hover {
            background-color: var(--warning);
            color: white;
            border-color: var(--warning);
        }

        .task-action-btn.delete {
            color: var(--danger);
        }

        .task-action-btn.delete:hover {
            background-color: var(--danger);
            color: white;
            border-color: var(--danger);
        }

        .task-timer-info {
            font-size: 12px;
            margin-top: 10px;
            color: var(--secondary);
        }

        .batch-actions {
            display: none;
            position: sticky;
            bottom: 20px;
            left: 0;
            right: 0;
            background: linear-gradient(to right, #5D5CDE, #4a49d1);
            color: white;
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 5px 15px rgba(93, 92, 222, 0.3);
            z-index: 10;
            animation: slideUp 0.3s ease-in-out;
            margin-top: 20px;
        }

        @keyframes slideUp {
            from {
                transform: translateY(100%);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }

        .batch-actions.show {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .batch-info {
            font-weight: 500;
        }

        .batch-buttons {
            display: flex;
            gap: 10px;
        }

        .graph-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }

        .graph-card {
            background-color: var(--background-light);
            border: 1px solid var(--border-light);
            border-radius: 8px;
            padding: 20px;
            box-shadow: var(--shadow-sm-light);
        }

        .dark .graph-card {
            background-color: var(--background-dark);
            border-color: var(--border-dark);
            box-shadow: var(--shadow-sm-dark);
        }

        .graph-title {
            font-size: 16px;
            font-weight: 600;
            margin-bottom: 15px;
            text-align: center;
        }

        canvas {
            width: 100% !important;
        }

        .insights {
            margin-top: 20px;
        }

        .insights-title {
            font-size: 20px;
            font-weight: 600;
            margin-bottom: 15px;
        }

        .insights-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 20px;
        }

        .insight-card {
            background-color: var(--background-light);
            border: 1px solid var(--border-light);
            border-radius: 8px;
            padding: 15px;
            box-shadow: var(--shadow-sm-light);
            transition: transform 0.3s;
        }

        .dark .insight-card {
            background-color: var(--background-dark);
            border-color: var(--border-dark);
            box-shadow: var(--shadow-sm-dark);
        }

        .insight-card:hover {
            transform: translateY(-5px);
        }

        .insight-header {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 10px;
        }

        .insight-icon {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background-color: rgba(93, 92, 222, 0.1);
            color: var(--primary);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
        }

        .dark .insight-icon {
            background-color: rgba(93, 92, 222, 0.2);
        }

        .insight-title {
            font-size: 16px;
            font-weight: 600;
        }

        .insight-value {
            font-size: 24px;
            font-weight: 700;
            color: var(--primary);
            margin-bottom: 5px;
        }

        .insight-description {
            font-size: 13px;
            color: var(--secondary);
        }

        /* Modal */
        .modal-backdrop {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0, 0, 0, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s, visibility 0.3s;
        }

        .modal-backdrop.show {
            opacity: 1;
            visibility: visible;
        }

        .modal {
            background-color: var(--card-light);
            border-radius: 10px;
            box-shadow: var(--shadow-light);
            width: 90%;
            max-width: 500px;
            max-height: 90vh;
            overflow-y: auto;
            transform: translateY(-20px);
            transition: transform 0.3s;
        }

        .modal-backdrop.show .modal {
            transform: translateY(0);
        }

        .dark .modal {
            background-color: var(--card-dark);
            box-shadow: var(--shadow-dark);
        }

        .modal-header {
            padding: 15px 20px;
            border-bottom: 1px solid var(--border-light);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .dark .modal-header {
            border-color: var(--border-dark);
        }

        .modal-title {
            font-size: 18px;
            font-weight: 600;
        }

        .modal-close {
            background: none;
            border: none;
            font-size: 20px;
            color: var(--secondary);
            cursor: pointer;
            transition: color 0.3s;
        }

        .modal-close:hover {
            color: var(--danger);
        }

        .modal-body {
            padding: 20px;
        }

        .modal-footer {
            padding: 15px 20px;
            border-top: 1px solid var(--border-light);
            display: flex;
            justify-content: flex-end;
            gap: 10px;
        }

        .dark .modal-footer {
            border-color: var(--border-dark);
        }

        .subtask-list {
            margin-top: 15px;
        }

        .subtask-item {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 10px;
            background-color: var(--background-light);
            border: 1px solid var(--border-light);
            border-radius: 5px;
            padding: 10px;
        }

        .dark .subtask-item {
            background-color: var(--background-dark);
            border-color: var(--border-dark);
        }

        .subtask-input {
            flex: 1;
        }

        .subtask-actions {
            display: flex;
            gap: 5px;
        }

        .add-subtask-btn {
            display: flex;
            align-items: center;
            gap: 5px;
            background-color: var(--background-light);
            border: 1px dashed var(--border-light);
            border-radius: 5px;
            padding: 10px;
            width: 100%;
            cursor: pointer;
            transition: all 0.3s;
            color: var(--primary);
        }

        .dark .add-subtask-btn {
            background-color: var(--background-dark);
            border-color: var(--border-dark);
        }

        .add-subtask-btn:hover {
            background-color: rgba(93, 92, 222, 0.1);
        }

        .dark .add-subtask-btn:hover {
            background-color: rgba(93, 92, 222, 0.2);
        }

        /* Users */
        .users-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 20px;
        }

        .user-card {
            background-color: var(--background-light);
            border: 1px solid var(--border-light);
            border-radius: 8px;
            overflow: hidden;
            box-shadow: var(--shadow-sm-light);
            transition: transform 0.3s, box-shadow 0.3s;
        }

        .dark .user-card {
            background-color: var(--background-dark);
            border-color: var(--border-dark);
            box-shadow: var(--shadow-sm-dark);
        }

        .user-card:hover {
            transform: translateY(-5px) scale(1.02);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.1);
        }

        .dark .user-card:hover {
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.3);
        }

        .user-card-header {
            position: relative;
            height: 80px;
            background: linear-gradient(to right, #5D5CDE, #4a49d1);
        }

        .user-avatar {
            position: absolute;
            left: 50%;
            bottom: 0;
            transform: translate(-50%, 50%);
            width: 80px;
            height: 80px;
            border-radius: 50%;
            border: 4px solid var(--background-light);
            background-color: var(--background-light);
            object-fit: cover;
        }

        .dark .user-avatar {
            border-color: var(--background-dark);
            background-color: var(--background-dark);
        }

        .user-card-body {
            padding: 50px 20px 20px;
            text-align: center;
        }

        .user-name {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 5px;
        }

        .user-email {
            font-size: 14px;
            color: var(--secondary);
            margin-bottom: 10px;
        }

        .user-role {
            padding: 3px 10px;
            border-radius: 15px;
            background-color: rgba(93, 92, 222, 0.1);
            color: var(--primary);
            font-size: 12px;
            font-weight: 500;
            display: inline-block;
        }

        .dark .user-role {
            background-color: rgba(93, 92, 222, 0.2);
        }

        /* Toast */
        .toast-container {
            position: fixed;
            bottom: 20px;
            left: 20px;
            z-index: 1000;
        }

        .toast {
            background-color: var(--background-light);
            border-left: 5px solid var(--primary);
            border-radius: 5px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            padding: 15px 20px;
            margin-bottom: 10px;
            min-width: 300px;
            max-width: 400px;
            display: flex;
            align-items: center;
            gap: 10px;
            animation: slideIn 0.3s ease-in-out, fadeOut 0.5s ease-in-out 4.5s forwards;
        }

        .dark .toast {
            background-color: var(--background-dark);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
        }

        @keyframes slideIn {
            from {
                transform: translateX(-100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        @keyframes fadeOut {
            from {
                opacity: 1;
            }
            to {
                opacity: 0;
                transform: translateX(-20px);
            }
        }

        .toast-icon {
            width: 24px;
            height: 24px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 14px;
        }

        .toast-success .toast-icon {
            background-color: var(--success);
        }

        .toast-warning .toast-icon {
            background-color: var(--warning);
        }

        .toast-error .toast-icon {
            background-color: var(--danger);
        }

        .toast-info .toast-icon {
            background-color: var(--info);
        }

        .toast-content {
            flex: 1;
        }

        .toast-title {
            font-size: 14px;
            font-weight: 600;
            margin-bottom: 5px;
        }

        .toast-message {
            font-size: 13px;
            color: var(--secondary);
        }

        .toast-close {
            background: none;
            border: none;
            color: var(--secondary);
            cursor: pointer;
            font-size: 16px;
            transition: color 0.3s;
        }

        .toast-close:hover {
            color: var(--danger);
        }

        /* Responsive */
        @media (max-width: 768px) {
            .task-filters {
                grid-template-columns: 1fr 1fr;
            }

            .section-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 10px;
            }

            .section-actions {
                width: 100%;
                justify-content: space-between;
            }

            .graph-container {
                grid-template-columns: 1fr;
            }

            .modal {
                width: 95%;
            }
        }

        @media (max-width: 576px) {
            .task-filters {
                grid-template-columns: 1fr;
            }

            .task-meta {
                flex-direction: column;
                align-items: flex-start;
            }

            .user-controls {
                gap: 10px;
            }

            .batch-actions {
                flex-direction: column;
                gap: 10px;
            }

            .batch-buttons {
                width: 100%;
                justify-content: space-between;
            }
        }
    </style>
</head>
<body>
    <!-- Login Page -->
    <main class="auth-container" id="auth-page">
        <div class="auth-form">
            <h2>Welcome to To-Do App</h2>
            <div class="form-group">
                <label for="email">Email</label>
                <input type="email" id="email" class="form-control" value="test@example.com" aria-label="Email">
            </div>
            <div class="form-group">
                <label for="password">Password</label>
                <input type="password" id="password" class="form-control" value="123456" aria-label="Password">
            </div>
            <div class="login-btn-wrapper">
                <div class="login-btn-light"></div>
                <button id="login-btn" class="btn btn-primary btn-block">Login</button>
            </div>
            <div class="auth-links">
                <span>Don't have an account? <a href="#" id="register-link">Register now</a></span>
            </div>
        </div>
    </main>

    <!-- Dashboard -->
    <div class="dashboard" id="dashboard">
        <header>
            <div class="container">
                <div class="header-content">
                    <div class="logo" id="logo">
                        <i class="fas fa-check-circle"></i>
                        <span>To-Do App</span>
                    </div>
                    <div class="user-controls">
                        <div class="task-timer">
                            <span id="task-timer-display">00:00:00</span>
                            <div class="timer-controls">
                                <button id="timer-toggle">
                                    <i class="fas fa-play"></i>
                                </button>
                            </div>
                        </div>
                        <button class="mode-switcher" id="mode-switcher" aria-label="Toggle dark mode">
                            <i class="fas fa-moon"></i>
                        </button>
                        <div class="notification-icon" id="notification-icon">
                            <i class="fas fa-bell"></i>
                            <span class="notification-badge" id="notification-badge">0</span>
                            <div class="notification-dropdown" id="notification-dropdown">
                                <div class="notification-header">
                                    <h3>Notifications</h3>
                                    <button id="mark-all-read">Mark all as read</button>
                                </div>
                                <div class="notification-list" id="notification-list">
                                    <!-- Notifications will be added here dynamically -->
                                </div>
                            </div>
                        </div>
                        <div class="profile">
                            <img src="https://randomuser.me/api/portraits/men/1.jpg" alt="Profile" class="profile-img" id="profile-img">
                            <span class="profile-status"></span>
                            <div class="profile-dropdown" id="profile-dropdown">
                                <div class="profile-dropdown-item" id="view-profile">
                                    <i class="fas fa-user"></i>
                                    <span>View Profile</span>
                                </div>
                                <div class="profile-dropdown-item" id="status-dropdown">
                                    <i class="fas fa-circle"></i>
                                    <span>Status: <span id="user-status">Online</span></span>
                                </div>
                                <div class="profile-dropdown-item" id="users-button">
                                    <i class="fas fa-users"></i>
                                    <span>Users</span>
                                </div>
                                <div class="profile-dropdown-item" id="logout-button">
                                    <i class="fas fa-sign-out-alt"></i>
                                    <span>Logout</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </header>

        <main>
            <div class="container">
                <section class="section">
                    <div class="task-summary">
                        <div class="total-tasks">
                            <h3>Total Tasks</h3>
                            <div class="count" id="total-tasks-count">0</div>
                        </div>
                        <div class="task-stats">
                            <div class="task-stat-card completed-tasks">
                                <h3>Completed Tasks</h3>
                                <div class="count" id="completed-tasks-count">0</div>
                            </div>
                            <div class="task-stat-card pending-tasks">
                                <h3>Pending Tasks</h3>
                                <div class="count" id="pending-tasks-count">0</div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="section-header">
                        <h2 class="section-title">Tasks</h2>
                        <div class="section-actions">
                            <button class="btn btn-success" id="add-task-btn">
                                <i class="fas fa-plus"></i> Add Task
                            </button>
                            <button class="btn btn-primary" id="export-btn">
                                <i class="fas fa-file-export"></i> Export
                            </button>
                            <button class="btn btn-secondary" id="import-btn">
                                <i class="fas fa-file-import"></i> Import
                            </button>
                            <button class="btn btn-secondary" id="categories-btn">
                                <i class="fas fa-tags"></i> Categories
                            </button>
                        </div>
                    </div>

                    <div class="search-bar">
                        <i class="fas fa-search"></i>
                        <input type="text" id="search-input" placeholder="Search tasks..." aria-label="Search tasks">
                    </div>

                    <div class="task-filters">
                        <div class="task-filter">
                            <select id="status-filter" aria-label="Filter by status">
                                <option value="all">All Tasks</option>
                                <option value="active">Active</option>
                                <option value="completed">Completed</option>
                            </select>
                            <i class="fas fa-filter"></i>
                        </div>
                        <div class="task-filter">
                            <select id="category-filter" aria-label="Filter by category">
                                <option value="all">All Categories</option>
                                <!-- Categories will be added dynamically -->
                            </select>
                            <i class="fas fa-tag"></i>
                        </div>
                        <div class="task-filter">
                            <select id="priority-filter" aria-label="Filter by priority">
                                <option value="all">All Priorities</option>
                                <option value="high">High</option>
                                <option value="medium">Medium</option>
                                <option value="low">Low</option>
                            </select>
                            <i class="fas fa-flag"></i>
                        </div>
                        <div class="task-filter">
                            <select id="due-date-filter" aria-label="Filter by due date">
                                <option value="all">All Dates</option>
                                <option value="today">Today</option>
                                <option value="week">This Week</option>
                                <option value="month">This Month</option>
                                <option value="custom">Custom Range</option>
                            </select>
                            <i class="fas fa-calendar"></i>
                        </div>
                        <div class="task-filter">
                            <select id="sort-options" aria-label="Sort tasks">
                                <option value="default">Default Sort</option>
                                <option value="title-asc">Title (A-Z)</option>
                                <option value="title-desc">Title (Z-A)</option>
                                <option value="date-asc">Due Date (Earliest)</option>
                                <option value="date-desc">Due Date (Latest)</option>
                                <option value="priority-asc">Priority (Low to High)</option>
                                <option value="priority-desc">Priority (High to Low)</option>
                            </select>
                            <i class="fas fa-sort"></i>
                        </div>
                    </div>

                    <div class="task-list-header">
                        <div class="undo-redo">
                            <button id="undo-btn" disabled aria-label="Undo">
                                <i class="fas fa-undo"></i>
                            </button>
                            <button id="redo-btn" disabled aria-label="Redo">
                                <i class="fas fa-redo"></i>
                            </button>
                        </div>
                        <div class="view-switcher">
                            <button class="view-btn active" id="list-view-btn">
                                <i class="fas fa-list"></i> List
                            </button>
                            <button class="view-btn" id="graph-view-btn">
                                <i class="fas fa-chart-pie"></i> Graph
                            </button>
                        </div>
                    </div>

                    <div class="task-list">
                        <div class="task-list-view" id="task-list-view">
                            <!-- Tasks will be added here dynamically -->
                        </div>
                        <div class="graph-view" id="graph-view">
                            <div class="graph-container">
                                <div class="graph-card">
                                    <h3 class="graph-title">Task Progress Over Time</h3>
                                    <canvas id="progress-chart"></canvas>
                                </div>
                                <div class="graph-card">
                                    <h3 class="graph-title">Task Distribution</h3>
                                    <canvas id="distribution-chart"></canvas>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="batch-actions" id="batch-actions">
                        <div class="batch-info">
                            <span id="selected-count">0</span> tasks selected
                        </div>
                        <div class="batch-buttons">
                            <button class="btn btn-danger" id="batch-delete-btn">
                                <i class="fas fa-trash"></i> Delete
                            </button>
                            <button class="btn btn-success" id="batch-complete-btn">
                                <i class="fas fa-check"></i> Mark Complete
                            </button>
                            <button class="btn btn-secondary" id="batch-cancel-btn">
                                <i class="fas fa-times"></i> Cancel
                            </button>
                        </div>
                    </div>
                </section>

                <section class="section insights">
                    <h2 class="insights-title">Insights</h2>
                    <div class="insights-grid">
                        <div class="insight-card">
                            <div class="insight-header">
                                <div class="insight-icon">
                                    <i class="fas fa-calendar-check"></i>
                                </div>
                                <h3 class="insight-title">Tasks Today</h3>
                            </div>
                            <div class="insight-value" id="tasks-today">0</div>
                            <div class="insight-description">Tasks due today</div>
                        </div>
                        <div class="insight-card">
                            <div class="insight-header">
                                <div class="insight-icon">
                                    <i class="fas fa-exclamation-triangle"></i>
                                </div>
                                <h3 class="insight-title">High Priority</h3>
                            </div>
                            <div class="insight-value" id="high-priority-count">0</div>
                            <div class="insight-description">High priority tasks</div>
                        </div>
                        <div class="insight-card">
                            <div class="insight-header">
                                <div class="insight-icon">
                                    <i class="fas fa-fire"></i>
                                </div>
                                <h3 class="insight-title">About to Expire</h3>
                            </div>
                            <div class="insight-value" id="due-soon-count">0</div>
                            <div class="insight-description">Tasks due within 48 hours</div>
                        </div>
                        <div class="insight-card">
                            <div class="insight-header">
                                <div class="insight-icon">
                                    <i class="fas fa-history"></i>
                                </div>
                                <h3 class="insight-title">Expired Tasks</h3>
                            </div>
                            <div class="insight-value" id="expired-count">0</div>
                            <div class="insight-description">Tasks past their due date</div>
                        </div>
                    </div>
                </section>
            </div>
        </main>
    </div>

    <!-- Modals -->
    <!-- Register Modal -->
    <div class="modal-backdrop" id="register-modal">
        <div class="modal">
            <div class="modal-header">
                <h2 class="modal-title">Create Account</h2>
                <button class="modal-close" aria-label="Close">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label for="register-firstname">First Name</label>
                    <input type="text" id="register-firstname" class="form-control" aria-label="First Name">
                </div>
                <div class="form-group">
                    <label for="register-lastname">Last Name</label>
                    <input type="text" id="register-lastname" class="form-control" aria-label="Last Name">
                </div>
                <div class="form-group">
                    <label for="register-email">Email</label>
                    <input type="email" id="register-email" class="form-control" aria-label="Email">
                </div>
                <div class="form-group">
                    <label for="register-email-confirm">Confirm Email</label>
                    <input type="email" id="register-email-confirm" class="form-control" aria-label="Confirm Email">
                </div>
                <div class="form-group">
                    <label for="register-password">Password</label>
                    <input type="password" id="register-password" class="form-control" aria-label="Password">
                </div>
                <div class="form-group">
                    <label for="register-password-confirm">Confirm Password</label>
                    <input type="password" id="register-password-confirm" class="form-control" aria-label="Confirm Password">
                </div>
                <div class="form-group">
                    <label for="register-birthdate">Birthdate</label>
                    <input type="text" id="register-birthdate" class="form-control" aria-label="Birthdate">
                </div>
                <div class="form-group">
                    <label for="register-nationality">Nationality</label>
                    <select id="register-nationality" class="form-control" aria-label="Nationality">
                        <option value="">Select your country</option>
                        <!-- Countries will be added dynamically -->
                    </select>
                </div>
                <div class="form-group">
                    <label for="register-role">Role</label>
                    <select id="register-role" class="form-control" aria-label="Role">
                        <option value="manager">Manager</option>
                        <option value="staff">Staff</option>
                        <option value="customer">Customer</option>
                        <option value="admin">Admin</option>
                    </select>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" id="register-cancel">Cancel</button>
                <button class="btn btn-success" id="register-create">Create</button>
            </div>
        </div>
    </div>

    <!-- Profile Modal -->
    <div class="modal-backdrop" id="profile-modal">
        <div class="modal">
            <div class="modal-header">
                <h2 class="modal-title">My Profile</h2>
                <button class="modal-close" aria-label="Close">&times;</button>
            </div>
            <div class="modal-body">
                <div style="text-align: center; margin-bottom: 20px;">
                    <img id="profile-picture" src="https://randomuser.me/api/portraits/men/1.jpg" alt="Profile Picture" style="width: 100px; height: 100px; border-radius: 50%; object-fit: cover;">
                    <div style="margin-top: 10px;">
                        <label for="profile-picture-input" class="btn btn-primary" style="cursor: pointer;">
                            <i class="fas fa-camera"></i> Change Picture
                        </label>
                        <input type="file" id="profile-picture-input" accept="image/*" style="display: none;">
                    </div>
                </div>
                <div id="profile-view">
                    <div class="form-group">
                        <label>Name</label>
                        <p id="profile-name" class="form-control">John Doe</p>
                    </div>
                    <div class="form-group">
                        <label>Email</label>
                        <p id="profile-email" class="form-control">test@example.com</p>
                    </div>
                    <div class="form-group">
                        <label>Phone</label>
                        <p id="profile-phone" class="form-control">+1 234 567 890</p>
                    </div>
                    <div class="form-group">
                        <label>Country</label>
                        <p id="profile-country" class="form-control">United States</p>
                    </div>
                    <div class="form-group">
                        <label>Role</label>
                        <p id="profile-role" class="form-control">Admin</p>
                    </div>
                    <div class="form-group">
                        <label>Joining Date</label>
                        <p id="profile-date" class="form-control"></p>
                    </div>
                </div>
                <div id="profile-edit" style="display: none;">
                    <div class="form-group">
                        <label for="edit-first-name">First Name</label>
                        <input type="text" id="edit-first-name" class="form-control" aria-label="First Name">
                    </div>
                    <div class="form-group">
                        <label for="edit-last-name">Last Name</label>
                        <input type="text" id="edit-last-name" class="form-control" aria-label="Last Name">
                    </div>
                    <div class="form-group">
                        <label for="edit-email">Email</label>
                        <input type="email" id="edit-email" class="form-control" aria-label="Email">
                    </div>
                    <div class="form-group">
                        <label for="edit-phone">Phone</label>
                        <input type="tel" id="edit-phone" class="form-control" aria-label="Phone">
                    </div>
                    <div class="form-group">
                        <label for="edit-country">Country</label>
                        <select id="edit-country" class="form-control" aria-label="Country">
                            <!-- Countries will be added dynamically -->
                        </select>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" id="profile-close">Close</button>
                <button class="btn btn-primary" id="profile-edit-btn">Edit Profile</button>
                <button class="btn btn-success" id="profile-save-btn" style="display: none;">Save</button>
                <button class="btn btn-secondary" id="profile-cancel-btn" style="display: none;">Cancel</button>
            </div>
        </div>
    </div>

    <!-- Users Modal -->
    <div class="modal-backdrop" id="users-modal">
        <div class="modal" style="max-width: 800px;">
            <div class="modal-header">
                <h2 class="modal-title">Users</h2>
                <button class="modal-close" aria-label="Close">&times;</button>
            </div>
            <div class="modal-body">
                <div class="users-grid" id="users-grid">
                    <!-- Users will be added here dynamically -->
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" id="users-close">Close</button>
            </div>
        </div>
    </div>

    <!-- Add Task Modal -->
    <div class="modal-backdrop" id="add-task-modal">
        <div class="modal">
            <div class="modal-header">
                <h2 class="modal-title">Add New Task</h2>
                <button class="modal-close" aria-label="Close">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label for="task-title">Title</label>
                    <input type="text" id="task-title" class="form-control" aria-label="Task Title">
                </div>
                <div class="form-group">
                    <label for="task-description">Description</label>
                    <textarea id="task-description" class="form-control" rows="3" aria-label="Task Description"></textarea>
                </div>
                <div class="form-group">
                    <label for="task-due-date">Due Date</label>
                    <input type="text" id="task-due-date" class="form-control" aria-label="Due Date">
                </div>
                <div class="form-group">
                    <label for="task-priority">Priority</label>
                    <select id="task-priority" class="form-control" aria-label="Priority">
                        <option value="high">High</option>
                        <option value="medium">Medium</option>
                        <option value="low">Low</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="task-category">Category</label>
                    <select id="task-category" class="form-control" aria-label="Category">
                        <!-- Categories will be added dynamically -->
                    </select>
                </div>
                <div class="form-group">
                    <label>Sub-Tasks</label>
                    <div id="subtask-list" class="subtask-list">
                        <!-- Sub-tasks will be added here dynamically -->
                    </div>
                    <button type="button" id="add-subtask" class="add-subtask-btn">
                        <i class="fas fa-plus"></i> Add Sub-Task
                    </button>
                </div>
                <div class="form-group">
                    <label for="task-notes">Notes</label>
                    <textarea id="task-notes" class="form-control" rows="3" aria-label="Notes"></textarea>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" id="add-task-cancel">Cancel</button>
                <button class="btn btn-success" id="add-task-create">Create</button>
            </div>
        </div>
    </div>

    <!-- View Task Modal -->
    <div class="modal-backdrop" id="view-task-modal">
        <div class="modal">
            <div class="modal-header">
                <h2 class="modal-title" id="view-task-title">Task Details</h2>
                <button class="modal-close" aria-label="Close">&times;</button>
            </div>
            <div class="modal-body">
                <h3 id="view-task-name" style="margin-bottom: 15px; color: var(--primary);"></h3>
                <p id="view-task-description" style="margin-bottom: 20px;"></p>
                
                <div style="display: flex; flex-wrap: wrap; gap: 10px; margin-bottom: 20px;">
                    <span id="view-task-category" style="padding: 5px 10px; border-radius: 15px; background-color: rgba(93, 92, 222, 0.1); color: var(--primary); font-size: 12px;"></span>
                    <span id="view-task-priority" style="padding: 5px 10px; border-radius: 15px; background-color: rgba(220, 53, 69, 0.1); color: var(--danger); font-size: 12px;"></span>
                </div>
                
                <div style="margin-bottom: 15px;">
                    <strong>Due Date:</strong>
                    <span id="view-task-due-date"></span>
                </div>
                
                <div id="view-subtasks-container" style="margin-bottom: 20px;">
                    <h4 style="margin-bottom: 10px;">Sub-Tasks</h4>
                    <ul id="view-subtasks-list" style="list-style-type: none; padding: 0;">
                        <!-- Sub-tasks will be added here dynamically -->
                    </ul>
                </div>
                
                <div id="view-notes-container">
                    <h4 style="margin-bottom: 10px;">Notes</h4>
                    <p id="view-task-notes" style="background-color: var(--background-light); padding: 10px; border-radius: 5px; border: 1px solid var(--border-light);"></p>
                </div>

                <div style="margin-top: 20px;">
                    <strong>Timer:</strong>
                    <span id="view-task-timer">00:00:00</span>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" id="view-task-close">Close</button>
                <button class="btn btn-primary" id="view-task-share">
                    <i class="fas fa-share-alt"></i> Share
                </button>
            </div>
        </div>
    </div>

    <!-- Edit Task Modal -->
    <div class="modal-backdrop" id="edit-task-modal">
        <div class="modal">
            <div class="modal-header">
                <h2 class="modal-title">Edit Task</h2>
                <button class="modal-close" aria-label="Close">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label for="edit-task-title">Title</label>
                    <input type="text" id="edit-task-title" class="form-control" aria-label="Task Title">
                </div>
                <div class="form-group">
                    <label for="edit-task-description">Description</label>
                    <textarea id="edit-task-description" class="form-control" rows="3" aria-label="Task Description"></textarea>
                </div>
                <div class="form-group">
                    <label for="edit-task-due-date">Due Date</label>
                    <input type="text" id="edit-task-due-date" class="form-control" aria-label="Due Date">
                </div>
                <div class="form-group">
                    <label for="edit-task-priority">Priority</label>
                    <select id="edit-task-priority" class="form-control" aria-label="Priority">
                        <option value="high">High</option>
                        <option value="medium">Medium</option>
                        <option value="low">Low</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="edit-task-category">Category</label>
                    <select id="edit-task-category" class="form-control" aria-label="Category">
                        <!-- Categories will be added dynamically -->
                    </select>
                </div>
                <div class="form-group">
                    <label>Sub-Tasks</label>
                    <div id="edit-subtask-list" class="subtask-list">
                        <!-- Sub-tasks will be added here dynamically -->
                    </div>
                    <button type="button" id="edit-add-subtask" class="add-subtask-btn">
                        <i class="fas fa-plus"></i> Add Sub-Task
                    </button>
                </div>
                <div class="form-group">
                    <label for="edit-task-notes">Notes</label>
                    <textarea id="edit-task-notes" class="form-control" rows="3" aria-label="Notes"></textarea>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" id="edit-task-cancel">Cancel</button>
                <button class="btn btn-primary" id="edit-task-save">Save</button>
            </div>
        </div>
    </div>

    <!-- Share Task Modal -->
    <div class="modal-backdrop" id="share-task-modal">
        <div class="modal">
            <div class="modal-header">
                <h2 class="modal-title">Share Task</h2>
                <button class="modal-close" aria-label="Close">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label for="share-with">Share with</label>
                    <select id="share-with" class="form-control" aria-label="Share with" multiple>
                        <!-- Users will be added dynamically -->
                    </select>
                </div>
                <div class="form-group">
                    <label for="share-message">Message (optional)</label>
                    <textarea id="share-message" class="form-control" rows="3" aria-label="Message" placeholder="Add a message..."></textarea>
                </div>
                <div class="form-group">
                    <label>Task to share</label>
                    <div class="task-item" style="margin-bottom: 0;">
                        <h3 id="share-task-title" style="font-size: 16px; margin-bottom: 5px;"></h3>
                        <p id="share-task-description" style="font-size: 14px; color: var(--secondary); margin-bottom: 5px;"></p>
                        <div style="display: flex; gap: 10px; font-size: 12px;">
                            <div>Due: <span id="share-task-due-date"></span></div>
                            <div>Priority: <span id="share-task-priority"></span></div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" id="share-task-cancel">Cancel</button>
                <button class="btn btn-primary" id="share-task-send">
                    <i class="fas fa-paper-plane"></i> Send
                </button>
            </div>
        </div>
    </div>

    <!-- Categories Modal -->
    <div class="modal-backdrop" id="categories-modal">
        <div class="modal">
            <div class="modal-header">
                <h2 class="modal-title">Manage Categories</h2>
                <button class="modal-close" aria-label="Close">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label for="new-category">New Category</label>
                    <div style="display: flex; gap: 10px;">
                        <input type="text" id="new-category" class="form-control" aria-label="New Category">
                        <button class="btn btn-primary" id="add-category-btn">Add</button>
                    </div>
                </div>
                <div class="category-list" id="category-list" style="margin-top: 20px;">
                    <!-- Categories will be added here dynamically -->
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" id="categories-close">Close</button>
            </div>
        </div>
    </div>

    <!-- Export Modal -->
    <div class="modal-backdrop" id="export-modal">
        <div class="modal">
            <div class="modal-header">
                <h2 class="modal-title">Export Tasks</h2>
                <button class="modal-close" aria-label="Close">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label for="export-format">Select Format</label>
                    <select id="export-format" class="form-control" aria-label="Export Format">
                        <option value="json">JSON</option>
                        <option value="csv">CSV</option>
                        <option value="excel">Excel</option>
                        <option value="pdf">PDF</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="export-tasks">Tasks to Export</label>
                    <select id="export-tasks" class="form-control" aria-label="Tasks to Export">
                        <option value="all">All Tasks</option>
                        <option value="active">Active Tasks Only</option>
                        <option value="completed">Completed Tasks Only</option>
                    </select>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" id="export-cancel">Cancel</button>
                <button class="btn btn-primary" id="export-download">
                    <i class="fas fa-download"></i> Download
                </button>
            </div>
        </div>
    </div>

    <!-- Import Modal -->
    <div class="modal-backdrop" id="import-modal">
        <div class="modal">
            <div class="modal-header">
                <h2 class="modal-title">Import Tasks</h2>
                <button class="modal-close" aria-label="Close">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label for="import-file">Upload File (JSON)</label>
                    <input type="file" id="import-file" class="form-control" accept=".json" aria-label="Import File">
                </div>
                <div class="form-group">
                    <label for="import-url">Or Import from URL</label>
                    <input type="url" id="import-url" class="form-control" placeholder="https://" aria-label="Import URL">
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" id="import-cancel">Cancel</button>
                <button class="btn btn-primary" id="import-submit">
                    <i class="fas fa-file-import"></i> Import
                </button>
            </div>
        </div>
    </div>

    <!-- Date Range Modal -->
    <div class="modal-backdrop" id="date-range-modal">
        <div class="modal">
            <div class="modal-header">
                <h2 class="modal-title">Select Date Range</h2>
                <button class="modal-close" aria-label="Close">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label for="date-range-start">Start Date</label>
                    <input type="text" id="date-range-start" class="form-control" aria-label="Start Date">
                </div>
                <div class="form-group">
                    <label for="date-range-end">End Date</label>
                    <input type="text" id="date-range-end" class="form-control" aria-label="End Date">
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" id="date-range-cancel">Cancel</button>
                <button class="btn btn-primary" id="date-range-apply">Apply</button>
            </div>
        </div>
    </div>

    <!-- Status Modal -->
    <div class="modal-backdrop" id="status-modal">
        <div class="modal">
            <div class="modal-header">
                <h2 class="modal-title">Change Status</h2>
                <button class="modal-close" aria-label="Close">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label for="user-status-select">Select Status</label>
                    <select id="user-status-select" class="form-control" aria-label="User Status">
                        <option value="online">Online</option>
                        <option value="break">On Break</option>
                        <option value="shadow">Shadow</option>
                        <option value="logout">Logout</option>
                    </select>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" id="status-cancel">Cancel</button>
                <button class="btn btn-primary" id="status-apply">Apply</button>
            </div>
        </div>
    </div>

    <!-- Toast Container -->
    <div class="toast-container" id="toast-container"></div>

    <script>
        // Utility functions
        function formatTime(seconds) {
            const hours = Math.floor(seconds / 3600);
            const minutes = Math.floor((seconds % 3600) / 60);
            const secs = seconds % 60;
            return `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;
        }

        function getTimeElapsed(startTime, additionalSeconds = 0) {
            if (!startTime) return additionalSeconds;
            const elapsed = Math.floor((Date.now() - startTime) / 1000);
            return elapsed + additionalSeconds;
        }

        function debounce(func, wait) {
            let timeout;
            return function executedFunction(...args) {
                const later = () => {
                    clearTimeout(timeout);
                    func(...args);
                };
                clearTimeout(timeout);
                timeout = setTimeout(later, wait);
            };
        }

        function showToast(type, title, message, duration = 5000) {
            const toastContainer = document.getElementById('toast-container');
            const toast = document.createElement('div');
            toast.className = `toast toast-${type}`;
            
            let icon = '';
            switch (type) {
                case 'success': icon = 'fa-check'; break;
                case 'warning': icon = 'fa-exclamation-triangle'; break;
                case 'error': icon = 'fa-times'; break;
                case 'info': icon = 'fa-info'; break;
            }
            
            toast.innerHTML = `
                <div class="toast-icon">
                    <i class="fas ${icon}"></i>
                </div>
                <div class="toast-content">
                    <div class="toast-title">${title}</div>
                    <div class="toast-message">${message}</div>
                </div>
                <button class="toast-close" aria-label="Close">&times;</button>
            `;
            
            toastContainer.appendChild(toast);
            
            // Remove toast after duration
            const closeToast = () => {
                toast.style.opacity = '0';
                toast.style.transform = 'translateX(-20px)';
                setTimeout(() => {
                    toast.remove();
                }, 300);
            };
            
            // Close button click
            toast.querySelector('.toast-close').addEventListener('click', closeToast);
            
            // Auto close
            if (duration) {
                setTimeout(closeToast, duration);
            }
        }

        // Generate a random ID
        function generateId() {
            return Math.random().toString(36).substring(2, 15) + Math.random().toString(36).substring(2, 15);
        }

        // Format date
        function formatDate(date) {
            if (!date) return '';
            const d = new Date(date);
            return d.toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' });
        }

        // Check if date is today
        function isToday(date) {
            const today = new Date();
            const d = new Date(date);
            return d.getDate() === today.getDate() && 
                   d.getMonth() === today.getMonth() && 
                   d.getFullYear() === today.getFullYear();
        }

        // Check if date is within this week
        function isThisWeek(date) {
            const now = new Date();
            const d = new Date(date);
            const startOfWeek = new Date(now.setDate(now.getDate() - now.getDay()));
            startOfWeek.setHours(0, 0, 0, 0);
            const endOfWeek = new Date(startOfWeek);
            endOfWeek.setDate(endOfWeek.getDate() + 6);
            endOfWeek.setHours(23, 59, 59, 999);
            return d >= startOfWeek && d <= endOfWeek;
        }

        // Check if date is within this month
        function isThisMonth(date) {
            const now = new Date();
            const d = new Date(date);
            return d.getMonth() === now.getMonth() && 
                   d.getFullYear() === now.getFullYear();
        }

        // Check if date is expired
        function isExpired(date) {
            const now = new Date();
            now.setHours(0, 0, 0, 0);
            const d = new Date(date);
            d.setHours(0, 0, 0, 0);
            return d < now;
        }

        // Check if date is due soon (within 48 hours)
        function isDueSoon(date) {
            const now = new Date();
            const d = new Date(date);
            const diff = d.getTime() - now.getTime();
            const hours = diff / (1000 * 60 * 60);
            return hours > 0 && hours <= 48;
        }

        // Initialize the application
        document.addEventListener('DOMContentLoaded', function() {
            // Check for dark mode preference
            if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
                document.documentElement.classList.add('dark');
                document.body.classList.add('dark');
                document.getElementById('mode-switcher').innerHTML = '<i class="fas fa-sun"></i>';
            }

            // Listen for dark mode changes
            window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', event => {
                if (event.matches) {
                    document.documentElement.classList.add('dark');
                    document.body.classList.add('dark');
                    document.getElementById('mode-switcher').innerHTML = '<i class="fas fa-sun"></i>';
                } else {
                    document.documentElement.classList.remove('dark');
                    document.body.classList.remove('dark');
                    document.getElementById('mode-switcher').innerHTML = '<i class="fas fa-moon"></i>';
                }
                updateCharts();
            });

            // App state
            const appState = {
                tasks: [],
                categories: ['Work', 'Personal', 'Shopping', 'Health', 'Education', 'Finance'],
                users: [],
                notifications: [],
                currentUser: null,
                timerActive: false,
                timerTask: null,
                timerInterval: null,
                timerStart: null,
                selectedTasks: [],
                filters: {
                    status: 'all',
                    category: 'all',
                    priority: 'all',
                    dueDate: 'all',
                    search: '',
                    sort: 'default',
                    dateRange: {
                        start: null,
                        end: null
                    }
                },
                actionHistory: {
                    past: [],
                    future: []
                },
                currentTaskId: null,
                modalTask: null
            };

            // DOM Elements
            const elements = {
                authPage: document.getElementById('auth-page'),
                dashboard: document.getElementById('dashboard'),
                email: document.getElementById('email'),
                password: document.getElementById('password'),
                loginBtn: document.getElementById('login-btn'),
                registerLink: document.getElementById('register-link'),
                registerModal: document.getElementById('register-modal'),
                registerFirstname: document.getElementById('register-firstname'),
                registerLastname: document.getElementById('register-lastname'),
                registerEmail: document.getElementById('register-email'),
                registerEmailConfirm: document.getElementById('register-email-confirm'),
                registerPassword: document.getElementById('register-password'),
                registerPasswordConfirm: document.getElementById('register-password-confirm'),
                registerBirthdate: document.getElementById('register-birthdate'),
                registerNationality: document.getElementById('register-nationality'),
                registerRole: document.getElementById('register-role'),
                registerCancel: document.getElementById('register-cancel'),
                registerCreate: document.getElementById('register-create'),
                modeSwitcher: document.getElementById('mode-switcher'),
                taskTimerDisplay: document.getElementById('task-timer-display'),
                timerToggle: document.getElementById('timer-toggle'),
                profileImg: document.getElementById('profile-img'),
                profileDropdown: document.getElementById('profile-dropdown'),
                viewProfile: document.getElementById('view-profile'),
                logoutButton: document.getElementById('logout-button'),
                addTaskBtn: document.getElementById('add-task-btn'),
                taskListView: document.getElementById('task-list-view'),
                graphView: document.getElementById('graph-view'),
                listViewBtn: document.getElementById('list-view-btn'),
                graphViewBtn: document.getElementById('graph-view-btn'),
                progressChart: document.getElementById('progress-chart'),
                distributionChart: document.getElementById('distribution-chart'),
                totalTasksCount: document.getElementById('total-tasks-count'),
                completedTasksCount: document.getElementById('completed-tasks-count'),
                pendingTasksCount: document.getElementById('pending-tasks-count'),
                profileModal: document.getElementById('profile-modal'),
                profilePicture: document.getElementById('profile-picture'),
                profilePictureInput: document.getElementById('profile-picture-input'),
                profileView: document.getElementById('profile-view'),
                profileEdit: document.getElementById('profile-edit'),
                profileName: document.getElementById('profile-name'),
                profileEmail: document.getElementById('profile-email'),
                profilePhone: document.getElementById('profile-phone'),
                profileCountry: document.getElementById('profile-country'),
                profileRole: document.getElementById('profile-role'),
                profileDate: document.getElementById('profile-date'),
                profileClose: document.getElementById('profile-close'),
                profileEditBtn: document.getElementById('profile-edit-btn'),
                profileSaveBtn: document.getElementById('profile-save-btn'),
                profileCancelBtn: document.getElementById('profile-cancel-btn'),
                editFirstName: document.getElementById('edit-first-name'),
                editLastName: document.getElementById('edit-last-name'),
                editEmail: document.getElementById('edit-email'),
                editPhone: document.getElementById('edit-phone'),
                editCountry: document.getElementById('edit-country'),
                addTaskModal: document.getElementById('add-task-modal'),
                taskTitle: document.getElementById('task-title'),
                taskDescription: document.getElementById('task-description'),
                taskDueDate: document.getElementById('task-due-date'),
                taskPriority: document.getElementById('task-priority'),
                taskCategory: document.getElementById('task-category'),
                taskNotes: document.getElementById('task-notes'),
                subtaskList: document.getElementById('subtask-list'),
                addSubtask: document.getElementById('add-subtask'),
                addTaskCancel: document.getElementById('add-task-cancel'),
                addTaskCreate: document.getElementById('add-task-create'),
                viewTaskModal: document.getElementById('view-task-modal'),
                viewTaskTitle: document.getElementById('view-task-title'),
                viewTaskName: document.getElementById('view-task-name'),
                viewTaskDescription: document.getElementById('view-task-description'),
                viewTaskCategory: document.getElementById('view-task-category'),
                viewTaskPriority: document.getElementById('view-task-priority'),
                viewTaskDueDate: document.getElementById('view-task-due-date'),
                viewSubtasksList: document.getElementById('view-subtasks-list'),
                viewTaskNotes: document.getElementById('view-task-notes'),
                viewTaskTimer: document.getElementById('view-task-timer'),
                viewTaskClose: document.getElementById('view-task-close'),
                viewTaskShare: document.getElementById('view-task-share'),
                editTaskModal: document.getElementById('edit-task-modal'),
                editTaskTitle: document.getElementById('edit-task-title'),
                editTaskDescription: document.getElementById('edit-task-description'),
                editTaskDueDate: document.getElementById('edit-task-due-date'),
                editTaskPriority: document.getElementById('edit-task-priority'),
                editTaskCategory: document.getElementById('edit-task-category'),
                editSubtaskList: document.getElementById('edit-subtask-list'),
                editAddSubtask: document.getElementById('edit-add-subtask'),
                editTaskNotes: document.getElementById('edit-task-notes'),
                editTaskCancel: document.getElementById('edit-task-cancel'),
                editTaskSave: document.getElementById('edit-task-save'),
                shareTaskModal: document.getElementById('share-task-modal'),
                shareWith: document.getElementById('share-with'),
                shareMessage: document.getElementById('share-message'),
                shareTaskTitle: document.getElementById('share-task-title'),
                shareTaskDescription: document.getElementById('share-task-description'),
                shareTaskDueDate: document.getElementById('share-task-due-date'),
                shareTaskPriority: document.getElementById('share-task-priority'),
                shareTaskCancel: document.getElementById('share-task-cancel'),
                shareTaskSend: document.getElementById('share-task-send'),
                usersButton: document.getElementById('users-button'),
                usersModal: document.getElementById('users-modal'),
                usersGrid: document.getElementById('users-grid'),
                usersClose: document.getElementById('users-close'),
                categoriesBtn: document.getElementById('categories-btn'),
                categoriesModal: document.getElementById('categories-modal'),
                newCategory: document.getElementById('new-category'),
                addCategoryBtn: document.getElementById('add-category-btn'),
                categoryList: document.getElementById('category-list'),
                categoriesClose: document.getElementById('categories-close'),
                exportBtn: document.getElementById('export-btn'),
                exportModal: document.getElementById('export-modal'),
                exportFormat: document.getElementById('export-format'),
                exportTasks: document.getElementById('export-tasks'),
                exportCancel: document.getElementById('export-cancel'),
                exportDownload: document.getElementById('export-download'),
                importBtn: document.getElementById('import-btn'),
                importModal: document.getElementById('import-modal'),
                importFile: document.getElementById('import-file'),
                importUrl: document.getElementById('import-url'),
                importCancel: document.getElementById('import-cancel'),
                importSubmit: document.getElementById('import-submit'),
                searchInput: document.getElementById('search-input'),
                statusFilter: document.getElementById('status-filter'),
                categoryFilter: document.getElementById('category-filter'),
                priorityFilter: document.getElementById('priority-filter'),
                dueDateFilter: document.getElementById('due-date-filter'),
                sortOptions: document.getElementById('sort-options'),
                dateRangeModal: document.getElementById('date-range-modal'),
                dateRangeStart: document.getElementById('date-range-start'),
                dateRangeEnd: document.getElementById('date-range-end'),
                dateRangeCancel: document.getElementById('date-range-cancel'),
                dateRangeApply: document.getElementById('date-range-apply'),
                undoBtn: document.getElementById('undo-btn'),
                redoBtn: document.getElementById('redo-btn'),
                batchActions: document.getElementById('batch-actions'),
                selectedCount: document.getElementById('selected-count'),
                batchDeleteBtn: document.getElementById('batch-delete-btn'),
                batchCompleteBtn: document.getElementById('batch-complete-btn'),
                batchCancelBtn: document.getElementById('batch-cancel-btn'),
                notificationIcon: document.getElementById('notification-icon'),
                notificationBadge: document.getElementById('notification-badge'),
                notificationDropdown: document.getElementById('notification-dropdown'),
                notificationList: document.getElementById('notification-list'),
                markAllRead: document.getElementById('mark-all-read'),
                statusDropdown: document.getElementById('status-dropdown'),
                userStatus: document.getElementById('user-status'),
                statusModal: document.getElementById('status-modal'),
                userStatusSelect: document.getElementById('user-status-select'),
                statusCancel: document.getElementById('status-cancel'),
                statusApply: document.getElementById('status-apply'),
                tasksToday: document.getElementById('tasks-today'),
                highPriorityCount: document.getElementById('high-priority-count'),
                dueSoonCount: document.getElementById('due-soon-count'),
                expiredCount: document.getElementById('expired-count'),
                logo: document.getElementById('logo')
            };

            // Chart instances
            let progressChart = null;
            let distributionChart = null;

            // Initialize Flatpickr
            const taskDueDatePicker = flatpickr(elements.taskDueDate, {
                enableTime: false,
                dateFormat: "Y-m-d",
                minDate: "today"
            });

            const editTaskDueDatePicker = flatpickr(elements.editTaskDueDate, {
                enableTime: false,
                dateFormat: "Y-m-d",
                minDate: "today"
            });

            const registerBirthdatePicker = flatpickr(elements.registerBirthdate, {
                enableTime: false,
                dateFormat: "Y-m-d",
                maxDate: new Date()
            });

            const dateRangeStartPicker = flatpickr(elements.dateRangeStart, {
                enableTime: false,
                dateFormat: "Y-m-d"
            });

            const dateRangeEndPicker = flatpickr(elements.dateRangeEnd, {
                enableTime: false,
                dateFormat: "Y-m-d"
            });

            // Load data from localStorage
            function loadData() {
                const storedTasks = localStorage.getItem('tasks');
                if (storedTasks) {
                    appState.tasks = JSON.parse(storedTasks);
                } else {
                    generateRandomTasks();
                }

                const storedCategories = localStorage.getItem('categories');
                if (storedCategories) {
                    appState.categories = JSON.parse(storedCategories);
                }

                const storedUsers = localStorage.getItem('users');
                if (storedUsers) {
                    appState.users = JSON.parse(storedUsers);
                } else {
                    generateRandomUsers();
                }

                const storedNotifications = localStorage.getItem('notifications');
                if (storedNotifications) {
                    appState.notifications = JSON.parse(storedNotifications);
                }

                const storedCurrentUser = localStorage.getItem('currentUser');
                if (storedCurrentUser) {
                    appState.currentUser = JSON.parse(storedCurrentUser);
                }

                // Load timer state
                const timerState = localStorage.getItem('timerState');
                if (timerState) {
                    const parsed = JSON.parse(timerState);
                    if (parsed.timerActive && parsed.timerTask) {
                        resumeTimer(parsed.timerTask, parsed.timerSeconds || 0);
                    }
                }
            }

            // Save data to localStorage
            function saveData() {
                localStorage.setItem('tasks', JSON.stringify(appState.tasks));
                localStorage.setItem('categories', JSON.stringify(appState.categories));
                localStorage.setItem('users', JSON.stringify(appState.users));
                localStorage.setItem('notifications', JSON.stringify(appState.notifications));
                if (appState.currentUser) {
                    localStorage.setItem('currentUser', JSON.stringify(appState.currentUser));
                }

                // Save timer state
                if (appState.timerActive && appState.timerTask) {
                    const seconds = getTimeElapsed(appState.timerStart, appState.timerTask.elapsedSeconds || 0);
                    localStorage.setItem('timerState', JSON.stringify({
                        timerActive: true,
                        timerTask: appState.timerTask,
                        timerSeconds: seconds
                    }));
                } else {
                    localStorage.setItem('timerState', JSON.stringify({
                        timerActive: false
                    }));
                }
            }

            // Generate random tasks
            function generateRandomTasks() {
                const taskTitles = [
                    "Complete Project Proposal",
                    "Review Client Feedback",
                    "Schedule Team Meeting",
                    "Research New Technologies",
                    "Update Documentation",
                    "Fix Critical Bug",
                    "Create Marketing Content",
                    "Prepare Financial Report",
                    "Call New Client",
                    "Organize Office Space",
                    "Develop Website Feature",
                    "Design New Logo"
                ];
                
                const descriptions = [
                    "Need to finish this as soon as possible",
                    "Make sure to include all the feedback points",
                    "All team members should be present",
                    "Focus on emerging trends in our industry",
                    "Ensure all sections are updated with latest information",
                    "High priority - affecting multiple users",
                    "Align with new brand guidelines",
                    "Include Q2 financial data",
                    "Discuss potential collaboration opportunities",
                    "Clean up and reorganize desk area",
                    "Implement user authentication system",
                    "Create multiple variations for client review"
                ];
                
                const notes = [
                    "Don't forget to check with Sarah before finalizing",
                    "John mentioned we should focus on the UX aspect",
                    "Book the conference room in advance",
                    "Consider competitive analysis as well",
                    "Ask Tom for the latest metrics",
                    "The bug appears on Firefox and Safari only",
                    "Use the new brand colors and typography",
                    "Coordinate with accounting team",
                    "Prepare a presentation with our services",
                    "Order new storage containers",
                    "Check security best practices",
                    "Use company color palette"
                ];
                
                const subtaskExamples = [
                    ["Research topic", "Create outline", "Draft content", "Review and edit"],
                    ["Collect data", "Analyze findings", "Create visual charts", "Write summary"],
                    ["Send invitations", "Prepare agenda", "Setup presentation", "Follow up with minutes"],
                    ["Read articles", "Watch tutorials", "Try demos", "Create summary report"],
                    ["Update section 1", "Review section 2", "Add new appendix", "Fix formatting"],
                    ["Reproduce issue", "Debug code", "Test fix", "Deploy solution"],
                    ["Draft copy", "Design graphics", "Get approval", "Schedule publication"],
                    ["Gather data", "Verify numbers", "Create charts", "Write analysis"],
                    ["Prepare talking points", "Research company", "Schedule call", "Send follow-up email"],
                    ["Sort paperwork", "Clean desk", "Organize cables", "Label storage"],
                    ["Design UI", "Implement backend", "Add validation", "Test functionality"],
                    ["Sketch concepts", "Create digital mockups", "Get feedback", "Finalize design"]
                ];
                
                const currentDate = new Date();
                
                // Create 12 random tasks
                appState.tasks = [];
                for (let i = 0; i < 12; i++) {
                    const randomIndex = Math.floor(Math.random() * taskTitles.length);
                    
                    // Generate random due date between yesterday and 10 days from now
                    const dueDate = new Date(currentDate);
                    dueDate.setDate(dueDate.getDate() + Math.floor(Math.random() * 12) - 1); // -1 to 10 days from now
                    
                    // Randomly assign priority
                    const priorities = ["high", "medium", "low"];
                    const priority = priorities[Math.floor(Math.random() * priorities.length)];
                    
                    // Randomly assign category
                    const category = appState.categories[Math.floor(Math.random() * appState.categories.length)];
                    
                    // Randomly determine if task is completed
                    const completed = Math.random() > 0.7;
                    
                    // Create subtasks (30% chance of having subtasks)
                    let subtasks = [];
                    if (Math.random() < 0.3) {
                        const subtaskList = subtaskExamples[randomIndex] || subtaskExamples[0];
                        // Add 2-4 subtasks
                        const subtaskCount = Math.floor(Math.random() * 3) + 2;
                        for (let j = 0; j < subtaskCount; j++) {
                            if (j < subtaskList.length) {
                                subtasks.push({
                                    id: generateId(),
                                    title: subtaskList[j],
                                    completed: Math.random() > 0.5
                                });
                            }
                        }
                    }
                    
                    // Create task
                    appState.tasks.push({
                        id: generateId(),
                        title: taskTitles[randomIndex],
                        description: descriptions[randomIndex],
                        dueDate: dueDate.toISOString().split('T')[0],
                        priority: priority,
                        category: category,
                        notes: notes[randomIndex],
                        completed: completed,
                        subtasks: subtasks,
                        createdAt: new Date().toISOString(),
                        elapsedSeconds: Math.floor(Math.random() * 3600) // Random elapsed time up to 1 hour
                    });
                }
            }

            // Generate random users
            function generateRandomUsers() {
                const firstNames = ["John", "Jane", "Michael", "Emma", "David", "Sarah", "Robert", "Lisa", "Thomas", "Emily"];
                const lastNames = ["Smith", "Johnson", "Williams", "Brown", "Jones", "Miller", "Davis", "Garcia", "Wilson", "Martinez"];
                const roles = ["Manager", "Staff", "Customer", "Admin"];
                const countries = ["United States", "Canada", "United Kingdom", "Germany", "France", "Australia", "Japan", "Brazil", "India", "China"];
                
                appState.users = [];
                for (let i = 0; i < 10; i++) {
                    const firstName = firstNames[Math.floor(Math.random() * firstNames.length)];
                    const lastName = lastNames[Math.floor(Math.random() * lastNames.length)];
                    const email = `${firstName.toLowerCase()}.${lastName.toLowerCase()}@example.com`;
                    
                    appState.users.push({
                        id: generateId(),
                        firstName: firstName,
                        lastName: lastName,
                        email: email,
                        password: "123456", // All users have the same password for demo
                        role: roles[Math.floor(Math.random() * roles.length)],
                        country: countries[Math.floor(Math.random() * countries.length)],
                        phone: `+1 ${Math.floor(Math.random() * 900) + 100}-${Math.floor(Math.random() * 900) + 100}-${Math.floor(Math.random() * 9000) + 1000}`,
                        avatar: `https://randomuser.me/api/portraits/${Math.random() > 0.5 ? 'men' : 'women'}/${i + 1}.jpg`,
                        joinDate: new Date(Date.now() - Math.floor(Math.random() * 31536000000)).toISOString() // Random date within the last year
                    });
                }
                
                // Add the default test user
                appState.users.push({
                    id: generateId(),
                    firstName: "Test",
                    lastName: "User",
                    email: "test@example.com",
                    password: "123456",
                    role: "Admin",
                    country: "United States",
                    phone: "+1 234-567-8901",
                    avatar: "https://randomuser.me/api/portraits/men/1.jpg",
                    joinDate: new Date().toISOString()
                });
            }

            // Show the login page
            function showLogin() {
                elements.authPage.style.display = 'flex';
                elements.dashboard.style.display = 'none';
            }

            // Show the dashboard
            function showDashboard() {
                elements.authPage.style.display = 'none';
                elements.dashboard.style.display = 'block';
                renderDashboard();
            }

            // Render all dashboard content
            function renderDashboard() {
                renderTasks();
                updateTaskCounts();
                updateCharts();
                renderCategories();
                updateNotificationBadge();
                updateInsights();
            }

            // Filter tasks based on current filters
            function getFilteredTasks() {
                return appState.tasks.filter(task => {
                    // Filter by status
                    if (appState.filters.status === 'active' && task.completed) return false;
                    if (appState.filters.status === 'completed' && !task.completed) return false;
                    
                    // Filter by category
                    if (appState.filters.category !== 'all' && task.category !== appState.filters.category) return false;
                    
                    // Filter by priority
                    if (appState.filters.priority !== 'all' && task.priority !== appState.filters.priority) return false;
                    
                    // Filter by due date
                    const dueDate = new Date(task.dueDate);
                    if (appState.filters.dueDate === 'today' && !isToday(dueDate)) return false;
                    if (appState.filters.dueDate === 'week' && !isThisWeek(dueDate)) return false;
                    if (appState.filters.dueDate === 'month' && !isThisMonth(dueDate)) return false;
                    if (appState.filters.dueDate === 'custom' && appState.filters.dateRange.start && appState.filters.dateRange.end) {
                        const start = new Date(appState.filters.dateRange.start);
                        const end = new Date(appState.filters.dateRange.end);
                        end.setHours(23, 59, 59, 999); // Set to end of day
                        if (dueDate < start || dueDate > end) return false;
                    }
                    
                    // Filter by search term
                    if (appState.filters.search) {
                        const searchTerm = appState.filters.search.toLowerCase();
                        const titleMatch = task.title.toLowerCase().includes(searchTerm);
                        const descMatch = task.description.toLowerCase().includes(searchTerm);
                        if (!titleMatch && !descMatch) return false;
                    }
                    
                    return true;
                }).sort((a, b) => {
                    // Sort tasks
                    switch (appState.filters.sort) {
                        case 'title-asc':
                            return a.title.localeCompare(b.title);
                        case 'title-desc':
                            return b.title.localeCompare(a.title);
                        case 'date-asc':
                            return new Date(a.dueDate) - new Date(b.dueDate);
                        case 'date-desc':
                            return new Date(b.dueDate) - new Date(a.dueDate);
                        case 'priority-asc':
                            const priorityOrder = { low: 0, medium: 1, high: 2 };
                            return priorityOrder[a.priority] - priorityOrder[b.priority];
                        case 'priority-desc':
                            const priorityOrderDesc = { low: 0, medium: 1, high: 2 };
                            return priorityOrderDesc[b.priority] - priorityOrderDesc[a.priority];
                        default:
                            return 0;
                    }
                });
            }

            // Render tasks
            function renderTasks() {
                const filteredTasks = getFilteredTasks();
                const taskListContainer = elements.taskListView;
                taskListContainer.innerHTML = '';
                
                if (filteredTasks.length === 0) {
                    taskListContainer.innerHTML = `
                        <div style="text-align: center; padding: 40px;">
                            <i class="fas fa-tasks" style="font-size: 48px; color: var(--secondary); margin-bottom: 15px;"></i>
                            <h3>No tasks found</h3>
                            <p>Create a new task or adjust your filters.</p>
                        </div>
                    `;
                    return;
                }
                
                filteredTasks.forEach(task => {
                    const taskEl = document.createElement('div');
                    taskEl.className = `task-item ${task.priority}-priority`;
                    taskEl.setAttribute('data-id', task.id);
                    taskEl.setAttribute('draggable', 'true');
                    
                    // Add status classes
                    if (task.completed) {
                        taskEl.classList.add('completed');
                    } else if (isExpired(task.dueDate)) {
                        taskEl.classList.add('expired');
                    } else if (isDueSoon(task.dueDate)) {
                        taskEl.classList.add('due-soon');
                    } else {
                        taskEl.classList.add('ok');
                    }
                    
                    const subtasksCompleted = task.subtasks.filter(st => st.completed).length;
                    const subtasksTotal = task.subtasks.length;
                    const subtasksText = subtasksTotal > 0 
                        ? `<div class="task-meta-item"><i class="fas fa-tasks"></i> ${subtasksCompleted}/${subtasksTotal} subtasks</div>` 
                        : '';
                    
                    const dueDateClass = isExpired(task.dueDate) ? 'text-danger' : (isDueSoon(task.dueDate) ? 'text-warning' : '');
                    const priorityClasses = {
                        high: 'priority-high',
                        medium: 'priority-medium',
                        low: 'priority-low'
                    };

                    const timerInfo = task.elapsedSeconds ? 
                        `<div class="task-timer-info"><i class="fas fa-clock"></i> Time spent: ${formatTime(task.elapsedSeconds)}</div>` :
                        '';
                    
                    taskEl.innerHTML = `
                        <div class="task-header">
                            <div class="task-header-left">
                                <div class="task-select">
                                    <input type="checkbox" id="task-select-${task.id}" class="task-checkbox" aria-label="Select task" data-id="${task.id}">
                                </div>
                                <div>
                                    <h3 class="task-title">${task.title}</h3>
                                    <p class="task-description">${task.description}</p>
                                </div>
                            </div>
                            <div class="task-actions">
                                <button class="task-action-btn view" aria-label="View task" data-id="${task.id}">
                                    <i class="fas fa-eye"></i>
                                </button>
                                <button class="task-action-btn edit" aria-label="Edit task" data-id="${task.id}">
                                    <i class="fas fa-edit"></i>
                                </button>
                                <button class="task-action-btn delete" aria-label="Delete task" data-id="${task.id}">
                                    <i class="fas fa-trash"></i>
                                </button>
                                <button class="task-action-btn ${appState.timerTask && appState.timerTask.id === task.id && appState.timerActive ? 'pause' : 'play'}" aria-label="${appState.timerTask && appState.timerTask.id === task.id && appState.timerActive ? 'Pause timer' : 'Start timer'}" data-id="${task.id}">
                                    <i class="fas ${appState.timerTask && appState.timerTask.id === task.id && appState.timerActive ? 'fa-pause' : 'fa-play'}"></i>
                                </button>
                                <button class="task-action-btn toggle-complete" aria-label="${task.completed ? 'Mark as incomplete' : 'Mark as complete'}" data-id="${task.id}">
                                    <i class="fas ${task.completed ? 'fa-times-circle' : 'fa-check-circle'}"></i>
                                </button>
                            </div>
                        </div>
                        <div class="task-meta">
                            <div class="task-meta-item"><i class="fas fa-calendar"></i> <span class="${dueDateClass}">${formatDate(task.dueDate)}</span></div>
                            <div class="task-meta-item"><span class="task-priority ${priorityClasses[task.priority]}">${task.priority.charAt(0).toUpperCase() + task.priority.slice(1)}</span></div>
                            <div class="task-meta-item"><span class="task-category">${task.category}</span></div>
                            ${subtasksText}
                        </div>
                        ${timerInfo}
                    `;
                    
                    taskListContainer.appendChild(taskEl);
                });
                
                // Add event listeners
                addTaskEventListeners();
            }

            // Add event listeners to task elements
            function addTaskEventListeners() {
                // View task buttons
                document.querySelectorAll('.task-action-btn.view').forEach(btn => {
                    btn.addEventListener('click', function() {
                        const taskId = this.getAttribute('data-id');
                        viewTask(taskId);
                    });
                });
                
                // Edit task buttons
                document.querySelectorAll('.task-action-btn.edit').forEach(btn => {
                    btn.addEventListener('click', function() {
                        const taskId = this.getAttribute('data-id');
                        editTask(taskId);
                    });
                });
                
                // Delete task buttons
                document.querySelectorAll('.task-action-btn.delete').forEach(btn => {
                    btn.addEventListener('click', function() {
                        const taskId = this.getAttribute('data-id');
                        deleteTask(taskId);
                    });
                });
                
                // Play/Pause task timer buttons
                document.querySelectorAll('.task-action-btn.play, .task-action-btn.pause').forEach(btn => {
                    btn.addEventListener('click', function() {
                        const taskId = this.getAttribute('data-id');
                        const task = appState.tasks.find(t => t.id === taskId);
                        if (!task) return;
                        
                        if (appState.timerActive && appState.timerTask && appState.timerTask.id === taskId) {
                            pauseTimer();
                        } else {
                            startTimer(task);
                        }
                    });
                });
                
                // Toggle complete buttons
                document.querySelectorAll('.task-action-btn.toggle-complete').forEach(btn => {
                    btn.addEventListener('click', function() {
                        const taskId = this.getAttribute('data-id');
                        toggleTaskComplete(taskId);
                    });
                });
                
                // Task checkboxes
                document.querySelectorAll('.task-checkbox').forEach(checkbox => {
                    checkbox.addEventListener('change', function() {
                        const taskId = this.getAttribute('data-id');
                        if (this.checked) {
                            appState.selectedTasks.push(taskId);
                        } else {
                            appState.selectedTasks = appState.selectedTasks.filter(id => id !== taskId);
                        }
                        
                        updateBatchActions();
                    });
                });
                
                // Make tasks draggable
                document.querySelectorAll('.task-item').forEach(task => {
                    task.addEventListener('dragstart', function(e) {
                        e.dataTransfer.setData('text/plain', task.getAttribute('data-id'));
                        task.classList.add('dragging');
                    });
                    
                    task.addEventListener('dragend', function() {
                        task.classList.remove('dragging');
                    });
                    
                    task.addEventListener('dragover', function(e) {
                        e.preventDefault();
                        const draggingTask = document.querySelector('.dragging');
                        if (draggingTask && draggingTask !== task) {
                            const taskListRect = elements.taskListView.getBoundingClientRect();
                            const taskRect = task.getBoundingClientRect();
                            const mouseY = e.clientY;
                            
                            // Determine if we should insert before or after this task
                            const isBelow = mouseY > (taskRect.top + taskRect.height / 2);
                            
                            if (isBelow) {
                                elements.taskListView.insertBefore(draggingTask, task.nextSibling);
                            } else {
                                elements.taskListView.insertBefore(draggingTask, task);
                            }
                        }
                    });
                    
                    task.addEventListener('drop', function(e) {
                        e.preventDefault();
                        const draggedTaskId = e.dataTransfer.getData('text/plain');
                        const targetTaskId = task.getAttribute('data-id');
                        
                        if (draggedTaskId && targetTaskId && draggedTaskId !== targetTaskId) {
                            // Find indices of tasks
                            const draggedIndex = appState.tasks.findIndex(t => t.id === draggedTaskId);
                            const targetIndex = appState.tasks.findIndex(t => t.id === targetTaskId);
                            
                            if (draggedIndex !== -1 && targetIndex !== -1) {
                                // Save for undo
                                pushToHistory({
                                    action: 'reorder',
                                    tasks: [...appState.tasks]
                                });
                                
                                // Move task
                                const [draggedTask] = appState.tasks.splice(draggedIndex, 1);
                                appState.tasks.splice(targetIndex, 0, draggedTask);
                                
                                // Refresh
                                saveData();
                                renderTasks();
                                
                                showToast('success', 'Task Reordered', 'Task order has been updated');
                            }
                        }
                    });
                });
            }

            // Update batch actions visibility and count
            function updateBatchActions() {
                if (appState.selectedTasks.length > 0) {
                    elements.batchActions.classList.add('show');
                    elements.selectedCount.textContent = appState.selectedTasks.length;
                } else {
                    elements.batchActions.classList.remove('show');
                }
            }

            // Start task timer
            function startTimer(task) {
                // If a timer is already running for another task, pause it first
                if (appState.timerActive && appState.timerTask && appState.timerTask.id !== task.id) {
                    pauseTimer();
                }
                
                // Start new timer
                appState.timerTask = task;
                appState.timerActive = true;
                appState.timerStart = Date.now();
                
                if (!appState.timerInterval) {
                    appState.timerInterval = setInterval(updateTimer, 1000);
                }
                
                // Update UI
                elements.timerToggle.innerHTML = '<i class="fas fa-pause"></i>';
                document.querySelectorAll(`.task-action-btn[data-id="${task.id}"]`).forEach(btn => {
                    if (btn.classList.contains('play') || btn.classList.contains('pause')) {
                        btn.classList.remove('play');
                        btn.classList.add('pause');
                        btn.setAttribute('aria-label', 'Pause timer');
                        btn.innerHTML = '<i class="fas fa-pause"></i>';
                    }
                });
                
                showToast('info', 'Timer Started', `Timer started for task: ${task.title}`);
                saveData();
            }

            // Pause task timer
            function pauseTimer() {
                if (!appState.timerActive || !appState.timerTask) return;
                
                // Calculate elapsed time
                const elapsed = getTimeElapsed(appState.timerStart, appState.timerTask.elapsedSeconds || 0);
                
                // Update task
                const taskIndex = appState.tasks.findIndex(t => t.id === appState.timerTask.id);
                if (taskIndex !== -1) {
                    appState.tasks[taskIndex].elapsedSeconds = elapsed;
                }
                
                // Reset timer state
                appState.timerActive = false;
                appState.timerStart = null;
                
                // Update UI
                elements.timerToggle.innerHTML = '<i class="fas fa-play"></i>';
                document.querySelectorAll(`.task-action-btn.pause[data-id="${appState.timerTask.id}"]`).forEach(btn => {
                    btn.classList.remove('pause');
                    btn.classList.add('play');
                    btn.setAttribute('aria-label', 'Start timer');
                    btn.innerHTML = '<i class="fas fa-play"></i>';
                });
                
                const taskTitle = appState.timerTask.title;
                const formattedTime = formatTime(elapsed);
                showToast('info', 'Timer Paused', `Time spent on "${taskTitle}": ${formattedTime}`);
                
                saveData();
            }

            // Resume timer from saved state
            function resumeTimer(task, seconds) {
                const existingTask = appState.tasks.find(t => t.id === task.id);
                if (!existingTask) return;
                
                existingTask.elapsedSeconds = seconds;
                appState.timerTask = existingTask;
                appState.timerActive = true;
                appState.timerStart = Date.now();
                
                if (!appState.timerInterval) {
                    appState.timerInterval = setInterval(updateTimer, 1000);
                }
                
                // Update UI
                elements.timerToggle.innerHTML = '<i class="fas fa-pause"></i>';
            }

            // Update timer display
            function updateTimer() {
                if (!appState.timerActive || !appState.timerTask) return;
                
                const elapsed = getTimeElapsed(appState.timerStart, appState.timerTask.elapsedSeconds || 0);
                elements.taskTimerDisplay.textContent = formatTime(elapsed);
                
                // Also update the timer in the view task modal if open
                if (elements.viewTaskModal.classList.contains('show') && appState.modalTask && appState.modalTask.id === appState.timerTask.id) {
                    elements.viewTaskTimer.textContent = formatTime(elapsed);
                }
            }

            // Toggle task complete
            function toggleTaskComplete(taskId) {
                const taskIndex = appState.tasks.findIndex(t => t.id === taskId);
                if (taskIndex === -1) return;
                
                // Save for undo
                pushToHistory({
                    action: 'toggle',
                    taskId: taskId,
                    oldValue: appState.tasks[taskIndex].completed
                });
                
                // Toggle completion
                appState.tasks[taskIndex].completed = !appState.tasks[taskIndex].completed;
                
                // Add notification
                addNotification(
                    appState.tasks[taskIndex].completed ? 'Task Completed' : 'Task Reopened',
                    `"${appState.tasks[taskIndex].title}" is now ${appState.tasks[taskIndex].completed ? 'completed' : 'active'}.`
                );
                
                // Update UI
                saveData();
                renderTasks();
                updateTaskCounts();
                updateCharts();
                updateInsights();
                
                showToast(
                    'success', 
                    appState.tasks[taskIndex].completed ? 'Task Completed' : 'Task Reopened', 
                    `"${appState.tasks[taskIndex].title}" is now ${appState.tasks[taskIndex].completed ? 'completed' : 'active'}.`
                );
            }

            // View task details
            function viewTask(taskId) {
                const task = appState.tasks.find(t => t.id === taskId);
                if (!task) return;
                
                appState.modalTask = task;
                
                // Fill modal with task details
                elements.viewTaskName.textContent = task.title;
                elements.viewTaskDescription.textContent = task.description || 'No description';
                elements.viewTaskCategory.textContent = task.category;
                
                // Set priority with proper class
                elements.viewTaskPriority.textContent = task.priority.charAt(0).toUpperCase() + task.priority.slice(1);
                elements.viewTaskPriority.className = '';
                if (task.priority === 'high') {
                    elements.viewTaskPriority.style.backgroundColor = 'rgba(220, 53, 69, 0.1)';
                    elements.viewTaskPriority.style.color = 'var(--danger)';
                } else if (task.priority === 'medium') {
                    elements.viewTaskPriority.style.backgroundColor = 'rgba(255, 193, 7, 0.1)';
                    elements.viewTaskPriority.style.color = 'var(--warning)';
                } else {
                    elements.viewTaskPriority.style.backgroundColor = 'rgba(108, 117, 125, 0.1)';
                    elements.viewTaskPriority.style.color = 'var(--secondary)';
                }
                
                elements.viewTaskDueDate.textContent = formatDate(task.dueDate);
                
                // Show subtasks if any
                if (task.subtasks && task.subtasks.length > 0) {
                    elements.viewSubtasksList.innerHTML = '';
                    task.subtasks.forEach(subtask => {
                        const li = document.createElement('li');
                        li.style.display = 'flex';
                        li.style.alignItems = 'center';
                        li.style.marginBottom = '8px';
                        li.style.padding = '8px';
                        li.style.backgroundColor = 'var(--background-light)';
                        li.style.borderRadius = '5px';
                        li.style.border = '1px solid var(--border-light)';
                        
                        const icon = document.createElement('i');
                        icon.className = `fas ${subtask.completed ? 'fa-check-circle' : 'fa-circle'}`;
                        icon.style.marginRight = '10px';
                        icon.style.color = subtask.completed ? 'var(--success)' : 'var(--secondary)';
                        
                        li.appendChild(icon);
                        li.appendChild(document.createTextNode(subtask.title));
                        elements.viewSubtasksList.appendChild(li);
                    });
                    document.getElementById('view-subtasks-container').style.display = 'block';
                } else {
                    document.getElementById('view-subtasks-container').style.display = 'none';
                }
                
                // Show notes if any
                if (task.notes) {
                    elements.viewTaskNotes.textContent = task.notes;
                    document.getElementById('view-notes-container').style.display = 'block';
                } else {
                    document.getElementById('view-notes-container').style.display = 'none';
                }
                
                // Show timer
                elements.viewTaskTimer.textContent = formatTime(task.elapsedSeconds || 0);
                
                // Show modal
                elements.viewTaskModal.classList.add('show');
            }

            // Edit task
            function editTask(taskId) {
                const task = appState.tasks.find(t => t.id === taskId);
                if (!task) return;
                
                appState.modalTask = task;
                
                // Fill form with task details
                elements.editTaskTitle.value = task.title;
                elements.editTaskDescription.value = task.description || '';
                editTaskDueDatePicker.setDate(task.dueDate);
                elements.editTaskPriority.value = task.priority;
                elements.editTaskCategory.value = task.category;
                elements.editTaskNotes.value = task.notes || '';
                
                // Add subtasks
                elements.editSubtaskList.innerHTML = '';
                if (task.subtasks && task.subtasks.length > 0) {
                    task.subtasks.forEach(subtask => {
                        addSubtaskToForm(elements.editSubtaskList, subtask.title, subtask.completed, subtask.id);
                    });
                }
                
                // Show modal
                elements.editTaskModal.classList.add('show');
            }

            // Delete task
            function deleteTask(taskId) {
                const taskIndex = appState.tasks.findIndex(t => t.id === taskId);
                if (taskIndex === -1) return;
                
                const task = appState.tasks[taskIndex];
                
                // Save for undo
                pushToHistory({
                    action: 'delete',
                    task: {...task},
                    index: taskIndex
                });
                
                // Remove task
                appState.tasks.splice(taskIndex, 1);
                
                // If this was the active timer task, stop the timer
                if (appState.timerTask && appState.timerTask.id === taskId) {
                    pauseTimer();
                    appState.timerTask = null;
                    elements.taskTimerDisplay.textContent = '00:00:00';
                }
                
                // Add notification
                addNotification('Task Deleted', `"${task.title}" has been deleted.`);
                
                // Update UI
                saveData();
                renderTasks();
                updateTaskCounts();
                updateCharts();
                updateInsights();
                
                showToast('success', 'Task Deleted', `"${task.title}" has been deleted.`);
            }

            // Share task
            function shareTask(taskId) {
                const task = appState.tasks.find(t => t.id === taskId);
                if (!task) return;
                
                appState.modalTask = task;
                
                // Fill modal with task details
                elements.shareTaskTitle.textContent = task.title;
                elements.shareTaskDescription.textContent = task.description || 'No description';
                elements.shareTaskDueDate.textContent = formatDate(task.dueDate);
                elements.shareTaskPriority.textContent = task.priority.charAt(0).toUpperCase() + task.priority.slice(1);
                
                // Fill user options
                elements.shareWith.innerHTML = '';
                appState.users.forEach(user => {
                    if (user.id !== appState.currentUser.id) {
                        const option = document.createElement('option');
                        option.value = user.id;
                        option.textContent = `${user.firstName} ${user.lastName}`;
                        elements.shareWith.appendChild(option);
                    }
                });
                
                // Show modal
                elements.shareTaskModal.classList.add('show');
            }

            // Update task counts
            function updateTaskCounts() {
                const total = appState.tasks.length;
                const completed = appState.tasks.filter(task => task.completed).length;
                const pending = total - completed;
                
                elements.totalTasksCount.textContent = total;
                elements.completedTasksCount.textContent = completed;
                elements.pendingTasksCount.textContent = pending;
            }

            // Update charts
            function updateCharts() {
                const ctx1 = elements.progressChart.getContext('2d');
                const ctx2 = elements.distributionChart.getContext('2d');
                
                // Determine theme colors
                const isDark = document.body.classList.contains('dark');
                const textColor = isDark ? '#f8f9fa' : '#212529';
                
                // Destroy existing charts
                if (progressChart) progressChart.destroy();
                if (distributionChart) distributionChart.destroy();
                
                // Get task data by month (last 6 months)
                const months = [];
                const completedData = [];
                const pendingData = [];
                
                const now = new Date();
                for (let i = 5; i >= 0; i--) {
                    const month = new Date(now.getFullYear(), now.getMonth() - i, 1);
                    const monthName = month.toLocaleDateString('en-US', { month: 'short' });
                    
                    months.push(monthName);
                    
                    // Count tasks for this month
                    const monthStart = new Date(month.getFullYear(), month.getMonth(), 1);
                    const monthEnd = new Date(month.getFullYear(), month.getMonth() + 1, 0);
                    
                    const tasksThisMonth = appState.tasks.filter(task => {
                        const taskDate = new Date(task.dueDate);
                        return taskDate >= monthStart && taskDate <= monthEnd;
                    });
                    
                    completedData.push(tasksThisMonth.filter(task => task.completed).length);
                    pendingData.push(tasksThisMonth.filter(task => !task.completed).length);
                }
                
                // Create progress chart (line)
                progressChart = new Chart(ctx1, {
                    type: 'line',
                    data: {
                        labels: months,
                        datasets: [
                            {
                                label: 'Completed',
                                data: completedData,
                                backgroundColor: 'rgba(40, 167, 69, 0.2)',
                                borderColor: 'rgba(40, 167, 69, 1)',
                                borderWidth: 2,
                                tension: 0.3,
                                fill: true
                            },
                            {
                                label: 'Pending',
                                data: pendingData,
                                backgroundColor: 'rgba(255, 193, 7, 0.2)',
                                borderColor: 'rgba(255, 193, 7, 1)',
                                borderWidth: 2,
                                tension: 0.3,
                                fill: true
                            }
                        ]
                    },
                    options: {
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                position: 'top',
                                labels: {
                                    color: textColor
                                }
                            }
                        },
                        scales: {
                            y: {
                                beginAtZero: true,
                                ticks: {
                                    color: textColor
                                },
                                grid: {
                                    color: isDark ? 'rgba(255, 255, 255, 0.1)' : 'rgba(0, 0, 0, 0.1)'
                                }
                            },
                            x: {
                                ticks: {
                                    color: textColor
                                },
                                grid: {
                                    color: isDark ? 'rgba(255, 255, 255, 0.1)' : 'rgba(0, 0, 0, 0.1)'
                                }
                            }
                        },
                        animation: {
                            duration: 1000
                        }
                    }
                });
                
                // Get distribution data
                const totalTasks = appState.tasks.length;
                const completed = appState.tasks.filter(task => task.completed).length;
                const pending = totalTasks - completed;
                
                // Get priority distribution
                const highPriority = appState.tasks.filter(task => task.priority === 'high').length;
                const mediumPriority = appState.tasks.filter(task => task.priority === 'medium').length;
                const lowPriority = appState.tasks.filter(task => task.priority === 'low').length;
                
                // Create distribution chart (pie)
                distributionChart = new Chart(ctx2, {
                    type: 'pie',
                    data: {
                        labels: ['Completed', 'Pending'],
                        datasets: [{
                            data: [completed, pending],
                            backgroundColor: [
                                'rgba(40, 167, 69, 0.8)',
                                'rgba(255, 193, 7, 0.8)'
                            ],
                            borderColor: [
                                'rgba(40, 167, 69, 1)',
                                'rgba(255, 193, 7, 1)'
                            ],
                            borderWidth: 1
                        }]
                    },
                    options: {
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                position: 'top',
                                labels: {
                                    color: textColor
                                }
                            }
                        },
                        animation: {
                            animateRotate: true,
                            animateScale: true,
                            duration: 1000
                        }
                    }
                });
            }

            // Add a new task
            function createTask(taskData) {
                const newTask = {
                    id: generateId(),
                    title: taskData.title,
                    description: taskData.description,
                    dueDate: taskData.dueDate,
                    priority: taskData.priority,
                    category: taskData.category,
                    notes: taskData.notes,
                    completed: false,
                    subtasks: taskData.subtasks || [],
                    createdAt: new Date().toISOString(),
                    elapsedSeconds: 0
                };
                
                // Save for undo
                pushToHistory({
                    action: 'create',
                    task: newTask
                });
                
                // Add task
                appState.tasks.push(newTask);
                
                // Add notification
                addNotification('Task Created', `New task "${newTask.title}" has been created.`);
                
                // Update UI
                saveData();
                renderTasks();
                updateTaskCounts();
                updateCharts();
                updateInsights();
                
                showToast('success', 'Task Created', `New task "${newTask.title}" has been created.`);
                
                return newTask;
            }

            // Update an existing task
            function updateTask(taskId, taskData) {
                const taskIndex = appState.tasks.findIndex(t => t.id === taskId);
                if (taskIndex === -1) return null;
                
                const oldTask = {...appState.tasks[taskIndex]};
                
                // Save for undo
                pushToHistory({
                    action: 'update',
                    taskId: taskId,
                    oldTask: oldTask,
                    newTask: taskData
                });
                
                // Update task
                appState.tasks[taskIndex] = {
                    ...appState.tasks[taskIndex],
                    ...taskData
                };
                
                // Add notification
                addNotification('Task Updated', `Task "${taskData.title}" has been updated.`);
                
                // Update UI
                saveData();
                renderTasks();
                updateTaskCounts();
                updateCharts();
                updateInsights();
                
                showToast('success', 'Task Updated', `Task "${taskData.title}" has been updated.`);
                
                return appState.tasks[taskIndex];
            }

            // Add a subtask item to the form
            function addSubtaskToForm(container, value = '', completed = false, id = null) {
                const subtaskId = id || generateId();
                const subtaskItem = document.createElement('div');
                subtaskItem.className = 'subtask-item';
                subtaskItem.innerHTML = `
                    <input type="checkbox" ${completed ? 'checked' : ''} aria-label="Subtask completed">
                    <input type="text" class="form-control subtask-input" value="${value}" placeholder="Subtask" aria-label="Subtask title">
                    <div class="subtask-actions">
                        <button type="button" class="task-action-btn delete-subtask" aria-label="Delete subtask">
                            <i class="fas fa-trash"></i>
                        </button>
                    </div>
                `;
                
                // Add data attribute for identification
                subtaskItem.setAttribute('data-id', subtaskId);
                
                // Add event listener for delete button
                subtaskItem.querySelector('.delete-subtask').addEventListener('click', function() {
                    subtaskItem.remove();
                });
                
                container.appendChild(subtaskItem);
            }

            // Get subtasks from the form
            function getSubtasksFromForm(container) {
                const subtasks = [];
                container.querySelectorAll('.subtask-item').forEach(item => {
                    const title = item.querySelector('.subtask-input').value.trim();
                    if (title) {
                        subtasks.push({
                            id: item.getAttribute('data-id'),
                            title: title,
                            completed: item.querySelector('input[type="checkbox"]').checked
                        });
                    }
                });
                return subtasks;
            }

            // Add a notification
            function addNotification(title, message) {
                const notification = {
                    id: generateId(),
                    title: title,
                    message: message,
                    timestamp: new Date().toISOString(),
                    read: false
                };
                
                appState.notifications.unshift(notification);
                
                // Limit to 50 notifications
                if (appState.notifications.length > 50) {
                    appState.notifications = appState.notifications.slice(0, 50);
                }
                
                saveData();
                updateNotificationBadge();
            }

            // Update notification badge
            function updateNotificationBadge() {
                const unreadCount = appState.notifications.filter(n => !n.read).length;
                elements.notificationBadge.textContent = unreadCount;
                
                if (unreadCount > 0) {
                    elements.notificationBadge.style.display = 'flex';
                } else {
                    elements.notificationBadge.style.display = 'none';
                }
                
                // Also update the notification list if it's open
                if (elements.notificationDropdown.classList.contains('show')) {
                    renderNotifications();
                }
            }

            // Render notifications
            function renderNotifications() {
                elements.notificationList.innerHTML = '';
                
                if (appState.notifications.length === 0) {
                    elements.notificationList.innerHTML = `
                        <div style="text-align: center; padding: 20px;">
                            <i class="fas fa-bell-slash" style="font-size: 24px; color: var(--secondary); margin-bottom: 10px;"></i>
                            <p>No notifications</p>
                        </div>
                    `;
                    return;
                }
                
                appState.notifications.forEach(notification => {
                    const notificationItem = document.createElement('div');
                    notificationItem.className = `notification-item ${notification.read ? '' : 'unread'}`;
                    notificationItem.setAttribute('data-id', notification.id);
                    
                    const date = new Date(notification.timestamp);
                    const timeAgo = getTimeAgo(date);
                    
                    notificationItem.innerHTML = `
                        <h4>${notification.title}</h4>
                        <p>${notification.message}</p>
                        <div class="notification-time">${timeAgo}</div>
                    `;
                    
                    notificationItem.addEventListener('click', function() {
                        if (!notification.read) {
                            notification.read = true;
                            saveData();
                            updateNotificationBadge();
                            notificationItem.classList.remove('unread');
                        }
                    });
                    
                    elements.notificationList.appendChild(notificationItem);
                });
            }

            // Get time ago string
            function getTimeAgo(date) {
                const seconds = Math.floor((new Date() - date) / 1000);
                
                let interval = Math.floor(seconds / 31536000);
                if (interval > 1) return interval + ' years ago';
                if (interval === 1) return '1 year ago';
                
                interval = Math.floor(seconds / 2592000);
                if (interval > 1) return interval + ' months ago';
                if (interval === 1) return '1 month ago';
                
                interval = Math.floor(seconds / 86400);
                if (interval > 1) return interval + ' days ago';
                if (interval === 1) return '1 day ago';
                
                interval = Math.floor(seconds / 3600);
                if (interval > 1) return interval + ' hours ago';
                if (interval === 1) return '1 hour ago';
                
                interval = Math.floor(seconds / 60);
                if (interval > 1) return interval + ' minutes ago';
                if (interval === 1) return '1 minute ago';
                
                return 'just now';
            }

            // Update insights section
            function updateInsights() {
                const today = new Date();
                today.setHours(0, 0, 0, 0);
                
                // Tasks due today
                const tasksToday = appState.tasks.filter(task => {
                    const dueDate = new Date(task.dueDate);
                    dueDate.setHours(0, 0, 0, 0);
                    return dueDate.getTime() === today.getTime() && !task.completed;
                }).length;
                
                // High priority tasks
                const highPriority = appState.tasks.filter(task => 
                    task.priority === 'high' && !task.completed
                ).length;
                
                // Tasks due soon (within 48 hours)
                const dueSoon = appState.tasks.filter(task => 
                    isDueSoon(task.dueDate) && !task.completed
                ).length;
                
                // Expired tasks
                const expired = appState.tasks.filter(task => 
                    isExpired(task.dueDate) && !task.completed
                ).length;
                
                // Update counters
                elements.tasksToday.textContent = tasksToday;
                elements.highPriorityCount.textContent = highPriority;
                elements.dueSoonCount.textContent = dueSoon;
                elements.expiredCount.textContent = expired;
            }

            // Push action to history for undo/redo
            function pushToHistory(action) {
                appState.actionHistory.past.push(action);
                
                // Clear future actions
                appState.actionHistory.future = [];
                
                // Limit history size
                if (appState.actionHistory.past.length > 20) {
                    appState.actionHistory.past.shift();
                }
                
                // Update UI
                updateUndoRedoButtons();
            }

            // Undo last action
            function undoAction() {
                if (appState.actionHistory.past.length === 0) return;
                
                const action = appState.actionHistory.past.pop();
                appState.actionHistory.future.push(action);
                
                switch (action.action) {
                    case 'create':
                        // Remove created task
                        const taskIndex = appState.tasks.findIndex(t => t.id === action.task.id);
                        if (taskIndex !== -1) {
                            appState.tasks.splice(taskIndex, 1);
                        }
                        break;
                        
                    case 'update':
                        // Restore old task
                        const updateIndex = appState.tasks.findIndex(t => t.id === action.taskId);
                        if (updateIndex !== -1) {
                            appState.tasks[updateIndex] = action.oldTask;
                        }
                        break;
                        
                    case 'delete':
                        // Restore deleted task
                        appState.tasks.splice(action.index, 0, action.task);
                        break;
                        
                    case 'toggle':
                        // Toggle back
                        const toggleIndex = appState.tasks.findIndex(t => t.id === action.taskId);
                        if (toggleIndex !== -1) {
                            appState.tasks[toggleIndex].completed = action.oldValue;
                        }
                        break;
                        
                    case 'reorder':
                        // Restore original order
                        appState.tasks = [...action.tasks];
                        break;
                        
                    case 'batch-complete':
                        // Restore completion states
                        action.tasks.forEach(task => {
                            const i = appState.tasks.findIndex(t => t.id === task.id);
                            if (i !== -1) {
                                appState.tasks[i].completed = task.completed;
                            }
                        });
                        break;
                        
                    case 'batch-delete':
                        // Restore deleted tasks
                        action.tasks.forEach(task => {
                            appState.tasks.push(task);
                        });
                        break;
                }
                
                // Update UI
                saveData();
                renderTasks();
                updateTaskCounts();
                updateCharts();
                updateInsights();
                updateUndoRedoButtons();
                
                showToast('info', 'Undo', 'Last action has been undone');
            }

            // Redo last undone action
            function redoAction() {
                if (appState.actionHistory.future.length === 0) return;
                
                const action = appState.actionHistory.future.pop();
                appState.actionHistory.past.push(action);
                
                switch (action.action) {
                    case 'create':
                        // Re-add created task
                        appState.tasks.push(action.task);
                        break;
                        
                    case 'update':
                        // Apply new task
                        const updateIndex = appState.tasks.findIndex(t => t.id === action.taskId);
                        if (updateIndex !== -1) {
                            appState.tasks[updateIndex] = {
                                ...appState.tasks[updateIndex],
                                ...action.newTask
                            };
                        }
                        break;
                        
                    case 'delete':
                        // Delete task again
                        const deleteIndex = appState.tasks.findIndex(t => t.id === action.task.id);
                        if (deleteIndex !== -1) {
                            appState.tasks.splice(deleteIndex, 1);
                        }
                        break;
                        
                    case 'toggle':
                        // Toggle again
                        const toggleIndex = appState.tasks.findIndex(t => t.id === action.taskId);
                        if (toggleIndex !== -1) {
                            appState.tasks[toggleIndex].completed = !action.oldValue;
                        }
                        break;
                        
                    case 'reorder':
                        // No direct way to redo reorder, just leave as is
                        break;
                        
                    case 'batch-complete':
                        // Mark as complete again
                        action.taskIds.forEach(id => {
                            const i = appState.tasks.findIndex(t => t.id === id);
                            if (i !== -1) {
                                appState.tasks[i].completed = true;
                            }
                        });
                        break;
                        
                    case 'batch-delete':
                        // Delete tasks again
                        action.taskIds.forEach(id => {
                            const i = appState.tasks.findIndex(t => t.id === id);
                            if (i !== -1) {
                                appState.tasks.splice(i, 1);
                            }
                        });
                        break;
                }
                
                // Update UI
                saveData();
                renderTasks();
                updateTaskCounts();
                updateCharts();
                updateInsights();
                updateUndoRedoButtons();
                
                showToast('info', 'Redo', 'Action has been redone');
            }

            // Update undo/redo buttons state
            function updateUndoRedoButtons() {
                elements.undoBtn.disabled = appState.actionHistory.past.length === 0;
                elements.redoBtn.disabled = appState.actionHistory.future.length === 0;
            }

            // Render category options
            function renderCategories() {
                // Get unique categories
                const categories = [...new Set(appState.categories)];
                
                // Update category filter
                elements.categoryFilter.innerHTML = '<option value="all">All Categories</option>';
                categories.forEach(category => {
                    const option = document.createElement('option');
                    option.value = category;
                    option.textContent = category;
                    elements.categoryFilter.appendChild(option);
                });
                
                // Update task category select
                elements.taskCategory.innerHTML = '';
                categories.forEach(category => {
                    const option = document.createElement('option');
                    option.value = category;
                    option.textContent = category;
                    elements.taskCategory.appendChild(option);
                });
                
                // Update edit task category select
                elements.editTaskCategory.innerHTML = '';
                categories.forEach(category => {
                    const option = document.createElement('option');
                    option.value = category;
                    option.textContent = category;
                    elements.editTaskCategory.appendChild(option);
                });
                
                // Update category list in the categories modal
                elements.categoryList.innerHTML = '';
                categories.forEach(category => {
                    const item = document.createElement('div');
                    item.className = 'category-item';
                    item.style.display = 'flex';
                    item.style.justifyContent = 'space-between';
                    item.style.alignItems = 'center';
                    item.style.padding = '10px';
                    item.style.marginBottom = '10px';
                    item.style.backgroundColor = 'var(--background-light)';
                    item.style.borderRadius = '5px';
                    item.style.border = '1px solid var(--border-light)';
                    
                    item.innerHTML = `
                        <span>${category}</span>
                        <button class="task-action-btn delete-category" data-category="${category}" aria-label="Delete category">
                            <i class="fas fa-trash"></i>
                        </button>
                    `;
                    
                    elements.categoryList.appendChild(item);
                });
                
                // Add event listeners for delete buttons
                document.querySelectorAll('.delete-category').forEach(btn => {
                    btn.addEventListener('click', function() {
                        const category = this.getAttribute('data-category');
                        deleteCategory(category);
                    });
                });
            }

            // Add a new category
            function addCategory(category) {
                if (!category || appState.categories.includes(category)) return;
                
                appState.categories.push(category);
                saveData();
                renderCategories();
                
                showToast('success', 'Category Added', `New category "${category}" has been added.`);
            }

            // Delete a category
            function deleteCategory(category) {
                const index = appState.categories.indexOf(category);
                if (index === -1) return;
                
                // Check if category is in use
                const inUse = appState.tasks.some(task => task.category === category);
                if (inUse) {
                    showToast('error', 'Cannot Delete', `Category "${category}" is in use by one or more tasks.`);
                    return;
                }
                
                appState.categories.splice(index, 1);
                saveData();
                renderCategories();
                
                showToast('success', 'Category Deleted', `Category "${category}" has been deleted.`);
            }

            // Batch operations
            function batchComplete() {
                if (appState.selectedTasks.length === 0) return;
                
                // Save the current state for undo
                const tasksBeforeUpdate = appState.selectedTasks.map(id => {
                    const task = appState.tasks.find(t => t.id === id);
                    return { id, completed: task.completed };
                });
                
                pushToHistory({
                    action: 'batch-complete',
                    taskIds: [...appState.selectedTasks],
                    tasks: tasksBeforeUpdate
                });
                
                // Update tasks
                appState.selectedTasks.forEach(id => {
                    const task = appState.tasks.find(t => t.id === id);
                    if (task) {
                        task.completed = true;
                    }
                });
                
                // Clear selection
                appState.selectedTasks = [];
                
                // Update UI
                saveData();
                renderTasks();
                updateTaskCounts();
                updateCharts();
                updateInsights();
                updateBatchActions();
                
                showToast('success', 'Batch Update', `${tasksBeforeUpdate.length} tasks marked as complete.`);
            }

            function batchDelete() {
                if (appState.selectedTasks.length === 0) return;
                
                // Save the tasks for undo
                const tasksToDelete = appState.tasks.filter(task => 
                    appState.selectedTasks.includes(task.id)
                );
                
                pushToHistory({
                    action: 'batch-delete',
                    taskIds: [...appState.selectedTasks],
                    tasks: tasksToDelete
                });
                
                // Delete tasks
                appState.tasks = appState.tasks.filter(task => 
                    !appState.selectedTasks.includes(task.id)
                );
                
                // Clear selection
                appState.selectedTasks = [];
                
                // Update UI
                saveData();
                renderTasks();
                updateTaskCounts();
                updateCharts();
                updateInsights();
                updateBatchActions();
                
                showToast('success', 'Batch Delete', `${tasksToDelete.length} tasks deleted.`);
            }

            // Export tasks
            function exportTasks(format, filter = 'all') {
                let tasksToExport = [...appState.tasks];
                
                // Apply filter
                if (filter === 'active') {
                    tasksToExport = tasksToExport.filter(task => !task.completed);
                } else if (filter === 'completed') {
                    tasksToExport = tasksToExport.filter(task => task.completed);
                }
                
                // Create filename
                const date = new Date().toISOString().split('T')[0];
                let filename = `tasks_${date}`;
                
                let content;
                let dataUrl;
                
                switch (format) {
                    case 'json':
                        content = JSON.stringify(tasksToExport, null, 2);
                        dataUrl = 'data:application/json;charset=utf-8,' + encodeURIComponent(content);
                        filename += '.json';
                        break;
                        
                    case 'csv':
                        // Create CSV content
                        const headers = ['ID', 'Title', 'Description', 'Due Date', 'Priority', 'Category', 'Completed', 'Notes'];
                        content = headers.join(',') + '\n';
                        
                        tasksToExport.forEach(task => {
                            const row = [
                                task.id,
                                `"${task.title.replace(/"/g, '""')}"`,
                                `"${(task.description || '').replace(/"/g, '""')}"`,
                                task.dueDate,
                                task.priority,
                                task.category,
                                task.completed ? 'Yes' : 'No',
                                `"${(task.notes || '').replace(/"/g, '""')}"`
                            ];
                            content += row.join(',') + '\n';
                        });
                        
                        dataUrl = 'data:text/csv;charset=utf-8,' + encodeURIComponent(content);
                        filename += '.csv';
                        break;
                        
                    case 'excel':
                        // Use SheetJS
                        const ws = XLSX.utils.json_to_sheet(tasksToExport.map(task => ({
                            ID: task.id,
                            Title: task.title,
                            Description: task.description || '',
                            'Due Date': task.dueDate,
                            Priority: task.priority,
                            Category: task.category,
                            Completed: task.completed ? 'Yes' : 'No',
                            Notes: task.notes || ''
                        })));
                        
                        const wb = XLSX.utils.book_new();
                        XLSX.utils.book_append_sheet(wb, ws, 'Tasks');
                        
                        content = XLSX.write(wb, {bookType:'xlsx', type:'binary'});
                        
                        // Convert to binary string
                        const s2ab = (s) => {
                            const buf = new ArrayBuffer(s.length);
                            const view = new Uint8Array(buf);
                            for (let i=0; i<s.length; i++) view[i] = s.charCodeAt(i) & 0xFF;
                            return buf;
                        };
                        
                        const blob = new Blob([s2ab(content)], {type: 'application/octet-stream'});
                        dataUrl = URL.createObjectURL(blob);
                        filename += '.xlsx';
                        break;
                        
                    case 'pdf':
                        // Use jsPDF
                        const { jsPDF } = window.jspdf;
                        const doc = new jsPDF();
                        
                        doc.setFontSize(18);
                        doc.text('Task List', 14, 22);
                        
                        doc.setFontSize(12);
                        doc.text(`Exported on ${new Date().toLocaleDateString()}`, 14, 30);
                        
                        doc.setFontSize(10);
                        
                        // Table settings
                        const margin = 14;
                        let y = 40;
                        const headers = ['Title', 'Due Date', 'Priority', 'Category', 'Completed'];
                        const columnWidths = [80, 30, 20, 30, 20];
                        
                        // Draw header row
                        headers.forEach((header, i) => {
                            let x = margin;
                            for (let j = 0; j < i; j++) {
                                x += columnWidths[j];
                            }
                            doc.setFont(undefined, 'bold');
                            doc.text(header, x, y);
                        });
                        
                        doc.setFont(undefined, 'normal');
                        y += 8;
                        
                        // Draw task rows
                        tasksToExport.forEach((task, index) => {
                            // Check if we need a new page
                            if (y > 280) {
                                doc.addPage();
                                y = 20;
                            }
                            
                            // Draw row
                            let x = margin;
                            doc.text(task.title.substring(0, 40) + (task.title.length > 40 ? '...' : ''), x, y);
                            x += columnWidths[0];
                            
                            doc.text(formatDate(task.dueDate), x, y);
                            x += columnWidths[1];
                            
                            doc.text(task.priority.charAt(0).toUpperCase() + task.priority.slice(1), x, y);
                            x += columnWidths[2];
                            
                            doc.text(task.category, x, y);
                            x += columnWidths[3];
                            
                            doc.text(task.completed ? 'Yes' : 'No', x, y);
                            
                            y += 7;
                        });
                        
                        // Convert to blob
                        const pdfBlob = doc.output('blob');
                        dataUrl = URL.createObjectURL(pdfBlob);
                        filename += '.pdf';
                        break;
                }
                
                // Create download link
                const downloadLink = document.createElement('a');
                downloadLink.href = dataUrl;
                downloadLink.download = filename;
                
                // Append to body, click, then remove
                document.body.appendChild(downloadLink);
                downloadLink.click();
                document.body.removeChild(downloadLink);
                
                if (format === 'excel' || format === 'pdf') {
                    URL.revokeObjectURL(dataUrl);
                }
                
                showToast('success', 'Export Complete', `Tasks exported as ${format.toUpperCase()}.`);
            }

            // Import tasks
            function importTasks(tasks) {
                if (!Array.isArray(tasks) || tasks.length === 0) {
                    showToast('error', 'Import Failed', 'Invalid task data format.');
                    return;
                }
                
                try {
                    // Validate and normalize imported tasks
                    const validTasks = tasks.filter(task => {
                        return task && task.title && task.dueDate;
                    }).map(task => {
                        // Generate new ID to avoid conflicts
                        const newId = generateId();
                        
                        // Check if category exists, add if it doesn't
                        if (task.category && !appState.categories.includes(task.category)) {
                            appState.categories.push(task.category);
                        }
                        
                        // Normalize subtasks
                        const subtasks = (task.subtasks || []).map(subtask => {
                            if (typeof subtask === 'string') {
                                return {
                                    id: generateId(),
                                    title: subtask,
                                    completed: false
                                };
                            } else if (typeof subtask === 'object') {
                                return {
                                    id: generateId(),
                                    title: subtask.title || 'Untitled Subtask',
                                    completed: !!subtask.completed
                                };
                            }
                            return null;
                        }).filter(Boolean);
                        
                        // Return normalized task
                        return {
                            id: newId,
                            title: task.title,
                            description: task.description || '',
                            dueDate: task.dueDate,
                            priority: ['high', 'medium', 'low'].includes(task.priority) ? task.priority : 'medium',
                            category: task.category || 'Work',
                            notes: task.notes || '',
                            completed: !!task.completed,
                            subtasks: subtasks,
                            createdAt: task.createdAt || new Date().toISOString(),
                            elapsedSeconds: task.elapsedSeconds || 0
                        };
                    });
                    
                    if (validTasks.length === 0) {
                        showToast('error', 'Import Failed', 'No valid tasks found in the imported data.');
                        return;
                    }
                    
                    // Add tasks to the list
                    appState.tasks = [...appState.tasks, ...validTasks];
                    
                    // Update UI
                    saveData();
                    renderTasks();
                    updateTaskCounts();
                    updateCharts();
                    updateInsights();
                    
                    showToast('success', 'Import Complete', `${validTasks.length} tasks imported successfully.`);
                } catch (error) {
                    console.error('Import error:', error);
                    showToast('error', 'Import Failed', 'Error processing the imported data.');
                }
            }

            // Event listeners
            // Login
            elements.loginBtn.addEventListener('click', function() {
                const email = elements.email.value;
                const password = elements.password.value;
                
                // Simple validation
                if (!email || !password) {
                    showToast('error', 'Login Failed', 'Please enter email and password.');
                    return;
                }
                
                // Find user
                const user = appState.users.find(u => u.email === email && u.password === password);
                if (!user) {
                    showToast('error', 'Login Failed', 'Invalid email or password.');
                    return;
                }
                
                // Log in
                appState.currentUser = user;
                saveData();
                
                // Update profile image
                elements.profileImg.src = user.avatar;
                elements.profilePicture.src = user.avatar;
                
                // Show dashboard
                showDashboard();
                
                showToast('success', 'Login Successful', `Welcome, ${user.firstName}!`);
            });

            // Register link
            elements.registerLink.addEventListener('click', function(e) {
                e.preventDefault();
                
                // Get countries for nationality dropdown
                if (elements.registerNationality.children.length <= 1) {
                    const countries = [
                        "United States", "Canada", "United Kingdom", "Afghanistan", "Albania", "Algeria", "Andorra", "Angola", 
                        "Antigua and Barbuda", "Argentina", "Armenia", "Australia", "Austria", "Azerbaijan", "Bahamas", "Bahrain", 
                        "Bangladesh", "Barbados", "Belarus", "Belgium", "Belize", "Benin", "Bhutan", "Bolivia", "Bosnia and Herzegovina", 
                        "Botswana", "Brazil", "Brunei", "Bulgaria", "Burkina Faso", "Burundi", "Cabo Verde", "Cambodia", "Cameroon", 
                        "Central African Republic", "Chad", "Chile", "China", "Colombia", "Comoros", "Congo", "Costa Rica", "Croatia", 
                        "Cuba", "Cyprus", "Czech Republic", "Denmark", "Djibouti", "Dominica", "Dominican Republic", "Ecuador", "Egypt", 
                        "El Salvador", "Equatorial Guinea", "Eritrea", "Estonia", "Eswatini", "Ethiopia", "Fiji", "Finland", "France", 
                        "Gabon", "Gambia", "Georgia", "Germany", "Ghana", "Greece", "Grenada", "Guatemala", "Guinea", "Guinea-Bissau", 
                        "Guyana", "Haiti", "Honduras", "Hungary", "Iceland", "India", "Indonesia", "Iran", "Iraq", "Ireland", "Israel", 
                        "Italy", "Jamaica", "Japan", "Jordan", "Kazakhstan", "Kenya", "Kiribati", "Korea, North", "Korea, South", "Kosovo", 
                        "Kuwait", "Kyrgyzstan", "Laos", "Latvia", "Lebanon", "Lesotho", "Liberia", "Libya", "Liechtenstein", "Lithuania", 
                        "Luxembourg", "Madagascar", "Malawi", "Malaysia", "Maldives", "Mali", "Malta", "Marshall Islands", "Mauritania", 
                        "Mauritius", "Mexico", "Micronesia", "Moldova", "Monaco", "Mongolia", "Montenegro", "Morocco", "Mozambique", 
                        "Myanmar", "Namibia", "Nauru", "Nepal", "Netherlands", "New Zealand", "Nicaragua", "Niger", "Nigeria", "North Macedonia", 
                        "Norway", "Oman", "Pakistan", "Palau", "Palestine", "Panama", "Papua New Guinea", "Paraguay", "Peru", "Philippines", 
                        "Poland", "Portugal", "Qatar", "Romania", "Russia", "Rwanda", "Saint Kitts and Nevis", "Saint Lucia", 
                        "Saint Vincent and the Grenadines", "Samoa", "San Marino", "Sao Tome and Principe", "Saudi Arabia", "Senegal", 
                        "Serbia", "Seychelles", "Sierra Leone", "Singapore", "Slovakia", "Slovenia", "Solomon Islands", "Somalia", 
                        "South Africa", "South Sudan", "Spain", "Sri Lanka", "Sudan", "Suriname", "Sweden", "Switzerland", "Syria", 
                        "Taiwan", "Tajikistan", "Tanzania", "Thailand", "Timor-Leste", "Togo", "Tonga", "Trinidad and Tobago", "Tunisia", 
                        "Turkey", "Turkmenistan", "Tuvalu", "Uganda", "Ukraine", "United Arab Emirates", "Uruguay", "Uzbekistan", 
                        "Vanuatu", "Vatican City", "Venezuela", "Vietnam", "Yemen", "Zambia", "Zimbabwe"
                    ];
                    
                    countries.forEach(country => {
                        const option = document.createElement('option');
                        option.value = country;
                        option.textContent = country;
                        elements.registerNationality.appendChild(option);
                    });
                }
                
                // Show register modal
                elements.registerModal.classList.add('show');
            });

            // Register cancel
            elements.registerCancel.addEventListener('click', function() {
                elements.registerModal.classList.remove('show');
            });

            // Close register modal on backdrop click
            elements.registerModal.addEventListener('click', function(e) {
                if (e.target === elements.registerModal) {
                    elements.registerModal.classList.remove('show');
                }
            });

            // Close register modal on X button
            elements.registerModal.querySelector('.modal-close').addEventListener('click', function() {
                elements.registerModal.classList.remove('show');
            });

            // Register create
            elements.registerCreate.addEventListener('click', function() {
                const firstName = elements.registerFirstname.value;
                const lastName = elements.registerLastname.value;
                const email = elements.registerEmail.value;
                const emailConfirm = elements.registerEmailConfirm.value;
                const password = elements.registerPassword.value;
                const passwordConfirm = elements.registerPasswordConfirm.value;
                const birthdate = elements.registerBirthdate.value;
                const nationality = elements.registerNationality.value;
                const role = elements.registerRole.value;
                
                // Validation
                if (!firstName || !lastName || !email || !emailConfirm || !password || !passwordConfirm || !birthdate || !nationality || !role) {
                    showToast('error', 'Registration Failed', 'Please fill in all fields.');
                    return;
                }
                
                if (email !== emailConfirm) {
                    showToast('error', 'Registration Failed', 'Emails do not match.');
                    return;
                }
                
                if (password !== passwordConfirm) {
                    showToast('error', 'Registration Failed', 'Passwords do not match.');
                    return;
                }
                
                // Check if email already exists
                if (appState.users.some(u => u.email === email)) {
                    showToast('error', 'Registration Failed', 'Email already in use.');
                    return;
                }
                
                // Create user
                const newUser = {
                    id: generateId(),
                    firstName: firstName,
                    lastName: lastName,
                    email: email,
                    password: password,
                    birthdate: birthdate,
                    country: nationality,
                    role: role,
                    avatar: 'https://randomuser.me/api/portraits/men/1.jpg',
                    phone: '',
                    joinDate: new Date().toISOString()
                };
                
                appState.users.push(newUser);
                saveData();
                
                // Close modal
                elements.registerModal.classList.remove('show');
                
                showToast('success', 'Registration Successful', 'You can now log in with your new account.');
            });

            // Mode switcher
            elements.modeSwitcher.addEventListener('click', function() {
                document.body.classList.toggle('dark');
                
                if (document.body.classList.contains('dark')) {
                    elements.modeSwitcher.innerHTML = '<i class="fas fa-sun"></i>';
                } else {
                    elements.modeSwitcher.innerHTML = '<i class="fas fa-moon"></i>';
                }
                
                updateCharts();
            });

            // Timer toggle
            elements.timerToggle.addEventListener('click', function() {
                if (appState.timerActive) {
                    pauseTimer();
                } else if (appState.timerTask) {
                    startTimer(appState.timerTask);
                }
            });

            // Profile dropdown toggle
            elements.profileImg.addEventListener('click', function() {
                elements.profileDropdown.classList.toggle('show');
                
                // Hide notification dropdown if open
                if (elements.notificationDropdown.classList.contains('show')) {
                    elements.notificationDropdown.classList.remove('show');
                }
            });

            // Close profile dropdown when clicking outside
            document.addEventListener('click', function(e) {
                if (!elements.profileImg.contains(e.target) && !elements.profileDropdown.contains(e.target)) {
                    elements.profileDropdown.classList.remove('show');
                }
                
                if (!elements.notificationIcon.contains(e.target) && !elements.notificationDropdown.contains(e.target)) {
                    elements.notificationDropdown.classList.remove('show');
                }
            });

            // View profile
            elements.viewProfile.addEventListener('click', function() {
                elements.profileDropdown.classList.remove('show');
                
                // Fill profile data
                elements.profileName.textContent = `${appState.currentUser.firstName} ${appState.currentUser.lastName}`;
                elements.profileEmail.textContent = appState.currentUser.email;
                elements.profilePhone.textContent = appState.currentUser.phone || 'Not set';
                elements.profileCountry.textContent = appState.currentUser.country;
                elements.profileRole.textContent = appState.currentUser.role;
                elements.profileDate.textContent = formatDate(appState.currentUser.joinDate);
                
                // Show profile modal
                elements.profileModal.classList.add('show');
            });

            // Close profile modal on backdrop click
            elements.profileModal.addEventListener('click', function(e) {
                if (e.target === elements.profileModal) {
                    elements.profileModal.classList.remove('show');
                }
            });

            // Close profile modal on X button
            elements.profileModal.querySelector('.modal-close').addEventListener('click', function() {
                elements.profileModal.classList.remove('show');
            });

            // Close profile modal on close button
            elements.profileClose.addEventListener('click', function() {
                elements.profileModal.classList.remove('show');
            });

            // Edit profile
            elements.profileEditBtn.addEventListener('click', function() {
                // Fill edit form
                elements.editFirstName.value = appState.currentUser.firstName;
                elements.editLastName.value = appState.currentUser.lastName;
                elements.editEmail.value = appState.currentUser.email;
                elements.editPhone.value = appState.currentUser.phone || '';
                
                // Fill countries dropdown if not already filled
                if (elements.editCountry.children.length === 0) {
                    const countries = [
                        "United States", "Canada", "United Kingdom", "Afghanistan", "Albania", "Algeria", "Andorra", "Angola", 
                        "Antigua and Barbuda", "Argentina", "Armenia", "Australia", "Austria", "Azerbaijan", "Bahamas", "Bahrain", 
                        "Bangladesh", "Barbados", "Belarus", "Belgium", "Belize", "Benin", "Bhutan", "Bolivia", "Bosnia and Herzegovina", 
                        "Botswana", "Brazil", "Brunei", "Bulgaria", "Burkina Faso", "Burundi", "Cabo Verde", "Cambodia", "Cameroon", 
                        "Central African Republic", "Chad", "Chile", "China", "Colombia", "Comoros", "Congo", "Costa Rica", "Croatia", 
                        "Cuba", "Cyprus", "Czech Republic", "Denmark", "Djibouti", "Dominica", "Dominican Republic", "Ecuador", "Egypt", 
                        "El Salvador", "Equatorial Guinea", "Eritrea", "Estonia", "Eswatini", "Ethiopia", "Fiji", "Finland", "France", 
                        "Gabon", "Gambia", "Georgia", "Germany", "Ghana", "Greece", "Grenada", "Guatemala", "Guinea", "Guinea-Bissau", 
                        "Guyana", "Haiti", "Honduras", "Hungary", "Iceland", "India", "Indonesia", "Iran", "Iraq", "Ireland", "Israel", 
                        "Italy", "Jamaica", "Japan", "Jordan", "Kazakhstan", "Kenya", "Kiribati", "Korea, North", "Korea, South", "Kosovo", 
                        "Kuwait", "Kyrgyzstan", "Laos", "Latvia", "Lebanon", "Lesotho", "Liberia", "Libya", "Liechtenstein", "Lithuania", 
                        "Luxembourg", "Madagascar", "Malawi", "Malaysia", "Maldives", "Mali", "Malta", "Marshall Islands", "Mauritania", 
                        "Mauritius", "Mexico", "Micronesia", "Moldova", "Monaco", "Mongolia", "Montenegro", "Morocco", "Mozambique", 
                        "Myanmar", "Namibia", "Nauru", "Nepal", "Netherlands", "New Zealand", "Nicaragua", "Niger", "Nigeria", "North Macedonia", 
                        "Norway", "Oman", "Pakistan", "Palau", "Palestine", "Panama", "Papua New Guinea", "Paraguay", "Peru", "Philippines", 
                        "Poland", "Portugal", "Qatar", "Romania", "Russia", "Rwanda", "Saint Kitts and Nevis", "Saint Lucia", 
                        "Saint Vincent and the Grenadines", "Samoa", "San Marino", "Sao Tome and Principe", "Saudi Arabia", "Senegal", 
                        "Serbia", "Seychelles", "Sierra Leone", "Singapore", "Slovakia", "Slovenia", "Solomon Islands", "Somalia", 
                        "South Africa", "South Sudan", "Spain", "Sri Lanka", "Sudan", "Suriname", "Sweden", "Switzerland", "Syria", 
                        "Taiwan", "Tajikistan", "Tanzania", "Thailand", "Timor-Leste", "Togo", "Tonga", "Trinidad and Tobago", "Tunisia", 
                        "Turkey", "Turkmenistan", "Tuvalu", "Uganda", "Ukraine", "United Arab Emirates", "Uruguay", "Uzbekistan", 
                        "Vanuatu", "Vatican City", "Venezuela", "Vietnam", "Yemen", "Zambia", "Zimbabwe"
                    ];
                    
                    countries.forEach(country => {
                        const option = document.createElement('option');
                        option.value = country;
                        option.textContent = country;
                        elements.editCountry.appendChild(option);
                    });
                }
                
                elements.editCountry.value = appState.currentUser.country;
                
                // Show edit form, hide view form
                elements.profileView.style.display = 'none';
                elements.profileEdit.style.display = 'block';
                
                // Show save and cancel buttons, hide edit button
                elements.profileEditBtn.style.display = 'none';
                elements.profileSaveBtn.style.display = 'inline-block';
                elements.profileCancelBtn.style.display = 'inline-block';
            });

            // Save profile
            elements.profileSaveBtn.addEventListener('click', function() {
                // Get values
                const firstName = elements.editFirstName.value;
                const lastName = elements.editLastName.value;
                const email = elements.editEmail.value;
                const phone = elements.editPhone.value;
                const country = elements.editCountry.value;
                
                // Validation
                if (!firstName || !lastName || !email || !country) {
                    showToast('error', 'Update Failed', 'Please fill in all required fields.');
                    return;
                }
                
                // Update user
                appState.currentUser.firstName = firstName;
                appState.currentUser.lastName = lastName;
                appState.currentUser.email = email;
                appState.currentUser.phone = phone;
                appState.currentUser.country = country;
                
                // Update users array
                const userIndex = appState.users.findIndex(u => u.id === appState.currentUser.id);
                if (userIndex !== -1) {
                    appState.users[userIndex] = {...appState.currentUser};
                }
                
                saveData();
                
                // Show view form, hide edit form
                elements.profileView.style.display = 'block';
                elements.profileEdit.style.display = 'none';
                
                // Show edit button, hide save and cancel buttons
                elements.profileEditBtn.style.display = 'inline-block';
                elements.profileSaveBtn.style.display = 'none';
                elements.profileCancelBtn.style.display = 'none';
                
                // Update view form
                elements.profileName.textContent = `${firstName} ${lastName}`;
                elements.profileEmail.textContent = email;
                elements.profilePhone.textContent = phone || 'Not set';
                elements.profileCountry.textContent = country;
                
                showToast('success', 'Profile Updated', 'Your profile has been updated.');
            });

            // Cancel profile edit
            elements.profileCancelBtn.addEventListener('click', function() {
                // Show view form, hide edit form
                elements.profileView.style.display = 'block';
                elements.profileEdit.style.display = 'none';
                
                // Show edit button, hide save and cancel buttons
                elements.profileEditBtn.style.display = 'inline-block';
                elements.profileSaveBtn.style.display = 'none';
                elements.profileCancelBtn.style.display = 'none';
            });

            // Profile picture change
            elements.profilePictureInput.addEventListener('change', function(e) {
                const file = e.target.files[0];
                if (!file) return;
                
                // Check if file is an image
                if (!file.type.startsWith('image/')) {
                    showToast('error', 'Invalid File', 'Please select an image file.');
                    return;
                }
                
                // Check file size (max 5MB)
                if (file.size > 5 * 1024 * 1024) {
                    showToast('error', 'File Too Large', 'Please select an image smaller than 5MB.');
                    return;
                }
                
                // Read file and set as profile picture
                const reader = new FileReader();
                reader.onload = function(event) {
                    const imageUrl = event.target.result;
                    
                    // Update UI
                    elements.profilePicture.src = imageUrl;
                    elements.profileImg.src = imageUrl;
                    
                    // Update user
                    appState.currentUser.avatar = imageUrl;
                    
                    // Update users array
                    const userIndex = appState.users.findIndex(u => u.id === appState.currentUser.id);
                    if (userIndex !== -1) {
                        appState.users[userIndex].avatar = imageUrl;
                    }
                    
                    saveData();
                    
                    showToast('success', 'Picture Updated', 'Your profile picture has been updated.');
                };
                reader.readAsDataURL(file);
            });

            // Logout
            elements.logoutButton.addEventListener('click', function() {
                // Clear current user
                appState.currentUser = null;
                localStorage.removeItem('currentUser');
                
                // Stop timer if active
                if (appState.timerActive) {
                    pauseTimer();
                }
                
                // Go to login page
                showLogin();
                
                showToast('info', 'Logged Out', 'You have been logged out.');
            });

            // Status dropdown
            elements.statusDropdown.addEventListener('click', function() {
                elements.profileDropdown.classList.remove('show');
                elements.statusModal.classList.add('show');
            });

            // Close status modal on backdrop click
            elements.statusModal.addEventListener('click', function(e) {
                if (e.target === elements.statusModal) {
                    elements.statusModal.classList.remove('show');
                }
            });

            // Close status modal on X button
            elements.statusModal.querySelector('.modal-close').addEventListener('click', function() {
                elements.statusModal.classList.remove('show');
            });

            // Cancel status change
            elements.statusCancel.addEventListener('click', function() {
                elements.statusModal.classList.remove('show');
            });

            // Apply status change
            elements.statusApply.addEventListener('click', function() {
                const status = elements.userStatusSelect.value;
                
                // Update UI
                elements.userStatus.textContent = status.charAt(0).toUpperCase() + status.slice(1);
                
                // Update profile status indicator
                const statusElement = document.querySelector('.profile-status');
                
                switch (status) {
                    case 'online':
                        statusElement.style.backgroundColor = 'var(--success)';
                        break;
                    case 'break':
                        statusElement.style.backgroundColor = 'var(--warning)';
                        break;
                    case 'shadow':
                        statusElement.style.backgroundColor = 'var(--secondary)';
                        break;
                    case 'logout':
                        statusElement.style.backgroundColor = 'var(--danger)';
                        break;
                }
                
                elements.statusModal.classList.remove('show');
                
                showToast('info', 'Status Updated', `Your status is now: ${status}.`);
            });

            // Add task button
            elements.addTaskBtn.addEventListener('click', function() {
                // Reset form
                elements.taskTitle.value = '';
                elements.taskDescription.value = '';
                taskDueDatePicker.setDate(new Date());
                elements.taskPriority.value = 'medium';
                elements.taskCategory.value = appState.categories[0];
                elements.taskNotes.value = '';
                elements.subtaskList.innerHTML = '';
                
                // Show modal
                elements.addTaskModal.classList.add('show');
            });

            // Close add task modal on backdrop click
            elements.addTaskModal.addEventListener('click', function(e) {
                if (e.target === elements.addTaskModal) {
                    elements.addTaskModal.classList.remove('show');
                }
            });

            // Close add task modal on X button
            elements.addTaskModal.querySelector('.modal-close').addEventListener('click', function() {
                elements.addTaskModal.classList.remove('show');
            });

            // Cancel add task
            elements.addTaskCancel.addEventListener('click', function() {
                elements.addTaskModal.classList.remove('show');
            });

            // Add subtask button
            elements.addSubtask.addEventListener('click', function() {
                addSubtaskToForm(elements.subtaskList);
            });

            // Add subtask button (edit modal)
            elements.editAddSubtask.addEventListener('click', function() {
                addSubtaskToForm(elements.editSubtaskList);
            });

            // Create task
            elements.addTaskCreate.addEventListener('click', function() {
                // Get values
                const title = elements.taskTitle.value.trim();
                const description = elements.taskDescription.value.trim();
                const dueDate = elements.taskDueDate.value;
                const priority = elements.taskPriority.value;
                const category = elements.taskCategory.value;
                const notes = elements.taskNotes.value.trim();
                const subtasks = getSubtasksFromForm(elements.subtaskList);
                
                // Validation
                if (!title) {
                    showToast('error', 'Task Creation Failed', 'Please enter a title for the task.');
                    return;
                }
                
                if (!dueDate) {
                    showToast('error', 'Task Creation Failed', 'Please select a due date for the task.');
                    return;
                }
                
                // Create task
                const task = createTask({
                    title,
                    description,
                    dueDate,
                    priority,
                    category,
                    notes,
                    subtasks
                });
                
                // Close modal
                elements.addTaskModal.classList.remove('show');
            });

            // View task modal close
            elements.viewTaskClose.addEventListener('click', function() {
                elements.viewTaskModal.classList.remove('show');
                appState.modalTask = null;
            });

            // Close view task modal on backdrop click
            elements.viewTaskModal.addEventListener('click', function(e) {
                if (e.target === elements.viewTaskModal) {
                    elements.viewTaskModal.classList.remove('show');
                    appState.modalTask = null;
                }
            });

            // Close view task modal on X button
            elements.viewTaskModal.querySelector('.modal-close').addEventListener('click', function() {
                elements.viewTaskModal.classList.remove('show');
                appState.modalTask = null;
            });

            // Share task button
            elements.viewTaskShare.addEventListener('click', function() {
                if (appState.modalTask) {
                    elements.viewTaskModal.classList.remove('show');
                    shareTask(appState.modalTask.id);
                }
            });

            // Edit task modal close
            elements.editTaskCancel.addEventListener('click', function() {
                elements.editTaskModal.classList.remove('show');
                appState.modalTask = null;
            });

            // Close edit task modal on backdrop click
            elements.editTaskModal.addEventListener('click', function(e) {
                if (e.target === elements.editTaskModal) {
                    elements.editTaskModal.classList.remove('show');
                    appState.modalTask = null;
                }
            });

            // Close edit task modal on X button
            elements.editTaskModal.querySelector('.modal-close').addEventListener('click', function() {
                elements.editTaskModal.classList.remove('show');
                appState.modalTask = null;
            });

            // Save edited task
            elements.editTaskSave.addEventListener('click', function() {
                if (!appState.modalTask) return;
                
                // Get values
                const title = elements.editTaskTitle.value.trim();
                const description = elements.editTaskDescription.value.trim();
                const dueDate = elements.editTaskDueDate.value;
                const priority = elements.editTaskPriority.value;
                const category = elements.editTaskCategory.value;
                const notes = elements.editTaskNotes.value.trim();
                const subtasks = getSubtasksFromForm(elements.editSubtaskList);
                
                // Validation
                if (!title) {
                    showToast('error', 'Task Update Failed', 'Please enter a title for the task.');
                    return;
                }
                
                if (!dueDate) {
                    showToast('error', 'Task Update Failed', 'Please select a due date for the task.');
                    return;
                }
                
                // Update task
                updateTask(appState.modalTask.id, {
                    title,
                    description,
                    dueDate,
                    priority,
                    category,
                    notes,
                    subtasks
                });
                
                // Close modal
                elements.editTaskModal.classList.remove('show');
                appState.modalTask = null;
            });

            // Share task modal close
            elements.shareTaskCancel.addEventListener('click', function() {
                elements.shareTaskModal.classList.remove('show');
                appState.modalTask = null;
            });

            // Close share task modal on backdrop click
            elements.shareTaskModal.addEventListener('click', function(e) {
                if (e.target === elements.shareTaskModal) {
                    elements.shareTaskModal.classList.remove('show');
                    appState.modalTask = null;
                }
            });

            // Close share task modal on X button
            elements.shareTaskModal.querySelector('.modal-close').addEventListener('click', function() {
                elements.shareTaskModal.classList.remove('show');
                appState.modalTask = null;
            });

            // Send shared task
            elements.shareTaskSend.addEventListener('click', function() {
                if (!appState.modalTask) return;
                
                const selectedUsers = Array.from(elements.shareWith.selectedOptions).map(option => option.value);
                const message = elements.shareMessage.value.trim();
                
                if (selectedUsers.length === 0) {
                    showToast('error', 'Share Failed', 'Please select at least one user to share with.');
                    return;
                }
                
                // In a real app, this would send to the server
                // For this demo, just show a toast
                showToast('success', 'Task Shared', `Task shared with ${selectedUsers.length} user(s).`);
                
                // Close modal
                elements.shareTaskModal.classList.remove('show');
                appState.modalTask = null;
            });

            // Users button
            elements.usersButton.addEventListener('click', function() {
                elements.profileDropdown.classList.remove('show');
                
                // Render users
                elements.usersGrid.innerHTML = '';
                
                appState.users.forEach(user => {
                    const userCard = document.createElement('div');
                    userCard.className = 'user-card';
                    
                    userCard.innerHTML = `
                        <div class="user-card-header"></div>
                        <img src="${user.avatar}" alt="${user.firstName} ${user.lastName}" class="user-avatar">
                        <div class="user-card-body">
                            <h3 class="user-name">${user.firstName} ${user.lastName}</h3>
                            <p class="user-email">${user.email}</p>
                            <span class="user-role">${user.role}</span>
                        </div>
                    `;
                    
                    elements.usersGrid.appendChild(userCard);
                });
                
                // Show modal
                elements.usersModal.classList.add('show');
            });

            // Close users modal on backdrop click
            elements.usersModal.addEventListener('click', function(e) {
                if (e.target === elements.usersModal) {
                    elements.usersModal.classList.remove('show');
                }
            });

            // Close users modal on X button
            elements.usersModal.querySelector('.modal-close').addEventListener('click', function() {
                elements.usersModal.classList.remove('show');
            });

            // Close users modal on close button
            elements.usersClose.addEventListener('click', function() {
                elements.usersModal.classList.remove('show');
            });

            // Categories button
            elements.categoriesBtn.addEventListener('click', function() {
                elements.newCategory.value = '';
                
                // Show modal
                elements.categoriesModal.classList.add('show');
            });

            // Close categories modal on backdrop click
            elements.categoriesModal.addEventListener('click', function(e) {
                if (e.target === elements.categoriesModal) {
                    elements.categoriesModal.classList.remove('show');
                }
            });

            // Close categories modal on X button
            elements.categoriesModal.querySelector('.modal-close').addEventListener('click', function() {
                elements.categoriesModal.classList.remove('show');
            });

            // Close categories modal on close button
            elements.categoriesClose.addEventListener('click', function() {
                elements.categoriesModal.classList.remove('show');
            });

            // Add category button
            elements.addCategoryBtn.addEventListener('click', function() {
                const category = elements.newCategory.value.trim();
                
                if (!category) {
                    showToast('error', 'Category Creation Failed', 'Please enter a category name.');
                    return;
                }
                
                addCategory(category);
                elements.newCategory.value = '';
            });

            // Export button
            elements.exportBtn.addEventListener('click', function() {
                // Show modal
                elements.exportModal.classList.add('show');
            });

            // Close export modal on backdrop click
            elements.exportModal.addEventListener('click', function(e) {
                if (e.target === elements.exportModal) {
                    elements.exportModal.classList.remove('show');
                }
            });

            // Close export modal on X button
            elements.exportModal.querySelector('.modal-close').addEventListener('click', function() {
                elements.exportModal.classList.remove('show');
            });

            // Close export modal on cancel button
            elements.exportCancel.addEventListener('click', function() {
                elements.exportModal.classList.remove('show');
            });

            // Download export
            elements.exportDownload.addEventListener('click', function() {
                const format = elements.exportFormat.value;
                const filter = elements.exportTasks.value;
                
                exportTasks(format, filter);
                
                // Close modal
                elements.exportModal.classList.remove('show');
            });

            // Import button
            elements.importBtn.addEventListener('click', function() {
                // Reset form
                elements.importFile.value = '';
                elements.importUrl.value = '';
                
                // Show modal
                elements.importModal.classList.add('show');
            });

            // Close import modal on backdrop click
            elements.importModal.addEventListener('click', function(e) {
                if (e.target === elements.importModal) {
                    elements.importModal.classList.remove('show');
                }
            });

            // Close import modal on X button
            elements.importModal.querySelector('.modal-close').addEventListener('click', function() {
                elements.importModal.classList.remove('show');
            });

            // Close import modal on cancel button
            elements.importCancel.addEventListener('click', function() {
                elements.importModal.classList.remove('show');
            });

            // Submit import
            elements.importSubmit.addEventListener('click', function() {
                const file = elements.importFile.files[0];
                const url = elements.importUrl.value.trim();
                
                if (!file && !url) {
                    showToast('error', 'Import Failed', 'Please either upload a file or enter a URL.');
                    return;
                }
                
                if (file) {
                    // Process file
                    const reader = new FileReader();
                    reader.onload = function(event) {
                        try {
                            const tasks = JSON.parse(event.target.result);
                            importTasks(tasks);
                            elements.importModal.classList.remove('show');
                        } catch (error) {
                            showToast('error', 'Import Failed', 'Invalid JSON format in the file.');
                        }
                    };
                    reader.readAsText(file);
                } else if (url) {
                    // In a real app, this would fetch from the URL
                    // For this demo, just show an error
                    showToast('error', 'Import Failed', 'URL imports are not supported in this demo.');
                }
            });

            // Search input
            elements.searchInput.addEventListener('input', debounce(function() {
                appState.filters.search = this.value.trim();
                renderTasks();
            }, 300));

            // Status filter
            elements.statusFilter.addEventListener('change', function() {
                appState.filters.status = this.value;
                renderTasks();
            });

            // Category filter
            elements.categoryFilter.addEventListener('change', function() {
                appState.filters.category = this.value;
                renderTasks();
            });

            // Priority filter
            elements.priorityFilter.addEventListener('change', function() {
                appState.filters.priority = this.value;
                renderTasks();
            });

            // Due date filter
            elements.dueDateFilter.addEventListener('change', function() {
                appState.filters.dueDate = this.value;
                
                if (this.value === 'custom') {
                    // Show date range picker
                    dateRangeStartPicker.setDate(new Date());
                    dateRangeEndPicker.setDate(new Date(new Date().setDate(new Date().getDate() + 7)));
                    elements.dateRangeModal.classList.add('show');
                } else {
                    renderTasks();
                }
            });

            // Close date range modal on backdrop click
            elements.dateRangeModal.addEventListener('click', function(e) {
                if (e.target === elements.dateRangeModal) {
                    elements.dateRangeModal.classList.remove('show');
                }
            });

            // Close date range modal on X button
            elements.dateRangeModal.querySelector('.modal-close').addEventListener('click', function() {
                elements.dateRangeModal.classList.remove('show');
            });

            // Cancel date range
            elements.dateRangeCancel.addEventListener('click', function() {
                elements.dateRangeModal.classList.remove('show');
                elements.dueDateFilter.value = 'all';
                appState.filters.dueDate = 'all';
                renderTasks();
            });

            // Apply date range
            elements.dateRangeApply.addEventListener('click', function() {
                const start = elements.dateRangeStart.value;
                const end = elements.dateRangeEnd.value;
                
                if (!start || !end) {
                    showToast('error', 'Filter Failed', 'Please select both start and end dates.');
                    return;
                }
                
                if (new Date(start) > new Date(end)) {
                    showToast('error', 'Filter Failed', 'Start date cannot be after end date.');
                    return;
                }
                
                appState.filters.dateRange.start = start;
                appState.filters.dateRange.end = end;
                
                elements.dateRangeModal.classList.remove('show');
                renderTasks();
            });

            // Sort options
            elements.sortOptions.addEventListener('change', function() {
                appState.filters.sort = this.value;
                renderTasks();
            });

            // Undo button
            elements.undoBtn.addEventListener('click', function() {
                undoAction();
            });

            // Redo button
            elements.redoBtn.addEventListener('click', function() {
                redoAction();
            });

            // View switcher - list view
            elements.listViewBtn.addEventListener('click', function() {
                elements.listViewBtn.classList.add('active');
                elements.graphViewBtn.classList.remove('active');
                elements.taskListView.style.display = 'block';
                elements.graphView.style.display = 'none';
            });

            // View switcher - graph view
            elements.graphViewBtn.addEventListener('click', function() {
                elements.graphViewBtn.classList.add('active');
                elements.listViewBtn.classList.remove('active');
                elements.taskListView.style.display = 'none';
                elements.graphView.style.display = 'block';
                
                // Refresh charts
                setTimeout(updateCharts, 100);
            });

            // Batch actions
            elements.batchDeleteBtn.addEventListener('click', function() {
                batchDelete();
            });

            elements.batchCompleteBtn.addEventListener('click', function() {
                batchComplete();
            });

            elements.batchCancelBtn.addEventListener('click', function() {
                appState.selectedTasks = [];
                updateBatchActions();
                renderTasks(); // Re-render to reset checkboxes
            });

            // Notification icon
            elements.notificationIcon.addEventListener('click', function() {
                elements.notificationDropdown.classList.toggle('show');
                
                // Hide profile dropdown if open
                if (elements.profileDropdown.classList.contains('show')) {
                    elements.profileDropdown.classList.remove('show');
                }
                
                // Render notifications
                renderNotifications();
            });

            // Mark all notifications as read
            elements.markAllRead.addEventListener('click', function() {
                appState.notifications.forEach(notification => {
                    notification.read = true;
                });
                
                saveData();
                updateNotificationBadge();
                renderNotifications();
                
                showToast('success', 'Notifications', 'All notifications marked as read.');
            });

            // Logo click to go to dashboard
            elements.logo.addEventListener('click', function() {
                window.location.reload();
            });

            // Initialize app
            loadData();
            renderCategories();
            updateUndoRedoButtons();
            
            // Show login page or dashboard if already logged in
            if (appState.currentUser) {
                elements.profileImg.src = appState.currentUser.avatar;
                elements.profilePicture.src = appState.currentUser.avatar;
                showDashboard();
            } else {
                showLogin();
            }
        });
    </script>
</body>
</html>
