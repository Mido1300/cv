<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Advanced Todo Application</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        primary: {
                            50: '#f5f3ff',
                            100: '#ede9fe',
                            200: '#ddd6fe',
                            300: '#c4b5fd',
                            400: '#a78bfa',
                            500: '#8b5cf6',
                            600: '#7c3aed',
                            700: '#6d28d9',
                            800: '#5b21b6',
                            900: '#4c1d95',
                        },
                    },
                    animation: {
                        'fade-in': 'fadeIn 0.3s ease-in-out',
                        'slide-in': 'slideIn 0.3s ease-in-out',
                    },
                    keyframes: {
                        fadeIn: {
                            '0%': { opacity: '0' },
                            '100%': { opacity: '1' },
                        },
                        slideIn: {
                            '0%': { transform: 'translateY(10px)', opacity: '0' },
                            '100%': { transform: 'translateY(0)', opacity: '1' },
                        },
                    },
                },
            },
        };
    </script>
    <style>
        .task-enter {
            opacity: 0;
            transform: translateY(-10px);
        }
        .task-enter-active {
            opacity: 1;
            transform: translateY(0);
            transition: opacity 300ms, transform 300ms;
        }
        .task-exit {
            opacity: 1;
        }
        .task-exit-active {
            opacity: 0;
            transform: translateY(-10px);
            transition: opacity 300ms, transform 300ms;
        }
        .drag-item {
            cursor: grab;
        }
        .drag-item:active {
            cursor: grabbing;
        }
        .dragging {
            opacity: 0.5;
            border: 2px dashed #8b5cf6;
        }

        /* Custom Scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }
        ::-webkit-scrollbar-track {
            background: rgba(0, 0, 0, 0.05);
            border-radius: 4px;
        }
        ::-webkit-scrollbar-thumb {
            background: rgba(139, 92, 246, 0.5);
            border-radius: 4px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: rgba(139, 92, 246, 0.7);
        }
        
        /* Light/Dark mode transitions */
        * {
            transition: background-color 0.3s ease, color 0.3s ease, border-color 0.3s ease, box-shadow 0.3s ease;
        }
    </style>
</head>
<body class="bg-gray-50 text-gray-900 dark:bg-gray-900 dark:text-gray-100 min-h-screen">
    <div id="root"></div>

    <script type="text/babel">
        // Utility functions
        const generateId = () => Math.random().toString(36).substr(2, 9);
        
        const formatDate = (date) => {
            if (!date) return '';
            const d = new Date(date);
            return d.toLocaleDateString();
        };
        
        const getDaysRemaining = (dueDate) => {
            if (!dueDate) return null;
            const today = new Date();
            today.setHours(0, 0, 0, 0);
            const due = new Date(dueDate);
            due.setHours(0, 0, 0, 0);
            return Math.ceil((due - today) / (1000 * 60 * 60 * 24));
        };

        // Define initial data
        const defaultCategories = [
            { id: 'work', name: 'Work', color: '#4f46e5' },
            { id: 'personal', name: 'Personal', color: '#16a34a' },
            { id: 'shopping', name: 'Shopping', color: '#ea580c' },
            { id: 'health', name: 'Health', color: '#0891b2' },
            { id: 'education', name: 'Education', color: '#9333ea' },
        ];

        const defaultTasks = [
            {
                id: 'task1',
                title: 'Complete Project Proposal',
                description: 'Finalize the project proposal for the client meeting',
                completed: false,
                dueDate: new Date(Date.now() + 2 * 24 * 60 * 60 * 1000).toISOString().split('T')[0],
                category: 'work',
                priority: 'high',
                createdAt: new Date().toISOString(),
                recurrence: null,
                subtasks: [
                    { id: 'sub1', title: 'Research competition', completed: true },
                    { id: 'sub2', title: 'Create draft outline', completed: false },
                ],
                timeTracked: 0,
                timeTrackingActive: false,
                timeTrackingStartedAt: null,
                shared: [],
            },
            {
                id: 'task2',
                title: 'Grocery Shopping',
                description: 'Buy fruits, vegetables, and other essentials',
                completed: false,
                dueDate: new Date(Date.now() + 1 * 24 * 60 * 60 * 1000).toISOString().split('T')[0],
                category: 'shopping',
                priority: 'medium',
                createdAt: new Date().toISOString(),
                recurrence: { type: 'weekly', interval: 1 },
                subtasks: [
                    { id: 'sub3', title: 'Make shopping list', completed: true },
                    { id: 'sub4', title: 'Check pantry inventory', completed: false },
                ],
                timeTracked: 15 * 60, // 15 minutes in seconds
                timeTrackingActive: false,
                timeTrackingStartedAt: null,
                shared: [],
            },
            {
                id: 'task3',
                title: 'Morning Run',
                description: '5km morning run in the park',
                completed: true,
                dueDate: new Date().toISOString().split('T')[0],
                category: 'health',
                priority: 'low',
                createdAt: new Date(Date.now() - 2 * 24 * 60 * 60 * 1000).toISOString(),
                recurrence: { type: 'daily', interval: 1 },
                subtasks: [],
                timeTracked: 30 * 60, // 30 minutes in seconds
                timeTrackingActive: false,
                timeTrackingStartedAt: null,
                shared: [],
            },
        ];

        const sampleUsers = [
            { id: 'user1', username: 'demo', password: 'password', name: 'Demo User' },
            { id: 'user2', username: 'john', password: 'password', name: 'John Doe' },
            { id: 'user3', username: 'jane', password: 'password', name: 'Jane Smith' },
        ];

        // Context Providers
        const AuthContext = React.createContext();
        const TaskContext = React.createContext();
        const ThemeContext = React.createContext();

        // Auth Provider
        const AuthProvider = ({ children }) => {
            const [user, setUser] = React.useState(null);
            const [isAuthenticated, setIsAuthenticated] = React.useState(false);
            const [loading, setLoading] = React.useState(true);

            React.useEffect(() => {
                // Check if user is already logged in
                const storedUser = localStorage.getItem('todoAppUser');
                if (storedUser) {
                    setUser(JSON.parse(storedUser));
                    setIsAuthenticated(true);
                }
                setLoading(false);
            }, []);

            const login = (username, password) => {
                // Find user in sample users array
                const foundUser = sampleUsers.find(
                    u => u.username === username && u.password === password
                );
                
                if (foundUser) {
                    const userInfo = { ...foundUser };
                    delete userInfo.password; // Remove password from stored user object
                    
                    setUser(userInfo);
                    setIsAuthenticated(true);
                    localStorage.setItem('todoAppUser', JSON.stringify(userInfo));
                    return { success: true };
                }
                
                return { success: false, message: 'Invalid username or password' };
            };

            const register = (username, password, name) => {
                // Check if username already exists
                if (sampleUsers.some(u => u.username === username)) {
                    return { success: false, message: 'Username already taken' };
                }
                
                // Simulate user registration
                const newUser = {
                    id: generateId(),
                    username,
                    password,
                    name,
                };
                
                sampleUsers.push(newUser);
                
                const userInfo = { ...newUser };
                delete userInfo.password;
                
                setUser(userInfo);
                setIsAuthenticated(true);
                localStorage.setItem('todoAppUser', JSON.stringify(userInfo));
                
                return { success: true };
            };

            const logout = () => {
                setUser(null);
                setIsAuthenticated(false);
                localStorage.removeItem('todoAppUser');
            };

            return (
                <AuthContext.Provider value={{ user, isAuthenticated, loading, login, register, logout }}>
                    {children}
                </AuthContext.Provider>
            );
        };

        // Task Provider
        const TaskProvider = ({ children }) => {
            const { isAuthenticated, user } = React.useContext(AuthContext);
            const [tasks, setTasks] = React.useState([]);
            const [categories, setCategories] = React.useState(defaultCategories);
            const [loading, setLoading] = React.useState(true);
            const [selectedTasks, setSelectedTasks] = React.useState([]);
            
            React.useEffect(() => {
                // Load tasks and categories from localStorage
                if (isAuthenticated) {
                    const storedTasks = localStorage.getItem(`todoApp_tasks_${user.id}`);
                    const storedCategories = localStorage.getItem(`todoApp_categories_${user.id}`);
                    
                    setTasks(storedTasks ? JSON.parse(storedTasks) : defaultTasks);
                    setCategories(storedCategories ? JSON.parse(storedCategories) : defaultCategories);
                } else {
                    setTasks([]);
                    setCategories(defaultCategories);
                }
                
                setLoading(false);
            }, [isAuthenticated, user]);

            React.useEffect(() => {
                // Save tasks and categories to localStorage when they change
                if (isAuthenticated && user && !loading) {
                    localStorage.setItem(`todoApp_tasks_${user.id}`, JSON.stringify(tasks));
                    localStorage.setItem(`todoApp_categories_${user.id}`, JSON.stringify(categories));
                }
            }, [tasks, categories, isAuthenticated, user, loading]);

            // Task Management
            const addTask = (task) => {
                const newTask = {
                    ...task,
                    id: generateId(),
                    createdAt: new Date().toISOString(),
                    completed: false,
                    subtasks: task.subtasks || [],
                    timeTracked: 0,
                    timeTrackingActive: false,
                    timeTrackingStartedAt: null,
                    shared: [],
                };
                
                setTasks(prevTasks => [...prevTasks, newTask]);
                return newTask;
            };

            const updateTask = (taskId, updates) => {
                setTasks(prevTasks => 
                    prevTasks.map(task => 
                        task.id === taskId ? { ...task, ...updates } : task
                    )
                );
            };

            const deleteTask = (taskId) => {
                setTasks(prevTasks => prevTasks.filter(task => task.id !== taskId));
                setSelectedTasks(prev => prev.filter(id => id !== taskId));
            };

            const toggleTaskCompletion = (taskId) => {
                setTasks(prevTasks => 
                    prevTasks.map(task => 
                        task.id === taskId ? { ...task, completed: !task.completed } : task
                    )
                );
            };

            // Subtask Management
            const addSubtask = (taskId, subtaskTitle) => {
                setTasks(prevTasks => 
                    prevTasks.map(task => {
                        if (task.id === taskId) {
                            const newSubtask = {
                                id: generateId(),
                                title: subtaskTitle,
                                completed: false,
                            };
                            return {
                                ...task,
                                subtasks: [...task.subtasks, newSubtask],
                            };
                        }
                        return task;
                    })
                );
            };

            const updateSubtask = (taskId, subtaskId, updates) => {
                setTasks(prevTasks => 
                    prevTasks.map(task => {
                        if (task.id === taskId) {
                            return {
                                ...task,
                                subtasks: task.subtasks.map(subtask => 
                                    subtask.id === subtaskId ? { ...subtask, ...updates } : subtask
                                ),
                            };
                        }
                        return task;
                    })
                );
            };

            const deleteSubtask = (taskId, subtaskId) => {
                setTasks(prevTasks => 
                    prevTasks.map(task => {
                        if (task.id === taskId) {
                            return {
                                ...task,
                                subtasks: task.subtasks.filter(subtask => subtask.id !== subtaskId),
                            };
                        }
                        return task;
                    })
                );
            };

            // Time Tracking
            const startTimeTracking = (taskId) => {
                setTasks(prevTasks => 
                    prevTasks.map(task => {
                        if (task.id === taskId) {
                            return {
                                ...task,
                                timeTrackingActive: true,
                                timeTrackingStartedAt: new Date().toISOString(),
                            };
                        }
                        // Stop tracking on other tasks
                        if (task.timeTrackingActive) {
                            const elapsedTime = calculateElapsedTime(task.timeTrackingStartedAt);
                            return {
                                ...task,
                                timeTracked: task.timeTracked + elapsedTime,
                                timeTrackingActive: false,
                                timeTrackingStartedAt: null,
                            };
                        }
                        return task;
                    })
                );
            };

            const stopTimeTracking = (taskId) => {
                setTasks(prevTasks => 
                    prevTasks.map(task => {
                        if (task.id === taskId && task.timeTrackingActive) {
                            const elapsedTime = calculateElapsedTime(task.timeTrackingStartedAt);
                            return {
                                ...task,
                                timeTracked: task.timeTracked + elapsedTime,
                                timeTrackingActive: false,
                                timeTrackingStartedAt: null,
                            };
                        }
                        return task;
                    })
                );
            };

            const calculateElapsedTime = (startTime) => {
                if (!startTime) return 0;
                const start = new Date(startTime);
                const now = new Date();
                return Math.floor((now - start) / 1000); // Return seconds
            };

            // Category Management
            const addCategory = (category) => {
                const newCategory = {
                    ...category,
                    id: category.id || generateId(),
                };
                setCategories(prevCategories => [...prevCategories, newCategory]);
            };

            const updateCategory = (categoryId, updates) => {
                setCategories(prevCategories => 
                    prevCategories.map(category => 
                        category.id === categoryId ? { ...category, ...updates } : category
                    )
                );
            };

            const deleteCategory = (categoryId) => {
                // Update any tasks with this category to have no category
                setTasks(prevTasks => 
                    prevTasks.map(task => 
                        task.category === categoryId ? { ...task, category: null } : task
                    )
                );
                
                // Delete the category
                setCategories(prevCategories => 
                    prevCategories.filter(category => category.id !== categoryId)
                );
            };

            // Batch Operations
            const batchDeleteTasks = () => {
                setTasks(prevTasks => 
                    prevTasks.filter(task => !selectedTasks.includes(task.id))
                );
                setSelectedTasks([]);
            };

            const batchCompleteTask = (completed = true) => {
                setTasks(prevTasks => 
                    prevTasks.map(task => 
                        selectedTasks.includes(task.id) 
                            ? { ...task, completed } 
                            : task
                    )
                );
            };

            // Selection Management
            const toggleTaskSelection = (taskId) => {
                setSelectedTasks(prev => 
                    prev.includes(taskId)
                        ? prev.filter(id => id !== taskId)
                        : [...prev, taskId]
                );
            };

            const selectAllTasks = (filter) => {
                let taskIds;
                
                if (filter && Object.keys(filter).length > 0) {
                    taskIds = tasks
                        .filter(task => {
                            // Filter by status
                            if (filter.status && filter.status !== 'all') {
                                if (filter.status === 'active' && task.completed) return false;
                                if (filter.status === 'completed' && !task.completed) return false;
                            }
                            
                            // Filter by category
                            if (filter.category && task.category !== filter.category) return false;
                            
                            // Filter by priority
                            if (filter.priority && task.priority !== filter.priority) return false;
                            
                            // Filter by due date
                            if (filter.dueDate) {
                                const today = new Date();
                                today.setHours(0, 0, 0, 0);
                                
                                const taskDueDate = task.dueDate ? new Date(task.dueDate) : null;
                                if (!taskDueDate) return false;
                                
                                if (filter.dueDate === 'today') {
                                    const isSameDay = 
                                        taskDueDate.getDate() === today.getDate() &&
                                        taskDueDate.getMonth() === today.getMonth() &&
                                        taskDueDate.getFullYear() === today.getFullYear();
                                    if (!isSameDay) return false;
                                } else if (filter.dueDate === 'week') {
                                    const weekEnd = new Date(today);
                                    weekEnd.setDate(today.getDate() + 7);
                                    if (taskDueDate < today || taskDueDate > weekEnd) return false;
                                } else if (filter.dueDate === 'month') {
                                    const monthEnd = new Date(today);
                                    monthEnd.setMonth(today.getMonth() + 1);
                                    if (taskDueDate < today || taskDueDate > monthEnd) return false;
                                }
                            }
                            
                            // If all filters pass, include the task
                            return true;
                        })
                        .map(task => task.id);
                } else {
                    taskIds = tasks.map(task => task.id);
                }
                
                setSelectedTasks(taskIds);
            };

            const clearSelection = () => {
                setSelectedTasks([]);
            };

            // Task Sharing
            const shareTask = (taskId, userId) => {
                setTasks(prevTasks => 
                    prevTasks.map(task => {
                        if (task.id === taskId) {
                            return {
                                ...task,
                                shared: task.shared.includes(userId)
                                    ? task.shared
                                    : [...task.shared, userId],
                            };
                        }
                        return task;
                    })
                );
            };

            const unshareTask = (taskId, userId) => {
                setTasks(prevTasks => 
                    prevTasks.map(task => {
                        if (task.id === taskId) {
                            return {
                                ...task,
                                shared: task.shared.filter(id => id !== userId),
                            };
                        }
                        return task;
                    })
                );
            };

            // Task reordering
            const reorderTasks = (startIndex, endIndex) => {
                const result = Array.from(tasks);
                const [removed] = result.splice(startIndex, 1);
                result.splice(endIndex, 0, removed);
                setTasks(result);
            };

            // Data export/import
            const exportTasks = () => {
                const dataToExport = {
                    tasks,
                    categories,
                };
                
                return JSON.stringify(dataToExport, null, 2);
            };

            const importTasks = (jsonData) => {
                try {
                    const data = JSON.parse(jsonData);
                    
                    if (data.tasks && Array.isArray(data.tasks)) {
                        setTasks(data.tasks);
                    }
                    
                    if (data.categories && Array.isArray(data.categories)) {
                        setCategories(data.categories);
                    }
                    
                    return { success: true };
                } catch (error) {
                    return { success: false, message: 'Invalid JSON data' };
                }
            };

            return (
                <TaskContext.Provider value={{
                    tasks,
                    categories,
                    selectedTasks,
                    loading,
                    addTask,
                    updateTask,
                    deleteTask,
                    toggleTaskCompletion,
                    addSubtask,
                    updateSubtask,
                    deleteSubtask,
                    startTimeTracking,
                    stopTimeTracking,
                    addCategory,
                    updateCategory,
                    deleteCategory,
                    batchDeleteTasks,
                    batchCompleteTask,
                    toggleTaskSelection,
                    selectAllTasks,
                    clearSelection,
                    shareTask,
                    unshareTask,
                    reorderTasks,
                    exportTasks,
                    importTasks,
                }}>
                    {children}
                </TaskContext.Provider>
            );
        };

        // Theme Provider
        const ThemeProvider = ({ children }) => {
            const [darkMode, setDarkMode] = React.useState(false);
            
            React.useEffect(() => {
                // Check system preference
                if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
                    setDarkMode(true);
                    document.documentElement.classList.add('dark');
                }
                
                // Listen for changes
                const mediaQuery = window.matchMedia('(prefers-color-scheme: dark)');
                const handleChange = (e) => {
                    setDarkMode(e.matches);
                    if (e.matches) {
                        document.documentElement.classList.add('dark');
                    } else {
                        document.documentElement.classList.remove('dark');
                    }
                };
                
                mediaQuery.addEventListener('change', handleChange);
                
                return () => {
                    mediaQuery.removeEventListener('change', handleChange);
                };
            }, []);
            
            const toggleDarkMode = () => {
                setDarkMode(prev => {
                    const newMode = !prev;
                    if (newMode) {
                        document.documentElement.classList.add('dark');
                    } else {
                        document.documentElement.classList.remove('dark');
                    }
                    return newMode;
                });
            };
            
            return (
                <ThemeContext.Provider value={{ darkMode, toggleDarkMode }}>
                    {children}
                </ThemeContext.Provider>
            );
        };

        // Component: Login Form
        const LoginForm = ({ onSwitch }) => {
            const { login } = React.useContext(AuthContext);
            const [formData, setFormData] = React.useState({ username: '', password: '' });
            const [error, setError] = React.useState('');
            const [loading, setLoading] = React.useState(false);
            
            const handleChange = (e) => {
                setFormData({ ...formData, [e.target.name]: e.target.value });
            };
            
            const handleSubmit = (e) => {
                e.preventDefault();
                setError('');
                setLoading(true);
                
                const { username, password } = formData;
                
                if (!username || !password) {
                    setError('Please fill in all fields');
                    setLoading(false);
                    return;
                }
                
                const result = login(username, password);
                
                if (!result.success) {
                    setError(result.message);
                }
                
                setLoading(false);
            };
            
            return (
                <div className="animate-fade-in p-6 bg-white dark:bg-gray-800 rounded-lg shadow-lg max-w-md w-full">
                    <h2 className="text-2xl font-semibold text-center mb-6 text-gray-800 dark:text-white">Log In</h2>
                    
                    {error && (
                        <div className="mb-4 p-3 bg-red-100 dark:bg-red-900/30 text-red-800 dark:text-red-200 rounded-md text-sm">
                            {error}
                        </div>
                    )}
                    
                    <form onSubmit={handleSubmit}>
                        <div className="mb-4">
                            <label className="block text-gray-700 dark:text-gray-300 text-sm font-medium mb-2" htmlFor="username">
                                Username
                            </label>
                            <input
                                id="username"
                                name="username"
                                type="text"
                                value={formData.username}
                                onChange={handleChange}
                                className="w-full px-3 py-2 border border-gray-300 dark:border-gray-700 rounded-md shadow-sm focus:outline-none focus:ring-primary-500 focus:border-primary-500 dark:bg-gray-700 dark:text-white text-base"
                                placeholder="Enter your username"
                            />
                        </div>
                        
                        <div className="mb-6">
                            <label className="block text-gray-700 dark:text-gray-300 text-sm font-medium mb-2" htmlFor="password">
                                Password
                            </label>
                            <input
                                id="password"
                                name="password"
                                type="password"
                                value={formData.password}
                                onChange={handleChange}
                                className="w-full px-3 py-2 border border-gray-300 dark:border-gray-700 rounded-md shadow-sm focus:outline-none focus:ring-primary-500 focus:border-primary-500 dark:bg-gray-700 dark:text-white text-base"
                                placeholder="Enter your password"
                            />
                        </div>
                        
                        <button
                            type="submit"
                            disabled={loading}
                            className="w-full py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-primary-600 hover:bg-primary-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500 transition-colors duration-200 disabled:opacity-50"
                        >
                            {loading ? 'Logging in...' : 'Log In'}
                        </button>
                    </form>
                    
                    <div className="mt-4 text-center">
                        <span className="text-sm text-gray-600 dark:text-gray-400">
                            Don't have an account?{' '}
                            <button 
                                onClick={() => onSwitch('register')} 
                                className="text-primary-600 hover:text-primary-500 dark:text-primary-400 font-medium focus:outline-none"
                            >
                                Sign up
                            </button>
                        </span>
                    </div>
                    
                    <div className="mt-4 border-t border-gray-200 dark:border-gray-700 pt-4">
                        <p className="text-xs text-gray-500 dark:text-gray-400 text-center">
                            Demo credentials: username "demo", password "password"
                        </p>
                    </div>
                </div>
            );
        };

        // Component: Register Form
        const RegisterForm = ({ onSwitch }) => {
            const { register } = React.useContext(AuthContext);
            const [formData, setFormData] = React.useState({ 
                username: '', 
                password: '', 
                confirmPassword: '',
                name: ''
            });
            const [error, setError] = React.useState('');
            const [loading, setLoading] = React.useState(false);
            
            const handleChange = (e) => {
                setFormData({ ...formData, [e.target.name]: e.target.value });
            };
            
            const handleSubmit = (e) => {
                e.preventDefault();
                setError('');
                setLoading(true);
                
                const { username, password, confirmPassword, name } = formData;
                
                if (!username || !password || !confirmPassword || !name) {
                    setError('Please fill in all fields');
                    setLoading(false);
                    return;
                }
                
                if (password !== confirmPassword) {
                    setError('Passwords do not match');
                    setLoading(false);
                    return;
                }
                
                const result = register(username, password, name);
                
                if (!result.success) {
                    setError(result.message);
                }
                
                setLoading(false);
            };
            
            return (
                <div className="animate-fade-in p-6 bg-white dark:bg-gray-800 rounded-lg shadow-lg max-w-md w-full">
                    <h2 className="text-2xl font-semibold text-center mb-6 text-gray-800 dark:text-white">Create Account</h2>
                    
                    {error && (
                        <div className="mb-4 p-3 bg-red-100 dark:bg-red-900/30 text-red-800 dark:text-red-200 rounded-md text-sm">
                            {error}
                        </div>
                    )}
                    
                    <form onSubmit={handleSubmit}>
                        <div className="mb-4">
                            <label className="block text-gray-700 dark:text-gray-300 text-sm font-medium mb-2" htmlFor="name">
                                Full Name
                            </label>
                            <input
                                id="name"
                                name="name"
                                type="text"
                                value={formData.name}
                                onChange={handleChange}
                                className="w-full px-3 py-2 border border-gray-300 dark:border-gray-700 rounded-md shadow-sm focus:outline-none focus:ring-primary-500 focus:border-primary-500 dark:bg-gray-700 dark:text-white text-base"
                                placeholder="Enter your full name"
                            />
                        </div>
                    
                        <div className="mb-4">
                            <label className="block text-gray-700 dark:text-gray-300 text-sm font-medium mb-2" htmlFor="username">
                                Username
                            </label>
                            <input
                                id="username"
                                name="username"
                                type="text"
                                value={formData.username}
                                onChange={handleChange}
                                className="w-full px-3 py-2 border border-gray-300 dark:border-gray-700 rounded-md shadow-sm focus:outline-none focus:ring-primary-500 focus:border-primary-500 dark:bg-gray-700 dark:text-white text-base"
                                placeholder="Choose a username"
                            />
                        </div>
                        
                        <div className="mb-4">
                            <label className="block text-gray-700 dark:text-gray-300 text-sm font-medium mb-2" htmlFor="password">
                                Password
                            </label>
                            <input
                                id="password"
                                name="password"
                                type="password"
                                value={formData.password}
                                onChange={handleChange}
                                className="w-full px-3 py-2 border border-gray-300 dark:border-gray-700 rounded-md shadow-sm focus:outline-none focus:ring-primary-500 focus:border-primary-500 dark:bg-gray-700 dark:text-white text-base"
                                placeholder="Create a password"
                            />
                        </div>
                        
                        <div className="mb-6">
                            <label className="block text-gray-700 dark:text-gray-300 text-sm font-medium mb-2" htmlFor="confirmPassword">
                                Confirm Password
                            </label>
                            <input
                                id="confirmPassword"
                                name="confirmPassword"
                                type="password"
                                value={formData.confirmPassword}
                                onChange={handleChange}
                                className="w-full px-3 py-2 border border-gray-300 dark:border-gray-700 rounded-md shadow-sm focus:outline-none focus:ring-primary-500 focus:border-primary-500 dark:bg-gray-700 dark:text-white text-base"
                                placeholder="Confirm your password"
                            />
                        </div>
                        
                        <button
                            type="submit"
                            disabled={loading}
                            className="w-full py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-primary-600 hover:bg-primary-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500 transition-colors duration-200 disabled:opacity-50"
                        >
                            {loading ? 'Creating account...' : 'Sign Up'}
                        </button>
                    </form>
                    
                    <div className="mt-4 text-center">
                        <span className="text-sm text-gray-600 dark:text-gray-400">
                            Already have an account?{' '}
                            <button 
                                onClick={() => onSwitch('login')} 
                                className="text-primary-600 hover:text-primary-500 dark:text-primary-400 font-medium focus:outline-none"
                            >
                                Log in
                            </button>
                        </span>
                    </div>
                </div>
            );
        };

        // Component: Auth Container
        const AuthContainer = () => {
            const [activeForm, setActiveForm] = React.useState('login');
            
            return (
                <div className="min-h-screen flex items-center justify-center p-4 bg-gray-50 dark:bg-gray-900">
                    <div className="max-w-md w-full">
                        {activeForm === 'login' ? (
                            <LoginForm onSwitch={setActiveForm} />
                        ) : (
                            <RegisterForm onSwitch={setActiveForm} />
                        )}
                    </div>
                </div>
            );
        };

        // Component: Header
        const Header = () => {
            const { user, logout } = React.useContext(AuthContext);
            const { darkMode, toggleDarkMode } = React.useContext(ThemeContext);
            const [showUserMenu, setShowUserMenu] = React.useState(false);
            
            return (
                <header className="bg-white dark:bg-gray-800 shadow-sm z-10">
                    <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                        <div className="flex justify-between h-16">
                            <div className="flex items-center">
                                <div className="flex-shrink-0 flex items-center">
                                    <div className="flex items-center space-x-2">
                                        <span className="text-primary-600 dark:text-primary-400">
                                            <i className="fas fa-check-circle text-2xl"></i>
                                        </span>
                                        <span className="text-gray-900 dark:text-white font-bold text-xl">
                                            Advanced Todo
                                        </span>
                                    </div>
                                </div>
                            </div>
                            
                            <div className="flex items-center space-x-4">
                                <button
                                    onClick={toggleDarkMode}
                                    className="p-2 rounded-full text-gray-600 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 focus:outline-none"
                                    aria-label="Toggle dark mode"
                                >
                                    {darkMode ? (
                                        <i className="fas fa-sun"></i>
                                    ) : (
                                        <i className="fas fa-moon"></i>
                                    )}
                                </button>
                                
                                <div className="relative">
                                    <button
                                        onClick={() => setShowUserMenu(!showUserMenu)}
                                        className="flex items-center space-x-2 focus:outline-none"
                                    >
                                        <div className="w-8 h-8 rounded-full bg-primary-600 flex items-center justify-center text-white">
                                            {user.name.charAt(0).toUpperCase()}
                                        </div>
                                        <span className="hidden md:block text-sm font-medium text-gray-700 dark:text-gray-300">
                                            {user.name}
                                        </span>
                                        <i className="fas fa-chevron-down text-xs text-gray-500 dark:text-gray-400"></i>
                                    </button>
                                    
                                    {showUserMenu && (
                                        <div 
                                            className="absolute right-0 mt-2 w-48 bg-white dark:bg-gray-800 rounded-md shadow-lg py-1 z-10 ring-1 ring-black ring-opacity-5 animate-fade-in"
                                            onMouseLeave={() => setShowUserMenu(false)}
                                        >
                                            <button
                                                onClick={logout}
                                                className="w-full text-left px-4 py-2 text-sm text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700"
                                            >
                                                Sign out
                                            </button>
                                        </div>
                                    )}
                                </div>
                            </div>
                        </div>
                    </div>
                </header>
            );
        };

        // Component: TaskForm
        const TaskForm = ({ task = null, onSave, onCancel }) => {
            const { categories } = React.useContext(TaskContext);
            const [formData, setFormData] = React.useState({
                title: task?.title || '',
                description: task?.description || '',
                dueDate: task?.dueDate || '',
                category: task?.category || '',
                priority: task?.priority || 'medium',
                recurrence: task?.recurrence ? task.recurrence.type : 'none',
                recurrenceInterval: task?.recurrence ? task.recurrence.interval : 1,
                subtasks: task?.subtasks || [],
            });
            const [newSubtask, setNewSubtask] = React.useState('');
            const [error, setError] = React.useState('');
            
            const handleChange = (e) => {
                const { name, value } = e.target;
                setFormData({ ...formData, [name]: value });
            };
            
            const handleAddSubtask = () => {
                if (!newSubtask.trim()) return;
                
                const newSubtaskObj = {
                    id: generateId(),
                    title: newSubtask.trim(),
                    completed: false,
                };
                
                setFormData({
                    ...formData,
                    subtasks: [...formData.subtasks, newSubtaskObj],
                });
                
                setNewSubtask('');
            };
            
            const handleRemoveSubtask = (subtaskId) => {
                setFormData({
                    ...formData,
                    subtasks: formData.subtasks.filter(subtask => subtask.id !== subtaskId),
                });
            };
            
            const handleSubmit = (e) => {
                e.preventDefault();
                setError('');
                
                if (!formData.title.trim()) {
                    setError('Title is required');
                    return;
                }
                
                const taskData = {
                    ...task,
                    title: formData.title.trim(),
                    description: formData.description.trim(),
                    dueDate: formData.dueDate,
                    category: formData.category || null,
                    priority: formData.priority,
                    subtasks: formData.subtasks,
                    recurrence: formData.recurrence !== 'none' 
                        ? { 
                            type: formData.recurrence, 
                            interval: parseInt(formData.recurrenceInterval, 10) || 1 
                        } 
                        : null,
                };
                
                onSave(taskData);
            };
            
            return (
                <div className="animate-fade-in bg-white dark:bg-gray-800 rounded-lg shadow-lg p-6">
                    <h2 className="text-xl font-semibold mb-4 text-gray-800 dark:text-white">
                        {task ? 'Edit Task' : 'Add New Task'}
                    </h2>
                    
                    {error && (
                        <div className="mb-4 p-3 bg-red-100 dark:bg-red-900/30 text-red-800 dark:text-red-200 rounded-md text-sm">
                            {error}
                        </div>
                    )}
                    
                    <form onSubmit={handleSubmit}>
                        <div className="space-y-4">
                            <div>
                                <label className="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1" htmlFor="title">
                                    Title
                                </label>
                                <input
                                    id="title"
                                    name="title"
                                    type="text"
                                    value={formData.title}
                                    onChange={handleChange}
                                    className="w-full px-3 py-2 border border-gray-300 dark:border-gray-700 rounded-md shadow-sm focus:outline-none focus:ring-primary-500 focus:border-primary-500 dark:bg-gray-700 dark:text-white text-base"
                                    placeholder="Task title"
                                />
                            </div>
                            
                            <div>
                                <label className="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1" htmlFor="description">
                                    Description
                                </label>
                                <textarea
                                    id="description"
                                    name="description"
                                    rows="3"
                                    value={formData.description}
                                    onChange={handleChange}
                                    className="w-full px-3 py-2 border border-gray-300 dark:border-gray-700 rounded-md shadow-sm focus:outline-none focus:ring-primary-500 focus:border-primary-500 dark:bg-gray-700 dark:text-white text-base"
                                    placeholder="Task description"
                                ></textarea>
                            </div>
                            
                            <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                                <div>
                                    <label className="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1" htmlFor="dueDate">
                                        Due Date
                                    </label>
                                    <input
                                        id="dueDate"
                                        name="dueDate"
                                        type="date"
                                        value={formData.dueDate}
                                        onChange={handleChange}
                                        className="w-full px-3 py-2 border border-gray-300 dark:border-gray-700 rounded-md shadow-sm focus:outline-none focus:ring-primary-500 focus:border-primary-500 dark:bg-gray-700 dark:text-white text-base"
                                    />
                                </div>
                                
                                <div>
                                    <label className="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1" htmlFor="category">
                                        Category
                                    </label>
                                    <select
                                        id="category"
                                        name="category"
                                        value={formData.category}
                                        onChange={handleChange}
                                        className="w-full px-3 py-2 border border-gray-300 dark:border-gray-700 rounded-md shadow-sm focus:outline-none focus:ring-primary-500 focus:border-primary-500 dark:bg-gray-700 dark:text-white text-base"
                                    >
                                        <option value="">No Category</option>
                                        {categories.map((category) => (
                                            <option key={category.id} value={category.id}>
                                                {category.name}
                                            </option>
                                        ))}
                                    </select>
                                </div>
                            </div>
                            
                            <div>
                                <label className="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">
                                    Priority
                                </label>
                                <div className="flex space-x-4">
                                    {['low', 'medium', 'high'].map((priority) => (
                                        <label key={priority} className="flex items-center">
                                            <input
                                                type="radio"
                                                name="priority"
                                                value={priority}
                                                checked={formData.priority === priority}
                                                onChange={handleChange}
                                                className="h-4 w-4 text-primary-600 focus:ring-primary-500"
                                            />
                                            <span className="ml-2 text-sm text-gray-700 dark:text-gray-300 capitalize">
                                                {priority}
                                            </span>
                                        </label>
                                    ))}
                                </div>
                            </div>
                            
                            <div>
                                <label className="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">
                                    Recurrence
                                </label>
                                <div className="grid grid-cols-2 gap-4">
                                    <select
                                        name="recurrence"
                                        value={formData.recurrence}
                                        onChange={handleChange}
                                        className="px-3 py-2 border border-gray-300 dark:border-gray-700 rounded-md shadow-sm focus:outline-none focus:ring-primary-500 focus:border-primary-500 dark:bg-gray-700 dark:text-white text-base"
                                    >
                                        <option value="none">None</option>
                                        <option value="daily">Daily</option>
                                        <option value="weekly">Weekly</option>
                                        <option value="monthly">Monthly</option>
                                    </select>
                                    
                                    {formData.recurrence !== 'none' && (
                                        <div className="flex items-center space-x-2">
                                            <span className="text-sm text-gray-700 dark:text-gray-300">Every</span>
                                            <input
                                                type="number"
                                                name="recurrenceInterval"
                                                value={formData.recurrenceInterval}
                                                onChange={handleChange}
                                                min="1"
                                                max="30"
                                                className="w-16 px-2 py-1 border border-gray-300 dark:border-gray-700 rounded-md shadow-sm focus:outline-none focus:ring-primary-500 focus:border-primary-500 dark:bg-gray-700 dark:text-white text-base"
                                            />
                                            <span className="text-sm text-gray-700 dark:text-gray-300">
                                                {formData.recurrence === 'daily' ? 'days' : 
                                                 formData.recurrence === 'weekly' ? 'weeks' : 'months'}
                                            </span>
                                        </div>
                                    )}
                                </div>
                            </div>
                            
                            <div>
                                <label className="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                                    Subtasks
                                </label>
                                <div className="space-y-2">
                                    {formData.subtasks.map((subtask, index) => (
                                        <div key={subtask.id} className="flex items-center justify-between bg-gray-50 dark:bg-gray-700 rounded-md p-2">
                                            <span className="text-sm text-gray-700 dark:text-gray-300">
                                                {subtask.title}
                                            </span>
                                            <button
                                                type="button"
                                                onClick={() => handleRemoveSubtask(subtask.id)}
                                                className="text-red-500 hover:text-red-700 dark:text-red-400 dark:hover:text-red-300 focus:outline-none"
                                                aria-label="Remove subtask"
                                            >
                                                <i className="fas fa-times"></i>
                                            </button>
                                        </div>
                                    ))}
                                    
                                    <div className="flex">
                                        <input
                                            type="text"
                                            value={newSubtask}
                                            onChange={(e) => setNewSubtask(e.target.value)}
                                            className="flex-grow px-3 py-2 border border-gray-300 dark:border-gray-700 rounded-l-md shadow-sm focus:outline-none focus:ring-primary-500 focus:border-primary-500 dark:bg-gray-700 dark:text-white text-base"
                                            placeholder="Add a subtask"
                                            onKeyDown={(e) => {
                                                if (e.key === 'Enter') {
                                                    e.preventDefault();
                                                    handleAddSubtask();
                                                }
                                            }}
                                        />
                                        <button
                                            type="button"
                                            onClick={handleAddSubtask}
                                            className="px-3 py-2 bg-gray-200 dark:bg-gray-600 text-gray-700 dark:text-gray-200 rounded-r-md hover:bg-gray-300 dark:hover:bg-gray-500 focus:outline-none"
                                        >
                                            <i className="fas fa-plus"></i>
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div className="mt-6 flex justify-end space-x-3">
                            <button
                                type="button"
                                onClick={onCancel}
                                className="px-4 py-2 text-sm font-medium text-gray-700 dark:text-gray-300 bg-white dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm hover:bg-gray-50 dark:hover:bg-gray-600 focus:outline-none"
                            >
                                Cancel
                            </button>
                            <button
                                type="submit"
                                className="px-4 py-2 text-sm font-medium text-white bg-primary-600 border border-transparent rounded-md shadow-sm hover:bg-primary-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500"
                            >
                                {task ? 'Update Task' : 'Create Task'}
                            </button>
                        </div>
                    </form>
                </div>
            );
        };

        // Component: CategoryForm
        const CategoryForm = ({ category = null, onSave, onCancel }) => {
            const [formData, setFormData] = React.useState({
                name: category?.name || '',
                color: category?.color || '#4f46e5',
            });
            const [error, setError] = React.useState('');
            
            const handleChange = (e) => {
                const { name, value } = e.target;
                setFormData({ ...formData, [name]: value });
            };
            
            const handleSubmit = (e) => {
                e.preventDefault();
                setError('');
                
                if (!formData.name.trim()) {
                    setError('Category name is required');
                    return;
                }
                
                const categoryData = {
                    ...category,
                    name: formData.name.trim(),
                    color: formData.color,
                };
                
                onSave(categoryData);
            };
            
            return (
                <div className="animate-fade-in bg-white dark:bg-gray-800 rounded-lg shadow-lg p-6">
                    <h2 className="text-xl font-semibold mb-4 text-gray-800 dark:text-white">
                        {category ? 'Edit Category' : 'Add New Category'}
                    </h2>
                    
                    {error && (
                        <div className="mb-4 p-3 bg-red-100 dark:bg-red-900/30 text-red-800 dark:text-red-200 rounded-md text-sm">
                            {error}
                        </div>
                    )}
                    
                    <form onSubmit={handleSubmit}>
                        <div className="space-y-4">
                            <div>
                                <label className="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1" htmlFor="name">
                                    Category Name
                                </label>
                                <input
                                    id="name"
                                    name="name"
                                    type="text"
                                    value={formData.name}
                                    onChange={handleChange}
                                    className="w-full px-3 py-2 border border-gray-300 dark:border-gray-700 rounded-md shadow-sm focus:outline-none focus:ring-primary-500 focus:border-primary-500 dark:bg-gray-700 dark:text-white text-base"
                                    placeholder="Category name"
                                />
                            </div>
                            
                            <div>
                                <label className="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1" htmlFor="color">
                                    Color
                                </label>
                                <div className="flex items-center space-x-3">
                                    <input
                                        id="color"
                                        name="color"
                                        type="color"
                                        value={formData.color}
                                        onChange={handleChange}
                                        className="h-10 w-10 border-0 p-0 bg-transparent cursor-pointer"
                                    />
                                    <span className="text-sm text-gray-700 dark:text-gray-300">
                                        {formData.color}
                                    </span>
                                </div>
                            </div>
                        </div>
                        
                        <div className="mt-6 flex justify-end space-x-3">
                            <button
                                type="button"
                                onClick={onCancel}
                                className="px-4 py-2 text-sm font-medium text-gray-700 dark:text-gray-300 bg-white dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm hover:bg-gray-50 dark:hover:bg-gray-600 focus:outline-none"
                            >
                                Cancel
                            </button>
                            <button
                                type="submit"
                                className="px-4 py-2 text-sm font-medium text-white bg-primary-600 border border-transparent rounded-md shadow-sm hover:bg-primary-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500"
                            >
                                {category ? 'Update Category' : 'Create Category'}
                            </button>
                        </div>
                    </form>
                </div>
            );
        };

        // Component: SubtaskItem
        const SubtaskItem = ({ subtask, taskId, onUpdate, onDelete }) => {
            return (
                <div className="flex items-center space-x-2 ml-6 mt-1 text-sm text-gray-500 dark:text-gray-400">
                    <input
                        type="checkbox"
                        checked={subtask.completed}
                        onChange={() => onUpdate(taskId, subtask.id, { completed: !subtask.completed })}
                        className="h-4 w-4 rounded text-primary-600 focus:ring-primary-500 focus:ring-offset-0 dark:bg-gray-700 dark:checked:bg-primary-500"
                    />
                    <span className={`flex-grow ${subtask.completed ? 'line-through text-gray-400 dark:text-gray-500' : ''}`}>
                        {subtask.title}
                    </span>
                    <button
                        onClick={() => onDelete(taskId, subtask.id)}
                        className="text-red-500 hover:text-red-700 dark:text-red-400 dark:hover:text-red-300 focus:outline-none"
                        aria-label="Delete subtask"
                    >
                        <i className="fas fa-times text-xs"></i>
                    </button>
                </div>
            );
        };

        // Component: ShareTaskModal
        const ShareTaskModal = ({ task, onClose, onShare }) => {
            const { user } = React.useContext(AuthContext);
            const [sharingWith, setSharingWith] = React.useState('');
            const [error, setError] = React.useState('');
            
            const handleShare = () => {
                if (!sharingWith.trim()) {
                    setError('Please enter a username');
                    return;
                }
                
                // Find user by username
                const targetUser = sampleUsers.find(u => u.username === sharingWith);
                
                if (!targetUser) {
                    setError('User not found');
                    return;
                }
                
                if (targetUser.id === user.id) {
                    setError('You cannot share with yourself');
                    return;
                }
                
                onShare(task.id, targetUser.id);
                onClose();
            };
            
            return (
                <div className="fixed inset-0 flex items-center justify-center z-50 bg-black bg-opacity-50">
                    <div className="bg-white dark:bg-gray-800 rounded-lg shadow-xl p-6 max-w-md w-full animate-fade-in">
                        <div className="flex justify-between items-center mb-4">
                            <h3 className="text-lg font-medium text-gray-900 dark:text-white">
                                Share Task
                            </h3>
                            <button
                                onClick={onClose}
                                className="text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-300 focus:outline-none"
                            >
                                <i className="fas fa-times"></i>
                            </button>
                        </div>
                        
                        <div className="mb-4">
                            <p className="text-sm text-gray-600 dark:text-gray-400 mb-2">
                                Share "{task.title}" with another user:
                            </p>
                            
                            {error && (
                                <p className="text-sm text-red-600 dark:text-red-400 mb-2">
                                    {error}
                                </p>
                            )}
                            
                            <input
                                type="text"
                                value={sharingWith}
                                onChange={(e) => setSharingWith(e.target.value)}
                                placeholder="Enter username"
                                className="w-full px-3 py-2 border border-gray-300 dark:border-gray-700 rounded-md shadow-sm focus:outline-none focus:ring-primary-500 focus:border-primary-500 dark:bg-gray-700 dark:text-white text-base"
                            />
                        </div>
                        
                        <div className="flex justify-end space-x-2">
                            <button
                                onClick={onClose}
                                className="px-4 py-2 text-sm font-medium text-gray-700 dark:text-gray-300 bg-white dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm hover:bg-gray-50 dark:hover:bg-gray-600 focus:outline-none"
                            >
                                Cancel
                            </button>
                            <button
                                onClick={handleShare}
                                className="px-4 py-2 text-sm font-medium text-white bg-primary-600 border border-transparent rounded-md shadow-sm hover:bg-primary-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500"
                            >
                                Share
                            </button>
                        </div>
                        
                        {task.shared.length > 0 && (
                            <div className="mt-4 border-t border-gray-200 dark:border-gray-700 pt-4">
                                <h4 className="text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                                    Currently shared with:
                                </h4>
                                <ul className="space-y-1">
                                    {task.shared.map(userId => {
                                        const sharedUser = sampleUsers.find(u => u.id === userId);
                                        return sharedUser ? (
                                            <li key={userId} className="flex items-center justify-between text-sm">
                                                <span className="text-gray-600 dark:text-gray-400">
                                                    {sharedUser.name} ({sharedUser.username})
                                                </span>
                                                <button
                                                    onClick={() => onShare(task.id, userId)} // This will toggle sharing
                                                    className="text-red-500 hover:text-red-700 dark:text-red-400 dark:hover:text-red-300 focus:outline-none text-xs"
                                                >
                                                    Remove
                                                </button>
                                            </li>
                                        ) : null;
                                    })}
                                </ul>
                            </div>
                        )}
                    </div>
                </div>
            );
        };

        // Component: ExportImportModal
        const ExportImportModal = ({ mode, onClose, onExport, onImport }) => {
            const [importData, setImportData] = React.useState('');
            const [error, setError] = React.useState('');
            const [exportData, setExportData] = React.useState('');
            
            React.useEffect(() => {
                if (mode === 'export') {
                    setExportData(onExport());
                }
            }, [mode, onExport]);
            
            const handleImport = () => {
                if (!importData.trim()) {
                    setError('Please enter JSON data');
                    return;
                }
                
                const result = onImport(importData);
                
                if (!result.success) {
                    setError(result.message);
                    return;
                }
                
                onClose();
            };
            
            const handleCopyToClipboard = async () => {
                try {
                    await navigator.clipboard.writeText(exportData);
                    // We would show a notification here in a real app
                } catch (err) {
                    console.error('Failed to copy: ', err);
                }
            };
            
            return (
                <div className="fixed inset-0 flex items-center justify-center z-50 bg-black bg-opacity-50">
                    <div className="bg-white dark:bg-gray-800 rounded-lg shadow-xl p-6 max-w-xl w-full animate-fade-in">
                        <div className="flex justify-between items-center mb-4">
                            <h3 className="text-lg font-medium text-gray-900 dark:text-white">
                                {mode === 'export' ? 'Export Tasks' : 'Import Tasks'}
                            </h3>
                            <button
                                onClick={onClose}
                                className="text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-300 focus:outline-none"
                            >
                                <i className="fas fa-times"></i>
                            </button>
                        </div>
                        
                        {mode === 'export' ? (
                            <div>
                                <p className="text-sm text-gray-600 dark:text-gray-400 mb-2">
                                    Copy the JSON data below to save or share your tasks:
                                </p>
                                <div className="relative">
                                    <textarea
                                        value={exportData}
                                        readOnly
                                        rows="10"
                                        className="w-full px-3 py-2 border border-gray-300 dark:border-gray-700 rounded-md shadow-sm focus:outline-none focus:ring-primary-500 focus:border-primary-500 dark:bg-gray-700 dark:text-white text-sm font-mono"
                                    ></textarea>
                                    <button
                                        onClick={handleCopyToClipboard}
                                        className="absolute top-2 right-2 p-1 text-sm bg-gray-200 dark:bg-gray-600 text-gray-700 dark:text-gray-300 rounded hover:bg-gray-300 dark:hover:bg-gray-500 focus:outline-none"
                                        title="Copy to clipboard"
                                    >
                                        <i className="fas fa-copy"></i>
                                    </button>
                                </div>
                                <div className="flex justify-end mt-4">
                                    <button
                                        onClick={onClose}
                                        className="px-4 py-2 text-sm font-medium text-gray-700 dark:text-gray-300 bg-white dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm hover:bg-gray-50 dark:hover:bg-gray-600 focus:outline-none"
                                    >
                                        Close
                                    </button>
                                </div>
                            </div>
                        ) : (
                            <div>
                                <p className="text-sm text-gray-600 dark:text-gray-400 mb-2">
                                    Paste the JSON data to import tasks and categories:
                                </p>
                                
                                {error && (
                                    <p className="text-sm text-red-600 dark:text-red-400 mb-2">
                                        {error}
                                    </p>
                                )}
                                
                                <textarea
                                    value={importData}
                                    onChange={(e) => setImportData(e.target.value)}
                                    rows="10"
                                    className="w-full px-3 py-2 border border-gray-300 dark:border-gray-700 rounded-md shadow-sm focus:outline-none focus:ring-primary-500 focus:border-primary-500 dark:bg-gray-700 dark:text-white text-sm font-mono"
                                    placeholder="Paste JSON data here"
                                ></textarea>
                                
                                <div className="flex justify-end space-x-2 mt-4">
                                    <button
                                        onClick={onClose}
                                        className="px-4 py-2 text-sm font-medium text-gray-700 dark:text-gray-300 bg-white dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm hover:bg-gray-50 dark:hover:bg-gray-600 focus:outline-none"
                                    >
                                        Cancel
                                    </button>
                                    <button
                                        onClick={handleImport}
                                        className="px-4 py-2 text-sm font-medium text-white bg-primary-600 border border-transparent rounded-md shadow-sm hover:bg-primary-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500"
                                    >
                                        Import
                                    </button>
                                </div>
                            </div>
                        )}
                    </div>
                </div>
            );
        };

        // Component: TaskItem
        const TaskItem = ({
            task,
            category,
            onEdit,
            onDelete,
            onToggleComplete,
            onToggleSelect,
            isSelected,
            onTimeTrackingToggle,
            updateSubtask,
            deleteSubtask,
            openShareModal,
            onDragStart,
            onDragEnd,
            dragging,
        }) => {
            const [showDetails, setShowDetails] = React.useState(false);
            const [newSubtask, setNewSubtask] = React.useState('');
            const [localTimeTracked, setLocalTimeTracked] = React.useState(task.timeTracked || 0);
            
            React.useEffect(() => {
                let interval;
                if (task.timeTrackingActive) {
                    interval = setInterval(() => {
                        const elapsedTime = calculateElapsedTime(task.timeTrackingStartedAt);
                        setLocalTimeTracked(task.timeTracked + elapsedTime);
                    }, 1000);
                } else {
                    setLocalTimeTracked(task.timeTracked);
                }
                
                return () => clearInterval(interval);
            }, [task.timeTrackingActive, task.timeTrackingStartedAt, task.timeTracked]);
            
            const calculateElapsedTime = (startTime) => {
                if (!startTime) return 0;
                const start = new Date(startTime);
                const now = new Date();
                return Math.floor((now - start) / 1000); // Return seconds
            };
            
            const formatTime = (seconds) => {
                if (!seconds) return '0m';
                
                const hours = Math.floor(seconds / 3600);
                const minutes = Math.floor((seconds % 3600) / 60);
                
                if (hours > 0) {
                    return `${hours}h ${minutes}m`;
                }
                return `${minutes}m`;
            };
            
            const handleAddSubtask = () => {
                if (!newSubtask.trim()) return;
                
                onAddSubtask(task.id, newSubtask.trim());
                setNewSubtask('');
            };
            
            const getPriorityColor = () => {
                switch (task.priority) {
                    case 'high':
                        return 'bg-red-100 text-red-800 dark:bg-red-900/30 dark:text-red-300';
                    case 'medium':
                        return 'bg-yellow-100 text-yellow-800 dark:bg-yellow-900/30 dark:text-yellow-300';
                    default:
                        return 'bg-green-100 text-green-800 dark:bg-green-900/30 dark:text-green-300';
                }
            };
            
            const getDueDateColor = () => {
                if (!task.dueDate) return 'text-gray-500 dark:text-gray-400';
                
                const daysRemaining = getDaysRemaining(task.dueDate);
                
                if (daysRemaining < 0) {
                    return 'text-red-600 dark:text-red-400';
                } else if (daysRemaining === 0) {
                    return 'text-orange-600 dark:text-orange-400';
                } else if (daysRemaining <= 3) {
                    return 'text-yellow-600 dark:text-yellow-400';
                } else {
                    return 'text-green-600 dark:text-green-400';
                }
            };
            
            const getDueDateText = () => {
                if (!task.dueDate) return 'No due date';
                
                const daysRemaining = getDaysRemaining(task.dueDate);
                
                if (daysRemaining < 0) {
                    return `Overdue by ${Math.abs(daysRemaining)} day${Math.abs(daysRemaining) !== 1 ? 's' : ''}`;
                } else if (daysRemaining === 0) {
                    return 'Due today';
                } else if (daysRemaining === 1) {
                    return 'Due tomorrow';
                } else {
                    return `Due in ${daysRemaining} days`;
                }
            };
            
            return (
                <div
                    className={`mb-3 bg-white dark:bg-gray-800 rounded-lg shadow-sm hover:shadow-md transition-shadow duration-200 overflow-hidden ${dragging ? 'dragging' : ''} ${isSelected ? 'ring-2 ring-primary-500' : ''}`}
                    draggable="true"
                    onDragStart={onDragStart}
                    onDragEnd={onDragEnd}
                >
                    <div className="p-4">
                        <div className="flex items-start">
                            <div className="flex-shrink-0 pt-1">
                                <input
                                    type="checkbox"
                                    checked={isSelected}
                                    onChange={() => onToggleSelect(task.id)}
                                    className="h-4 w-4 rounded text-primary-600 focus:ring-primary-500 focus:ring-offset-0 dark:bg-gray-700 dark:checked:bg-primary-500"
                                />
                            </div>
                            
                            <div className="ml-3 flex-grow cursor-pointer" onClick={() => setShowDetails(!showDetails)}>
                                <div className="flex items-center justify-between">
                                    <div className="flex items-center">
                                        <input
                                            type="checkbox"
                                            checked={task.completed}
                                            onChange={(e) => {
                                                e.stopPropagation();
                                                onToggleComplete(task.id);
                                            }}
                                            className="h-5 w-5 rounded text-primary-600 focus:ring-primary-500 focus:ring-offset-0 dark:bg-gray-700 dark:checked:bg-primary-500"
                                        />
                                        <h3 className={`ml-2 text-base font-medium ${task.completed ? 'line-through text-gray-400 dark:text-gray-500' : 'text-gray-900 dark:text-white'}`}>
                                            {task.title}
                                        </h3>
                                    </div>
                                    
                                    <div className="flex items-center space-x-1">
                                        <span className={`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${getPriorityColor()}`}>
                                            {task.priority}
                                        </span>
                                        
                                        {category && (
                                            <span
                                                className="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium"
                                                style={{
                                                    backgroundColor: `${category.color}1a`, // 10% opacity
                                                    color: category.color,
                                                }}
                                            >
                                                {category.name}
                                            </span>
                                        )}
                                        
                                        {task.recurrence && (
                                            <span className="inline-flex items-center px-2 text-gray-500 dark:text-gray-400" title="Recurring task">
                                                <i className="fas fa-repeat text-xs"></i>
                                            </span>
                                        )}
                                        
                                        {task.shared.length > 0 && (
                                            <span className="inline-flex items-center px-2 text-gray-500 dark:text-gray-400" title="Shared task">
                                                <i className="fas fa-user-friends text-xs"></i>
                                            </span>
                                        )}
                                    </div>
                                </div>
                                
                                <div className="mt-1 flex items-center text-sm text-gray-500 dark:text-gray-400">
                                    <span className={`flex items-center ${getDueDateColor()}`}>
                                        <i className="fas fa-calendar-alt mr-1"></i>
                                        {getDueDateText()}
                                    </span>
                                    
                                    {task.subtasks.length > 0 && (
                                        <span className="ml-3 flex items-center">
                                            <i className="fas fa-tasks mr-1"></i>
                                            {task.subtasks.filter(s => s.completed).length}/{task.subtasks.length}
                                        </span>
                                    )}
                                    
                                    <span className="ml-3 flex items-center">
                                        <i className="fas fa-clock mr-1"></i>
                                        {formatTime(localTimeTracked)}
                                    </span>
                                </div>
                            </div>
                            
                            <div className="ml-3 flex-shrink-0 flex flex-col">
                                <div className="flex space-x-1">
                                    <button
                                        onClick={(e) => {
                                            e.stopPropagation();
                                            onTimeTrackingToggle(task.id);
                                        }}
                                        className={`p-1 rounded-full ${task.timeTrackingActive ? 'text-red-600 hover:text-red-700 dark:text-red-400 dark:hover:text-red-300' : 'text-primary-600 hover:text-primary-700 dark:text-primary-400 dark:hover:text-primary-300'} focus:outline-none`}
                                        aria-label={task.timeTrackingActive ? 'Stop time tracking' : 'Start time tracking'}
                                    >
                                        <i className={`fas ${task.timeTrackingActive ? 'fa-stop' : 'fa-play'}`}></i>
                                    </button>
                                    
                                    <button
                                        onClick={(e) => {
                                            e.stopPropagation();
                                            openShareModal(task);
                                        }}
                                        className="p-1 rounded-full text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-300 focus:outline-none"
                                        aria-label="Share task"
                                    >
                                        <i className="fas fa-share-alt"></i>
                                    </button>
                                    
                                    <button
                                        onClick={(e) => {
                                            e.stopPropagation();
                                            onEdit(task);
                                        }}
                                        className="p-1 rounded-full text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-300 focus:outline-none"
                                        aria-label="Edit task"
                                    >
                                        <i className="fas fa-edit"></i>
                                    </button>
                                    
                                    <button
                                        onClick={(e) => {
                                            e.stopPropagation();
                                            onDelete(task.id);
                                        }}
                                        className="p-1 rounded-full text-red-500 hover:text-red-700 dark:text-red-400 dark:hover:text-red-300 focus:outline-none"
                                        aria-label="Delete task"
                                    >
                                        <i className="fas fa-trash-alt"></i>
                                    </button>
                                </div>
                            </div>
                        </div>
                        
                        {task.description && (
                            <div className={`mt-2 text-sm text-gray-600 dark:text-gray-400 ${showDetails ? '' : 'line-clamp-1'}`}>
                                {task.description}
                            </div>
                        )}
                    </div>
                    
                    {showDetails && (
                        <div className="border-t border-gray-100 dark:border-gray-700 px-4 py-3 bg-gray-50 dark:bg-gray-800/70 animate-fade-in">
                            {task.subtasks.length > 0 && (
                                <div className="mb-3">
                                    <h4 className="text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">
                                        Subtasks
                                    </h4>
                                    <div className="space-y-1">
                                        {task.subtasks.map(subtask => (
                                            <SubtaskItem
                                                key={subtask.id}
                                                subtask={subtask}
                                                taskId={task.id}
                                                onUpdate={updateSubtask}
                                                onDelete={deleteSubtask}
                                            />
                                        ))}
                                    </div>
                                </div>
                            )}
                            
                            {/* Add new subtask form */}
                            <div className="flex">
                                <input
                                    type="text"
                                    value={newSubtask}
                                    onChange={(e) => setNewSubtask(e.target.value)}
                                    placeholder="Add a subtask"
                                    className="flex-grow text-sm px-3 py-1.5 border border-gray-300 dark:border-gray-700 rounded-l-md shadow-sm focus:outline-none focus:ring-primary-500 focus:border-primary-500 dark:bg-gray-700 dark:text-white"
                                    onKeyDown={(e) => {
                                        if (e.key === 'Enter' && newSubtask.trim()) {
                                            e.preventDefault();
                                            handleAddSubtask();
                                        }
                                    }}
                                />
                                <button
                                    onClick={handleAddSubtask}
                                    className="px-3 py-1.5 bg-gray-200 dark:bg-gray-600 text-gray-700 dark:text-gray-200 rounded-r-md hover:bg-gray-300 dark:hover:bg-gray-500 focus:outline-none"
                                >
                                    <i className="fas fa-plus text-sm"></i>
                                </button>
                            </div>
                        </div>
                    )}
                </div>
            );
        };

        // Component: FilterBar
        const FilterBar = ({ filters, setFilters, categories, onShowCategoryManager, onShowExportImport }) => {
            return (
                <div className="mb-6 bg-white dark:bg-gray-800 rounded-lg shadow-sm p-4">
                    <div className="grid grid-cols-1 md:grid-cols-4 gap-4">
                        <div>
                            <label className="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">
                                Status
                            </label>
                            <select
                                value={filters.status}
                                onChange={(e) => setFilters({ ...filters, status: e.target.value })}
                                className="w-full px-3 py-1.5 text-sm border border-gray-300 dark:border-gray-700 rounded-md shadow-sm focus:outline-none focus:ring-primary-500 focus:border-primary-500 dark:bg-gray-700 dark:text-white text-base"
                            >
                                <option value="all">All Tasks</option>
                                <option value="active">Active</option>
                                <option value="completed">Completed</option>
                            </select>
                        </div>
                        
                        <div>
                            <label className="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">
                                Category
                            </label>
                            <select
                                value={filters.category}
                                onChange={(e) => setFilters({ ...filters, category: e.target.value })}
                                className="w-full px-3 py-1.5 text-sm border border-gray-300 dark:border-gray-700 rounded-md shadow-sm focus:outline-none focus:ring-primary-500 focus:border-primary-500 dark:bg-gray-700 dark:text-white text-base"
                            >
                                <option value="">All Categories</option>
                                <option value="none">No Category</option>
                                {categories.map((category) => (
                                    <option key={category.id} value={category.id}>
                                        {category.name}
                                    </option>
                                ))}
                            </select>
                        </div>
                        
                        <div>
                            <label className="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">
                                Priority
                            </label>
                            <select
                                value={filters.priority}
                                onChange={(e) => setFilters({ ...filters, priority: e.target.value })}
                                className="w-full px-3 py-1.5 text-sm border border-gray-300 dark:border-gray-700 rounded-md shadow-sm focus:outline-none focus:ring-primary-500 focus:border-primary-500 dark:bg-gray-700 dark:text-white text-base"
                            >
                                <option value="">All Priorities</option>
                                <option value="high">High</option>
                                <option value="medium">Medium</option>
                                <option value="low">Low</option>
                            </select>
                        </div>
                        
                        <div>
                            <label className="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">
                                Due Date
                            </label>
                            <select
                                value={filters.dueDate}
                                onChange={(e) => setFilters({ ...filters, dueDate: e.target.value })}
                                className="w-full px-3 py-1.5 text-sm border border-gray-300 dark:border-gray-700 rounded-md shadow-sm focus:outline-none focus:ring-primary-500 focus:border-primary-500 dark:bg-gray-700 dark:text-white text-base"
                            >
                                <option value="">Any Time</option>
                                <option value="today">Due Today</option>
                                <option value="week">Due This Week</option>
                                <option value="month">Due This Month</option>
                                <option value="overdue">Overdue</option>
                            </select>
                        </div>
                    </div>
                    
                    <div className="mt-4 flex flex-wrap items-center justify-between gap-2">
                        <div className="flex items-center">
                            <input
                                type="text"
                                value={filters.search}
                                onChange={(e) => setFilters({ ...filters, search: e.target.value })}
                                placeholder="Search tasks..."
                                className="px-3 py-1.5 text-sm border border-gray-300 dark:border-gray-700 rounded-md shadow-sm focus:outline-none focus:ring-primary-500 focus:border-primary-500 dark:bg-gray-700 dark:text-white text-base"
                            />
                            
                            {(filters.status !== 'all' || filters.category || filters.priority || filters.dueDate || filters.search) && (
                                <button
                                    onClick={() => setFilters({
                                        status: 'all',
                                        category: '',
                                        priority: '',
                                        dueDate: '',
                                        search: '',
                                        sortBy: filters.sortBy,
                                        sortOrder: filters.sortOrder,
                                    })}
                                    className="ml-2 text-sm text-primary-600 hover:text-primary-700 dark:text-primary-400 dark:hover:text-primary-300 focus:outline-none"
                                >
                                    Clear Filters
                                </button>
                            )}
                        </div>
                        
                        <div className="flex flex-wrap items-center space-x-2">
                            <button
                                onClick={onShowCategoryManager}
                                className="px-3 py-1.5 text-sm text-white bg-primary-600 rounded-md hover:bg-primary-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500 flex items-center"
                            >
                                <i className="fas fa-tags mr-1"></i>
                                Categories
                            </button>
                            
                            <button
                                onClick={onShowExportImport}
                                className="px-3 py-1.5 text-sm text-white bg-primary-600 rounded-md hover:bg-primary-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500 flex items-center"
                            >
                                <i className="fas fa-file-export mr-1"></i>
                                Export/Import
                            </button>
                            
                            <div className="flex items-center space-x-1">
                                <select
                                    value={filters.sortBy}
                                    onChange={(e) => setFilters({ ...filters, sortBy: e.target.value })}
                                    className="px-3 py-1.5 text-sm border border-gray-300 dark:border-gray-700 rounded-md shadow-sm focus:outline-none focus:ring-primary-500 focus:border-primary-500 dark:bg-gray-700 dark:text-white text-base"
                                >
                                    <option value="dueDate">Due Date</option>
                                    <option value="priority">Priority</option>
                                    <option value="title">Title</option>
                                    <option value="createdAt">Created</option>
                                </select>
                                
                                <button
                                    onClick={() => setFilters({
                                        ...filters,
                                        sortOrder: filters.sortOrder === 'asc' ? 'desc' : 'asc',
                                    })}
                                    className="p-2 text-gray-600 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-md focus:outline-none"
                                    aria-label="Toggle sort order"
                                >
                                    <i className={`fas ${filters.sortOrder === 'asc' ? 'fa-sort-up' : 'fa-sort-down'}`}></i>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            );
        };

        // Component: CategoryManager
        const CategoryManager = ({ onClose }) => {
            const { categories, addCategory, updateCategory, deleteCategory } = React.useContext(TaskContext);
            const [editingCategory, setEditingCategory] = React.useState(null);
            const [isAdding, setIsAdding] = React.useState(false);
            
            return (
                <div className="fixed inset-0 flex items-center justify-center z-50 bg-black bg-opacity-50">
                    <div className="bg-white dark:bg-gray-800 rounded-lg shadow-xl p-6 max-w-2xl w-full animate-fade-in">
                        <div className="flex justify-between items-center mb-4">
                            <h3 className="text-xl font-semibold text-gray-900 dark:text-white">
                                Manage Categories
                            </h3>
                            <button
                                onClick={onClose}
                                className="text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-300 focus:outline-none"
                            >
                                <i className="fas fa-times"></i>
                            </button>
                        </div>
                        
                        {isAdding || editingCategory ? (
                            <CategoryForm
                                category={editingCategory}
                                onSave={(categoryData) => {
                                    if (editingCategory) {
                                        updateCategory(editingCategory.id, categoryData);
                                    } else {
                                        addCategory(categoryData);
                                    }
                                    setIsAdding(false);
                                    setEditingCategory(null);
                                }}
                                onCancel={() => {
                                    setIsAdding(false);
                                    setEditingCategory(null);
                                }}
                            />
                        ) : (
                            <>
                                <div className="mb-4">
                                    <button
                                        onClick={() => setIsAdding(true)}
                                        className="px-4 py-2 text-sm font-medium text-white bg-primary-600 border border-transparent rounded-md shadow-sm hover:bg-primary-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500"
                                    >
                                        <i className="fas fa-plus mr-1"></i>
                                        Add Category
                                    </button>
                                </div>
                                
                                <div className="overflow-y-auto max-h-96 pr-2">
                                    {categories.length === 0 ? (
                                        <p className="text-gray-500 dark:text-gray-400 text-center py-4">
                                            No categories yet. Add your first category to organize tasks.
                                        </p>
                                    ) : (
                                        <div className="space-y-2">
                                            {categories.map((category) => (
                                                <div
                                                    key={category.id}
                                                    className="flex items-center justify-between p-3 bg-gray-50 dark:bg-gray-700 rounded-md"
                                                >
                                                    <div className="flex items-center">
                                                        <div
                                                            className="w-4 h-4 rounded-full mr-3"
                                                            style={{ backgroundColor: category.color }}
                                                        ></div>
                                                        <span className="font-medium text-gray-800 dark:text-white">
                                                            {category.name}
                                                        </span>
                                                    </div>
                                                    <div className="flex space-x-2">
                                                        <button
                                                            onClick={() => setEditingCategory(category)}
                                                            className="p-1 text-gray-600 hover:text-gray-900 dark:text-gray-400 dark:hover:text-white focus:outline-none"
                                                            aria-label="Edit category"
                                                        >
                                                            <i className="fas fa-edit"></i>
                                                        </button>
                                                        <button
                                                            onClick={() => deleteCategory(category.id)}
                                                            className="p-1 text-red-600 hover:text-red-900 dark:text-red-400 dark:hover:text-red-300 focus:outline-none"
                                                            aria-label="Delete category"
                                                        >
                                                            <i className="fas fa-trash-alt"></i>
                                                        </button>
                                                    </div>
                                                </div>
                                            ))}
                                        </div>
                                    )}
                                </div>
                                
                                <div className="mt-6 flex justify-end">
                                    <button
                                        onClick={onClose}
                                        className="px-4 py-2 text-sm font-medium text-gray-700 dark:text-gray-300 bg-white dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm hover:bg-gray-50 dark:hover:bg-gray-600 focus:outline-none"
                                    >
                                        Close
                                    </button>
                                </div>
                            </>
                        )}
                    </div>
                </div>
            );
        };

        // Component: TaskStats
        const TaskStats = ({ tasks, categories }) => {
            const canvasRef = React.useRef(null);
            const pieChartRef = React.useRef(null);
            
            React.useEffect(() => {
                if (!canvasRef.current) return;
                
                // Create chart for task completion
                const completedTasks = tasks.filter(task => task.completed).length;
                const activeTasks = tasks.length - completedTasks;
                
                const ctx = canvasRef.current.getContext('2d');
                
                // Destroy existing chart if it exists
                if (pieChartRef.current) {
                    pieChartRef.current.destroy();
                }
                
                // Check dark mode
                const isDarkMode = document.documentElement.classList.contains('dark');
                const textColor = isDarkMode ? '#e5e7eb' : '#374151';
                
                pieChartRef.current = new Chart(ctx, {
                    type: 'doughnut',
                    data: {
                        labels: ['Completed', 'Active'],
                        datasets: [{
                            data: [completedTasks, activeTasks],
                            backgroundColor: [
                                '#10b981', // green
                                '#8b5cf6'  // primary
                            ],
                            borderColor: isDarkMode ? '#1f2937' : '#ffffff',
                            borderWidth: 2
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        cutout: '70%',
                        plugins: {
                            legend: {
                                position: 'bottom',
                                labels: {
                                    color: textColor,
                                    font: {
                                        size: 12
                                    },
                                    padding: 10
                                }
                            },
                            tooltip: {
                                callbacks: {
                                    label: function(context) {
                                        const label = context.label || '';
                                        const value = context.raw || 0;
                                        const total = tasks.length;
                                        const percentage = Math.round((value / total) * 100);
                                        return `${label}: ${value} (${percentage}%)`;
                                    }
                                }
                            }
                        },
                    }
                });
                
                // Update chart when theme changes
                const updateChartTheme = () => {
                    const isDarkMode = document.documentElement.classList.contains('dark');
                    const textColor = isDarkMode ? '#e5e7eb' : '#374151';
                    
                    if (pieChartRef.current) {
                        pieChartRef.current.options.plugins.legend.labels.color = textColor;
                        pieChartRef.current.data.datasets[0].borderColor = isDarkMode ? '#1f2937' : '#ffffff';
                        pieChartRef.current.update();
                    }
                };
                
                const mediaQuery = window.matchMedia('(prefers-color-scheme: dark)');
                mediaQuery.addEventListener('change', updateChartTheme);
                
                return () => {
                    if (pieChartRef.current) {
                        pieChartRef.current.destroy();
                    }
                    mediaQuery.removeEventListener('change', updateChartTheme);
                };
            }, [tasks]);
            
            // Get tasks due today
            const today = new Date();
            today.setHours(0, 0, 0, 0);
            const tasksDueToday = tasks.filter(task => {
                if (!task.dueDate || task.completed) return false;
                const dueDate = new Date(task.dueDate);
                dueDate.setHours(0, 0, 0, 0);
                return dueDate.getTime() === today.getTime();
            }).length;
            
            // Get overdue tasks
            const overdueTasks = tasks.filter(task => {
                if (!task.dueDate || task.completed) return false;
                const dueDate = new Date(task.dueDate);
                dueDate.setHours(0, 0, 0, 0);
                return dueDate < today;
            }).length;
            
            // Group tasks by category
            const tasksByCategory = categories.map(category => {
                const count = tasks.filter(task => task.category === category.id).length;
                return {
                    name: category.name,
                    count,
                    color: category.color
                };
            });
            
            // Sort by count (descending)
            tasksByCategory.sort((a, b) => b.count - a.count);
            
            return (
                <div className="bg-white dark:bg-gray-800 rounded-lg shadow-sm p-4">
                    <h3 className="text-lg font-semibold text-gray-800 dark:text-white mb-4">
                        Task Overview
                    </h3>
                    
                    <div className="grid grid-cols-1 lg:grid-cols-3 gap-4">
                        <div className="bg-gray-50 dark:bg-gray-700 p-4 rounded-lg col-span-1">
                            <h4 className="text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                                Task Completion
                            </h4>
                            
                            <div className="h-48">
                                <canvas ref={canvasRef}></canvas>
                            </div>
                            
                            <div className="grid grid-cols-2 gap-2 mt-4">
                                <div className="bg-white dark:bg-gray-800 p-3 rounded-md text-center shadow-sm">
                                    <p className="text-xs text-gray-500 dark:text-gray-400">Tasks Due Today</p>
                                    <p className="text-xl font-semibold text-primary-600 dark:text-primary-400">{tasksDueToday}</p>
                                </div>
                                <div className="bg-white dark:bg-gray-800 p-3 rounded-md text-center shadow-sm">
                                    <p className="text-xs text-gray-500 dark:text-gray-400">Overdue Tasks</p>
                                    <p className="text-xl font-semibold text-red-600 dark:text-red-400">{overdueTasks}</p>
                                </div>
                            </div>
                        </div>
                        
                        <div className="bg-gray-50 dark:bg-gray-700 p-4 rounded-lg col-span-1 lg:col-span-2">
                            <h4 className="text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                                Tasks by Category
                            </h4>
                            
                            {categories.length === 0 ? (
                                <p className="text-center text-gray-500 dark:text-gray-400 py-6">
                                    No categories yet. Add categories to see statistics.
                                </p>
                            ) : (
                                <div className="space-y-3 mt-2">
                                    {tasksByCategory.map(category => (
                                        <div key={category.name} className="flex items-center">
                                            <div style={{ backgroundColor: category.color }} className="w-3 h-3 rounded-full mr-2"></div>
                                            <span className="text-sm text-gray-600 dark:text-gray-300 flex-grow">{category.name}</span>
                                            <span className="text-sm font-medium text-gray-800 dark:text-white">{category.count}</span>
                                        </div>
                                    ))}
                                </div>
                            )}
                            
                            <div className="mt-4 pt-4 border-t border-gray-200 dark:border-gray-600">
                                <h4 className="text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                                    Task Summary
                                </h4>
                                
                                <div className="grid grid-cols-2 sm:grid-cols-4 gap-2">
                                    <div className="bg-white dark:bg-gray-800 p-3 rounded-md text-center shadow-sm">
                                        <p className="text-xs text-gray-500 dark:text-gray-400">Total</p>
                                        <p className="text-xl font-semibold text-gray-800 dark:text-white">{tasks.length}</p>
                                    </div>
                                    <div className="bg-white dark:bg-gray-800 p-3 rounded-md text-center shadow-sm">
                                        <p className="text-xs text-gray-500 dark:text-gray-400">Active</p>
                                        <p className="text-xl font-semibold text-primary-600 dark:text-primary-400">
                                            {tasks.filter(task => !task.completed).length}
                                        </p>
                                    </div>
                                    <div className="bg-white dark:bg-gray-800 p-3 rounded-md text-center shadow-sm">
                                        <p className="text-xs text-gray-500 dark:text-gray-400">Completed</p>
                                        <p className="text-xl font-semibold text-green-600 dark:text-green-400">
                                            {tasks.filter(task => task.completed).length}
                                        </p>
                                    </div>
                                    <div className="bg-white dark:bg-gray-800 p-3 rounded-md text-center shadow-sm">
                                        <p className="text-xs text-gray-500 dark:text-gray-400">Priority</p>
                                        <p className="text-xl font-semibold text-yellow-600 dark:text-yellow-400">
                                            {tasks.filter(task => task.priority === 'high' && !task.completed).length}
                                        </p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            );
        };

        // Component: TaskDashboard
        const TaskDashboard = () => {
            const { user } = React.useContext(AuthContext);
            const {
                tasks,
                categories,
                selectedTasks,
                loading,
                addTask,
                updateTask,
                deleteTask,
                toggleTaskCompletion,
                addSubtask,
                updateSubtask,
                deleteSubtask,
                startTimeTracking,
                stopTimeTracking,
                batchDeleteTasks,
                batchCompleteTask,
                toggleTaskSelection,
                selectAllTasks,
                clearSelection,
                shareTask,
                unshareTask,
                reorderTasks,
                exportTasks,
                importTasks,
            } = React.useContext(TaskContext);
            
            const [showAddTask, setShowAddTask] = React.useState(false);
            const [editingTask, setEditingTask] = React.useState(null);
            const [filters, setFilters] = React.useState({
                status: 'all',
                category: '',
                priority: '',
                dueDate: '',
                search: '',
                sortBy: 'dueDate',
                sortOrder: 'asc',
            });
            const [showCategoryManager, setShowCategoryManager] = React.useState(false);
            const [showShareModal, setShowShareModal] = React.useState(false);
            const [sharingTask, setSharingTask] = React.useState(null);
            const [showExportImport, setShowExportImport] = React.useState(false);
            const [exportImportMode, setExportImportMode] = React.useState('export');
            const [showStats, setShowStats] = React.useState(false);
            const [draggingTaskId, setDraggingTaskId] = React.useState(null);
            
            // Filter and sort tasks
            const filteredTasks = React.useMemo(() => {
                return tasks
                    .filter(task => {
                        // Filter by status
                        if (filters.status === 'active' && task.completed) return false;
                        if (filters.status === 'completed' && !task.completed) return false;
                        
                        // Filter by category
                        if (filters.category === 'none' && task.category) return false;
                        if (filters.category && filters.category !== 'none' && task.category !== filters.category) return false;
                        
                        // Filter by priority
                        if (filters.priority && task.priority !== filters.priority) return false;
                        
                        // Filter by due date
                        if (filters.dueDate) {
                            const today = new Date();
                            today.setHours(0, 0, 0, 0);
                            
                            const taskDueDate = task.dueDate ? new Date(task.dueDate) : null;
                            if (!taskDueDate) return false;
                            
                            taskDueDate.setHours(0, 0, 0, 0);
                            
                            if (filters.dueDate === 'today') {
                                const isSameDay = 
                                    taskDueDate.getDate() === today.getDate() &&
                                    taskDueDate.getMonth() === today.getMonth() &&
                                    taskDueDate.getFullYear() === today.getFullYear();
                                if (!isSameDay) return false;
                            } else if (filters.dueDate === 'week') {
                                const weekEnd = new Date(today);
                                weekEnd.setDate(today.getDate() + 7);
                                if (taskDueDate < today || taskDueDate > weekEnd) return false;
                            } else if (filters.dueDate === 'month') {
                                const monthEnd = new Date(today);
                                monthEnd.setMonth(today.getMonth() + 1);
                                if (taskDueDate < today || taskDueDate > monthEnd) return false;
                            } else if (filters.dueDate === 'overdue') {
                                if (taskDueDate >= today) return false;
                            }
                        }
                        
                        // Filter by search
                        if (filters.search) {
                            const searchLower = filters.search.toLowerCase();
                            const titleMatch = task.title.toLowerCase().includes(searchLower);
                            const descMatch = task.description && task.description.toLowerCase().includes(searchLower);
                            
                            if (!titleMatch && !descMatch) return false;
                        }
                        
                        return true;
                    })
                    .sort((a, b) => {
                        const sortOrder = filters.sortOrder === 'asc' ? 1 : -1;
                        
                        switch (filters.sortBy) {
                            case 'dueDate':
                                // Sort null dates to the end
                                if (!a.dueDate && !b.dueDate) return 0;
                                if (!a.dueDate) return 1;
                                if (!b.dueDate) return -1;
                                return sortOrder * (new Date(a.dueDate) - new Date(b.dueDate));
                                
                            case 'priority': {
                                const priorityValues = { high: 2, medium: 1, low: 0 };
                                return sortOrder * (priorityValues[b.priority] - priorityValues[a.priority]);
                            }
                                
                            case 'title':
                                return sortOrder * a.title.localeCompare(b.title);
                                
                            case 'createdAt':
                                return sortOrder * (new Date(b.createdAt) - new Date(a.createdAt));
                                
                            default:
                                return 0;
                        }
                    });
            }, [tasks, filters]);
            
            const handleAddTask = (taskData) => {
                addTask(taskData);
                setShowAddTask(false);
            };
            
            const handleUpdateTask = (taskData) => {
                updateTask(taskData.id, taskData);
                setEditingTask(null);
            };
            
            const handleDeleteTask = (taskId) => {
                deleteTask(taskId);
            };
            
            const handleAddSubtask = (taskId, subtaskTitle) => {
                addSubtask(taskId, subtaskTitle);
            };
            
            const handleTimeTrackingToggle = (taskId) => {
                const task = tasks.find(t => t.id === taskId);
                
                if (task.timeTrackingActive) {
                    stopTimeTracking(taskId);
                } else {
                    startTimeTracking(taskId);
                }
            };
            
            const handleShareTask = (taskId, userId) => {
                const task = tasks.find(t => t.id === taskId);
                
                if (task.shared.includes(userId)) {
                    unshareTask(taskId, userId);
                } else {
                    shareTask(taskId, userId);
                }
            };
            
            const handleOpenShareModal = (task) => {
                setSharingTask(task);
                setShowShareModal(true);
            };
            
            const handleShowExportImport = (mode) => {
                setExportImportMode(mode);
                setShowExportImport(true);
            };
            
            const handleDragStart = (taskId) => {
                setDraggingTaskId(taskId);
            };
            
            const handleDragEnd = () => {
                setDraggingTaskId(null);
            };
            
            const handleDragOver = (e, targetTaskId) => {
                e.preventDefault();
                
                if (!draggingTaskId || draggingTaskId === targetTaskId) return;
                
                const draggingIndex = filteredTasks.findIndex(task => task.id === draggingTaskId);
                const targetIndex = filteredTasks.findIndex(task => task.id === targetTaskId);
                
                if (draggingIndex === -1 || targetIndex === -1) return;
                
                // Find the original indices in the unfiltered tasks array
                const originalDraggingIndex = tasks.findIndex(task => task.id === draggingTaskId);
                const originalTargetIndex = tasks.findIndex(task => task.id === targetTaskId);
                
                if (originalDraggingIndex !== -1 && originalTargetIndex !== -1) {
                    reorderTasks(originalDraggingIndex, originalTargetIndex);
                }
            };
            
            return (
                <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6">
                    <div className="mb-6 flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4">
                        <div>
                            <h1 className="text-2xl font-bold text-gray-900 dark:text-white">
                                Welcome, {user.name}
                            </h1>
                            <p className="text-sm text-gray-600 dark:text-gray-400 mt-1">
                                Manage your tasks and stay organized
                            </p>
                        </div>
                        
                        <div className="flex flex-wrap gap-2">
                            <button
                                onClick={() => setShowAddTask(true)}
                                className="px-4 py-2 text-sm font-medium text-white bg-primary-600 rounded-md hover:bg-primary-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500 flex items-center"
                            >
                                <i className="fas fa-plus mr-2"></i>
                                Add Task
                            </button>
                            
                            <button
                                onClick={() => setShowStats(!showStats)}
                                className="px-4 py-2 text-sm font-medium text-white bg-primary-600 rounded-md hover:bg-primary-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500 flex items-center"
                            >
                                <i className={`fas ${showStats ? 'fa-chart-bar' : 'fa-chart-bar'} mr-2`}></i>
                                {showStats ? 'Hide Stats' : 'Show Stats'}
                            </button>
                        </div>
                    </div>
                    
                    {showStats && (
                        <div className="mb-6 animate-fade-in">
                            <TaskStats tasks={tasks} categories={categories} />
                        </div>
                    )}
                    
                    <FilterBar
                        filters={filters}
                        setFilters={setFilters}
                        categories={categories}
                        onShowCategoryManager={() => setShowCategoryManager(true)}
                        onShowExportImport={() => handleShowExportImport('export')}
                    />
                    
                    {/* Batch actions */}
                    {selectedTasks.length > 0 && (
                        <div className="mb-4 p-3 bg-white dark:bg-gray-800 rounded-lg shadow-sm flex flex-wrap items-center justify-between gap-2 animate-fade-in">
                            <div className="flex items-center">
                                <span className="text-sm font-medium text-gray-700 dark:text-gray-300">
                                    {selectedTasks.length} {selectedTasks.length === 1 ? 'task' : 'tasks'} selected
                                </span>
                            </div>
                            
                            <div className="flex flex-wrap items-center space-x-2">
                                <button
                                    onClick={() => batchCompleteTask(true)}
                                    className="px-3 py-1.5 text-xs font-medium text-white bg-green-600 rounded hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500"
                                >
                                    Mark as Completed
                                </button>
                                
                                <button
                                    onClick={() => batchCompleteTask(false)}
                                    className="px-3 py-1.5 text-xs font-medium text-white bg-yellow-600 rounded hover:bg-yellow-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-yellow-500"
                                >
                                    Mark as Active
                                </button>
                                
                                <button
                                    onClick={batchDeleteTasks}
                                    className="px-3 py-1.5 text-xs font-medium text-white bg-red-600 rounded hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500"
                                >
                                    Delete Selected
                                </button>
                                
                                <button
                                    onClick={clearSelection}
                                    className="px-3 py-1.5 text-xs font-medium text-gray-700 dark:text-gray-300 bg-gray-200 dark:bg-gray-700 rounded hover:bg-gray-300 dark:hover:bg-gray-600 focus:outline-none"
                                >
                                    Clear Selection
                                </button>
                                
                                <button
                                    onClick={() => selectAllTasks(filters)}
                                    className="px-3 py-1.5 text-xs font-medium text-gray-700 dark:text-gray-300 bg-gray-200 dark:bg-gray-700 rounded hover:bg-gray-300 dark:hover:bg-gray-600 focus:outline-none"
                                >
                                    Select All
                                </button>
                            </div>
                        </div>
                    )}
                    
                    {/* Task list */}
                    <div className="space-y-3">
                        {loading ? (
                            <div className="text-center py-12">
                                <i className="fas fa-circle-notch fa-spin text-3xl text-primary-600 dark:text-primary-400"></i>
                                <p className="mt-2 text-gray-600 dark:text-gray-400">Loading tasks...</p>
                            </div>
                        ) : filteredTasks.length === 0 ? (
                            <div className="text-center py-12 bg-white dark:bg-gray-800 rounded-lg shadow-sm">
                                <div className="inline-flex items-center justify-center w-16 h-16 rounded-full bg-gray-100 dark:bg-gray-700 text-gray-500 dark:text-gray-400 mb-4">
                                    <i className="fas fa-tasks text-2xl"></i>
                                </div>
                                <h3 className="text-lg font-medium text-gray-900 dark:text-white">No tasks found</h3>
                                <p className="mt-1 text-gray-600 dark:text-gray-400">
                                    {filters.status !== 'all' || filters.category || filters.priority || filters.dueDate || filters.search
                                        ? "Try clearing some filters or create a new task that matches your criteria."
                                        : "Get started by creating your first task."}
                                </p>
                                <div className="mt-4">
                                    <button
                                        onClick={() => setShowAddTask(true)}
                                        className="px-4 py-2 text-sm font-medium text-white bg-primary-600 rounded-md hover:bg-primary-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500 inline-flex items-center"
                                    >
                                        <i className="fas fa-plus mr-2"></i>
                                        Add Task
                                    </button>
                                </div>
                            </div>
                        ) : (
                            filteredTasks.map((task) => (
                                <div 
                                    key={task.id}
                                    onDragOver={(e) => handleDragOver(e, task.id)}
                                >
                                    <TaskItem
                                        task={task}
                                        category={categories.find(c => c.id === task.category)}
                                        onEdit={setEditingTask}
                                        onDelete={handleDeleteTask}
                                        onToggleComplete={toggleTaskCompletion}
                                        onToggleSelect={toggleTaskSelection}
                                        isSelected={selectedTasks.includes(task.id)}
                                        onTimeTrackingToggle={handleTimeTrackingToggle}
                                        onAddSubtask={handleAddSubtask}
                                        updateSubtask={updateSubtask}
                                        deleteSubtask={deleteSubtask}
                                        openShareModal={handleOpenShareModal}
                                        onDragStart={() => handleDragStart(task.id)}
                                        onDragEnd={handleDragEnd}
                                        dragging={draggingTaskId === task.id}
                                    />
                                </div>
                            ))
                        )}
                    </div>
                    
                    {/* Add/Edit Task Modal */}
                    {(showAddTask || editingTask) && (
                        <div className="fixed inset-0 flex items-center justify-center z-50 bg-black bg-opacity-50">
                            <div className="max-w-2xl w-full mx-4">
                                <TaskForm
                                    task={editingTask}
                                    onSave={editingTask ? handleUpdateTask : handleAddTask}
                                    onCancel={() => {
                                        setShowAddTask(false);
                                        setEditingTask(null);
                                    }}
                                />
                            </div>
                        </div>
                    )}
                    
                    {/* Category Manager Modal */}
                    {showCategoryManager && (
                        <CategoryManager
                            onClose={() => setShowCategoryManager(false)}
                        />
                    )}
                    
                    {/* Share Task Modal */}
                    {showShareModal && sharingTask && (
                        <ShareTaskModal
                            task={sharingTask}
                            onClose={() => {
                                setShowShareModal(false);
                                setSharingTask(null);
                            }}
                            onShare={handleShareTask}
                        />
                    )}
                    
                    {/* Export/Import Modal */}
                    {showExportImport && (
                        <ExportImportModal
                            mode={exportImportMode}
                            onClose={() => setShowExportImport(false)}
                            onExport={exportTasks}
                            onImport={importTasks}
                        />
                    )}
                </div>
            );
        };

        // Component: MainApp
        const MainApp = () => {
            const { isAuthenticated, loading } = React.useContext(AuthContext);
            
            if (loading) {
                return (
                    <div className="min-h-screen flex items-center justify-center bg-gray-50 dark:bg-gray-900">
                        <div className="text-center">
                            <i className="fas fa-circle-notch fa-spin text-4xl text-primary-600 dark:text-primary-400"></i>
                            <p className="mt-3 text-gray-600 dark:text-gray-400">Loading...</p>
                        </div>
                    </div>
                );
            }
            
            if (!isAuthenticated) {
                return <AuthContainer />;
            }
            
            return (
                <div className="min-h-screen bg-gray-50 dark:bg-gray-900 flex flex-col">
                    <Header />
                    <div className="flex-grow">
                        <TaskDashboard />
                    </div>
                </div>
            );
        };

        // App Container
        const App = () => {
            return (
                <ThemeProvider>
                    <AuthProvider>
                        <TaskProvider>
                            <MainApp />
                        </TaskProvider>
                    </AuthProvider>
                </ThemeProvider>
            );
        };
        
        // Render the App
        const rootElement = document.getElementById('root');
        const root = ReactDOM.createRoot(rootElement);
        root.render(<App />);
    </script>
</body>
</html>
