<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>TaskMaster - Professional To-Do App</title>

<!-- Tailwind CSS -->
<script src="https://cdn.tailwindcss.com"></script>

<!-- Google Fonts - Inter -->
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">

<!-- Font Awesome Icons -->
<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">

<!-- Flatpickr for Calendar -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
<script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>

<!-- Chart.js for Graphs -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<!-- XLSX for Excel Export -->
<script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>

<!-- jsPDF for PDF Export -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.28/jspdf.plugin.autotable.min.js"></script>

<!-- SortableJS for Drag and Drop -->
<script src="https://cdn.jsdelivr.net/npm/sortablejs@1.15.0/Sortable.min.js"></script>

<!-- Tailwind Config -->
<script>
tailwind.config = {
theme: {
extend: {
fontFamily: {
inter: ['Inter', 'sans-serif']
},
colors: {
primary: '#3B82F6',
secondary: '#10B981',
accent: '#F59E0B',
danger: '#EF4444',
neutral: {
50: '#F9FAFB',
100: '#F3F4F6',
200: '#E5E7EB',
300: '#D1D5DB',
400: '#9CA3AF',
500: '#6B7280',
600: '#4B5563',
700: '#374151',
800: '#1F2A44',
900: '#111827'
}
},
animation: {
fadeIn: 'fadeIn 0.3s ease-in-out',
slideIn: 'slideIn 0.3s ease-in-out',
scaleIn: 'scaleIn 0.2s ease-in-out',
pulse: 'pulse 1.5s infinite',
bounce: 'bounce 0.3s ease-in-out',
chartFade: 'chartFade 0.5s ease-in-out'
},
keyframes: {
fadeIn: {
'0%': { opacity: '0' },
'100%': { opacity: '1' }
},
slideIn: {
'0%': { transform: 'translateY(10px)', opacity: '0' },
'100%': { transform: 'translateY(0)', opacity: '1' }
},
scaleIn: {
'0%': { transform: 'scale(0.95)', opacity: '0' },
'100%': { transform: 'scale(1)', opacity: '1' }
},
pulse: {
'0%, 100%': { opacity: '1' },
'50%': { opacity: '0.5' }
},
bounce: {
'0%, 100%': { transform: 'translateY(0)' },
'50%': { transform: 'translateY(-5px)' }
},
chartFade: {
'0%': { opacity: '0', transform: 'scale(0.98)' },
'100%': { opacity: '1', transform: 'scale(1)' }
}
}
}
}
};
</script>

<style>
/* Custom Styles */
body {
font-family: 'Inter', sans-serif;
}

.bg-gradient {
background: linear-gradient(135deg, #F9FAFB, #E5E7EB);
}

.dark .bg-gradient {
background: linear-gradient(135deg, #1F2A44, #111827);
}

/* Card Hover */
.card-hover {
transition: transform 0.2s ease, box-shadow 0.2s ease;
}

.card-hover:hover {
transform: translateY(-2px);
box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
}

/* Task Status Colors */
.status-expired {
border-left: 4px solid #EF4444;
}

.status-warning {
border-left: 4px solid #F59E0B;
}

.status-ok {
border-left: 4px solid #10B981;
}

/* Priority Colors */
.priority-high {
background-color: rgba(239, 68, 68, 0.05);
}

.priority-medium {
background-color: rgba(245, 158, 11, 0.05);
}

.priority-low {
background-color: rgba(107, 114, 128, 0.05);
}

/* Custom Scrollbar */
::-webkit-scrollbar {
width: 6px;
}

::-webkit-scrollbar-track {
background: #F3F4F6;
}

.dark ::-webkit-scrollbar-track {
background: #374151;
}

::-webkit-scrollbar-thumb {
background: #9CA3AF;
border-radius: 3px;
}

::-webkit-scrollbar-thumb:hover {
background: #6B7280;
}

/* Toggle Switch */
.toggle-switch {
position: relative;
width: 40px;
height: 20px;
}

.toggle-switch input {
opacity: 0;
width: 0;
height: 0;
}

.slider {
position: absolute;
cursor: pointer;
top: 0;
left: 0;
right: 0;
bottom: 0;
background-color: #D1D5DB;
transition: 0.3s;
border-radius: 20px;
}

.slider:before {
position: absolute;
content: "";
height: 16px;
width: 16px;
left: 2px;
bottom: 2px;
background-color: white;
transition: 0.3s;
border-radius: 50%;
}

input:checked + .slider {
background-color: #3B82F6;
}

input:checked + .slider:before {
transform: translateX(20px);
}

/* Toast Notifications */
.toast {
position: fixed;
bottom: 20px;
right: 20px;
padding: 12px 20px;
border-radius: 8px;
box-shadow: 0 4px 12px rgba(0,0,0,0.15);
z-index: 9999;
display: flex;
align-items: center;
gap: 10px;
max-width: 400px;
animation: slideIn 0.3s ease-in-out, fadeOut 0.3s 4.7s forwards;
}

@keyframes fadeOut {
to { opacity: 0; }
}

/* Modal Transitions */
.modal {
transition: opacity 0.3s ease, transform 0.3s ease;
}

.modal-hidden {
opacity: 0;
transform: scale(0.95);
pointer-events: none;
}

/* View Transitions */
.view-transition {
transition: opacity 0.3s ease, transform 0.3s ease;
}

.view-hidden {
opacity: 0;
transform: translateX(20px);
}

/* Button Hover */
.btn-hover {
transition: background-color 0.2s ease, transform 0.2s ease;
}

.btn-hover:hover {
transform: scale(1.02);
}

/* Input Focus */
input:focus, select:focus, textarea:focus {
outline: none;
box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.3);
}
</style>
</head>
<body class="min-h-screen bg-gradient transition-all duration-300">
<!-- App Container -->
<div id="app-container" class="relative">
<!-- Login Page -->
<div id="login-page" class="flex items-center justify-center min-h-screen px-4">
<div class="bg-white rounded-2xl shadow-2xl p-8 w-full max-w-md animate-slideIn">
<h1 class="text-3xl font-bold text-neutral-900 mb-6 text-center">Welcome to TaskMaster</h1>
<form id="login-form" class="space-y-6">
<div>
<label for="email" class="block text-sm font-medium text-neutral-700">Email</label>
<input type="email" id="email" class="mt-1 block w-full rounded-lg border-neutral-300 shadow-sm focus:border-primary focus:ring focus:ring-primary focus:ring-opacity-50 text-base py-2 px-3" value="test@example.com" required>
</div>
<div>
<label for="password" class="block text-sm font-medium text-neutral-700">Password</label>
<input type="password" id="password" class="mt-1 block w-full rounded-lg border-neutral-300 shadow-sm focus:border-primary focus:ring focus:ring-primary focus:ring-opacity-50 text-base py-2 px-3" value="123456" required>
</div>
<button type="submit" class="w-full py-3 bg-primary text-white font-medium rounded-lg btn-hover focus:outline-none">Sign In</button>
</form>
<div class="mt-6 text-center">
<p class="text-neutral-600">Don't have an account? <button id="register-link" class="text-primary hover:underline font-medium">Register</button></p>
</div>
</div>
</div>

<!-- Register Page -->
<div id="register-page" class="hidden flex items-center justify-center min-h-screen px-4">
<div class="bg-white rounded-2xl shadow-2xl p-8 w-full max-w-md animate-slideIn">
<h1 class="text-3xl font-bold text-neutral-900 mb-6 text-center">Create Account</h1>
<form id="register-form" class="space-y-6">
<div class="grid grid-cols-2 gap-4">
<div>
<label for="first-name" class="block text-sm font-medium text-neutral-700">First Name</label>
<input type="text" id="first-name" class="mt-1 block w-full rounded-lg border-neutral-300 shadow-sm focus:border-primary focus:ring focus:ring-primary focus:ring-opacity-50 text-base py-2 px-3" required>
</div>
<div>
<label for="last-name" class="block text-sm font-medium text-neutral-700">Last Name</label>
<input type="text" id="last-name" class="mt-1 block w-full rounded-lg border-neutral-300 shadow-sm focus:border-primary focus:ring focus:ring-primary focus:ring-opacity-50 text-base py-2 px-3" required>
</div>
</div>
<div>
<label for="reg-email" class="block text-sm font-medium text-neutral-700">Email</label>
<input type="email" id="reg-email" class="mt-1 block w-full rounded-lg border-neutral-300 shadow-sm focus:border-primary focus:ring focus:ring-primary focus:ring-opacity-50 text-base py-2 px-3" required>
</div>
<div>
<label for="reg-password" class="block text-sm font-medium text-neutral-700">Password</label>
<input type="password" id="reg-password" class="mt-1 block w-full rounded-lg border-neutral-300 shadow-sm focus:border-primary focus:ring focus:ring-primary focus:ring-opacity-50 text-base py-2 px-3" required>
</div>
<div>
<label for="birthdate" class="block text-sm font-medium text-neutral-700">Birthdate</label>
<input type="text" id="birthdate" class="mt-1 block w-full rounded-lg border-neutral-300 shadow-sm focus:border-primary focus:ring focus:ring-primary focus:ring-opacity-50 text-base py-2 px-3" required>
</div>
<div>
<label for="role" class="block text-sm font-medium text-neutral-700">Role</label>
<select id="role" class="mt-1 block w-full rounded-lg border-neutral-300 shadow-sm focus:border-primary focus:ring focus:ring-primary focus:ring-opacity-50 text-base py-2 px-3" required>
<option value="User">User</option>
<option value="Manager">Manager</option>
<option value="Admin">Admin</option>
</select>
</div>
<div class="flex justify-between">
<button type="button" id="register-back" class="py-2 px-4 bg-neutral-400 text-white rounded-lg btn-hover">Back</button>
<button type="submit" class="py-2 px-4 bg-primary text-white rounded-lg btn-hover">Register</button>
</div>
</form>
</div>
</div>

<!-- Dashboard Page -->
<div id="dashboard-page" class="hidden container mx-auto px-4 py-8 max-w-7xl">
<!-- Header -->
<header class="bg-white dark:bg-neutral-800 rounded-2xl shadow-lg p-6 mb-8 flex items-center justify-between">
<div class="flex items-center space-x-4">
<h1 class="text-2xl font-bold text-neutral-900 dark:text-white"><i class="fas fa-tasks mr-2 text-primary"></i> TaskMaster</h1>
</div>
<div class="flex items-center space-x-4">
<div class="relative">
<button id="notification-btn" class="p-2 rounded-full hover:bg-neutral-100 dark:hover:bg-neutral-700">
<i class="fas fa-bell text-neutral-600 dark:text-neutral-300"></i>
<span id="notification-badge" class="absolute top-0 right-0 bg-danger text-white text-xs rounded-full h-4 w-4 flex items-center justify-center">0</span>
</button>
<div id="notification-dropdown" class="hidden absolute right-0 mt-2 w-80 bg-white dark:bg-neutral-800 rounded-lg shadow-lg z-10 py-2 animate-scaleIn">
<div class="px-4 py-2 border-b border-neutral-200 dark:border-neutral-700">
<h3 class="font-semibold text-neutral-900 dark:text-white">Notifications</h3>
</div>
<div id="notification-list" class="max-h-64 overflow-y-auto"></div>
<div class="px-4 py-2 border-t border-neutral-200 dark:border-neutral-700 text-center">
<button id="mark-all-read" class="text-sm text-primary hover:text-primary-600">Mark all as read</button>
</div>
</div>
</div>
<div class="toggle-switch">
<input type="checkbox" id="dark-mode-toggle">
<label class="slider" for="dark-mode-toggle"></label>
</div>
<div class="relative">
<img id="user-avatar" src="https://randomuser.me/api/portraits/men/1.jpg" alt="User" class="w-10 h-10 rounded-full cursor-pointer">
<div id="profile-dropdown" class="hidden absolute right-0 mt-2 w-48 bg-white dark:bg-neutral-800 rounded-lg shadow-lg z-10 animate-scaleIn">
<button id="view-profile-btn" class="block w-full text-left px-4 py-2 text-sm text-neutral-700 dark:text-neutral-300 hover:bg-neutral-100 dark:hover:bg-neutral-700"><i class="fas fa-user mr-2"></i> Profile</button>
<button id="logout-btn" class="block w-full text-left px-4 py-2 text-sm text-neutral-700 dark:text-neutral-300 hover:bg-neutral-100 dark:hover:bg-neutral-700"><i class="fas fa-sign-out-alt mr-2"></i> Logout</button>
</div>
</div>
</div>
</header>

<!-- Main Content -->
<main class="grid grid-cols-1 lg:grid-cols-3 gap-8">
<!-- Sidebar -->
<aside class="bg-white dark:bg-neutral-800 rounded-2xl shadow-lg p-6">
<h2 class="text-lg font-semibold text-neutral-900 dark:text-white mb-4"><i class="fas fa-tools mr-2 text-primary"></i> Actions</h2>
<div class="space-y-4">
<button id="add-task-btn" class="w-full py-2 bg-primary text-white rounded-lg btn-hover flex items-center justify-center"><i class="fas fa-plus mr-2"></i> Add Task</button>
<button id="manage-categories-btn" class="w-full py-2 bg-secondary text-white rounded-lg btn-hover flex items-center justify-center"><i class="fas fa-tags mr-2"></i> Categories</button>
<button id="manage-users-btn" class="w-full py-2 bg-accent text-white rounded-lg btn-hover flex items-center justify-center"><i class="fas fa-users mr-2"></i> Users</button>
<button id="export-btn" class="w-full py-2 bg-neutral-500 text-white rounded-lg btn-hover flex items-center justify-center"><i class="fas fa-file-export mr-2"></i> Export</button>
<button id="import-btn" class="w-full py-2 bg-neutral-500 text-white rounded-lg btn-hover flex items-center justify-center"><i class="fas fa-file-import mr-2"></i> Import</button>
</div>
</aside>

<!-- Tasks Section -->
<section class="lg:col-span-2">
<!-- Tasks Overview -->
<div class="bg-white dark:bg-neutral-800 rounded-2xl shadow-lg p-6 mb-8 card-hover">
<h2 class="text-lg font-semibold text-neutral-900 dark:text-white mb-4"><i class="fas fa-chart-pie mr-2 text-primary"></i> Overview</h2>
<div class="grid grid-cols-1 sm:grid-cols-3 gap-4">
<div class="bg-primary/10 p-4 rounded-lg">
<h3 class="text-sm text-neutral-600 dark:text-neutral-300">Total Tasks</h3>
<p id="total-tasks-count" class="text-2xl font-bold text-neutral-900 dark:text-white">0</p>
</div>
<div class="bg-secondary/10 p-4 rounded-lg">
<h3 class="text-sm text-neutral-600 dark:text-neutral-300">Completed</h3>
<p id="completed-tasks-count" class="text-2xl font-bold text-neutral-900 dark:text-white">0</p>
</div>
<div class="bg-accent/10 p-4 rounded-lg">
<h3 class="text-sm text-neutral-600 dark:text-neutral-300">Pending</h3>
<p id="pending-tasks-count" class="text-2xl font-bold text-neutral-900 dark:text-white">0</p>
</div>
</div>
</div>

<!-- Tasks Controls -->
<div class="bg-white dark:bg-neutral-800 rounded-2xl shadow-lg p-6 mb-8">
<div class="flex flex-col sm:flex-row justify-between items-center gap-4 mb-6">
<div class="flex space-x-2">
<button id="list-view-btn" class="px-4 py-2 bg-primary text-white rounded-lg flex items-center"><i class="fas fa-list mr-2"></i> List</button>
<button id="graph-view-btn" class="px-4 py-2 bg-neutral-200 dark:bg-neutral-700 text-neutral-700 dark:text-neutral-300 rounded-lg flex items-center"><i class="fas fa-chart-bar mr-2"></i> Graph</button>
</div>
<div class="flex items-center space-x-2">
<select id="sort-by" class="rounded-lg border-neutral-300 shadow-sm focus:border-primary focus:ring focus:ring-primary focus:ring-opacity-50 text-base py-2 px-3">
<option value="dueDate-asc">Due Date (Earliest)</option>
<option value="dueDate-desc">Due Date (Latest)</option>
<option value="title-asc">Title (A-Z)</option>
<option value="title-desc">Title (Z-A)</option>
</select>
</div>
</div>
<div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4">
<select id="filter-status" class="rounded-lg border-neutral-300 shadow-sm focus:border-primary focus:ring focus:ring-primary focus:ring-opacity-50 text-base py-2 px-3">
<option value="all">All Status</option>
<option value="completed">Completed</option>
<option value="pending">Pending</option>
</select>
<select id="filter-category" class="rounded-lg border-neutral-300 shadow-sm focus:border-primary focus:ring focus:ring-primary focus:ring-opacity-50 text-base py-2 px-3">
<option value="all">All Categories</option>
</select>
<select id="filter-priority" class="rounded-lg border-neutral-300 shadow-sm focus:border-primary focus:ring focus:ring-primary focus:ring-opacity-50 text-base py-2 px-3">
<option value="all">All Priorities</option>
<option value="high">High</option>
<option value="medium">Medium</option>
<option value="low">Low</option>
</select>
<input type="text" id="search-tasks" placeholder="Search tasks..." class="rounded-lg border-neutral-300 shadow-sm focus:border-primary focus:ring focus:ring-primary focus:ring-opacity-50 text-base py-2 px-3">
</div>
</div>

<!-- Tasks List View -->
<div id="tasks-list-view" class="view-transition">
<div id="tasks-container" class="space-y-4"></div>
</div>

<!-- Tasks Graph View -->
<div id="tasks-graph-view" class="hidden view-transition">
<div class="grid grid-cols-1 md:grid-cols-2 gap-6">
<div class="bg-white dark:bg-neutral-800 p-6 rounded-2xl shadow-lg card-hover animate-chartFade">
<h3 class="text-lg font-semibold text-neutral-900 dark:text-white mb-4">Tasks by Status</h3>
<canvas id="tasks-pie-chart" class="h-64"></canvas>
</div>
<div class="bg-white dark:bg-neutral-800 p-6 rounded-2xl shadow-lg card-hover animate-chartFade">
<h3 class="text-lg font-semibold text-neutral-900 dark:text-white mb-4">Tasks by Priority</h3>
<canvas id="tasks-priority-chart" class="h-64"></canvas>
</div>
</div>
</div>

<!-- Multi-Select Action Bar -->
<div id="multi-action-bar" class="hidden fixed bottom-4 left-4 right-4 bg-white dark:bg-neutral-800 rounded-lg shadow-lg p-4 flex items-center justify-between z-10 animate-slideIn">
<span id="selected-count" class="text-neutral-900 dark:text-white font-medium">0 tasks selected</span>
<div class="flex space-x-3">
<button id="multi-complete-btn" class="px-4 py-2 bg-secondary text-white rounded-lg btn-hover"><i class="fas fa-check mr-2"></i> Mark Completed</button>
<button id="multi-delete-btn" class="px-4 py-2 bg-danger text-white rounded-lg btn-hover"><i class="fas fa-trash mr-2"></i> Delete All</button>
<button id="multi-cancel-btn" class="px-4 py-2 bg-neutral-400 text-white rounded-lg btn-hover"><i class="fas fa-times mr-2"></i> Cancel</button>
</div>
</div>
</section>
</main>

<!-- Modals -->
<!-- Add/Edit Task Modal -->
<div id="task-modal" class="modal modal-hidden fixed inset-0 bg-black/50 flex items-center justify-center z-50">
<div class="bg-white dark:bg-neutral-800 rounded-2xl p-6 w-full max-w-lg animate-scaleIn">
<h3 id="task-modal-title" class="text-lg font-semibold text-neutral-900 dark:text-white mb-4">Add Task</h3>
<form id="task-form" class="space-y-4">
<input type="hidden" id="task-id">
<div>
<label for="task-title" class="block text-sm font-medium text-neutral-700 dark:text-neutral-300">Title</label>
<input type="text" id="task-title" class="mt-1 block w-full rounded-lg border-neutral-300 shadow-sm focus:border-primary focus:ring focus:ring-primary focus:ring-opacity-50 text-base py-2 px-3" required>
</div>
<div>
<label for="task-description" class="block text-sm font-medium text-neutral-700 dark:text-neutral-300">Description</label>
<textarea id="task-description" rows="3" class="mt-1 block w-full rounded-lg border-neutral-300 shadow-sm focus:border-primary focus:ring focus:ring-primary focus:ring-opacity-50 text-base py-2 px-3"></textarea>
</div>
<div>
<label for="task-due-date" class="block text-sm font-medium text-neutral-700 dark:text-neutral-300">Due Date</label>
<input type="text" id="task-due-date" class="mt-1 block w-full rounded-lg border-neutral-300 shadow-sm focus:border-primary focus:ring focus:ring-primary focus:ring-opacity-50 text-base py-2 px-3">
</div>
<div>
<label for="task-priority" class="block text-sm font-medium text-neutral-700 dark:text-neutral-300">Priority</label>
<select id="task-priority" class="mt-1 block w-full rounded-lg border-neutral-300 shadow-sm focus:border-primary focus:ring focus:ring-primary focus:ring-opacity-50 text-base py-2 px-3">
<option value="low">Low</option>
<option value="medium">Medium</option>
<option value="high">High</option>
</select>
</div>
<div>
<label for="task-category" class="block text-sm font-medium text-neutral-700 dark:text-neutral-300">Category</label>
<select id="task-category" class="mt-1 block w-full rounded-lg border-neutral-300 shadow-sm focus:border-primary focus:ring focus:ring-primary focus:ring-opacity-50 text-base py-2 px-3"></select>
</div>
<div class="flex justify-end space-x-2">
<button type="button" class="task-modal-close px-4 py-2 bg-neutral-400 text-white rounded-lg btn-hover">Cancel</button>
<button type="submit" class="px-4 py-2 bg-primary text-white rounded-lg btn-hover">Save</button>
</div>
</form>
</div>
</div>

<!-- Categories Modal -->
<div id="categories-modal" class="modal modal-hidden fixed inset-0 bg-black/50 flex items-center justify-center z-50">
<div class="bg-white dark:bg-neutral-800 rounded-2xl p-6 w-full max-w-md animate-scaleIn">
<h3 class="text-lg font-semibold text-neutral-900 dark:text-white mb-4">Manage Categories</h3>
<div class="space-y-4">
<div class="flex space-x-2">
<input type="text" id="new-category" placeholder="New category" class="flex-1 rounded-lg border-neutral-300 shadow-sm focus:border-primary focus:ring focus:ring-primary focus:ring-opacity-50 text-base py-2 px-3">
<button id="add-category-btn" class="px-4 py-2 bg-primary text-white rounded-lg btn-hover"><i class="fas fa-plus"></i></button>
</div>
<div id="categories-list" class="space-y-2"></div>
<button class="categories-modal-close w-full py-2 bg-neutral-400 text-white rounded-lg btn-hover">Close</button>
</div>
</div>
</div>

<!-- Users Modal -->
<div id="users-modal" class="modal modal-hidden fixed inset-0 bg-black/50 flex items-center justify-center z-50">
<div class="bg-white dark:bg-neutral-800 rounded-2xl p-6 w-full max-w-4xl animate-scaleIn">
<h3 class="text-lg font-semibold text-neutral-900 dark:text-white mb-4">Manage Users</h3>
<button id="add-user-btn" class="mb-4 px-4 py-2 bg-primary text-white rounded-lg btn-hover"><i class="fas fa-user-plus mr-2"></i> Add User</button>
<div id="users-container" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4"></div>
<button class="users-modal-close w-full mt-4 py-2 bg-neutral-400 text-white rounded-lg btn-hover">Close</button>
</div>
</div>

<!-- Add/Edit User Modal -->
<div id="user-modal" class="modal modal-hidden fixed inset-0 bg-black/50 flex items-center justify-center z-50">
<div class="bg-white dark:bg-neutral-800 rounded-2xl p-6 w-full max-w-md animate-scaleIn">
<h3 id="user-modal-title" class="text-lg font-semibold text-neutral-900 dark:text-white mb-4">Add User</h3>
<form id="user-form" class="space-y-4">
<input type="hidden" id="user-id">
<div>
<label for="user-first-name" class="block text-sm font-medium text-neutral-700 dark:text-neutral-300">First Name</label>
<input type="text" id="user-first-name" class="mt-1 block w-full rounded-lg border-neutral-300 shadow-sm focus:border-primary focus:ring focus:ring-primary focus:ring-opacity-50 text-base py-2 px-3" required>
</div>
<div>
<label for="user-last-name" class="block text-sm font-medium text-neutral-700 dark:text-neutral-300">Last Name</label>
<input type="text" id="user-last-name" class="mt-1 block w-full rounded-lg border-neutral-300 shadow-sm focus:border-primary focus:ring focus:ring-primary focus:ring-opacity-50 text-base py-2 px-3" required>
</div>
<div>
<label for="user-email" class="block text-sm font-medium text-neutral-700 dark:text-neutral-300">Email</label>
<input type="email" id="user-email" class="mt-1 block w-full rounded-lg border-neutral-300 shadow-sm focus:border-primary focus:ring focus:ring-primary focus:ring-opacity-50 text-base py-2 px-3" required>
</div>
<div>
<label for="user-role" class="block text-sm font-medium text-neutral-700 dark:text-neutral-300">Role</label>
<select id="user-role" class="mt-1 block w-full rounded-lg border-neutral-300 shadow-sm focus:border-primary focus:ring focus:ring-primary focus:ring-opacity-50 text-base py-2 px-3" required>
<option value="User">User</option>
<option value="Manager">Manager</option>
<option value="Admin">Admin</option>
</select>
</div>
<div class="flex justify-end space-x-2">
<button type="button" class="user-modal-close px-4 py-2 bg-neutral-400 text-white rounded-lg btn-hover">Cancel</button>
<button type="submit" class="px-4 py-2 bg-primary text-white rounded-lg btn-hover">Save</button>
</div>
</form>
</div>
</div>

<!-- Export Modal -->
<div id="export-modal" class="modal modal-hidden fixed inset-0 bg-black/50 flex items-center justify-center z-50">
<div class="bg-white dark:bg-neutral-800 rounded-2xl p-6 w-full max-w-md animate-scaleIn">
<h3 class="text-lg font-semibold text-neutral-900 dark:text-white mb-4">Export Tasks</h3>
<select id="export-format" class="mt-1 block w-full rounded-lg border-neutral-300 shadow-sm focus:border-primary focus:ring focus:ring-primary focus:ring-opacity-50 text-base py-2 px-3">
<option value="json">JSON</option>
<option value="csv">CSV</option>
<option value="excel">Excel</option>
<option value="pdf">PDF</option>
</select>
<div class="flex justify-end space-x-2 mt-6">
<button class="export-modal-close px-4 py-2 bg-neutral-400 text-white rounded-lg btn-hover">Cancel</button>
<button id="download-btn" class="px-4 py-2 bg-primary text-white rounded-lg btn-hover">Download</button>
</div>
</div>
</div>

<!-- Import Modal -->
<div id="import-modal" class="modal modal-hidden fixed inset-0 bg-black/50 flex items-center justify-center z-50">
<div class="bg-white dark:bg-neutral-800 rounded-2xl p-6 w-full max-w-md animate-scaleIn">
<h3 class="text-lg font-semibold text-neutral-900 dark:text-white mb-4">Import Tasks</h3>
<div class="space-y-4">
<div class="border-2 border-dashed border-neutral-300 dark:border-neutral-600 rounded-lg p-6 text-center">
<i class="fas fa-file-upload text-4xl text-neutral-400 mb-3"></i>
<p class="text-neutral-600 dark:text-neutral-400 mb-2">Drop JSON file or click to browse</p>
<input type="file" id="import-file" class="hidden" accept=".json">
<button id="browse-file-btn" class="px-4 py-2 bg-primary text-white rounded-lg btn-hover">Browse</button>
</div>
<div class="flex justify-end space-x-2">
<button class="import-modal-close px-4 py-2 bg-neutral-400 text-white rounded-lg btn-hover">Cancel</button>
<button id="import-btn-confirm" class="px-4 py-2 bg-primary text-white rounded-lg btn-hover">Import</button>
</div>
</div>
</div>
</div>

<!-- Profile Modal -->
<div id="profile-modal" class="modal modal-hidden fixed inset-0 bg-black/50 flex items-center justify-center z-50">
<div class="bg-white dark:bg-neutral-800 rounded-2xl p-6 w-full max-w-md animate-scaleIn">
<h3 class="text-lg font-semibold text-neutral-900 dark:text-white mb-4">Profile</h3>
<div class="text-center mb-6">
<img id="profile-image" src="https://randomuser.me/api/portraits/men/1.jpg" alt="Profile" class="w-24 h-24 rounded-full mx-auto mb-4">
<h4 id="profile-name" class="text-xl font-semibold text-neutral-900 dark:text-white"></h4>
<p id="profile-role" class="text-neutral-600 dark:text-neutral-400"></p>
</div>
<div class="space-y-3">
<div class="flex"><span class="w-1/3 text-neutral-600 dark:text-neutral-400">Email:</span><span id="profile-email" class="w-2/3 text-neutral-900 dark:text-white"></span></div>
<div class="flex"><span class="w-1/3 text-neutral-600 dark:text-neutral-400">Role:</span><span id="profile-role-display" class="w-2/3 text-neutral-900 dark:text-white"></span></div>
</div>
<div class="flex justify-end mt-6">
<button class="profile-modal-close px-4 py-2 bg-neutral-400 text-white rounded-lg btn-hover">Close</button>
</div>
</div>
</div>

<!-- Toast Container -->
<div id="toast-container" class="fixed bottom-4 right-4 z-50"></div>
</div>

<script>
// Data
let tasks = [];
let categories = ['Work', 'Personal', 'Urgent'];
let users = [];
let notifications = [];
let currentUser = null;
let selectedTasks = new Set();
let charts = { pieChart: null, priorityChart: null };

// Utility Functions
const generateId = () => crypto.randomUUID();

const formatDate = (dateStr) => {
if (!dateStr) return 'No due date';
const date = new Date(dateStr);
return date.toLocaleDateString('en-US', { year: 'numeric', month: 'short', day: 'numeric' });
};

const showToast = (message, type = 'info') => {
const toast = document.createElement('div');
toast.className = `toast bg-${type === 'success' ? 'secondary' : type === 'error' ? 'danger' : 'primary'} text-white`;
toast.innerHTML = `<i class="fas fa-${type === 'success' ? 'check-circle' : type === 'error' ? 'exclamation-circle' : 'info-circle'}"></i> ${message}`;
document.getElementById('toast-container').appendChild(toast);
setTimeout(() => toast.remove(), 5000);
};

// Storage
const saveData = () => {
localStorage.setItem('tasks', JSON.stringify(tasks));
localStorage.setItem('categories', JSON.stringify(categories));
localStorage.setItem('users', JSON.stringify(users));
localStorage.setItem('currentUser', JSON.stringify(currentUser));
};

const loadData = () => {
tasks = JSON.parse(localStorage.getItem('tasks')) || [];
categories = JSON.parse(localStorage.getItem('categories')) || ['Work', 'Personal', 'Urgent'];
users = JSON.parse(localStorage.getItem('users')) || [];
currentUser = JSON.parse(localStorage.getItem('currentUser'));
};

// Task Management
const createTask = (taskData) => {
const task = { id: generateId(), ...taskData, completed: false, createdAt: new Date().toISOString() };
tasks.push(task);
saveData();
renderTasks();
updateCharts();
showToast('Task created', 'success');
};

const updateTask = (id, data) => {
const index = tasks.findIndex(t => t.id === id);
if (index !== -1) {
tasks[index] = { ...tasks[index], ...data };
saveData();
renderTasks();
updateCharts();
showToast('Task updated', 'success');
}
};

const deleteTask = (id) => {
tasks = tasks.filter(t => t.id !== id);
saveData();
renderTasks();
updateCharts();
showToast('Task deleted', 'success');
};

const toggleTaskCompletion = (id) => {
const task = tasks.find(t => t.id === id);
if (task) {
task.completed = !task.completed;
saveData();
renderTasks();
updateCharts();
showToast(`Task marked as ${task.completed ? 'completed' : 'pending'}`, 'success');
}
};

// Export
const exportTasks = (format) => {
const timestamp = new Date().toISOString().slice(0, 16).replace(/[-:T]/g, '');
const filename = `tasks_${timestamp}`;
const data = tasks.map(t => ({
id: t.id,
title: t.title,
description: t.description || '',
dueDate: formatDate(t.dueDate),
priority: t.priority,
category: t.category,
completed: t.completed
}));

if (format === 'json') {
const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
downloadFile(blob, `${filename}.json`);
} else if (format === 'csv') {
const headers = ['ID,Title,Description,Due Date,Priority,Category,Completed'];
const rows = data.map(t => [
t.id,
`"${t.title.replace(/"/g, '""')}"`,
`"${t.description.replace(/"/g, '""')}"`,
t.dueDate,
t.priority,
t.category,
t.completed
].join(','));
const blob = new Blob([headers, ...rows].join('\n'), { type: 'text/csv' });
downloadFile(blob, `${filename}.csv`);
} else if (format === 'excel') {
const ws = XLSX.utils.json_to_sheet(data);
const wb = XLSX.utils.book_new();
XLSX.utils.book_append_sheet(wb, ws, 'Tasks');
const blob = new Blob([XLSX.write(wb, { bookType: 'xlsx', type: 'array' })], { type: 'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet' });
downloadFile(blob, `${filename}.xlsx`);
} else if (format === 'pdf') {
const { jsPDF } = window.jspdf;
const doc = new jsPDF();
doc.autoTable({
head: [['ID', 'Title', 'Due Date', 'Priority', 'Category', 'Completed']],
body: data.map(t => [t.id, t.title, t.dueDate, t.priority, t.category, t.completed ? 'Yes' : 'No']),
theme: 'striped',
headStyles: { fillColor: [59, 130, 246] }
});
doc.save(`${filename}.pdf`);
}
};

const downloadFile = (blob, filename) => {
const url = URL.createObjectURL(blob);
const a = document.createElement('a');
a.href = url;
a.download = filename;
a.click();
URL.revokeObjectURL(url);
};

// Import
const importTasks = (file) => {
const reader = new FileReader();
reader.onload = (e) => {
try {
const data = JSON.parse(e.target.result);
tasks.push(...data.map(t => ({ ...t, id: generateId() })));
saveData();
renderTasks();
updateCharts();
showToast('Tasks imported', 'success');
} catch {
showToast('Invalid JSON file', 'error');
}
};
reader.readAsText(file);
};

// Charts
const initCharts = () => {
const isDark = document.documentElement.classList.contains('dark');
const textColor = isDark ? '#fff' : '#111827';
const gridColor = isDark ? 'rgba(255,255,255,0.1)' : 'rgba(0,0,0,0.1)';

charts.pieChart = new Chart(document.getElementById('tasks-pie-chart'), {
type: 'pie',
data: {
labels: ['Completed', 'Pending'],
datasets: [{ data: [0, 0], backgroundColor: ['#10B981', '#F59E0B'] }]
},
options: {
responsive: true,
maintainAspectRatio: false,
plugins: { legend: { labels: { color: textColor } } },
animation: { animateScale: true, animateRotate: true }
}
});

charts.priorityChart = new Chart(document.getElementById('tasks-priority-chart'), {
type: 'bar',
data: {
labels: ['High', 'Medium', 'Low'],
datasets: [{ data: [0, 0, 0], backgroundColor: ['#EF4444', '#F59E0B', '#6B7280'] }]
},
options: {
responsive: true,
maintainAspectRatio: false,
plugins: { legend: { display: false } },
scales: {
x: { ticks: { color: textColor }, grid: { color: gridColor } },
y: { ticks: { color: textColor }, grid: { color: gridColor } }
},
animation: { duration: 1000, easing: 'easeOutQuart' }
}
});
};

const updateCharts = () => {
const completed = tasks.filter(t => t.completed).length;
const pending = tasks.length - completed;
document.getElementById('total-tasks-count').textContent = tasks.length;
document.getElementById('completed-tasks-count').textContent = completed;
document.getElementById('pending-tasks-count').textContent = pending;

charts.pieChart.data.datasets[0].data = [completed, pending];
charts.pieChart.update();

const priorities = { high: 0, medium: 0, low: 0 };
tasks.forEach(t => priorities[t.priority]++);
charts.priorityChart.data.datasets[0].data = [priorities.high, priorities.medium, priorities.low];
charts.priorityChart.update();
};

// Render
const renderTasks = () => {
const search = document.getElementById('search-tasks').value.toLowerCase();
const status = document.getElementById('filter-status').value;
const category = document.getElementById('filter-category').value;
const priority = document.getElementById('filter-priority').value;
const [sortField, sortOrder] = document.getElementById('sort-by').value.split('-');

let filteredTasks = tasks.filter(t =>
(t.title.toLowerCase().includes(search) || t.description?.toLowerCase().includes(search)) &&
(status === 'all' || (status === 'completed' ? t.completed : !t.completed)) &&
(category === 'all' || t.category === category) &&
(priority === 'all' || t.priority === priority)
);

filteredTasks.sort((a, b) => {
const valA = a[sortField] || '';
const valB = b[sortField] || '';
return sortOrder === 'asc' ? valA.localeCompare(valB) : valB.localeCompare(valA);
});

const container = document.getElementById('tasks-container');
container.innerHTML = filteredTasks.length ? '' : '<div class="text-center py-8 text-neutral-500">No tasks found</div>';

filteredTasks.forEach(t => {
const status = t.dueDate && !t.completed ? (new Date(t.dueDate) < new Date() ? 'expired' : new Date(t.dueDate) - new Date() < 3 * 24 * 60 * 60 * 1000 ? 'warning' : 'ok') : 'ok';
const task = document.createElement('div');
task.className = `task-item bg-white dark:bg-neutral-800 p-4 rounded-lg shadow-md card-hover priority-${t.priority} status-${status} flex items-center space-x-4`;
task.dataset.id = t.id;
task.innerHTML = `
<input type="checkbox" class="task-checkbox h-5 w-5 text-primary focus:ring-primary rounded" ${selectedTasks.has(t.id) ? 'checked' : ''}>
<div class="flex-1">
<h3 class="text-base font-medium text-neutral-900 dark:text-white ${t.completed ? 'line-through' : ''}">${t.title}</h3>
${t.description ? `<p class="text-sm text-neutral-600 dark:text-neutral-400">${t.description}</p>` : ''}
<div class="mt-1 text-sm text-neutral-500 dark:text-neutral-400">${t.category} â€¢ ${formatDate(t.dueDate)}</div>
</div>
<div class="toggle-switch">
<input type="checkbox" class="task-toggle" ${t.completed ? 'checked' : ''}>
<label class="slider"></label>
</div>
<div class="flex space-x-2">
<button class="edit-task-btn p-2 text-neutral-500 hover:text-primary"><i class="fas fa-edit"></i></button>
<button class="delete-task-btn p-2 text-neutral-500 hover:text-danger"><i class="fas fa-trash"></i></button>
</div>
`;
container.appendChild(task);
});

document.getElementById('multi-action-bar').classList.toggle('hidden', !selectedTasks.size);
document.getElementById('selected-count').textContent = `${selectedTasks.size} tasks selected`;
new Sortable(document.getElementById('tasks-container'), {
animation: 150,
onEnd: (evt) => {
const moved = tasks.splice(evt.oldIndex, 1)[0];
tasks.splice(evt.newIndex, 0, moved);
saveData();
}
});
};

const renderCategories = () => {
const select = document.getElementById('task-category');
const filter = document.getElementById('filter-category');
const list = document.getElementById('categories-list');
select.innerHTML = '<option value="">Select Category</option>';
filter.innerHTML = '<option value="all">All Categories</option>';
list.innerHTML = '';
categories.forEach(c => {
select.innerHTML += `<option value="${c}">${c}</option>`;
filter.innerHTML += `<option value="${c}">${c}</option>`;
list.innerHTML += `
<div class="flex justify-between items-center p-2 bg-neutral-100 dark:bg-neutral-700 rounded-lg">
<span>${c}</span>
<button class="delete-category-btn text-danger" data-category="${c}"><i class="fas fa-trash"></i></button>
</div>
`;
});
};

const renderUsers = () => {
const container = document.getElementById('users-container');
container.innerHTML = users.length ? '' : '<div class="text-center py-8 text-neutral-500">No users found</div>';
users.forEach(u => {
const user = document.createElement('div');
user.className = 'bg-white dark:bg-neutral-800 p-4 rounded-lg shadow-md card-hover';
user.innerHTML = `
<div class="flex items-center space-x-4">
<img src="${u.avatar}" alt="${u.firstName}" class="w-12 h-12 rounded-full">
<div>
<h3 class="text-base font-medium text-neutral-900 dark:text-white">${u.firstName} ${u.lastName}</h3>
<p class="text-sm text-neutral-600 dark:text-neutral-400">${u.email}</p>
<p class="text-sm text-neutral-500 dark:text-neutral-400">${u.role}</p>
</div>
</div>
<div class="mt-4 flex justify-end space-x-2">
<button class="edit-user-btn p-2 text-neutral-500 hover:text-primary" data-id="${u.id}"><i class="fas fa-edit"></i></button>
<button class="delete-user-btn p-2 text-neutral-500 hover:text-danger" data-id="${u.id}"><i class="fas fa-trash"></i></button>
</div>
`;
container.appendChild(user);
});
};

const renderNotifications = () => {
const list = document.getElementById('notification-list');
const badge = document.getElementById('notification-badge');
const unread = notifications.filter(n => !n.read).length;
badge.textContent = unread;
list.innerHTML = notifications.length ? '' : '<div class="px-4 py-2 text-neutral-500 text-center">No notifications</div>';
notifications.forEach(n => {
const item = document.createElement('div');
item.className = `px-4 py-2 hover:bg-neutral-100 dark:hover:bg-neutral-700 ${n.read ? 'opacity-50' : ''}`;
item.innerHTML = `<p class="text-sm text-neutral-900 dark:text-white">${n.message}</p>`;
list.appendChild(item);
});
};

// Event Listeners
document.getElementById('login-form').addEventListener('submit', (e) => {
e.preventDefault();
currentUser = { email: document.getElementById('email').value, firstName: 'John', lastName: 'Doe', role: 'User', avatar: 'https://randomuser.me/api/portraits/men/1.jpg' };
saveData();
document.getElementById('login-page').classList.add('hidden');
document.getElementById('dashboard-page').classList.remove('hidden');
renderTasks();
renderUsers();
renderNotifications();
showToast('Logged in', 'success');
});

document.getElementById('register-link').addEventListener('click', () => {
document.getElementById('login-page').classList.add('hidden');
document.getElementById('register-page').classList.remove('hidden');
});

document.getElementById('register-back').addEventListener('click', () => {
document.getElementById('register-page').classList.add('hidden');
document.getElementById('login-page').classList.remove('hidden');
});

document.getElementById('register-form').addEventListener('submit', (e) => {
e.preventDefault();
const user = {
id: generateId(),
firstName: document.getElementById('first-name').value,
lastName: document.getElementById('last-name').value,
email: document.getElementById('reg-email').value,
role: document.getElementById('role').value,
avatar: `https://randomuser.me/api/portraits/${Math.random() > 0.5 ? 'men' : 'women'}/${Math.floor(Math.random() * 100)}.jpg`
};
users.push(user);
currentUser = user;
saveData();
document.getElementById('register-page').classList.add('hidden');
document.getElementById('dashboard-page').classList.remove('hidden');
renderTasks();
renderUsers();
renderNotifications();
showToast('Registered', 'success');
});

document.getElementById('dark-mode-toggle').addEventListener('change', () => {
document.documentElement.classList.toggle('dark');
initCharts();
});

document.getElementById('add-task-btn').addEventListener('click', () => {
document.getElementById('task-form').reset();
document.getElementById('task-modal-title').textContent = 'Add Task';
document.getElementById('task-id').value = '';
document.getElementById('task-modal').classList.remove('modal-hidden');
});

document.querySelectorAll('.task-modal-close').forEach(btn => {
btn.addEventListener('click', () => {
document.getElementById('task-modal').classList.add('modal-hidden');
});
});

document.getElementById('task-form').addEventListener('submit', (e) => {
e.preventDefault();
const id = document.getElementById('task-id').value;
const data = {
title: document.getElementById('task-title').value,
description: document.getElementById('task-description').value,
dueDate: document.getElementById('task-due-date').value,
priority: document.getElementById('task-priority').value,
category: document.getElementById('task-category').value
};
if (id) {
updateTask(id, data);
} else {
createTask(data);
}
document.getElementById('task-modal').classList.add('modal-hidden');
});

document.getElementById('tasks-container').addEventListener('click', (e) => {
const taskId = e.target.closest('.task-item')?.dataset.id;
if (!taskId) return;
if (e.target.classList.contains('edit-task-btn')) {
const task = tasks.find(t => t.id === taskId);
document.getElementById('task-id').value = task.id;
document.getElementById('task-title').value = task.title;
document.getElementById('task-description').value = task.description || '';
document.getElementById('task-due-date').value = task.dueDate || '';
document.getElementById('task-priority').value = task.priority;
document.getElementById('task-category').value = task.category;
document.getElementById('task-modal-title').textContent = 'Edit Task';
document.getElementById('task-modal').classList.remove('modal-hidden');
} else if (e.target.classList.contains('delete-task-btn')) {
deleteTask(taskId);
} else if (e.target.classList.contains('task-toggle')) {
toggleTaskCompletion(taskId);
}
});

document.getElementById('tasks-container').addEventListener('change', (e) => {
if (e.target.classList.contains('task-checkbox')) {
const taskId = e.target.closest('.task-item').dataset.id;
if (e.target.checked) {
selectedTasks.add(taskId);
} else {
selectedTasks.delete(taskId);
}
renderTasks();
}
});

document.getElementById('multi-complete-btn').addEventListener('click', () => {
selectedTasks.forEach(id => toggleTaskCompletion(id));
selectedTasks.clear();
renderTasks();
});

document.getElementById('multi-delete-btn').addEventListener('click', () => {
selectedTasks.forEach(id => deleteTask(id));
selectedTasks.clear();
renderTasks();
});

document.getElementById('multi-cancel-btn').addEventListener('click', () => {
selectedTasks.clear();
renderTasks();
});

document.getElementById('manage-categories-btn').addEventListener('click', () => {
document.getElementById('categories-modal').classList.remove('modal-hidden');
});

document.querySelectorAll('.categories-modal-close').forEach(btn => {
btn.addEventListener('click', () => {
document.getElementById('categories-modal').classList.add('modal-hidden');
});
});

document.getElementById('add-category-btn').addEventListener('click', () => {
const category = document.getElementById('new-category').value.trim();
if (category && !categories.includes(category)) {
categories.push(category);
saveData();
renderCategories();
document.getElementById('new-category').value = '';
showToast('Category added', 'success');
} else {
showToast('Invalid or duplicate category', 'error');
}
});

document.getElementById('categories-list').addEventListener('click', (e) => {
if (e.target.classList.contains('delete-category-btn')) {
const category = e.target.dataset.category;
if (tasks.some(t => t.category === category)) {
showToast('Cannot delete category with tasks', 'error');
} else {
categories = categories.filter(c => c !== category);
saveData();
renderCategories();
showToast('Category deleted', 'success');
}
}
});

document.getElementById('manage-users-btn').addEventListener('click', () => {
document.getElementById('users-modal').classList.remove('modal-hidden');
});

document.querySelectorAll('.users-modal-close').forEach(btn => {
btn.addEventListener('click', () => {
document.getElementById('users-modal').classList.add('modal-hidden');
});
});

document.getElementById('add-user-btn').addEventListener('click', () => {
document.getElementById('user-form').reset();
document.getElementById('user-modal-title').textContent = 'Add User';
document.getElementById('user-id').value = '';
document.getElementById('user-modal').classList.remove('modal-hidden');
});

document.getElementById('users-container').addEventListener('click', (e) => {
const id = e.target.closest('button')?.dataset.id;
if (!id) return;
if (e.target.classList.contains('edit-user-btn')) {
const user = users.find(u => u.id === id);
document.getElementById('user-id').value = user.id;
document.getElementById('user-first-name').value = user.firstName;
document.getElementById('user-last-name').value = user.lastName;
document.getElementById('user-email').value = user.email;
document.getElementById('user-role').value = user.role;
document.getElementById('user-modal-title').textContent = 'Edit User';
document.getElementById('user-modal').classList.remove('modal-hidden');
} else if (e.target.classList.contains('delete-user-btn')) {
users = users.filter(u => u.id !== id);
saveData();
renderUsers();
showToast('User deleted', 'success');
}
});

document.querySelectorAll('.user-modal-close').forEach(btn => {
btn.addEventListener('click', () => {
document.getElementById('user-modal').classList.add('modal-hidden');
});
});

document.getElementById('user-form').addEventListener('submit', (e) => {
e.preventDefault();
const id = document.getElementById('user-id').value;
const user = {
id: id || generateId(),
firstName: document.getElementById('user-first-name').value,
lastName: document.getElementById('user-last-name').value,
email: document.getElementById('user-email').value,
role: document.getElementById('user-role').value,
avatar: `https://randomuser.me/api/portraits/${Math.random() > 0.5 ? 'men' : 'women'}/${Math.floor(Math.random() * 100)}.jpg`
};
if (id) {
const index = users.findIndex(u => u.id === id);
users[index] = user;
} else {
users.push(user);
}
saveData();
renderUsers();
document.getElementById('user-modal').classList.add('modal-hidden');
showToast(id ? 'User updated' : 'User added', 'success');
});

document.getElementById('export-btn').addEventListener('click', () => {
document.getElementById('export-modal').classList.remove('modal-hidden');
});

document.querySelectorAll('.export-modal-close').forEach(btn => {
btn.addEventListener('click', () => {
document.getElementById('export-modal').classList.add('modal-hidden');
});
});

document.getElementById('download-btn').addEventListener('click', () => {
exportTasks(document.getElementById('export-format').value);
document.getElementById('export-modal').classList.add('modal-hidden');
showToast('Tasks exported', 'success');
});

document.getElementById('import-btn').addEventListener('click', () => {
document.getElementById('import-modal').classList.remove('modal-hidden');
});

document.querySelectorAll('.import-modal-close').forEach(btn => {
btn.addEventListener('click', () => {
document.getElementById('import-modal').classList.add('modal-hidden');
});
});

document.getElementById('browse-file-btn').addEventListener('click', () => {
document.getElementById('import-file').click();
});

document.getElementById('import-file').addEventListener('change', (e) => {
if (e.target.files[0]) {
importTasks(e.target.files[0]);
document.getElementById('import-modal').classList.add('modal-hidden');
}
});

document.getElementById('import-btn-confirm').addEventListener('click', () => {
document.getElementById('import-modal').classList.add('modal-hidden');
});

document.getElementById('user-avatar').addEventListener('click', () => {
document.getElementById('profile-dropdown').classList.toggle('hidden');
});

document.getElementById('view-profile-btn').addEventListener('click', () => {
document.getElementById('profile-image').src = currentUser.avatar;
document.getElementById('profile-name').textContent = `${currentUser.firstName} ${currentUser.lastName}`;
document.getElementById('profile-role').textContent = currentUser.role;
document.getElementById('profile-email').textContent = currentUser.email;
document.getElementById('profile-role-display').textContent = currentUser.role;
document.getElementById('profile-modal').classList.remove('modal-hidden');
document.getElementById('profile-dropdown').classList.add('hidden');
});

document.querySelectorAll('.profile-modal-close').forEach(btn => {
btn.addEventListener('click', () => {
document.getElementById('profile-modal').classList.add('modal-hidden');
});
});

document.getElementById('logout-btn').addEventListener('click', () => {
currentUser = null;
saveData();
document.getElementById('dashboard-page').classList.add('hidden');
document.getElementById('login-page').classList.remove('hidden');
document.getElementById('profile-dropdown').classList.add('hidden');
showToast('Logged out', 'success');
});

document.getElementById('notification-btn').addEventListener('click', () => {
document.getElementById('notification-dropdown').classList.toggle('hidden');
});

document.getElementById('mark-all-read').addEventListener('click', () => {
notifications.forEach(n => n.read = true);
renderNotifications();
});

document.getElementById('list-view-btn').addEventListener('click', () => {
document.getElementById('tasks-list-view').classList.remove('view-hidden');
document.getElementById('tasks-graph-view').classList.add('view-hidden');
document.getElementById('list-view-btn').classList.add('bg-primary', 'text-white');
document.getElementById('list-view-btn').classList.remove('bg-neutral-200', 'text-neutral-700', 'dark:bg-neutral-700', 'dark:text-neutral-300');
document.getElementById('graph-view-btn').classList.remove('bg-primary', 'text-white');
document.getElementById('graph-view-btn').classList.add('bg-neutral-200', 'text-neutral-700', 'dark:bg-neutral-700', 'dark:text-neutral-300');
});

document.getElementById('graph-view-btn').addEventListener('click', () => {
document.getElementById('tasks-graph-view').classList.remove('view-hidden');
document.getElementById('tasks-list-view').classList.add('view-hidden');
document.getElementById('graph-view-btn').classList.add('bg-primary', 'text-white');
document.getElementById('graph-view-btn').classList.remove('bg-neutral-200', 'text-neutral-700', 'dark:bg-neutral-700', 'dark:text-neutral-300');
document.getElementById('list-view-btn').classList.remove('bg-primary', 'text-white');
document.getElementById('list-view-btn').classList.add('bg-neutral-200', 'text-neutral-700', 'dark:bg-neutral-700', 'dark:text-neutral-300');
});

['search-tasks', 'filter-status', 'filter-category', 'filter-priority', 'sort-by'].forEach(id => {
document.getElementById(id).addEventListener('input', renderTasks);
});

// Initialize
const init = () => {
loadData();
initCharts();
renderCategories();
if (!currentUser) {
document.getElementById('login-page').classList.remove('hidden');
} else {
document.getElementById('dashboard-page').classList.remove('hidden');
renderTasks();
renderUsers();
renderNotifications();
}
if (!users.length) {
for (let i = 0; i < 5; i++) {
users.push({
id: generateId(),
firstName: `User${i + 1}`,
lastName: `Last${i + 1}`,
email: `user${i + 1}@example.com`,
role: ['User', 'Manager', 'Admin'][Math.floor(Math.random() * 3)],
avatar: `https://randomuser.me/api/portraits/${Math.random() > 0.5 ? 'men' : 'women'}/${Math.floor(Math.random() * 100)}.jpg`
});
}
saveData();
renderUsers();
}
flatpickr('#task-due-date', { enableTime: true, dateFormat: 'Y-m-d H:i' });
flatpickr('#birthdate', { dateFormat: 'Y-m-d' });
};

init();
</script>
</body>
</html>
